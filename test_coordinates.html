<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test Coordinates Module</title>
</head>
<body>
    <h1>Testing coordinates.js</h1>

    <input type="text" id="locationSearchInput" placeholder="Ort oder Koordinaten suchen...">
    <button id="saveCurrentLocationBtn">Save Current as Favorite</button>
    <ul id="locationResults" style="border: 1px solid #ccc; list-style: none; padding: 0; display: none;"></ul>

    <script type="module" src="utils.js"></script> 
    <script type="module" src="coordinates.js"></script>

    <script type="module">
        import { initializeLocationSearch } from './coordinates.js';

        // Initialisieren Sie das Modul, damit die Event-Listener aktiv werden.
        initializeLocationSearch();
        console.log("Coordinates module initialized for testing.");

        // 4. Eigener Event-Listener, der auf das Event Ihres Moduls lauscht
        document.addEventListener('location:selected', (event) => {
            console.log("SUCCESS: 'location:selected' event was caught!");
            console.log("Received data:", event.detail);

            // 5. Überprüfung (Assertion)
            const { lat, lng } = event.detail;
            if (lat === 48.1351 && lng === 11.5820) {
                console.log("%cTEST PASSED!", "color: green; font-weight: bold;");
            } else {
                console.error("%cTEST FAILED!", "color: red; font-weight: bold;");
            }
        });

        // --- Test-Simulation ---
        function simulateClickOnSearchResult() {
            console.log("Simulating a click on a search result...");
            const resultsList = document.getElementById('locationResults');
            
            // Erstellen Sie manuell einen Listeneintrag zum Testen
            const testLi = document.createElement('li');
            const nameSpan = document.createElement('span');
            nameSpan.className = 'location-name';
            nameSpan.textContent = "München, Bayern";
            testLi.appendChild(nameSpan);
            
            resultsList.appendChild(testLi);
            
            // Der Klick wird auf dem 'nameSpan' ausgelöst, genau wie im echten Code
            nameSpan.dispatchEvent(new MouseEvent('mousedown', {
                bubbles: true,
                cancelable: true
            }));
        }

        // Führen Sie die Simulation nach kurzer Zeit aus, um sicherzustellen, dass alles geladen ist.
        setTimeout(() => {
            // Um das Event auszulösen, müssen wir die Daten direkt im 'mousedown'-Handler simulieren.
            // Besser: Wir passen den Listener in coordinates.js leicht an, um Testdaten zu verwenden.
            // ODER wir ahmen die Struktur nach, die renderResultsList erzeugt.

            // Holen Sie sich die render-Funktion (Annahme: sie ist jetzt global oder exportiert)
            // oder erstellen Sie das Element manuell wie im echten Code:
            const li = document.createElement('li');
            const nameSpan = document.createElement('span');
            nameSpan.className = 'location-name';
            nameSpan.textContent = "Test Location (München)";
            li.appendChild(nameSpan);

            // Hier ist der entscheidende Teil:
            // Wir fügen den Event-Listener direkt hinzu, anstatt auf die ganze Suchlogik zu warten.
            nameSpan.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const testLat = 48.1351;
                const testLng = 11.5820;

                const selectEvent = new CustomEvent('location:selected', {
                    detail: { lat: testLat, lng: testLng },
                    bubbles: true,
                    cancelable: true
                });
                li.dispatchEvent(selectEvent);
            });
            
            // Simulieren Sie den Klick
            console.log("Simulating a click on the test list item...");
            nameSpan.dispatchEvent(new MouseEvent('mousedown'));

        }, 500);

    </script>
</body>
</html>