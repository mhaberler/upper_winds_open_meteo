var uu=Object.defineProperty;var du=(i,t,a)=>t in i?uu(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a;var Wo=(i,t,a)=>du(i,typeof t!="symbol"?t+"":t,a);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(r){if(r.ep)return;r.ep=!0;const d=a(r);fetch(r.href,d)}})();const l={isInitialized:!1,coordsControl:null,lastMouseLatLng:null,landingWindDir:null,cutAwayMarker:null,cutAwayLat:null,cutAwayLng:null,cutAwayCircle:null,isJumperSeparationManual:!1,weatherData:null,lastModelRun:null,gpxLayer:null,gpxPoints:[],isLoadingGpx:!1,isTrackLoaded:!1,liveMarker:null,jumpMasterLine:null,isPlacingHarp:!1,harpMarker:null,watchId:null,prevLat:null,prevLng:null,prevTime:null,livePositionControl:null,lastLatitude:null,lastLongitude:null,lastDeviceAltitude:null,lastAltitudeAccuracy:null,lastAccuracy:null,lastSpeed:"N/A",lastEffectiveWindUnit:"kt",lastDirection:"N/A",lastTerrainAltitude:"N/A",lastSmoothedSpeedMs:0,map:null,baseMaps:{},lastLat:null,lastLng:null,lastAltitude:null,currentMarker:null,isManualPanning:!1,autoupdateInterval:null,accuracyCircle:null,ensembleModelsData:null,selectedEnsembleModels:[],currentEnsembleScenario:"all_models",ensembleLayerGroup:null,ensembleScenarioCircles:{},heatmapLayer:null,ismapInitialized:!1,hasTileErrorSwitched:!1,isCachingCancelled:!1,jumpVisualizationLayerGroup:null,landingPatternLayerGroup:null,jumpRunTrackLayerGroup:null,labelZoomListener:null},hu="skydiver2025",Go={135:5,130:5,125:5,120:5,115:5,110:5,105:5,100:6,95:7,90:7,85:7,80:8,75:8,70:9,65:10,60:10,55:11,50:12,45:14,40:15,35:17,30:20,25:24,20:30,15:40,10:60,5:119},Ir={LIST:["icon_seamless","icon_global","icon_eu","icon_d2","ecmwf_ifs025","ecmwf_aifs025_single","gfs_seamless","gfs_global","gfs_hrrr","arome_france","gem_hrdps_continental","gem_regional"],API_MAP:{icon_seamless:"dwd_icon",icon_global:"dwd_icon",icon_eu:"dwd_icon_eu",icon_d2:"dwd_icon_d2",ecmwf_ifs025:"ecmwf_ifs025",ecmwf_aifs025_single:"ecmwf_aifs025_single",gfs_seamless:"ncep_gfs013",gfs_global:"ncep_gfs025",gfs_hrrr:"ncep_hrrr_conus",arome_france:"meteofrance_arome_france0025",gem_hrdps_continental:"cmc_gem_hrdps",gem_regional:"cmc_gem_rdps"}},Qe={METERS_TO_FEET:3.28084,FEET_TO_METERS:.3048,KNOTS_TO_MPS:.514444,KNOTS_TO_KMH:1.852,CELSIUS_TO_KELVIN:273.15},Vo={MOLAR_MASS_AIR:.0289644,UNIVERSAL_GAS_CONSTANT:8.31446261815324},_n={LAPSE_RATE:.0065,SEA_LEVEL_TEMP_KELVIN:288.15,GRAVITY:9.80665,GAS_CONSTANT_AIR:287.05},ea={A_LIQUID:17.27,B_LIQUID:237.7,A_ICE:21.87,B_ICE:265.5},fu=6371e3,jo={KNOT_THRESHOLDS:[1,4,7,11,17,22,28,34,41,48,56,64],BEAUFORT_THRESHOLDS:[0,1,3,6,10,16,21,27,33,40,47,55,63]},yi={FORECAST:"https://api.open-meteo.com/v1/forecast",HISTORICAL:"https://historical-forecast-api.open-meteo.com/v1/forecast"},vt={SCENARIO_COLORS:{MIN_WIND:"rgba(0, 0, 255, 0.7)",MEAN_WIND:"rgba(0, 255, 0, 0.7)",MAX_WIND:"rgba(255, 0, 0, 0.7)"},HEATMAP_MIN_RADIUS_PX:5,HEATMAP_MAX_RADIUS_PX:50,HEATMAP_SCALING_BASE:1.42,HEATMAP_BASE_RADIUS:20,HEATMAP_REFERENCE_ZOOM:13},mu=[1e3,950,925,900,850,800,700,600,500,400,300,250,200],Ft=200,ns={OPEN:4.1,PARTIALLY:12.8,COLLAPSED:39.2},pu=150,ta={DEFAULT_AREA_VERTICAL:.5,DEFAULT_AREA_HORIZONTAL:.5,DEFAULT_MASS_KG:80,DEFAULT_DRAG_COEFFICIENT:1},Nn={MIN_TRACK_LENGTH_M:100,MAX_TRACK_LENGTH_M:1e4,MIN_APPROACH_LENGTH_M:100,MAX_APPROACH_LENGTH_M:2e4,APPROACH_TIME_SECONDS:120},wt={MESSAGE_TIMEOUT_MS:3e3,MOBILE_BREAKPOINT_PX:768,DEFAULT_MAP_CENTER:[48.0179,11.1923],DEFAULT_MAP_ZOOM:11,GEOLOCATION_TIMEOUT_MS:2e4,GEOLOCATION_ACCURACY_THRESHOLD_M:100,MIN_ZOOM:11,MAX_ZOOM:14,LANDING_PATTERN_MIN_ZOOM:14},na={MIN_TIME_DIFF_FOR_SPEED_CALC_S:.5,SPEED_SMOOTHING_LOW:.5,SPEED_SMOOTHING_HIGH:.2,SPEED_SMOOTHING_TRESHOLD:25},bi={TILE_MAX_AGE_DAYS:7,FETCH_TIMEOUT_MS:15e3,SIZE_LIMIT_MB_WARNING:500},Is={DEFAULT_MARKER:"favicon.ico",CUTAWAY_MARKER:"schere_purple.png",AIRPLANE_MARKER:"airplane_orange.png"},Dr=()=>g.getValue("interpStepSelect","select",200),g={FEATURE_PASSWORD:"skydiver2025",defaultSettings:{model:"icon_global",refLevel:"AGL",heightUnit:"m",temperatureUnit:"C",windUnit:"kt",timeZone:"Z",coordFormat:"Decimal",downloadFormat:"HEIDIS",showTable:!1,canopySpeed:20,descentRate:3.5,showLandingPattern:!1,landingDirection:"LL",customLandingDirectionLL:"",customLandingDirectionRR:"",legHeightDownwind:300,legHeightBase:200,legHeightFinal:100,interpStep:"200",lowerLimit:0,upperLimit:3e3,baseMaps:"Esri Street",calculateJump:!0,openingAltitude:1200,exitAltitude:3e3,showJumpRunTrack:!1,showExitArea:!1,showCanopyArea:!1,jumpRunTrackOffset:0,jumpRunTrackForwardOffset:0,aircraftSpeedKt:90,jumperSeparation:5,numberOfJumpers:5,cutAwayAltitude:1e3,cutAwayState:"Partially",trackPosition:!1,showJumpMasterLine:!1,jumpMasterLineTarget:"DIP",harpLat:null,harpLng:null,cacheRadiusKm:10,cacheZoomLevels:[11,12,13,14],autoupdate:!1,selectedEnsembleModels:[],currentEnsembleScenario:"all_models"},state:{userSettings:null,unlockedFeatures:{landingPattern:!1,calculateJump:!1},isJumperSeparationManual:!1,isLandingPatternUnlocked:!1,isCalculateJumpUnlocked:!1},initialize(){let i={},t={landingPattern:!1,calculateJump:!1};try{const s=localStorage.getItem("upperWindsSettings");s?(i=JSON.parse(s),console.log("Loaded settings from localStorage:",i)):console.log("No settings found in localStorage, using defaults")}catch(s){this.handleError(s,"Failed to load settings. Using defaults.")}try{const s=localStorage.getItem("unlockedFeatures");s?(t=JSON.parse(s),console.log("Loaded unlocked features from localStorage:",t)):console.log("No unlocked features found in localStorage, using defaults")}catch(s){this.handleError(s,"Failed to load unlocked features. Using defaults.")}this.state.userSettings={...this.defaultSettings,...i},console.log("Initialized userSettings:",this.state.userSettings),this.state.userSettings.harpLat=null,this.state.userSettings.harpLng=null,console.log("Reset HARP coordinates to null at startup"),this.state.userSettings.jumpMasterLineTarget==="HARP"&&(console.log("Reset jumpMasterLineTarget to DIP due to cleared HARP coordinates"),this.state.userSettings.jumpMasterLineTarget="DIP"),this.state.userSettings.selectedEnsembleModels=[...this.defaultSettings.selectedEnsembleModels],this.state.userSettings.currentEnsembleScenario=this.defaultSettings.currentEnsembleScenario,this.state.unlockedFeatures={landingPattern:t.landingPattern||!1,calculateJump:t.calculateJump||!1},["OpenStreetMap","OpenTopoMap","Esri Satellite","Esri Street","Esri Topo","Esri Satellite + OSM"].includes(this.state.userSettings.baseMaps)||(console.warn(`Invalid baseMaps setting: ${this.state.userSettings.baseMaps}, resetting to default`),this.state.userSettings.baseMaps=this.defaultSettings.baseMaps)},save(){const i={...this.state.userSettings};delete i.customJumpRunDirection;try{localStorage.setItem("upperWindsSettings",JSON.stringify(i)),console.log("Settings saved to localStorage:",i)}catch(t){console.error("Failed to save settings to localStorage:",t)}},saveUnlockStatus(i,t){try{i==="landingPattern"?(this.state.unlockedFeatures.landingPattern=t,this.state.isLandingPatternUnlocked=t):i==="calculateJump"&&(this.state.unlockedFeatures.calculateJump=t,this.state.isCalculateJumpUnlocked=t),this.saveUnlockedFeatures(),console.log("Saved unlock status:",{landingPattern:this.state.isLandingPatternUnlocked,calculateJump:this.state.isCalculateJumpUnlocked})}catch{Utils.handleError("Failed to save unlock status.")}},showPasswordModal(i,t,a){console.log("Entering showPasswordModal for feature:",i);const s=document.getElementById("passwordModal"),r=document.getElementById("passwordInput"),d=document.getElementById("passwordError"),c=document.getElementById("passwordSubmit"),h=document.getElementById("passwordCancel"),m=document.getElementById("modalHeader"),p=document.getElementById("modalMessage");if(!s||!r||!c||!h||!m||!p){console.error("Modal elements not found:",{modal:s,input:r,submitBtn:c,cancelBtn:h,header:m,message:p});return}const y=i==="landingPattern"?"Landing Pattern":"Calculate Jump";m.textContent=`${y} Access`,p.textContent=`Please enter the password to enable ${y.toLowerCase()}:`,r.value="",d.style.display="none",s.style.display="flex",console.log("Password modal should now be visible:",{modalDisplay:s.style.display});const v=()=>{if(console.log("Password modal submit clicked, entered value:",r.value),r.value===hu){if(s.style.display="none",this.saveUnlockStatus(i,!0),i==="landingPattern"){const w=document.getElementById("showLandingPattern");w&&(w.style.opacity="1",w.title="")}else if(i==="calculateJump"){const w=document.querySelector('.menu-label[data-label="calculateJump"]');w&&(w.style.opacity="1",w.title="")}console.log("Feature unlocked:",i),t()}else d.textContent="Incorrect password",d.style.display="block",console.log("Incorrect password entered")};c.onclick=v,r.onkeypress=w=>{w.key==="Enter"&&v()},h.onclick=()=>{s.style.display="none",console.log("Password modal cancelled"),a()}},saveUnlockedFeatures(){try{const i=JSON.stringify(this.state.unlockedFeatures);localStorage.setItem("unlockedFeatures",i),console.log("Unlocked features saved:",JSON.parse(i))}catch(i){this.handleError(i,"Failed to save unlocked features to localStorage.")}},getValue(i,t="radio",a){const s=t==="radio"?`input[name="${i}"]:checked`:`#${i}`,r=document.querySelector(s);if(!r)return console.warn(`Setting element not found: ${s}`),a;const d=r.value;return console.log(`Retrieved setting ${i}: ${d}`),d},updateUnitLabels(){const i=this.getValue("heightUnit","radio","m"),t=this.getValue("windUnit","radio","kt"),a=this.getValue("refLevel","radio","AGL"),s=document.querySelector('#controls-row label[for="interpStepSelect"]');s&&(s.textContent=`Step (${i}):`,console.log(`Updated step label to: Step (${i})`));const r=document.querySelector('label[for="lowerLimit"]'),d=document.querySelector('label[for="upperLimit"]');r&&(r.textContent=`Lower Limit (${i}):`,console.log(`Updated lower limit label to: Lower Limit (${i})`)),d&&(d.textContent=`Upper Limit (${i}):`,console.log(`Updated upper limit label to: Upper Limit (${i})`));const c=document.getElementById("meanWindResult");if(c!=null&&c.innerHTML){let h=c.innerHTML;const m=/\((\d+)-(\d+) m\b[^)]*\)/;if(m.test(h)){const[y,v,w]=h.match(m),S=this.convertHeight(parseFloat(v),i),E=this.convertHeight(parseFloat(w),i);h=h.replace(m,`(${Math.round(S)}-${Math.round(E)} ${i} ${a})`),console.log(`Updated mean wind height: (${Math.round(S)}-${Math.round(E)} ${i} ${a})`)}const p=/: (\d+(?:\.\d+)?)\s*([a-zA-Z\/]+)$/;if(p.test(h)){const[y,v,w]=h.match(p),S=parseFloat(v);if(!isNaN(S)){const E=this.convertWind(S,t,w),P=E==="N/A"?"N/A":t==="bft"?Math.round(E):E.toFixed(1);h=h.replace(p,`: ${P} ${t}`),console.log(`Updated mean wind speed: ${P} ${t}`)}}c.innerHTML=h}},updateModelRunInfo(i,t,a){const s=document.getElementById("modelLabel"),r=document.getElementById("modelSelect");if(!s||!r){console.warn("Model run info elements missing:",{modelLabel:s,modelSelect:r,lastModelRun:i,lastLat:t,lastLng:a});return}if(!i){console.log("lastModelRun is falsy, setting default model run info:",{lastModelRun:i,lastLat:t,lastLng:a}),s.title=`Model: ${r.value.replace("_"," ").toUpperCase()}
Run: Not available`;return}const d=r.value,c=`Model: ${d.replace("_"," ").toUpperCase()}
Run: ${i}`;s.title=c,console.log(`Updated model run info: ${c}`,{lastModelRun:i,model:d,lastLat:t,lastLng:a})},handleError(i,t="An error occurred. Please try again."){console.error("Settings Error:",i),Utils.handleError(t)},convertHeight(i,t){return isNaN(i)?i:t==="ft"?i*3.28084:i},convertWind(i,t,a){var r,d;return isNaN(i)?"N/A":((d=(r={kt:{"m/s":c=>c*.514444,"km/h":c=>c*1.852,mph:c=>c*1.15078,bft:c=>this.ktToBeaufort(c)},"m/s":{kt:c=>c/.514444,"km/h":c=>c*3.6,mph:c=>c*2.23694,bft:c=>this.ktToBeaufort(c/.514444)}}[a])==null?void 0:r[t])==null?void 0:d.call(r,i))||i},ktToBeaufort(i){return i<1?0:i<=3?1:i<=6?2:i<=10?3:i<=16?4:i<=21?5:i<=27?6:i<=33?7:i<=40?8:i<=47?9:i<=55?10:i<=63?11:12},isFeatureUnlocked(i){return!!this.state.unlockedFeatures[i]}};function Nr(i){const t=g.state.userSettings.exitAltitude*Qe.METERS_TO_FEET,a=b.calculateTAS(i,t);if(a==="N/A")return console.warn("TAS calculation failed, using default separation"),g.defaultSettings.jumperSeparation;const s=Object.keys(Go).map(Number).sort((c,h)=>h-c);let r=s[0];for(const c of s)if(a<=c)r=c;else break;return Go[r]||7}function Or(i,t,a,s,r,d,c){if(!i||!i.time||!s||s.length===0||!Number.isFinite(r)||!Number.isFinite(d)||!Number.isFinite(c))return null;const h=c+t,m=c+a-Ft,p=ya(s),y=p?p.direction:0,v=g.state.userSettings.aircraftSpeedKt,w=t/.3048,S=b.calculateTAS(v,w);let E=S==="N/A"?v*Qe.KNOTS_TO_MPS:S*Qe.KNOTS_TO_MPS;const P=Math.cos(y*Math.PI/180)*E,x=Math.sin(y*Math.PI/180)*E,A=s.map(F=>F.height),O=s.map(F=>Number.isFinite(F.dir)?parseFloat(F.dir):0),z=s.map(F=>b.convertWind(parseFloat(F.spd)||0,"m/s","km/h")),I=s.map(F=>F.temp),B=[{time:0,height:h,vz:0,vxGround:P,vyGround:x,x:0,y:0}],H=i.surface_pressure[0]||1013.25;let $=B[0];for(;$.height>m;){const F=b.linearInterpolate(A,O,$.height),R=b.linearInterpolate(A,z,$.height),ie=b.linearInterpolate(A,I,$.height)+Qe.CELSIUS_TO_KELVIN,be=_n.GAS_CONSTANT_AIR,te=.5,ae=H*100*Math.exp(-9.80665*($.height-c)/(be*ie))/(be*ie),W=(F+180)%360,ee=R*Math.cos(W*Math.PI/180),J=R*Math.sin(W*Math.PI/180),Z=$.vxGround-ee,ne=$.vyGround-J,V=Math.sqrt(Z*Z+ne*ne),le=1,Y=ta.DEFAULT_AREA_VERTICAL,j=ta.DEFAULT_MASS_KG,fe=ta.DEFAULT_DRAG_COEFFICIENT,X=ta.DEFAULT_AREA_HORIZONTAL,de=.5*le*Y*ae/j,we=.5*fe*X*ae/j,re=-9.80665-de*$.vz*Math.abs($.vz),Le=-we*V*Z,Ee=-we*V*ne;let pe=$.height+$.vz*te,me=$.vz+re*te,ce=$.time+te;if(pe<=m){const ye=($.height-m)/($.height-pe);ce=$.time+te*ye,pe=m,me=$.vz+re*te*ye}const De={time:ce,height:pe,vz:me,vxGround:P===0?ee:$.vxGround+Le*te,vyGround:x===0?J:$.vyGround+Ee*te,x:$.x+(P===0?ee:$.vxGround)*te,y:$.y+(x===0?J:$.vyGround)*te};if(B.push(De),$=De,De.height===m)break}const M=B[B.length-1],k=Math.sqrt(M.x*M.x+M.y*M.y);let D=Math.atan2(M.y,M.x)*180/Math.PI;return D=(D+360)%360,{time:M.time,distance:k,directionDeg:D,path:B.map(F=>({latLng:b.calculateNewCenter(r,d,Math.sqrt(F.x*F.x+F.y*F.y),Math.atan2(F.y,F.x)*180/Math.PI),height:F.height,time:F.time}))}}function Fr(i){var k,D,F,R,G;if(!g.state.userSettings.showExitArea||!g.state.userSettings.calculateJump||!l.weatherData||!l.lastLat||!l.lastLng||!i||i.length===0)return null;const t=parseInt((k=document.getElementById("exitAltitude"))==null?void 0:k.value)||3e3,a=parseInt((D=document.getElementById("openingAltitude"))==null?void 0:D.value)||1200,s=parseInt((F=document.getElementById("legHeightDownwind"))==null?void 0:F.value)||300,r=parseFloat((R=document.getElementById("descentRate"))==null?void 0:R.value)||3.5,d=(parseFloat((G=document.getElementById("canopySpeed"))==null?void 0:G.value)||20)*Qe.KNOTS_TO_MPS,c=i.map(ie=>ie.height),h=i.map(ie=>-b.convertWind(ie.spd,"m/s","km/h")*Math.sin(ie.dir*Math.PI/180)),m=i.map(ie=>-b.convertWind(ie.spd,"m/s","km/h")*Math.cos(ie.dir*Math.PI/180)),p=Math.round(l.lastAltitude),y=(a-Ft-s)/r,v=y*d,w=(a-Ft)/r,S=w*d,E=b.calculateMeanWind(c,h,m,p+s,p+a-Ft),P=b.calculateMeanWind(c,h,m,p,p+a-Ft),x=Rr(l.lastLat,l.lastLng,i);let{downwindLat:A,downwindLng:O}=x;Number.isFinite(A)||(A=l.lastLat,O=l.lastLng);const z=b.calculateNewCenter(A,O,E[1]*y,E[0]),I=b.calculateNewCenter(l.lastLat,l.lastLng,P[1]*w,P[0]),B=Or(l.weatherData,t,a,i,l.lastLat,l.lastLng,p);if(!B)return null;const H=(B.directionDeg+180)%360,$=b.calculateNewCenter(I[0],I[1],B.distance,H),M=b.calculateNewCenter(z[0],z[1],B.distance,H);return{greenLat:$[0],greenLng:$[1],darkGreenLat:M[0],darkGreenLng:M[1],greenRadius:S,darkGreenRadius:v,freeFallDirection:B.directionDeg,freeFallDistance:B.distance,freeFallTime:B.time}}function Gt(i){if(!l.map||l.cutAwayLat===null||l.cutAwayLng===null||!l.weatherData||l.lastAltitude==="N/A"||!i||i.length===0)return null;const t=Math.round(l.lastAltitude),a=g.state.userSettings.cutAwayAltitude,s=t,r=t+a,d=i.map(I=>I.height),c=i.map(I=>-b.convertWind(I.spd,"m/s","km/h")*Math.sin(I.dir*Math.PI/180)),h=i.map(I=>-b.convertWind(I.spd,"m/s","km/h")*Math.cos(I.dir*Math.PI/180)),m=b.calculateMeanWind(d,c,h,s,r);if(!m)return null;const[p,y]=m,v={Open:ns.OPEN,Partially:ns.PARTIALLY,Collapsed:ns.COLLAPSED},w=v[g.state.userSettings.cutAwayState]||v.Partially,S=a/w,E=y*S,P=(p+180)%360,[x,A]=b.calculateNewCenter(l.cutAwayLat,l.cutAwayLng,E,P),z=`<b>Cut-Away (${g.state.userSettings.cutAwayState.replace(/([A-Z])/g," $1").trim()})</b><br>Cut-Away Altitude: ${a} m<br>Displacement: ${p.toFixed(0)}°, ${E.toFixed(0)} m<br>Descent Time/Speed: ${S.toFixed(0)} s at ${w.toFixed(1)} m/s<br>`;return{center:[x,A],radius:pu,tooltipContent:z}}function gu(i){var F,R,G,ie,be;if(!g.state.userSettings.showCanopyArea||!g.state.userSettings.calculateJump||!l.weatherData||!l.lastLat||!l.lastLng||!i||i.length===0)return null;const t=parseInt((F=document.getElementById("exitAltitude"))==null?void 0:F.value)||3e3,a=parseInt((R=document.getElementById("openingAltitude"))==null?void 0:R.value)||1200,s=parseInt((G=document.getElementById("legHeightDownwind"))==null?void 0:G.value)||300,r=parseFloat((ie=document.getElementById("descentRate"))==null?void 0:ie.value)||3.5,d=(parseFloat((be=document.getElementById("canopySpeed"))==null?void 0:be.value)||20)*Qe.KNOTS_TO_MPS,c=i.map(te=>te.height),h=i.map(te=>-b.convertWind(te.spd,"m/s","km/h")*Math.sin(te.dir*Math.PI/180)),m=i.map(te=>-b.convertWind(te.spd,"m/s","km/h")*Math.cos(te.dir*Math.PI/180)),p=Math.round(l.lastAltitude),y=(a-Ft-s)/r,v=y*d,w=(a-Ft)/r,S=w*d,E=b.calculateMeanWind(c,h,m,p+s,p+a-Ft),P=b.calculateMeanWind(c,h,m,p,p+a-Ft),x=Or(l.weatherData,t,a,i,l.lastLat,l.lastLng,p);if(!x)return null;const A=Rr(l.lastLat,l.lastLng,i);let{downwindLat:O,downwindLng:z}=A;Number.isFinite(O)||(O=l.lastLat,z=l.lastLng);const I=p+a-Ft,B=p+s,H=[],$=[],M=[],k=[];let D=I-B<=1e3?200:500;for(let te=I;te>=B+200;te-=D){const ae=(te-B)/r,W=ae*d;if(W>0){const ee=b.calculateMeanWind(c,h,m,B,te);H.push(W),$.push(ee[1]*ae),M.push(ee[0]),k.push(te-p)}}return{blueLat:O,blueLng:z,redLat:l.lastLat,redLng:l.lastLng,radius:v,radiusFull:S,additionalBlueRadii:H,additionalBlueDisplacements:$,additionalBlueDirections:M,additionalBlueUpperLimits:k,displacement:E[1]*y,direction:E[0],displacementFull:P[1]*w,directionFull:P[0],meanWindForFullCanopyDir:P[0],meanWindForFullCanopySpeedMps:P[1],freeFallDirection:x.directionDeg,freeFallDistance:x.distance,freeFallTime:x.time}}function ya(i){var D,F;if(!l.weatherData||!l.lastLat||!l.lastLng||l.lastAltitude==="N/A"||!i||i.length===0)return null;const t=parseInt((D=document.getElementById("openingAltitude"))==null?void 0:D.value)||1e3,a=Math.round(l.lastAltitude),s=i.map(R=>R.height),r=i.map(R=>-b.convertWind(R.spd,"m/s","km/h")*Math.sin(R.dir*Math.PI/180)),d=i.map(R=>-b.convertWind(R.spd,"m/s","km/h")*Math.cos(R.dir*Math.PI/180)),c=b.calculateMeanWind(s,r,d,a,a+t);if(!c)return null;let h=Math.round(c[0]);const m=parseFloat(g.state.userSettings.customJumpRunDirection);Number.isFinite(m)&&m>=0&&m<=359&&(h=m);const p=parseInt((F=document.getElementById("exitAltitude"))==null?void 0:F.value)||3e3,y=a+p,v=b.calculateTAS(g.state.userSettings.aircraftSpeedKt||90,y/.3048);let w=null,S=2e3,E=2e3,P=null;if(v!=="N/A"&&Number.isFinite(v)){const R=b.linearInterpolate(s.map(Z=>Z-a),i.map(Z=>Z.dir),p),G=b.linearInterpolate(s.map(Z=>Z-a),i.map(Z=>b.convertWind(Z.spd,"m/s","km/h")),p),ie=v*Qe.KNOTS_TO_MPS,be=(R+180)*Math.PI/180,te=G*Math.sin(be),ae=G*Math.cos(be),W=h*Math.PI/180,ee=ie*Math.sin(W),J=ie*Math.cos(W);w=Math.sqrt(Math.pow(ee+te,2)+Math.pow(J+ae,2)),S=Math.max(Nn.MIN_TRACK_LENGTH_M,Math.min(Nn.MAX_TRACK_LENGTH_M,Math.round((g.state.userSettings.numberOfJumpers||10)*(g.state.userSettings.jumperSeparation||5)*w))),E=Math.max(Nn.MIN_APPROACH_LENGTH_M,Math.min(Nn.MAX_APPROACH_LENGTH_M,Math.round(w*Nn.APPROACH_TIME_SECONDS)))}const x=g.state.userSettings.jumpRunTrackOffset||0,A=g.state.userSettings.jumpRunTrackForwardOffset||0,O=(Math.atan2(x,A)*180/Math.PI+360)%360,z=Math.sqrt(x**2+A**2),I=(h+O+360)%360,[B,H]=b.calculateNewCenter(l.lastLat,l.lastLng,z,I),$=S/2,M=b.calculateNewCenter(B,H,$,(h+180)%360),k=b.calculateNewCenter(B,H,$,h);if(w){const R=b.calculateNewCenter(M[0],M[1],E,(h+180)%360);P=[M,R]}return{direction:h,trackLength:S,meanWindDirection:c[0],meanWindSpeed:c[1],latlngs:[M,k],approachLatLngs:P,approachLength:E,approachTime:Nn.APPROACH_TIME_SECONDS}}function Rr(i,t,a){var F,R;if(!a||a.length===0)return{downwindLat:i,downwindLng:t};const s=parseInt(document.getElementById("canopySpeed").value)||20,r=parseFloat(document.getElementById("descentRate").value)||3.5,d=parseInt(document.getElementById("legHeightFinal").value)||100,c=parseInt(document.getElementById("legHeightBase").value)||200,h=parseInt(document.getElementById("legHeightDownwind").value)||300,m=Math.round(l.lastAltitude),p=a.map(G=>G.height),y=a.map(G=>-b.convertWind(G.spd,"kt","km/h")*Math.sin(G.dir*Math.PI/180)),v=a.map(G=>-b.convertWind(G.spd,"kt","km/h")*Math.cos(G.dir*Math.PI/180)),w=((F=document.querySelector('input[name="landingDirection"]:checked'))==null?void 0:F.value)||"LL",S=parseInt((R=document.getElementById(w==="LL"?"customLandingDirectionLL":"customLandingDirectionRR"))==null?void 0:R.value,10);let E=Number.isFinite(S)?S:Number.isFinite(l.landingWindDir)?l.landingWindDir:a[0].dir;const P=(G,ie,be,te,ae)=>{const ee=te*Qe.KNOTS_TO_MPS*ae,[J,Z]=b.calculateNewCenter(G,ie,ee,be);return[J,Z]},x=b.calculateMeanWind(p,y,v,m,m+d),A=(E+180)%360,O=b.calculateGroundSpeed(s,b.calculateWindComponents(x[1],b.calculateWindAngle(A,x[0])).headwind),z=P(i,t,A,O,d/r),I=b.calculateMeanWind(p,y,v,m+d,m+c),B=(E+(w==="LL"?90:-90)+360)%360,H=b.calculateCourseFromHeading(B,I[0],I[1],s),$=P(z[0],z[1],(H.trueCourse+180)%360,H.groundSpeed,(c-d)/r),M=b.calculateMeanWind(p,y,v,m+c,m+h),k=b.calculateGroundSpeed(s,b.calculateWindComponents(M[1],b.calculateWindAngle(E,M[0])).headwind),D=P($[0],$[1],E,k,(h-c)/r);return{downwindLat:D[0],downwindLng:D[1]}}class wn extends Error{}class _u extends wn{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class yu extends wn{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class vu extends wn{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class Bn extends wn{}class zr extends wn{constructor(t){super(`Invalid unit ${t}`)}}class et extends wn{}class Xt extends wn{constructor(){super("Zone is an abstract class")}}const q="numeric",xt="short",ut="long",ha={year:q,month:q,day:q},$r={year:q,month:xt,day:q},wu={year:q,month:xt,day:q,weekday:xt},Br={year:q,month:ut,day:q},Ur={year:q,month:ut,day:q,weekday:ut},Hr={hour:q,minute:q},Zr={hour:q,minute:q,second:q},Wr={hour:q,minute:q,second:q,timeZoneName:xt},Gr={hour:q,minute:q,second:q,timeZoneName:ut},Vr={hour:q,minute:q,hourCycle:"h23"},jr={hour:q,minute:q,second:q,hourCycle:"h23"},Jr={hour:q,minute:q,second:q,hourCycle:"h23",timeZoneName:xt},qr={hour:q,minute:q,second:q,hourCycle:"h23",timeZoneName:ut},Kr={year:q,month:q,day:q,hour:q,minute:q},Yr={year:q,month:q,day:q,hour:q,minute:q,second:q},Xr={year:q,month:xt,day:q,hour:q,minute:q},Qr={year:q,month:xt,day:q,hour:q,minute:q,second:q},Lu={year:q,month:xt,day:q,weekday:xt,hour:q,minute:q},el={year:q,month:ut,day:q,hour:q,minute:q,timeZoneName:xt},tl={year:q,month:ut,day:q,hour:q,minute:q,second:q,timeZoneName:xt},nl={year:q,month:ut,day:q,weekday:ut,hour:q,minute:q,timeZoneName:ut},il={year:q,month:ut,day:q,weekday:ut,hour:q,minute:q,second:q,timeZoneName:ut};class Mi{get type(){throw new Xt}get name(){throw new Xt}get ianaName(){return this.name}get isUniversal(){throw new Xt}offsetName(t,a){throw new Xt}formatOffset(t,a){throw new Xt}offset(t){throw new Xt}equals(t){throw new Xt}get isValid(){throw new Xt}}let is=null;class va extends Mi{static get instance(){return is===null&&(is=new va),is}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:a,locale:s}){return ml(t,a,s)}formatOffset(t,a){return _i(this.offset(t),a)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}const ys=new Map;function Su(i){let t=ys.get(i);return t===void 0&&(t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:i,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),ys.set(i,t)),t}const bu={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Mu(i,t){const a=i.format(t).replace(/\u200E/g,""),s=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(a),[,r,d,c,h,m,p,y]=s;return[c,r,d,h,m,p,y]}function Tu(i,t){const a=i.formatToParts(t),s=[];for(let r=0;r<a.length;r++){const{type:d,value:c}=a[r],h=bu[d];d==="era"?s[h]=c:he(h)||(s[h]=parseInt(c,10))}return s}const as=new Map;class Jt extends Mi{static create(t){let a=as.get(t);return a===void 0&&as.set(t,a=new Jt(t)),a}static resetCache(){as.clear(),ys.clear()}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=Jt.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:a,locale:s}){return ml(t,a,s,this.name)}formatOffset(t,a){return _i(this.offset(t),a)}offset(t){if(!this.valid)return NaN;const a=new Date(t);if(isNaN(a))return NaN;const s=Su(this.name);let[r,d,c,h,m,p,y]=s.formatToParts?Tu(s,a):Mu(s,a);h==="BC"&&(r=-Math.abs(r)+1);const w=La({year:r,month:d,day:c,hour:m===24?0:m,minute:p,second:y,millisecond:0});let S=+a;const E=S%1e3;return S-=E>=0?E:1e3+E,(w-S)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let Jo={};function Eu(i,t={}){const a=JSON.stringify([i,t]);let s=Jo[a];return s||(s=new Intl.ListFormat(i,t),Jo[a]=s),s}const vs=new Map;function ws(i,t={}){const a=JSON.stringify([i,t]);let s=vs.get(a);return s===void 0&&(s=new Intl.DateTimeFormat(i,t),vs.set(a,s)),s}const Ls=new Map;function ku(i,t={}){const a=JSON.stringify([i,t]);let s=Ls.get(a);return s===void 0&&(s=new Intl.NumberFormat(i,t),Ls.set(a,s)),s}const Ss=new Map;function Pu(i,t={}){const{base:a,...s}=t,r=JSON.stringify([i,s]);let d=Ss.get(r);return d===void 0&&(d=new Intl.RelativeTimeFormat(i,t),Ss.set(r,d)),d}let di=null;function xu(){return di||(di=new Intl.DateTimeFormat().resolvedOptions().locale,di)}const bs=new Map;function al(i){let t=bs.get(i);return t===void 0&&(t=new Intl.DateTimeFormat(i).resolvedOptions(),bs.set(i,t)),t}const Ms=new Map;function Au(i){let t=Ms.get(i);if(!t){const a=new Intl.Locale(i);t="getWeekInfo"in a?a.getWeekInfo():a.weekInfo,"minimalDays"in t||(t={...sl,...t}),Ms.set(i,t)}return t}function Cu(i){const t=i.indexOf("-x-");t!==-1&&(i=i.substring(0,t));const a=i.indexOf("-u-");if(a===-1)return[i];{let s,r;try{s=ws(i).resolvedOptions(),r=i}catch{const m=i.substring(0,a);s=ws(m).resolvedOptions(),r=m}const{numberingSystem:d,calendar:c}=s;return[r,d,c]}}function Iu(i,t,a){return(a||t)&&(i.includes("-u-")||(i+="-u"),a&&(i+=`-ca-${a}`),t&&(i+=`-nu-${t}`)),i}function Du(i){const t=[];for(let a=1;a<=12;a++){const s=se.utc(2009,a,1);t.push(i(s))}return t}function Nu(i){const t=[];for(let a=1;a<=7;a++){const s=se.utc(2016,11,13+a);t.push(i(s))}return t}function ia(i,t,a,s){const r=i.listingMode();return r==="error"?null:r==="en"?a(t):s(t)}function Ou(i){return i.numberingSystem&&i.numberingSystem!=="latn"?!1:i.numberingSystem==="latn"||!i.locale||i.locale.startsWith("en")||al(i.locale).numberingSystem==="latn"}class Fu{constructor(t,a,s){this.padTo=s.padTo||0,this.floor=s.floor||!1;const{padTo:r,floor:d,...c}=s;if(!a||Object.keys(c).length>0){const h={useGrouping:!1,...s};s.padTo>0&&(h.minimumIntegerDigits=s.padTo),this.inf=ku(t,h)}}format(t){if(this.inf){const a=this.floor?Math.floor(t):t;return this.inf.format(a)}else{const a=this.floor?Math.floor(t):Rs(t,3);return Ge(a,this.padTo)}}}class Ru{constructor(t,a,s){this.opts=s,this.originalZone=void 0;let r;if(this.opts.timeZone)this.dt=t;else if(t.zone.type==="fixed"){const c=-1*(t.offset/60),h=c>=0?`Etc/GMT+${c}`:`Etc/GMT${c}`;t.offset!==0&&Jt.create(h).valid?(r=h,this.dt=t):(r="UTC",this.dt=t.offset===0?t:t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone)}else t.zone.type==="system"?this.dt=t:t.zone.type==="iana"?(this.dt=t,r=t.zone.name):(r="UTC",this.dt=t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone);const d={...this.opts};d.timeZone=d.timeZone||r,this.dtf=ws(a,d)}format(){return this.originalZone?this.formatToParts().map(({value:t})=>t).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const t=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?t.map(a=>{if(a.type==="timeZoneName"){const s=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...a,value:s}}else return a}):t}resolvedOptions(){return this.dtf.resolvedOptions()}}class zu{constructor(t,a,s){this.opts={style:"long",...s},!a&&hl()&&(this.rtf=Pu(t,s))}format(t,a){return this.rtf?this.rtf.format(t,a):od(a,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,a){return this.rtf?this.rtf.formatToParts(t,a):[]}}const sl={firstDay:1,minimalDays:4,weekend:[6,7]};class Ae{static fromOpts(t){return Ae.create(t.locale,t.numberingSystem,t.outputCalendar,t.weekSettings,t.defaultToEN)}static create(t,a,s,r,d=!1){const c=t||Ue.defaultLocale,h=c||(d?"en-US":xu()),m=a||Ue.defaultNumberingSystem,p=s||Ue.defaultOutputCalendar,y=Es(r)||Ue.defaultWeekSettings;return new Ae(h,m,p,y,c)}static resetCache(){di=null,vs.clear(),Ls.clear(),Ss.clear(),bs.clear(),Ms.clear()}static fromObject({locale:t,numberingSystem:a,outputCalendar:s,weekSettings:r}={}){return Ae.create(t,a,s,r)}constructor(t,a,s,r,d){const[c,h,m]=Cu(t);this.locale=c,this.numberingSystem=a||h||null,this.outputCalendar=s||m||null,this.weekSettings=r,this.intl=Iu(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=d,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Ou(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),a=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&a?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Ae.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,Es(t.weekSettings)||this.weekSettings,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,a=!1){return ia(this,t,_l,()=>{const s=a?{month:t,day:"numeric"}:{month:t},r=a?"format":"standalone";return this.monthsCache[r][t]||(this.monthsCache[r][t]=Du(d=>this.extract(d,s,"month"))),this.monthsCache[r][t]})}weekdays(t,a=!1){return ia(this,t,wl,()=>{const s=a?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},r=a?"format":"standalone";return this.weekdaysCache[r][t]||(this.weekdaysCache[r][t]=Nu(d=>this.extract(d,s,"weekday"))),this.weekdaysCache[r][t]})}meridiems(){return ia(this,void 0,()=>Ll,()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[se.utc(2016,11,13,9),se.utc(2016,11,13,19)].map(a=>this.extract(a,t,"dayperiod"))}return this.meridiemCache})}eras(t){return ia(this,t,Sl,()=>{const a={era:t};return this.eraCache[t]||(this.eraCache[t]=[se.utc(-40,1,1),se.utc(2017,1,1)].map(s=>this.extract(s,a,"era"))),this.eraCache[t]})}extract(t,a,s){const r=this.dtFormatter(t,a),d=r.formatToParts(),c=d.find(h=>h.type.toLowerCase()===s);return c?c.value:null}numberFormatter(t={}){return new Fu(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,a={}){return new Ru(t,this.intl,a)}relFormatter(t={}){return new zu(this.intl,this.isEnglish(),t)}listFormatter(t={}){return Eu(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||al(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:fl()?Au(this.locale):sl}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let ss=null;class st extends Mi{static get utcInstance(){return ss===null&&(ss=new st(0)),ss}static instance(t){return t===0?st.utcInstance:new st(t)}static parseSpecifier(t){if(t){const a=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(a)return new st(Sa(a[1],a[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${_i(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${_i(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,a){return _i(this.fixed,a)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class $u extends Mi{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function an(i,t){if(he(i)||i===null)return t;if(i instanceof Mi)return i;if(Gu(i)){const a=i.toLowerCase();return a==="default"?t:a==="local"||a==="system"?va.instance:a==="utc"||a==="gmt"?st.utcInstance:st.parseSpecifier(a)||Jt.create(i)}else return sn(i)?st.instance(i):typeof i=="object"&&"offset"in i&&typeof i.offset=="function"?i:new $u(i)}const Ds={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},qo={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Bu=Ds.hanidec.replace(/[\[|\]]/g,"").split("");function Uu(i){let t=parseInt(i,10);if(isNaN(t)){t="";for(let a=0;a<i.length;a++){const s=i.charCodeAt(a);if(i[a].search(Ds.hanidec)!==-1)t+=Bu.indexOf(i[a]);else for(const r in qo){const[d,c]=qo[r];s>=d&&s<=c&&(t+=s-d)}}return parseInt(t,10)}else return t}const Ts=new Map;function Hu(){Ts.clear()}function Et({numberingSystem:i},t=""){const a=i||"latn";let s=Ts.get(a);s===void 0&&(s=new Map,Ts.set(a,s));let r=s.get(t);return r===void 0&&(r=new RegExp(`${Ds[a]}${t}`),s.set(t,r)),r}let Ko=()=>Date.now(),Yo="system",Xo=null,Qo=null,er=null,tr=60,nr,ir=null;class Ue{static get now(){return Ko}static set now(t){Ko=t}static set defaultZone(t){Yo=t}static get defaultZone(){return an(Yo,va.instance)}static get defaultLocale(){return Xo}static set defaultLocale(t){Xo=t}static get defaultNumberingSystem(){return Qo}static set defaultNumberingSystem(t){Qo=t}static get defaultOutputCalendar(){return er}static set defaultOutputCalendar(t){er=t}static get defaultWeekSettings(){return ir}static set defaultWeekSettings(t){ir=Es(t)}static get twoDigitCutoffYear(){return tr}static set twoDigitCutoffYear(t){tr=t%100}static get throwOnInvalid(){return nr}static set throwOnInvalid(t){nr=t}static resetCaches(){Ae.resetCache(),Jt.resetCache(),se.resetCache(),Hu()}}class Pt{constructor(t,a){this.reason=t,this.explanation=a}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const ol=[0,31,59,90,120,151,181,212,243,273,304,334],rl=[0,31,60,91,121,152,182,213,244,274,305,335];function Lt(i,t){return new Pt("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${i}, which is invalid`)}function Ns(i,t,a){const s=new Date(Date.UTC(i,t-1,a));i<100&&i>=0&&s.setUTCFullYear(s.getUTCFullYear()-1900);const r=s.getUTCDay();return r===0?7:r}function ll(i,t,a){return a+(Ti(i)?rl:ol)[t-1]}function cl(i,t){const a=Ti(i)?rl:ol,s=a.findIndex(d=>d<t),r=t-a[s];return{month:s+1,day:r}}function Os(i,t){return(i-t+7)%7+1}function fa(i,t=4,a=1){const{year:s,month:r,day:d}=i,c=ll(s,r,d),h=Os(Ns(s,r,d),a);let m=Math.floor((c-h+14-t)/7),p;return m<1?(p=s-1,m=vi(p,t,a)):m>vi(s,t,a)?(p=s+1,m=1):p=s,{weekYear:p,weekNumber:m,weekday:h,...ba(i)}}function ar(i,t=4,a=1){const{weekYear:s,weekNumber:r,weekday:d}=i,c=Os(Ns(s,1,t),a),h=Hn(s);let m=r*7+d-c-7+t,p;m<1?(p=s-1,m+=Hn(p)):m>h?(p=s+1,m-=Hn(s)):p=s;const{month:y,day:v}=cl(p,m);return{year:p,month:y,day:v,...ba(i)}}function os(i){const{year:t,month:a,day:s}=i,r=ll(t,a,s);return{year:t,ordinal:r,...ba(i)}}function sr(i){const{year:t,ordinal:a}=i,{month:s,day:r}=cl(t,a);return{year:t,month:s,day:r,...ba(i)}}function or(i,t){if(!he(i.localWeekday)||!he(i.localWeekNumber)||!he(i.localWeekYear)){if(!he(i.weekday)||!he(i.weekNumber)||!he(i.weekYear))throw new Bn("Cannot mix locale-based week fields with ISO-based week fields");return he(i.localWeekday)||(i.weekday=i.localWeekday),he(i.localWeekNumber)||(i.weekNumber=i.localWeekNumber),he(i.localWeekYear)||(i.weekYear=i.localWeekYear),delete i.localWeekday,delete i.localWeekNumber,delete i.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function Zu(i,t=4,a=1){const s=wa(i.weekYear),r=St(i.weekNumber,1,vi(i.weekYear,t,a)),d=St(i.weekday,1,7);return s?r?d?!1:Lt("weekday",i.weekday):Lt("week",i.weekNumber):Lt("weekYear",i.weekYear)}function Wu(i){const t=wa(i.year),a=St(i.ordinal,1,Hn(i.year));return t?a?!1:Lt("ordinal",i.ordinal):Lt("year",i.year)}function ul(i){const t=wa(i.year),a=St(i.month,1,12),s=St(i.day,1,ma(i.year,i.month));return t?a?s?!1:Lt("day",i.day):Lt("month",i.month):Lt("year",i.year)}function dl(i){const{hour:t,minute:a,second:s,millisecond:r}=i,d=St(t,0,23)||t===24&&a===0&&s===0&&r===0,c=St(a,0,59),h=St(s,0,59),m=St(r,0,999);return d?c?h?m?!1:Lt("millisecond",r):Lt("second",s):Lt("minute",a):Lt("hour",t)}function he(i){return typeof i>"u"}function sn(i){return typeof i=="number"}function wa(i){return typeof i=="number"&&i%1===0}function Gu(i){return typeof i=="string"}function Vu(i){return Object.prototype.toString.call(i)==="[object Date]"}function hl(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function fl(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function ju(i){return Array.isArray(i)?i:[i]}function rr(i,t,a){if(i.length!==0)return i.reduce((s,r)=>{const d=[t(r),r];return s&&a(s[0],d[0])===s[0]?s:d},null)[1]}function Ju(i,t){return t.reduce((a,s)=>(a[s]=i[s],a),{})}function Wn(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function Es(i){if(i==null)return null;if(typeof i!="object")throw new et("Week settings must be an object");if(!St(i.firstDay,1,7)||!St(i.minimalDays,1,7)||!Array.isArray(i.weekend)||i.weekend.some(t=>!St(t,1,7)))throw new et("Invalid week settings");return{firstDay:i.firstDay,minimalDays:i.minimalDays,weekend:Array.from(i.weekend)}}function St(i,t,a){return wa(i)&&i>=t&&i<=a}function qu(i,t){return i-t*Math.floor(i/t)}function Ge(i,t=2){const a=i<0;let s;return a?s="-"+(""+-i).padStart(t,"0"):s=(""+i).padStart(t,"0"),s}function tn(i){if(!(he(i)||i===null||i===""))return parseInt(i,10)}function pn(i){if(!(he(i)||i===null||i===""))return parseFloat(i)}function Fs(i){if(!(he(i)||i===null||i==="")){const t=parseFloat("0."+i)*1e3;return Math.floor(t)}}function Rs(i,t,a=!1){const s=10**t;return(a?Math.trunc:Math.round)(i*s)/s}function Ti(i){return i%4===0&&(i%100!==0||i%400===0)}function Hn(i){return Ti(i)?366:365}function ma(i,t){const a=qu(t-1,12)+1,s=i+(t-a)/12;return a===2?Ti(s)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][a-1]}function La(i){let t=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.millisecond);return i.year<100&&i.year>=0&&(t=new Date(t),t.setUTCFullYear(i.year,i.month-1,i.day)),+t}function lr(i,t,a){return-Os(Ns(i,1,t),a)+t-1}function vi(i,t=4,a=1){const s=lr(i,t,a),r=lr(i+1,t,a);return(Hn(i)-s+r)/7}function ks(i){return i>99?i:i>Ue.twoDigitCutoffYear?1900+i:2e3+i}function ml(i,t,a,s=null){const r=new Date(i),d={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};s&&(d.timeZone=s);const c={timeZoneName:t,...d},h=new Intl.DateTimeFormat(a,c).formatToParts(r).find(m=>m.type.toLowerCase()==="timezonename");return h?h.value:null}function Sa(i,t){let a=parseInt(i,10);Number.isNaN(a)&&(a=0);const s=parseInt(t,10)||0,r=a<0||Object.is(a,-0)?-s:s;return a*60+r}function pl(i){const t=Number(i);if(typeof i=="boolean"||i===""||Number.isNaN(t))throw new et(`Invalid unit value ${i}`);return t}function pa(i,t){const a={};for(const s in i)if(Wn(i,s)){const r=i[s];if(r==null)continue;a[t(s)]=pl(r)}return a}function _i(i,t){const a=Math.trunc(Math.abs(i/60)),s=Math.trunc(Math.abs(i%60)),r=i>=0?"+":"-";switch(t){case"short":return`${r}${Ge(a,2)}:${Ge(s,2)}`;case"narrow":return`${r}${a}${s>0?`:${s}`:""}`;case"techie":return`${r}${Ge(a,2)}${Ge(s,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function ba(i){return Ju(i,["hour","minute","second","millisecond"])}const Ku=["January","February","March","April","May","June","July","August","September","October","November","December"],gl=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Yu=["J","F","M","A","M","J","J","A","S","O","N","D"];function _l(i){switch(i){case"narrow":return[...Yu];case"short":return[...gl];case"long":return[...Ku];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const yl=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],vl=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Xu=["M","T","W","T","F","S","S"];function wl(i){switch(i){case"narrow":return[...Xu];case"short":return[...vl];case"long":return[...yl];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Ll=["AM","PM"],Qu=["Before Christ","Anno Domini"],ed=["BC","AD"],td=["B","A"];function Sl(i){switch(i){case"narrow":return[...td];case"short":return[...ed];case"long":return[...Qu];default:return null}}function nd(i){return Ll[i.hour<12?0:1]}function id(i,t){return wl(t)[i.weekday-1]}function ad(i,t){return _l(t)[i.month-1]}function sd(i,t){return Sl(t)[i.year<0?0:1]}function od(i,t,a="always",s=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},d=["hours","minutes","seconds"].indexOf(i)===-1;if(a==="auto"&&d){const v=i==="days";switch(t){case 1:return v?"tomorrow":`next ${r[i][0]}`;case-1:return v?"yesterday":`last ${r[i][0]}`;case 0:return v?"today":`this ${r[i][0]}`}}const c=Object.is(t,-0)||t<0,h=Math.abs(t),m=h===1,p=r[i],y=s?m?p[1]:p[2]||p[1]:m?r[i][0]:i;return c?`${h} ${y} ago`:`in ${h} ${y}`}function cr(i,t){let a="";for(const s of i)s.literal?a+=s.val:a+=t(s.val);return a}const rd={D:ha,DD:$r,DDD:Br,DDDD:Ur,t:Hr,tt:Zr,ttt:Wr,tttt:Gr,T:Vr,TT:jr,TTT:Jr,TTTT:qr,f:Kr,ff:Xr,fff:el,ffff:nl,F:Yr,FF:Qr,FFF:tl,FFFF:il};class tt{static create(t,a={}){return new tt(t,a)}static parseFormat(t){let a=null,s="",r=!1;const d=[];for(let c=0;c<t.length;c++){const h=t.charAt(c);h==="'"?(s.length>0&&d.push({literal:r||/^\s+$/.test(s),val:s}),a=null,s="",r=!r):r||h===a?s+=h:(s.length>0&&d.push({literal:/^\s+$/.test(s),val:s}),s=h,a=h)}return s.length>0&&d.push({literal:r||/^\s+$/.test(s),val:s}),d}static macroTokenToFormatOpts(t){return rd[t]}constructor(t,a){this.opts=a,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,a){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...a}).format()}dtFormatter(t,a={}){return this.loc.dtFormatter(t,{...this.opts,...a})}formatDateTime(t,a){return this.dtFormatter(t,a).format()}formatDateTimeParts(t,a){return this.dtFormatter(t,a).formatToParts()}formatInterval(t,a){return this.dtFormatter(t.start,a).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,a){return this.dtFormatter(t,a).resolvedOptions()}num(t,a=0){if(this.opts.forceSimple)return Ge(t,a);const s={...this.opts};return a>0&&(s.padTo=a),this.loc.numberFormatter(s).format(t)}formatDateTimeFromString(t,a){const s=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",d=(S,E)=>this.loc.extract(t,S,E),c=S=>t.isOffsetFixed&&t.offset===0&&S.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,S.format):"",h=()=>s?nd(t):d({hour:"numeric",hourCycle:"h12"},"dayperiod"),m=(S,E)=>s?ad(t,S):d(E?{month:S}:{month:S,day:"numeric"},"month"),p=(S,E)=>s?id(t,S):d(E?{weekday:S}:{weekday:S,month:"long",day:"numeric"},"weekday"),y=S=>{const E=tt.macroTokenToFormatOpts(S);return E?this.formatWithSystemDefault(t,E):S},v=S=>s?sd(t,S):d({era:S},"era"),w=S=>{switch(S){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return c({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return c({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return c({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return h();case"d":return r?d({day:"numeric"},"day"):this.num(t.day);case"dd":return r?d({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return p("short",!0);case"cccc":return p("long",!0);case"ccccc":return p("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return p("short",!1);case"EEEE":return p("long",!1);case"EEEEE":return p("narrow",!1);case"L":return r?d({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return r?d({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return m("short",!0);case"LLLL":return m("long",!0);case"LLLLL":return m("narrow",!0);case"M":return r?d({month:"numeric"},"month"):this.num(t.month);case"MM":return r?d({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return m("short",!1);case"MMMM":return m("long",!1);case"MMMMM":return m("narrow",!1);case"y":return r?d({year:"numeric"},"year"):this.num(t.year);case"yy":return r?d({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return r?d({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return r?d({year:"numeric"},"year"):this.num(t.year,6);case"G":return v("short");case"GG":return v("long");case"GGGGG":return v("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"n":return this.num(t.localWeekNumber);case"nn":return this.num(t.localWeekNumber,2);case"ii":return this.num(t.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(t.localWeekYear,4);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return y(S)}};return cr(tt.parseFormat(a),w)}formatDurationFromString(t,a){const s=m=>{switch(m[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=m=>p=>{const y=s(p);return y?this.num(m.get(y),p.length):p},d=tt.parseFormat(a),c=d.reduce((m,{literal:p,val:y})=>p?m:m.concat(y),[]),h=t.shiftTo(...c.map(s).filter(m=>m));return cr(d,r(h))}}const bl=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function jn(...i){const t=i.reduce((a,s)=>a+s.source,"");return RegExp(`^${t}$`)}function Jn(...i){return t=>i.reduce(([a,s,r],d)=>{const[c,h,m]=d(t,r);return[{...a,...c},h||s,m]},[{},null,1]).slice(0,2)}function qn(i,...t){if(i==null)return[null,null];for(const[a,s]of t){const r=a.exec(i);if(r)return s(r)}return[null,null]}function Ml(...i){return(t,a)=>{const s={};let r;for(r=0;r<i.length;r++)s[i[r]]=tn(t[a+r]);return[s,null,a+r]}}const Tl=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,ld=`(?:${Tl.source}?(?:\\[(${bl.source})\\])?)?`,zs=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,El=RegExp(`${zs.source}${ld}`),$s=RegExp(`(?:T${El.source})?`),cd=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,ud=/(\d{4})-?W(\d\d)(?:-?(\d))?/,dd=/(\d{4})-?(\d{3})/,hd=Ml("weekYear","weekNumber","weekDay"),fd=Ml("year","ordinal"),md=/(\d{4})-(\d\d)-(\d\d)/,kl=RegExp(`${zs.source} ?(?:${Tl.source}|(${bl.source}))?`),pd=RegExp(`(?: ${kl.source})?`);function Zn(i,t,a){const s=i[t];return he(s)?a:tn(s)}function gd(i,t){return[{year:Zn(i,t),month:Zn(i,t+1,1),day:Zn(i,t+2,1)},null,t+3]}function Kn(i,t){return[{hours:Zn(i,t,0),minutes:Zn(i,t+1,0),seconds:Zn(i,t+2,0),milliseconds:Fs(i[t+3])},null,t+4]}function Ei(i,t){const a=!i[t]&&!i[t+1],s=Sa(i[t+1],i[t+2]),r=a?null:st.instance(s);return[{},r,t+3]}function ki(i,t){const a=i[t]?Jt.create(i[t]):null;return[{},a,t+1]}const _d=RegExp(`^T?${zs.source}$`),yd=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function vd(i){const[t,a,s,r,d,c,h,m,p]=i,y=t[0]==="-",v=m&&m[0]==="-",w=(S,E=!1)=>S!==void 0&&(E||S&&y)?-S:S;return[{years:w(pn(a)),months:w(pn(s)),weeks:w(pn(r)),days:w(pn(d)),hours:w(pn(c)),minutes:w(pn(h)),seconds:w(pn(m),m==="-0"),milliseconds:w(Fs(p),v)}]}const wd={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Bs(i,t,a,s,r,d,c){const h={year:t.length===2?ks(tn(t)):tn(t),month:gl.indexOf(a)+1,day:tn(s),hour:tn(r),minute:tn(d)};return c&&(h.second=tn(c)),i&&(h.weekday=i.length>3?yl.indexOf(i)+1:vl.indexOf(i)+1),h}const Ld=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Sd(i){const[,t,a,s,r,d,c,h,m,p,y,v]=i,w=Bs(t,r,s,a,d,c,h);let S;return m?S=wd[m]:p?S=0:S=Sa(y,v),[w,new st(S)]}function bd(i){return i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Md=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Td=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Ed=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function ur(i){const[,t,a,s,r,d,c,h]=i;return[Bs(t,r,s,a,d,c,h),st.utcInstance]}function kd(i){const[,t,a,s,r,d,c,h]=i;return[Bs(t,h,a,s,r,d,c),st.utcInstance]}const Pd=jn(cd,$s),xd=jn(ud,$s),Ad=jn(dd,$s),Cd=jn(El),Pl=Jn(gd,Kn,Ei,ki),Id=Jn(hd,Kn,Ei,ki),Dd=Jn(fd,Kn,Ei,ki),Nd=Jn(Kn,Ei,ki);function Od(i){return qn(i,[Pd,Pl],[xd,Id],[Ad,Dd],[Cd,Nd])}function Fd(i){return qn(bd(i),[Ld,Sd])}function Rd(i){return qn(i,[Md,ur],[Td,ur],[Ed,kd])}function zd(i){return qn(i,[yd,vd])}const $d=Jn(Kn);function Bd(i){return qn(i,[_d,$d])}const Ud=jn(md,pd),Hd=jn(kl),Zd=Jn(Kn,Ei,ki);function Wd(i){return qn(i,[Ud,Pl],[Hd,Zd])}const dr="Invalid Duration",xl={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Gd={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...xl},gt=146097/400,On=146097/4800,Vd={years:{quarters:4,months:12,weeks:gt/7,days:gt,hours:gt*24,minutes:gt*24*60,seconds:gt*24*60*60,milliseconds:gt*24*60*60*1e3},quarters:{months:3,weeks:gt/28,days:gt/4,hours:gt*24/4,minutes:gt*24*60/4,seconds:gt*24*60*60/4,milliseconds:gt*24*60*60*1e3/4},months:{weeks:On/7,days:On,hours:On*24,minutes:On*24*60,seconds:On*24*60*60,milliseconds:On*24*60*60*1e3},...xl},yn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],jd=yn.slice(0).reverse();function Qt(i,t,a=!1){const s={values:a?t.values:{...i.values,...t.values||{}},loc:i.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||i.conversionAccuracy,matrix:t.matrix||i.matrix};return new Te(s)}function Al(i,t){let a=t.milliseconds??0;for(const s of jd.slice(1))t[s]&&(a+=t[s]*i[s].milliseconds);return a}function hr(i,t){const a=Al(i,t)<0?-1:1;yn.reduceRight((s,r)=>{if(he(t[r]))return s;if(s){const d=t[s]*a,c=i[r][s],h=Math.floor(d/c);t[r]+=h*a,t[s]-=h*c*a}return r},null),yn.reduce((s,r)=>{if(he(t[r]))return s;if(s){const d=t[s]%1;t[s]-=d,t[r]+=d*i[s][r]}return r},null)}function Jd(i){const t={};for(const[a,s]of Object.entries(i))s!==0&&(t[a]=s);return t}class Te{constructor(t){const a=t.conversionAccuracy==="longterm"||!1;let s=a?Vd:Gd;t.matrix&&(s=t.matrix),this.values=t.values,this.loc=t.loc||Ae.create(),this.conversionAccuracy=a?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=s,this.isLuxonDuration=!0}static fromMillis(t,a){return Te.fromObject({milliseconds:t},a)}static fromObject(t,a={}){if(t==null||typeof t!="object")throw new et(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Te({values:pa(t,Te.normalizeUnit),loc:Ae.fromObject(a),conversionAccuracy:a.conversionAccuracy,matrix:a.matrix})}static fromDurationLike(t){if(sn(t))return Te.fromMillis(t);if(Te.isDuration(t))return t;if(typeof t=="object")return Te.fromObject(t);throw new et(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,a){const[s]=zd(t);return s?Te.fromObject(s,a):Te.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,a){const[s]=Bd(t);return s?Te.fromObject(s,a):Te.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,a=null){if(!t)throw new et("need to specify a reason the Duration is invalid");const s=t instanceof Pt?t:new Pt(t,a);if(Ue.throwOnInvalid)throw new vu(s);return new Te({invalid:s})}static normalizeUnit(t){const a={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!a)throw new zr(t);return a}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,a={}){const s={...a,floor:a.round!==!1&&a.floor!==!1};return this.isValid?tt.create(this.loc,s).formatDurationFromString(this,t):dr}toHuman(t={}){if(!this.isValid)return dr;const a=yn.map(s=>{const r=this.values[s];return he(r)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:s.slice(0,-1)}).format(r)}).filter(s=>s);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(a)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=Rs(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const a=this.toMillis();return a<0||a>=864e5?null:(t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t,includeOffset:!1},se.fromMillis(a,{zone:"UTC"}).toISOTime(t))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?Al(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const a=Te.fromDurationLike(t),s={};for(const r of yn)(Wn(a.values,r)||Wn(this.values,r))&&(s[r]=a.get(r)+this.get(r));return Qt(this,{values:s},!0)}minus(t){if(!this.isValid)return this;const a=Te.fromDurationLike(t);return this.plus(a.negate())}mapUnits(t){if(!this.isValid)return this;const a={};for(const s of Object.keys(this.values))a[s]=pl(t(this.values[s],s));return Qt(this,{values:a},!0)}get(t){return this[Te.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const a={...this.values,...pa(t,Te.normalizeUnit)};return Qt(this,{values:a})}reconfigure({locale:t,numberingSystem:a,conversionAccuracy:s,matrix:r}={}){const c={loc:this.loc.clone({locale:t,numberingSystem:a}),matrix:r,conversionAccuracy:s};return Qt(this,c)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return hr(this.matrix,t),Qt(this,{values:t},!0)}rescale(){if(!this.isValid)return this;const t=Jd(this.normalize().shiftToAll().toObject());return Qt(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(c=>Te.normalizeUnit(c));const a={},s={},r=this.toObject();let d;for(const c of yn)if(t.indexOf(c)>=0){d=c;let h=0;for(const p in s)h+=this.matrix[p][c]*s[p],s[p]=0;sn(r[c])&&(h+=r[c]);const m=Math.trunc(h);a[c]=m,s[c]=(h*1e3-m*1e3)/1e3}else sn(r[c])&&(s[c]=r[c]);for(const c in s)s[c]!==0&&(a[d]+=c===d?s[c]:s[c]/this.matrix[d][c]);return hr(this.matrix,a),Qt(this,{values:a},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const t={};for(const a of Object.keys(this.values))t[a]=this.values[a]===0?0:-this.values[a];return Qt(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function a(s,r){return s===void 0||s===0?r===void 0||r===0:s===r}for(const s of yn)if(!a(this.values[s],t.values[s]))return!1;return!0}}const Fn="Invalid Interval";function qd(i,t){return!i||!i.isValid?Be.invalid("missing or invalid start"):!t||!t.isValid?Be.invalid("missing or invalid end"):t<i?Be.invalid("end before start",`The end of an interval must be after its start, but you had start=${i.toISO()} and end=${t.toISO()}`):null}class Be{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,a=null){if(!t)throw new et("need to specify a reason the Interval is invalid");const s=t instanceof Pt?t:new Pt(t,a);if(Ue.throwOnInvalid)throw new yu(s);return new Be({invalid:s})}static fromDateTimes(t,a){const s=ui(t),r=ui(a),d=qd(s,r);return d??new Be({start:s,end:r})}static after(t,a){const s=Te.fromDurationLike(a),r=ui(t);return Be.fromDateTimes(r,r.plus(s))}static before(t,a){const s=Te.fromDurationLike(a),r=ui(t);return Be.fromDateTimes(r.minus(s),r)}static fromISO(t,a){const[s,r]=(t||"").split("/",2);if(s&&r){let d,c;try{d=se.fromISO(s,a),c=d.isValid}catch{c=!1}let h,m;try{h=se.fromISO(r,a),m=h.isValid}catch{m=!1}if(c&&m)return Be.fromDateTimes(d,h);if(c){const p=Te.fromISO(r,a);if(p.isValid)return Be.after(d,p)}else if(m){const p=Te.fromISO(s,a);if(p.isValid)return Be.before(h,p)}}return Be.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds",a){if(!this.isValid)return NaN;const s=this.start.startOf(t,a);let r;return a!=null&&a.useLocaleWeeks?r=this.end.reconfigure({locale:s.locale}):r=this.end,r=r.startOf(t,a),Math.floor(r.diff(s,t).get(t))+(r.valueOf()!==this.end.valueOf())}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:a}={}){return this.isValid?Be.fromDateTimes(t||this.s,a||this.e):this}splitAt(...t){if(!this.isValid)return[];const a=t.map(ui).filter(c=>this.contains(c)).sort((c,h)=>c.toMillis()-h.toMillis()),s=[];let{s:r}=this,d=0;for(;r<this.e;){const c=a[d]||this.e,h=+c>+this.e?this.e:c;s.push(Be.fromDateTimes(r,h)),r=h,d+=1}return s}splitBy(t){const a=Te.fromDurationLike(t);if(!this.isValid||!a.isValid||a.as("milliseconds")===0)return[];let{s}=this,r=1,d;const c=[];for(;s<this.e;){const h=this.start.plus(a.mapUnits(m=>m*r));d=+h>+this.e?this.e:h,c.push(Be.fromDateTimes(s,d)),s=d,r+=1}return c}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const a=this.s>t.s?this.s:t.s,s=this.e<t.e?this.e:t.e;return a>=s?null:Be.fromDateTimes(a,s)}union(t){if(!this.isValid)return this;const a=this.s<t.s?this.s:t.s,s=this.e>t.e?this.e:t.e;return Be.fromDateTimes(a,s)}static merge(t){const[a,s]=t.sort((r,d)=>r.s-d.s).reduce(([r,d],c)=>d?d.overlaps(c)||d.abutsStart(c)?[r,d.union(c)]:[r.concat([d]),c]:[r,c],[[],null]);return s&&a.push(s),a}static xor(t){let a=null,s=0;const r=[],d=t.map(m=>[{time:m.s,type:"s"},{time:m.e,type:"e"}]),c=Array.prototype.concat(...d),h=c.sort((m,p)=>m.time-p.time);for(const m of h)s+=m.type==="s"?1:-1,s===1?a=m.time:(a&&+a!=+m.time&&r.push(Be.fromDateTimes(a,m.time)),a=null);return Be.merge(r)}difference(...t){return Be.xor([this].concat(t)).map(a=>this.intersection(a)).filter(a=>a&&!a.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Fn}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(t=ha,a={}){return this.isValid?tt.create(this.s.loc.clone(a),t).formatInterval(this):Fn}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:Fn}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Fn}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:Fn}toFormat(t,{separator:a=" – "}={}){return this.isValid?`${this.s.toFormat(t)}${a}${this.e.toFormat(t)}`:Fn}toDuration(t,a){return this.isValid?this.e.diff(this.s,t,a):Te.invalid(this.invalidReason)}mapEndpoints(t){return Be.fromDateTimes(t(this.s),t(this.e))}}class aa{static hasDST(t=Ue.defaultZone){const a=se.now().setZone(t).set({month:12});return!t.isUniversal&&a.offset!==a.set({month:6}).offset}static isValidIANAZone(t){return Jt.isValidZone(t)}static normalizeZone(t){return an(t,Ue.defaultZone)}static getStartOfWeek({locale:t=null,locObj:a=null}={}){return(a||Ae.create(t)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:t=null,locObj:a=null}={}){return(a||Ae.create(t)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:t=null,locObj:a=null}={}){return(a||Ae.create(t)).getWeekendDays().slice()}static months(t="long",{locale:a=null,numberingSystem:s=null,locObj:r=null,outputCalendar:d="gregory"}={}){return(r||Ae.create(a,s,d)).months(t)}static monthsFormat(t="long",{locale:a=null,numberingSystem:s=null,locObj:r=null,outputCalendar:d="gregory"}={}){return(r||Ae.create(a,s,d)).months(t,!0)}static weekdays(t="long",{locale:a=null,numberingSystem:s=null,locObj:r=null}={}){return(r||Ae.create(a,s,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:a=null,numberingSystem:s=null,locObj:r=null}={}){return(r||Ae.create(a,s,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Ae.create(t).meridiems()}static eras(t="short",{locale:a=null}={}){return Ae.create(a,null,"gregory").eras(t)}static features(){return{relative:hl(),localeWeek:fl()}}}function fr(i,t){const a=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),s=a(t)-a(i);return Math.floor(Te.fromMillis(s).as("days"))}function Kd(i,t,a){const s=[["years",(m,p)=>p.year-m.year],["quarters",(m,p)=>p.quarter-m.quarter+(p.year-m.year)*4],["months",(m,p)=>p.month-m.month+(p.year-m.year)*12],["weeks",(m,p)=>{const y=fr(m,p);return(y-y%7)/7}],["days",fr]],r={},d=i;let c,h;for(const[m,p]of s)a.indexOf(m)>=0&&(c=m,r[m]=p(i,t),h=d.plus(r),h>t?(r[m]--,i=d.plus(r),i>t&&(h=i,r[m]--,i=d.plus(r))):i=h);return[i,r,h,c]}function Yd(i,t,a,s){let[r,d,c,h]=Kd(i,t,a);const m=t-r,p=a.filter(v=>["hours","minutes","seconds","milliseconds"].indexOf(v)>=0);p.length===0&&(c<t&&(c=r.plus({[h]:1})),c!==r&&(d[h]=(d[h]||0)+m/(c-r)));const y=Te.fromObject(d,s);return p.length>0?Te.fromMillis(m,s).shiftTo(...p).plus(y):y}const Xd="missing Intl.DateTimeFormat.formatToParts support";function xe(i,t=a=>a){return{regex:i,deser:([a])=>t(Uu(a))}}const Qd=" ",Cl=`[ ${Qd}]`,Il=new RegExp(Cl,"g");function eh(i){return i.replace(/\./g,"\\.?").replace(Il,Cl)}function mr(i){return i.replace(/\./g,"").replace(Il," ").toLowerCase()}function kt(i,t){return i===null?null:{regex:RegExp(i.map(eh).join("|")),deser:([a])=>i.findIndex(s=>mr(a)===mr(s))+t}}function pr(i,t){return{regex:i,deser:([,a,s])=>Sa(a,s),groups:t}}function sa(i){return{regex:i,deser:([t])=>t}}function th(i){return i.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function nh(i,t){const a=Et(t),s=Et(t,"{2}"),r=Et(t,"{3}"),d=Et(t,"{4}"),c=Et(t,"{6}"),h=Et(t,"{1,2}"),m=Et(t,"{1,3}"),p=Et(t,"{1,6}"),y=Et(t,"{1,9}"),v=Et(t,"{2,4}"),w=Et(t,"{4,6}"),S=x=>({regex:RegExp(th(x.val)),deser:([A])=>A,literal:!0}),P=(x=>{if(i.literal)return S(x);switch(x.val){case"G":return kt(t.eras("short"),0);case"GG":return kt(t.eras("long"),0);case"y":return xe(p);case"yy":return xe(v,ks);case"yyyy":return xe(d);case"yyyyy":return xe(w);case"yyyyyy":return xe(c);case"M":return xe(h);case"MM":return xe(s);case"MMM":return kt(t.months("short",!0),1);case"MMMM":return kt(t.months("long",!0),1);case"L":return xe(h);case"LL":return xe(s);case"LLL":return kt(t.months("short",!1),1);case"LLLL":return kt(t.months("long",!1),1);case"d":return xe(h);case"dd":return xe(s);case"o":return xe(m);case"ooo":return xe(r);case"HH":return xe(s);case"H":return xe(h);case"hh":return xe(s);case"h":return xe(h);case"mm":return xe(s);case"m":return xe(h);case"q":return xe(h);case"qq":return xe(s);case"s":return xe(h);case"ss":return xe(s);case"S":return xe(m);case"SSS":return xe(r);case"u":return sa(y);case"uu":return sa(h);case"uuu":return xe(a);case"a":return kt(t.meridiems(),0);case"kkkk":return xe(d);case"kk":return xe(v,ks);case"W":return xe(h);case"WW":return xe(s);case"E":case"c":return xe(a);case"EEE":return kt(t.weekdays("short",!1),1);case"EEEE":return kt(t.weekdays("long",!1),1);case"ccc":return kt(t.weekdays("short",!0),1);case"cccc":return kt(t.weekdays("long",!0),1);case"Z":case"ZZ":return pr(new RegExp(`([+-]${h.source})(?::(${s.source}))?`),2);case"ZZZ":return pr(new RegExp(`([+-]${h.source})(${s.source})?`),2);case"z":return sa(/[a-z_+-/]{1,256}?/i);case" ":return sa(/[^\S\n\r]/);default:return S(x)}})(i)||{invalidReason:Xd};return P.token=i,P}const ih={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function ah(i,t,a){const{type:s,value:r}=i;if(s==="literal"){const m=/^\s+$/.test(r);return{literal:!m,val:m?" ":r}}const d=t[s];let c=s;s==="hour"&&(t.hour12!=null?c=t.hour12?"hour12":"hour24":t.hourCycle!=null?t.hourCycle==="h11"||t.hourCycle==="h12"?c="hour12":c="hour24":c=a.hour12?"hour12":"hour24");let h=ih[c];if(typeof h=="object"&&(h=h[d]),h)return{literal:!1,val:h}}function sh(i){return[`^${i.map(a=>a.regex).reduce((a,s)=>`${a}(${s.source})`,"")}$`,i]}function oh(i,t,a){const s=i.match(t);if(s){const r={};let d=1;for(const c in a)if(Wn(a,c)){const h=a[c],m=h.groups?h.groups+1:1;!h.literal&&h.token&&(r[h.token.val[0]]=h.deser(s.slice(d,d+m))),d+=m}return[s,r]}else return[s,{}]}function rh(i){const t=d=>{switch(d){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let a=null,s;return he(i.z)||(a=Jt.create(i.z)),he(i.Z)||(a||(a=new st(i.Z)),s=i.Z),he(i.q)||(i.M=(i.q-1)*3+1),he(i.h)||(i.h<12&&i.a===1?i.h+=12:i.h===12&&i.a===0&&(i.h=0)),i.G===0&&i.y&&(i.y=-i.y),he(i.u)||(i.S=Fs(i.u)),[Object.keys(i).reduce((d,c)=>{const h=t(c);return h&&(d[h]=i[c]),d},{}),a,s]}let rs=null;function lh(){return rs||(rs=se.fromMillis(1555555555555)),rs}function ch(i,t){if(i.literal)return i;const a=tt.macroTokenToFormatOpts(i.val),s=Fl(a,t);return s==null||s.includes(void 0)?i:s}function Dl(i,t){return Array.prototype.concat(...i.map(a=>ch(a,t)))}class Nl{constructor(t,a){if(this.locale=t,this.format=a,this.tokens=Dl(tt.parseFormat(a),t),this.units=this.tokens.map(s=>nh(s,t)),this.disqualifyingUnit=this.units.find(s=>s.invalidReason),!this.disqualifyingUnit){const[s,r]=sh(this.units);this.regex=RegExp(s,"i"),this.handlers=r}}explainFromTokens(t){if(this.isValid){const[a,s]=oh(t,this.regex,this.handlers),[r,d,c]=s?rh(s):[null,null,void 0];if(Wn(s,"a")&&Wn(s,"H"))throw new Bn("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:this.tokens,regex:this.regex,rawMatches:a,matches:s,result:r,zone:d,specificOffset:c}}else return{input:t,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function Ol(i,t,a){return new Nl(i,a).explainFromTokens(t)}function uh(i,t,a){const{result:s,zone:r,specificOffset:d,invalidReason:c}=Ol(i,t,a);return[s,r,d,c]}function Fl(i,t){if(!i)return null;const s=tt.create(t,i).dtFormatter(lh()),r=s.formatToParts(),d=s.resolvedOptions();return r.map(c=>ah(c,i,d))}const ls="Invalid DateTime",gr=864e13;function hi(i){return new Pt("unsupported zone",`the zone "${i.name}" is not supported`)}function cs(i){return i.weekData===null&&(i.weekData=fa(i.c)),i.weekData}function us(i){return i.localWeekData===null&&(i.localWeekData=fa(i.c,i.loc.getMinDaysInFirstWeek(),i.loc.getStartOfWeek())),i.localWeekData}function gn(i,t){const a={ts:i.ts,zone:i.zone,c:i.c,o:i.o,loc:i.loc,invalid:i.invalid};return new se({...a,...t,old:a})}function Rl(i,t,a){let s=i-t*60*1e3;const r=a.offset(s);if(t===r)return[s,t];s-=(r-t)*60*1e3;const d=a.offset(s);return r===d?[s,r]:[i-Math.min(r,d)*60*1e3,Math.max(r,d)]}function oa(i,t){i+=t*60*1e3;const a=new Date(i);return{year:a.getUTCFullYear(),month:a.getUTCMonth()+1,day:a.getUTCDate(),hour:a.getUTCHours(),minute:a.getUTCMinutes(),second:a.getUTCSeconds(),millisecond:a.getUTCMilliseconds()}}function la(i,t,a){return Rl(La(i),t,a)}function _r(i,t){const a=i.o,s=i.c.year+Math.trunc(t.years),r=i.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,d={...i.c,year:s,month:r,day:Math.min(i.c.day,ma(s,r))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},c=Te.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),h=La(d);let[m,p]=Rl(h,a,i.zone);return c!==0&&(m+=c,p=i.zone.offset(m)),{ts:m,o:p}}function Rn(i,t,a,s,r,d){const{setZone:c,zone:h}=a;if(i&&Object.keys(i).length!==0||t){const m=t||h,p=se.fromObject(i,{...a,zone:m,specificOffset:d});return c?p:p.setZone(h)}else return se.invalid(new Pt("unparsable",`the input "${r}" can't be parsed as ${s}`))}function ra(i,t,a=!0){return i.isValid?tt.create(Ae.create("en-US"),{allowZ:a,forceSimple:!0}).formatDateTimeFromString(i,t):null}function ds(i,t){const a=i.c.year>9999||i.c.year<0;let s="";return a&&i.c.year>=0&&(s+="+"),s+=Ge(i.c.year,a?6:4),t?(s+="-",s+=Ge(i.c.month),s+="-",s+=Ge(i.c.day)):(s+=Ge(i.c.month),s+=Ge(i.c.day)),s}function yr(i,t,a,s,r,d){let c=Ge(i.c.hour);return t?(c+=":",c+=Ge(i.c.minute),(i.c.millisecond!==0||i.c.second!==0||!a)&&(c+=":")):c+=Ge(i.c.minute),(i.c.millisecond!==0||i.c.second!==0||!a)&&(c+=Ge(i.c.second),(i.c.millisecond!==0||!s)&&(c+=".",c+=Ge(i.c.millisecond,3))),r&&(i.isOffsetFixed&&i.offset===0&&!d?c+="Z":i.o<0?(c+="-",c+=Ge(Math.trunc(-i.o/60)),c+=":",c+=Ge(Math.trunc(-i.o%60))):(c+="+",c+=Ge(Math.trunc(i.o/60)),c+=":",c+=Ge(Math.trunc(i.o%60)))),d&&(c+="["+i.zone.ianaName+"]"),c}const zl={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},dh={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},hh={ordinal:1,hour:0,minute:0,second:0,millisecond:0},$l=["year","month","day","hour","minute","second","millisecond"],fh=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],mh=["year","ordinal","hour","minute","second","millisecond"];function ph(i){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[i.toLowerCase()];if(!t)throw new zr(i);return t}function vr(i){switch(i.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return ph(i)}}function gh(i){if(fi===void 0&&(fi=Ue.now()),i.type!=="iana")return i.offset(fi);const t=i.name;let a=Ps.get(t);return a===void 0&&(a=i.offset(fi),Ps.set(t,a)),a}function wr(i,t){const a=an(t.zone,Ue.defaultZone);if(!a.isValid)return se.invalid(hi(a));const s=Ae.fromObject(t);let r,d;if(he(i.year))r=Ue.now();else{for(const m of $l)he(i[m])&&(i[m]=zl[m]);const c=ul(i)||dl(i);if(c)return se.invalid(c);const h=gh(a);[r,d]=la(i,h,a)}return new se({ts:r,zone:a,loc:s,o:d})}function Lr(i,t,a){const s=he(a.round)?!0:a.round,r=(c,h)=>(c=Rs(c,s||a.calendary?0:2,!0),t.loc.clone(a).relFormatter(a).format(c,h)),d=c=>a.calendary?t.hasSame(i,c)?0:t.startOf(c).diff(i.startOf(c),c).get(c):t.diff(i,c).get(c);if(a.unit)return r(d(a.unit),a.unit);for(const c of a.units){const h=d(c);if(Math.abs(h)>=1)return r(h,c)}return r(i>t?-0:0,a.units[a.units.length-1])}function Sr(i){let t={},a;return i.length>0&&typeof i[i.length-1]=="object"?(t=i[i.length-1],a=Array.from(i).slice(0,i.length-1)):a=Array.from(i),[t,a]}let fi;const Ps=new Map;class se{constructor(t){const a=t.zone||Ue.defaultZone;let s=t.invalid||(Number.isNaN(t.ts)?new Pt("invalid input"):null)||(a.isValid?null:hi(a));this.ts=he(t.ts)?Ue.now():t.ts;let r=null,d=null;if(!s)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(a))[r,d]=[t.old.c,t.old.o];else{const h=sn(t.o)&&!t.old?t.o:a.offset(this.ts);r=oa(this.ts,h),s=Number.isNaN(r.year)?new Pt("invalid input"):null,r=s?null:r,d=s?null:h}this._zone=a,this.loc=t.loc||Ae.create(),this.invalid=s,this.weekData=null,this.localWeekData=null,this.c=r,this.o=d,this.isLuxonDateTime=!0}static now(){return new se({})}static local(){const[t,a]=Sr(arguments),[s,r,d,c,h,m,p]=a;return wr({year:s,month:r,day:d,hour:c,minute:h,second:m,millisecond:p},t)}static utc(){const[t,a]=Sr(arguments),[s,r,d,c,h,m,p]=a;return t.zone=st.utcInstance,wr({year:s,month:r,day:d,hour:c,minute:h,second:m,millisecond:p},t)}static fromJSDate(t,a={}){const s=Vu(t)?t.valueOf():NaN;if(Number.isNaN(s))return se.invalid("invalid input");const r=an(a.zone,Ue.defaultZone);return r.isValid?new se({ts:s,zone:r,loc:Ae.fromObject(a)}):se.invalid(hi(r))}static fromMillis(t,a={}){if(sn(t))return t<-gr||t>gr?se.invalid("Timestamp out of range"):new se({ts:t,zone:an(a.zone,Ue.defaultZone),loc:Ae.fromObject(a)});throw new et(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,a={}){if(sn(t))return new se({ts:t*1e3,zone:an(a.zone,Ue.defaultZone),loc:Ae.fromObject(a)});throw new et("fromSeconds requires a numerical input")}static fromObject(t,a={}){t=t||{};const s=an(a.zone,Ue.defaultZone);if(!s.isValid)return se.invalid(hi(s));const r=Ae.fromObject(a),d=pa(t,vr),{minDaysInFirstWeek:c,startOfWeek:h}=or(d,r),m=Ue.now(),p=he(a.specificOffset)?s.offset(m):a.specificOffset,y=!he(d.ordinal),v=!he(d.year),w=!he(d.month)||!he(d.day),S=v||w,E=d.weekYear||d.weekNumber;if((S||y)&&E)throw new Bn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(w&&y)throw new Bn("Can't mix ordinal dates with month/day");const P=E||d.weekday&&!S;let x,A,O=oa(m,p);P?(x=fh,A=dh,O=fa(O,c,h)):y?(x=mh,A=hh,O=os(O)):(x=$l,A=zl);let z=!1;for(const D of x){const F=d[D];he(F)?z?d[D]=A[D]:d[D]=O[D]:z=!0}const I=P?Zu(d,c,h):y?Wu(d):ul(d),B=I||dl(d);if(B)return se.invalid(B);const H=P?ar(d,c,h):y?sr(d):d,[$,M]=la(H,p,s),k=new se({ts:$,zone:s,o:M,loc:r});return d.weekday&&S&&t.weekday!==k.weekday?se.invalid("mismatched weekday",`you can't specify both a weekday of ${d.weekday} and a date of ${k.toISO()}`):k.isValid?k:se.invalid(k.invalid)}static fromISO(t,a={}){const[s,r]=Od(t);return Rn(s,r,a,"ISO 8601",t)}static fromRFC2822(t,a={}){const[s,r]=Fd(t);return Rn(s,r,a,"RFC 2822",t)}static fromHTTP(t,a={}){const[s,r]=Rd(t);return Rn(s,r,a,"HTTP",a)}static fromFormat(t,a,s={}){if(he(t)||he(a))throw new et("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:d=null}=s,c=Ae.fromOpts({locale:r,numberingSystem:d,defaultToEN:!0}),[h,m,p,y]=uh(c,t,a);return y?se.invalid(y):Rn(h,m,s,`format ${a}`,t,p)}static fromString(t,a,s={}){return se.fromFormat(t,a,s)}static fromSQL(t,a={}){const[s,r]=Wd(t);return Rn(s,r,a,"SQL",t)}static invalid(t,a=null){if(!t)throw new et("need to specify a reason the DateTime is invalid");const s=t instanceof Pt?t:new Pt(t,a);if(Ue.throwOnInvalid)throw new _u(s);return new se({invalid:s})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,a={}){const s=Fl(t,Ae.fromObject(a));return s?s.map(r=>r?r.val:null).join(""):null}static expandFormat(t,a={}){return Dl(tt.parseFormat(t),Ae.fromObject(a)).map(r=>r.val).join("")}static resetCache(){fi=void 0,Ps.clear()}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?cs(this).weekYear:NaN}get weekNumber(){return this.isValid?cs(this).weekNumber:NaN}get weekday(){return this.isValid?cs(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?us(this).weekday:NaN}get localWeekNumber(){return this.isValid?us(this).weekNumber:NaN}get localWeekYear(){return this.isValid?us(this).weekYear:NaN}get ordinal(){return this.isValid?os(this.c).ordinal:NaN}get monthShort(){return this.isValid?aa.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?aa.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?aa.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?aa.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const t=864e5,a=6e4,s=La(this.c),r=this.zone.offset(s-t),d=this.zone.offset(s+t),c=this.zone.offset(s-r*a),h=this.zone.offset(s-d*a);if(c===h)return[this];const m=s-c*a,p=s-h*a,y=oa(m,c),v=oa(p,h);return y.hour===v.hour&&y.minute===v.minute&&y.second===v.second&&y.millisecond===v.millisecond?[gn(this,{ts:m}),gn(this,{ts:p})]:[this]}get isInLeapYear(){return Ti(this.year)}get daysInMonth(){return ma(this.year,this.month)}get daysInYear(){return this.isValid?Hn(this.year):NaN}get weeksInWeekYear(){return this.isValid?vi(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?vi(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(t={}){const{locale:a,numberingSystem:s,calendar:r}=tt.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:a,numberingSystem:s,outputCalendar:r}}toUTC(t=0,a={}){return this.setZone(st.instance(t),a)}toLocal(){return this.setZone(Ue.defaultZone)}setZone(t,{keepLocalTime:a=!1,keepCalendarTime:s=!1}={}){if(t=an(t,Ue.defaultZone),t.equals(this.zone))return this;if(t.isValid){let r=this.ts;if(a||s){const d=t.offset(this.ts),c=this.toObject();[r]=la(c,d,t)}return gn(this,{ts:r,zone:t})}else return se.invalid(hi(t))}reconfigure({locale:t,numberingSystem:a,outputCalendar:s}={}){const r=this.loc.clone({locale:t,numberingSystem:a,outputCalendar:s});return gn(this,{loc:r})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const a=pa(t,vr),{minDaysInFirstWeek:s,startOfWeek:r}=or(a,this.loc),d=!he(a.weekYear)||!he(a.weekNumber)||!he(a.weekday),c=!he(a.ordinal),h=!he(a.year),m=!he(a.month)||!he(a.day),p=h||m,y=a.weekYear||a.weekNumber;if((p||c)&&y)throw new Bn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&c)throw new Bn("Can't mix ordinal dates with month/day");let v;d?v=ar({...fa(this.c,s,r),...a},s,r):he(a.ordinal)?(v={...this.toObject(),...a},he(a.day)&&(v.day=Math.min(ma(v.year,v.month),v.day))):v=sr({...os(this.c),...a});const[w,S]=la(v,this.o,this.zone);return gn(this,{ts:w,o:S})}plus(t){if(!this.isValid)return this;const a=Te.fromDurationLike(t);return gn(this,_r(this,a))}minus(t){if(!this.isValid)return this;const a=Te.fromDurationLike(t).negate();return gn(this,_r(this,a))}startOf(t,{useLocaleWeeks:a=!1}={}){if(!this.isValid)return this;const s={},r=Te.normalizeUnit(t);switch(r){case"years":s.month=1;case"quarters":case"months":s.day=1;case"weeks":case"days":s.hour=0;case"hours":s.minute=0;case"minutes":s.second=0;case"seconds":s.millisecond=0;break}if(r==="weeks")if(a){const d=this.loc.getStartOfWeek(),{weekday:c}=this;c<d&&(s.weekNumber=this.weekNumber-1),s.weekday=d}else s.weekday=1;if(r==="quarters"){const d=Math.ceil(this.month/3);s.month=(d-1)*3+1}return this.set(s)}endOf(t,a){return this.isValid?this.plus({[t]:1}).startOf(t,a).minus(1):this}toFormat(t,a={}){return this.isValid?tt.create(this.loc.redefaultToEN(a)).formatDateTimeFromString(this,t):ls}toLocaleString(t=ha,a={}){return this.isValid?tt.create(this.loc.clone(a),t).formatDateTime(this):ls}toLocaleParts(t={}){return this.isValid?tt.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:a=!1,suppressMilliseconds:s=!1,includeOffset:r=!0,extendedZone:d=!1}={}){if(!this.isValid)return null;const c=t==="extended";let h=ds(this,c);return h+="T",h+=yr(this,c,a,s,r,d),h}toISODate({format:t="extended"}={}){return this.isValid?ds(this,t==="extended"):null}toISOWeekDate(){return ra(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:a=!1,includeOffset:s=!0,includePrefix:r=!1,extendedZone:d=!1,format:c="extended"}={}){return this.isValid?(r?"T":"")+yr(this,c==="extended",a,t,s,d):null}toRFC2822(){return ra(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ra(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ds(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:a=!1,includeOffsetSpace:s=!0}={}){let r="HH:mm:ss.SSS";return(a||t)&&(s&&(r+=" "),a?r+="z":t&&(r+="ZZ")),ra(this,r,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():ls}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const a={...this.c};return t.includeConfig&&(a.outputCalendar=this.outputCalendar,a.numberingSystem=this.loc.numberingSystem,a.locale=this.loc.locale),a}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,a="milliseconds",s={}){if(!this.isValid||!t.isValid)return Te.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...s},d=ju(a).map(Te.normalizeUnit),c=t.valueOf()>this.valueOf(),h=c?this:t,m=c?t:this,p=Yd(h,m,d,r);return c?p.negate():p}diffNow(t="milliseconds",a={}){return this.diff(se.now(),t,a)}until(t){return this.isValid?Be.fromDateTimes(this,t):this}hasSame(t,a,s){if(!this.isValid)return!1;const r=t.valueOf(),d=this.setZone(t.zone,{keepLocalTime:!0});return d.startOf(a,s)<=r&&r<=d.endOf(a,s)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const a=t.base||se.fromObject({},{zone:this.zone}),s=t.padding?this<a?-t.padding:t.padding:0;let r=["years","months","days","hours","minutes","seconds"],d=t.unit;return Array.isArray(t.unit)&&(r=t.unit,d=void 0),Lr(a,this.plus(s),{...t,numeric:"always",units:r,unit:d})}toRelativeCalendar(t={}){return this.isValid?Lr(t.base||se.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(se.isDateTime))throw new et("min requires all arguments be DateTimes");return rr(t,a=>a.valueOf(),Math.min)}static max(...t){if(!t.every(se.isDateTime))throw new et("max requires all arguments be DateTimes");return rr(t,a=>a.valueOf(),Math.max)}static fromFormatExplain(t,a,s={}){const{locale:r=null,numberingSystem:d=null}=s,c=Ae.fromOpts({locale:r,numberingSystem:d,defaultToEN:!0});return Ol(c,t,a)}static fromStringExplain(t,a,s={}){return se.fromFormatExplain(t,a,s)}static buildFormatParser(t,a={}){const{locale:s=null,numberingSystem:r=null}=a,d=Ae.fromOpts({locale:s,numberingSystem:r,defaultToEN:!0});return new Nl(d,t)}static fromFormatParser(t,a,s={}){if(he(t)||he(a))throw new et("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:d=null}=s,c=Ae.fromOpts({locale:r,numberingSystem:d,defaultToEN:!0});if(!c.equals(a.locale))throw new et(`fromFormatParser called with a locale of ${c}, but the format parser was created for ${a.locale}`);const{result:h,zone:m,specificOffset:p,invalidReason:y}=a.explainFromTokens(t);return y?se.invalid(y):Rn(h,m,s,`format ${a.format}`,t,p)}static get DATE_SHORT(){return ha}static get DATE_MED(){return $r}static get DATE_MED_WITH_WEEKDAY(){return wu}static get DATE_FULL(){return Br}static get DATE_HUGE(){return Ur}static get TIME_SIMPLE(){return Hr}static get TIME_WITH_SECONDS(){return Zr}static get TIME_WITH_SHORT_OFFSET(){return Wr}static get TIME_WITH_LONG_OFFSET(){return Gr}static get TIME_24_SIMPLE(){return Vr}static get TIME_24_WITH_SECONDS(){return jr}static get TIME_24_WITH_SHORT_OFFSET(){return Jr}static get TIME_24_WITH_LONG_OFFSET(){return qr}static get DATETIME_SHORT(){return Kr}static get DATETIME_SHORT_WITH_SECONDS(){return Yr}static get DATETIME_MED(){return Xr}static get DATETIME_MED_WITH_SECONDS(){return Qr}static get DATETIME_MED_WITH_WEEKDAY(){return Lu}static get DATETIME_FULL(){return el}static get DATETIME_FULL_WITH_SECONDS(){return tl}static get DATETIME_HUGE(){return nl}static get DATETIME_HUGE_WITH_SECONDS(){return il}}function ui(i){if(se.isDateTime(i))return i;if(i&&i.valueOf&&sn(i.valueOf()))return se.fromJSDate(i);if(i&&typeof i=="object")return se.fromObject(i);throw new et(`Unknown datetime argument: ${i}, of type ${typeof i}`)}async function Ln(i,t,a=null){return console.log("[weatherManager] Starting full weather fetch for location:",{lat:i,lng:t}),await yh(i,t),await _h(i,t,a)}async function _h(i,t,a=null){var r,d;const s=document.getElementById("loading");s&&(s.style.display="block");try{const c=((r=document.getElementById("modelSelect"))==null?void 0:r.value)||g.defaultSettings.model;if(!c)throw new Error("No weather model selected.");const m=Ir.API_MAP[c]||c;let p=!1,y,v;const w=se.utc().startOf("day");let S=null;if(a){let z=se.fromISO(a,{zone:"utc"});z.isValid&&(S=z.startOf("day"),S<w&&(p=!0))}else{const z=(d=document.getElementById("historicalDatePicker"))==null?void 0:d.value;if(z){let I=se.fromISO(z,{zone:"utc"}).startOf("day");I<w&&(p=!0,S=I)}}let E=yi.FORECAST;if(p&&S)E=yi.HISTORICAL,y=v=S.toFormat("yyyy-MM-dd"),l.lastModelRun="N/A (Historical Data)";else{let z;try{const H=`https://api.open-meteo.com/data/${m}/static/meta.json`,M=await(await fetch(H)).json();z=new Date(M.last_run_initialisation_time*1e3),l.lastModelRun=z.toISOString().replace("T"," ").substring(0,17)+"Z"}catch{z=new Date,l.lastModelRun="N/A"}let I=se.fromJSDate(z).setZone("utc").plus({hours:6});I>se.utc()&&(I=se.utc()),y=I.toFormat("yyyy-MM-dd");const B=c.includes("_d2")?2:7;v=I.plus({days:B}).toFormat("yyyy-MM-dd")}const x=`${E}?latitude=${i}&longitude=${t}&hourly=surface_pressure,temperature_2m,relative_humidity_2m,wind_speed_10m,wind_direction_10m,wind_gusts_10m,temperature_1000hPa,relative_humidity_1000hPa,wind_speed_1000hPa,wind_direction_1000hPa,geopotential_height_1000hPa,temperature_950hPa,relative_humidity_950hPa,wind_speed_950hPa,wind_direction_950hPa,geopotential_height_950hPa,temperature_925hPa,relative_humidity_925hPa,wind_speed_925hPa,wind_direction_925hPa,geopotential_height_925hPa,temperature_900hPa,relative_humidity_900hPa,wind_speed_900hPa,wind_direction_900hPa,geopotential_height_900hPa,temperature_850hPa,relative_humidity_850hPa,wind_speed_850hPa,wind_direction_850hPa,geopotential_height_850hPa,temperature_800hPa,relative_humidity_800hPa,wind_speed_800hPa,wind_direction_800hPa,geopotential_height_800hPa,temperature_700hPa,relative_humidity_700hPa,wind_speed_700hPa,wind_direction_700hPa,geopotential_height_700hPa,temperature_600hPa,relative_humidity_600hPa,wind_speed_600hPa,wind_direction_600hPa,geopotential_height_600hPa,temperature_500hPa,relative_humidity_500hPa,wind_speed_500hPa,wind_direction_500hPa,geopotential_height_500hPa,temperature_400hPa,relative_humidity_400hPa,wind_speed_400hPa,wind_direction_400hPa,geopotential_height_400hPa,temperature_300hPa,relative_humidity_300hPa,wind_speed_300hPa,wind_direction_300hPa,geopotential_height_300hPa,temperature_250hPa,relative_humidity_250hPa,wind_speed_250hPa,wind_direction_250hPa,geopotential_height_250hPa,temperature_200hPa,relative_humidity_200hPa,wind_speed_200hPa,wind_direction_200hPa,geopotential_height_200hPa&models=${c}&start_date=${y}&end_date=${v}`,A=await fetch(x);if(!A.ok)throw new Error(`HTTP error! Status: ${A.status}`);const O=await A.json();if(!O.hourly||!O.hourly.time||!O.hourly.time.length)throw new Error("No hourly data in API response.");return O.hourly}catch(c){return console.error("[fetchWeather] Error:",c),Gn(`Failed to fetch weather: ${c.message}`),null}finally{s&&(s.style.display="none")}}async function yh(i,t){const a=Ir.LIST;let s=[];for(const r of a)try{const d=await fetch(`${yi.FORECAST}?latitude=${i}&longitude=${t}&hourly=temperature_2m&models=${r}`);if(d.ok){const c=await d.json();c.hourly&&c.hourly.temperature_2m&&c.hourly.temperature_2m.some(h=>h!==null)&&s.push(r)}else console.warn(`Modell '${r}' ist nicht verfügbar (Server-Antwort: ${d.status})`)}catch(d){console.error(`Netzwerkfehler beim Abruf von Modell '${r}':`,d)}return kh(s),Ph(s),xh(s),s}function Sn(i){if(!l.weatherData||!l.weatherData.time||i>=l.weatherData.time.length)return console.warn("No weather data available for interpolation"),[];const t=Math.round(l.lastAltitude),a=parseInt(Dr())||100,s=g.getValue("heightUnit","radio","m"),d=mu.filter($=>{var k;const M=(k=l.weatherData[`geopotential_height_${$}hPa`])==null?void 0:k[i];return M!=null});if(d.length<2)return console.warn("Insufficient valid pressure level data for interpolation:",d),[];let c=d.map($=>l.weatherData[`geopotential_height_${$}hPa`][i]),h=d.map($=>l.weatherData[`temperature_${$}hPa`][i]),m=d.map($=>l.weatherData[`relative_humidity_${$}hPa`][i]),p=d.map($=>l.weatherData[`wind_speed_${$}hPa`][i]),y=d.map($=>l.weatherData[`wind_direction_${$}hPa`][i]);const v=l.weatherData.surface_pressure[i];if(v==null)return console.warn("Surface pressure missing"),[];let w=p.map(($,M)=>-$*Math.sin(y[M]*Math.PI/180)),S=p.map(($,M)=>-$*Math.cos(y[M]*Math.PI/180));const E=Math.max(...d),P=l.weatherData[`geopotential_height_${E}hPa`][i];if(v>E&&Number.isFinite(P)&&P>t){const $=Math.floor((P-t)/a),M=-l.weatherData.wind_speed_10m[i]*Math.sin(l.weatherData.wind_direction_10m[i]*Math.PI/180),k=-l.weatherData.wind_speed_10m[i]*Math.cos(l.weatherData.wind_direction_10m[i]*Math.PI/180),D=w[d.indexOf(E)],F=S[d.indexOf(E)];for(let R=$-1;R>=1;R--){const G=t+R*a;if(G>=P)continue;const ie=(G-t)/(P-t),be=Math.log(v),te=Math.log(E),ae=be+ie*(te-be),W=Math.exp(ae),ee=Math.log(G-t+1),J=Math.log(1),Z=Math.log(P-t),ne=b.linearInterpolate([J,Z],[M,D],ee),V=b.linearInterpolate([J,Z],[k,F],ee),le=b.windSpeed(ne,V),Y=b.windDirection(ne,V);c.unshift(G),d.unshift(W),h.unshift(b.linearInterpolate([t,P],[l.weatherData.temperature_2m[i],l.weatherData[`temperature_${E}hPa`][i]],G)),m.unshift(b.linearInterpolate([t,P],[l.weatherData.relative_humidity_2m[i],l.weatherData[`relative_humidity_${E}hPa`][i]],G)),p.unshift(le),y.unshift(Y),w.unshift(ne),S.unshift(V)}c.unshift(t),d.unshift(v),h.unshift(l.weatherData.temperature_2m[i]),m.unshift(l.weatherData.relative_humidity_2m[i]),p.unshift(l.weatherData.wind_speed_10m[i]),y.unshift(l.weatherData.wind_direction_10m[i]),w.unshift(M),S.unshift(k)}const x=d.indexOf(Math.min(...d)),A=c[x],O=A-t;if(O<=0||isNaN(O))return console.warn("Invalid max height at lowest pressure level:",{maxHeightASL:A,baseHeight:t,minPressure:d[x]}),[];const z=s==="ft"?O*3.28084:O,I=Math.floor(z/a),B=Array.from({length:I+1},($,M)=>M*a);console.log("Interpolating up to lowest pressure level:",{maxHeightAGL:O,minPressure:d[x],interpStep:a});const H=[];return B.forEach($=>{const M=s==="ft"?$/3.28084:$,k=t+M;let D;if(M===0)D={height:k,pressure:v,temp:l.weatherData.temperature_2m[i],rh:l.weatherData.relative_humidity_2m[i],spd:l.weatherData.wind_speed_10m[i],dir:l.weatherData.wind_direction_10m[i],dew:b.calculateDewpoint(l.weatherData.temperature_2m[i],l.weatherData.relative_humidity_2m[i])};else{const F=b.interpolatePressure(k,d,c),R=b.interpolateWindAtAltitude(k,d,c,w,S),G=b.windSpeed(R.u,R.v),ie=b.windDirection(R.u,R.v),be=b.linearInterpolate(c,h,k),te=b.linearInterpolate(c,m,k),ae=b.calculateDewpoint(be,te);D={height:k,pressure:F==="N/A"?"N/A":Number(F.toFixed(1)),temp:Number(be.toFixed(1)),rh:Number(te.toFixed(0)),spd:Number(G.toFixed(1)),dir:Number(ie.toFixed(0)),dew:Number(ae.toFixed(1))}}D.displayHeight=$,H.push(D)}),console.log("Interpolated data length:",H.length,"Max height:",H[H.length-1].displayHeight),H}function vh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var mi={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var wh=mi.exports,br;function Lh(){return br||(br=1,function(i,t){(function(a,s){s(t)})(wh,function(a){var s="1.9.4";function r(e){var n,o,u,f;for(o=1,u=arguments.length;o<u;o++){f=arguments[o];for(n in f)e[n]=f[n]}return e}var d=Object.create||function(){function e(){}return function(n){return e.prototype=n,new e}}();function c(e,n){var o=Array.prototype.slice;if(e.bind)return e.bind.apply(e,o.call(arguments,1));var u=o.call(arguments,2);return function(){return e.apply(n,u.length?u.concat(o.call(arguments)):arguments)}}var h=0;function m(e){return"_leaflet_id"in e||(e._leaflet_id=++h),e._leaflet_id}function p(e,n,o){var u,f,_,T;return T=function(){u=!1,f&&(_.apply(o,f),f=!1)},_=function(){u?f=arguments:(e.apply(o,arguments),setTimeout(T,n),u=!0)},_}function y(e,n,o){var u=n[1],f=n[0],_=u-f;return e===u&&o?e:((e-f)%_+_)%_+f}function v(){return!1}function w(e,n){if(n===!1)return e;var o=Math.pow(10,n===void 0?6:n);return Math.round(e*o)/o}function S(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function E(e){return S(e).split(/\s+/)}function P(e,n){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?d(e.options):{});for(var o in n)e.options[o]=n[o];return e.options}function x(e,n,o){var u=[];for(var f in e)u.push(encodeURIComponent(o?f.toUpperCase():f)+"="+encodeURIComponent(e[f]));return(!n||n.indexOf("?")===-1?"?":"&")+u.join("&")}var A=/\{ *([\w_ -]+) *\}/g;function O(e,n){return e.replace(A,function(o,u){var f=n[u];if(f===void 0)throw new Error("No value provided for variable "+o);return typeof f=="function"&&(f=f(n)),f})}var z=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function I(e,n){for(var o=0;o<e.length;o++)if(e[o]===n)return o;return-1}var B="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function H(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var $=0;function M(e){var n=+new Date,o=Math.max(0,16-(n-$));return $=n+o,window.setTimeout(e,o)}var k=window.requestAnimationFrame||H("RequestAnimationFrame")||M,D=window.cancelAnimationFrame||H("CancelAnimationFrame")||H("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function F(e,n,o){if(o&&k===M)e.call(n);else return k.call(window,c(e,n))}function R(e){e&&D.call(window,e)}var G={__proto__:null,extend:r,create:d,bind:c,get lastId(){return h},stamp:m,throttle:p,wrapNum:y,falseFn:v,formatNum:w,trim:S,splitWords:E,setOptions:P,getParamString:x,template:O,isArray:z,indexOf:I,emptyImageUrl:B,requestFn:k,cancelFn:D,requestAnimFrame:F,cancelAnimFrame:R};function ie(){}ie.extend=function(e){var n=function(){P(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=n.__super__=this.prototype,u=d(o);u.constructor=n,n.prototype=u;for(var f in this)Object.prototype.hasOwnProperty.call(this,f)&&f!=="prototype"&&f!=="__super__"&&(n[f]=this[f]);return e.statics&&r(n,e.statics),e.includes&&(be(e.includes),r.apply(null,[u].concat(e.includes))),r(u,e),delete u.statics,delete u.includes,u.options&&(u.options=o.options?d(o.options):{},r(u.options,e.options)),u._initHooks=[],u.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var _=0,T=u._initHooks.length;_<T;_++)u._initHooks[_].call(this)}},n},ie.include=function(e){var n=this.prototype.options;return r(this.prototype,e),e.options&&(this.prototype.options=n,this.mergeOptions(e.options)),this},ie.mergeOptions=function(e){return r(this.prototype.options,e),this},ie.addInitHook=function(e){var n=Array.prototype.slice.call(arguments,1),o=typeof e=="function"?e:function(){this[e].apply(this,n)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};function be(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=z(e)?e:[e];for(var n=0;n<e.length;n++)e[n]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var te={on:function(e,n,o){if(typeof e=="object")for(var u in e)this._on(u,e[u],n);else{e=E(e);for(var f=0,_=e.length;f<_;f++)this._on(e[f],n,o)}return this},off:function(e,n,o){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var u in e)this._off(u,e[u],n);else{e=E(e);for(var f=arguments.length===1,_=0,T=e.length;_<T;_++)f?this._off(e[_]):this._off(e[_],n,o)}return this},_on:function(e,n,o,u){if(typeof n!="function"){console.warn("wrong listener type: "+typeof n);return}if(this._listens(e,n,o)===!1){o===this&&(o=void 0);var f={fn:n,ctx:o};u&&(f.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(f)}},_off:function(e,n,o){var u,f,_;if(this._events&&(u=this._events[e],!!u)){if(arguments.length===1){if(this._firingCount)for(f=0,_=u.length;f<_;f++)u[f].fn=v;delete this._events[e];return}if(typeof n!="function"){console.warn("wrong listener type: "+typeof n);return}var T=this._listens(e,n,o);if(T!==!1){var C=u[T];this._firingCount&&(C.fn=v,this._events[e]=u=u.slice()),u.splice(T,1)}}},fire:function(e,n,o){if(!this.listens(e,o))return this;var u=r({},n,{type:e,target:this,sourceTarget:n&&n.sourceTarget||this});if(this._events){var f=this._events[e];if(f){this._firingCount=this._firingCount+1||1;for(var _=0,T=f.length;_<T;_++){var C=f[_],N=C.fn;C.once&&this.off(e,N,C.ctx),N.call(C.ctx||this,u)}this._firingCount--}}return o&&this._propagateEvent(u),this},listens:function(e,n,o,u){typeof e!="string"&&console.warn('"string" type argument expected');var f=n;typeof n!="function"&&(u=!!n,f=void 0,o=void 0);var _=this._events&&this._events[e];if(_&&_.length&&this._listens(e,f,o)!==!1)return!0;if(u){for(var T in this._eventParents)if(this._eventParents[T].listens(e,n,o,u))return!0}return!1},_listens:function(e,n,o){if(!this._events)return!1;var u=this._events[e]||[];if(!n)return!!u.length;o===this&&(o=void 0);for(var f=0,_=u.length;f<_;f++)if(u[f].fn===n&&u[f].ctx===o)return f;return!1},once:function(e,n,o){if(typeof e=="object")for(var u in e)this._on(u,e[u],n,!0);else{e=E(e);for(var f=0,_=e.length;f<_;f++)this._on(e[f],n,o,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[m(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[m(e)],this},_propagateEvent:function(e){for(var n in this._eventParents)this._eventParents[n].fire(e.type,r({layer:e.target,propagatedFrom:e.target},e),!0)}};te.addEventListener=te.on,te.removeEventListener=te.clearAllEventListeners=te.off,te.addOneTimeEventListener=te.once,te.fireEvent=te.fire,te.hasEventListeners=te.listens;var ae=ie.extend(te);function W(e,n,o){this.x=o?Math.round(e):e,this.y=o?Math.round(n):n}var ee=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};W.prototype={clone:function(){return new W(this.x,this.y)},add:function(e){return this.clone()._add(J(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(J(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new W(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new W(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ee(this.x),this.y=ee(this.y),this},distanceTo:function(e){e=J(e);var n=e.x-this.x,o=e.y-this.y;return Math.sqrt(n*n+o*o)},equals:function(e){return e=J(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=J(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+w(this.x)+", "+w(this.y)+")"}};function J(e,n,o){return e instanceof W?e:z(e)?new W(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new W(e.x,e.y):new W(e,n,o)}function Z(e,n){if(e)for(var o=n?[e,n]:e,u=0,f=o.length;u<f;u++)this.extend(o[u])}Z.prototype={extend:function(e){var n,o;if(!e)return this;if(e instanceof W||typeof e[0]=="number"||"x"in e)n=o=J(e);else if(e=ne(e),n=e.min,o=e.max,!n||!o)return this;return!this.min&&!this.max?(this.min=n.clone(),this.max=o.clone()):(this.min.x=Math.min(n.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(n.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)),this},getCenter:function(e){return J((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return J(this.min.x,this.max.y)},getTopRight:function(){return J(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var n,o;return typeof e[0]=="number"||e instanceof W?e=J(e):e=ne(e),e instanceof Z?(n=e.min,o=e.max):n=o=e,n.x>=this.min.x&&o.x<=this.max.x&&n.y>=this.min.y&&o.y<=this.max.y},intersects:function(e){e=ne(e);var n=this.min,o=this.max,u=e.min,f=e.max,_=f.x>=n.x&&u.x<=o.x,T=f.y>=n.y&&u.y<=o.y;return _&&T},overlaps:function(e){e=ne(e);var n=this.min,o=this.max,u=e.min,f=e.max,_=f.x>n.x&&u.x<o.x,T=f.y>n.y&&u.y<o.y;return _&&T},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var n=this.min,o=this.max,u=Math.abs(n.x-o.x)*e,f=Math.abs(n.y-o.y)*e;return ne(J(n.x-u,n.y-f),J(o.x+u,o.y+f))},equals:function(e){return e?(e=ne(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function ne(e,n){return!e||e instanceof Z?e:new Z(e,n)}function V(e,n){if(e)for(var o=n?[e,n]:e,u=0,f=o.length;u<f;u++)this.extend(o[u])}V.prototype={extend:function(e){var n=this._southWest,o=this._northEast,u,f;if(e instanceof Y)u=e,f=e;else if(e instanceof V){if(u=e._southWest,f=e._northEast,!u||!f)return this}else return e?this.extend(j(e)||le(e)):this;return!n&&!o?(this._southWest=new Y(u.lat,u.lng),this._northEast=new Y(f.lat,f.lng)):(n.lat=Math.min(u.lat,n.lat),n.lng=Math.min(u.lng,n.lng),o.lat=Math.max(f.lat,o.lat),o.lng=Math.max(f.lng,o.lng)),this},pad:function(e){var n=this._southWest,o=this._northEast,u=Math.abs(n.lat-o.lat)*e,f=Math.abs(n.lng-o.lng)*e;return new V(new Y(n.lat-u,n.lng-f),new Y(o.lat+u,o.lng+f))},getCenter:function(){return new Y((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Y(this.getNorth(),this.getWest())},getSouthEast:function(){return new Y(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof Y||"lat"in e?e=j(e):e=le(e);var n=this._southWest,o=this._northEast,u,f;return e instanceof V?(u=e.getSouthWest(),f=e.getNorthEast()):u=f=e,u.lat>=n.lat&&f.lat<=o.lat&&u.lng>=n.lng&&f.lng<=o.lng},intersects:function(e){e=le(e);var n=this._southWest,o=this._northEast,u=e.getSouthWest(),f=e.getNorthEast(),_=f.lat>=n.lat&&u.lat<=o.lat,T=f.lng>=n.lng&&u.lng<=o.lng;return _&&T},overlaps:function(e){e=le(e);var n=this._southWest,o=this._northEast,u=e.getSouthWest(),f=e.getNorthEast(),_=f.lat>n.lat&&u.lat<o.lat,T=f.lng>n.lng&&u.lng<o.lng;return _&&T},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,n){return e?(e=le(e),this._southWest.equals(e.getSouthWest(),n)&&this._northEast.equals(e.getNorthEast(),n)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function le(e,n){return e instanceof V?e:new V(e,n)}function Y(e,n,o){if(isNaN(e)||isNaN(n))throw new Error("Invalid LatLng object: ("+e+", "+n+")");this.lat=+e,this.lng=+n,o!==void 0&&(this.alt=+o)}Y.prototype={equals:function(e,n){if(!e)return!1;e=j(e);var o=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return o<=(n===void 0?1e-9:n)},toString:function(e){return"LatLng("+w(this.lat,e)+", "+w(this.lng,e)+")"},distanceTo:function(e){return X.distance(this,j(e))},wrap:function(){return X.wrapLatLng(this)},toBounds:function(e){var n=180*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return le([this.lat-n,this.lng-o],[this.lat+n,this.lng+o])},clone:function(){return new Y(this.lat,this.lng,this.alt)}};function j(e,n,o){return e instanceof Y?e:z(e)&&typeof e[0]!="object"?e.length===3?new Y(e[0],e[1],e[2]):e.length===2?new Y(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new Y(e.lat,"lng"in e?e.lng:e.lon,e.alt):n===void 0?null:new Y(e,n,o)}var fe={latLngToPoint:function(e,n){var o=this.projection.project(e),u=this.scale(n);return this.transformation._transform(o,u)},pointToLatLng:function(e,n){var o=this.scale(n),u=this.transformation.untransform(e,o);return this.projection.unproject(u)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var n=this.projection.bounds,o=this.scale(e),u=this.transformation.transform(n.min,o),f=this.transformation.transform(n.max,o);return new Z(u,f)},infinite:!1,wrapLatLng:function(e){var n=this.wrapLng?y(e.lng,this.wrapLng,!0):e.lng,o=this.wrapLat?y(e.lat,this.wrapLat,!0):e.lat,u=e.alt;return new Y(o,n,u)},wrapLatLngBounds:function(e){var n=e.getCenter(),o=this.wrapLatLng(n),u=n.lat-o.lat,f=n.lng-o.lng;if(u===0&&f===0)return e;var _=e.getSouthWest(),T=e.getNorthEast(),C=new Y(_.lat-u,_.lng-f),N=new Y(T.lat-u,T.lng-f);return new V(C,N)}},X=r({},fe,{wrapLng:[-180,180],R:6371e3,distance:function(e,n){var o=Math.PI/180,u=e.lat*o,f=n.lat*o,_=Math.sin((n.lat-e.lat)*o/2),T=Math.sin((n.lng-e.lng)*o/2),C=_*_+Math.cos(u)*Math.cos(f)*T*T,N=2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C));return this.R*N}}),de=6378137,we={R:de,MAX_LATITUDE:85.0511287798,project:function(e){var n=Math.PI/180,o=this.MAX_LATITUDE,u=Math.max(Math.min(o,e.lat),-o),f=Math.sin(u*n);return new W(this.R*e.lng*n,this.R*Math.log((1+f)/(1-f))/2)},unproject:function(e){var n=180/Math.PI;return new Y((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*n,e.x*n/this.R)},bounds:function(){var e=de*Math.PI;return new Z([-e,-e],[e,e])}()};function re(e,n,o,u){if(z(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=n,this._c=o,this._d=u}re.prototype={transform:function(e,n){return this._transform(e.clone(),n)},_transform:function(e,n){return n=n||1,e.x=n*(this._a*e.x+this._b),e.y=n*(this._c*e.y+this._d),e},untransform:function(e,n){return n=n||1,new W((e.x/n-this._b)/this._a,(e.y/n-this._d)/this._c)}};function Le(e,n,o,u){return new re(e,n,o,u)}var Ee=r({},X,{code:"EPSG:3857",projection:we,transformation:function(){var e=.5/(Math.PI*we.R);return Le(e,.5,-e,.5)}()}),pe=r({},Ee,{code:"EPSG:900913"});function me(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ce(e,n){var o="",u,f,_,T,C,N;for(u=0,_=e.length;u<_;u++){for(C=e[u],f=0,T=C.length;f<T;f++)N=C[f],o+=(f?"L":"M")+N.x+" "+N.y;o+=n?oe.svg?"z":"x":""}return o||"M0 0"}var De=document.documentElement.style,ye="ActiveXObject"in window,Ce=ye&&!document.addEventListener,Fe="msLaunchUri"in navigator&&!("documentMode"in document),ht=ct("webkit"),Ie=ct("android"),At=ct("android 2")||ct("android 3"),Re=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ve=Ie&&ct("Google")&&Re<537&&!("AudioNode"in window),Pe=!!window.opera,ze=!Fe&&ct("chrome"),qe=ct("gecko")&&!ht&&!Pe&&!ye,rn=!ze&&ct("safari"),qt=ct("phantom"),bt="OTransition"in De,it=navigator.platform.indexOf("Win")===0,Ct=ye&&"transition"in De,ln="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!At,bn="MozPerspective"in De,xi=!window.L_DISABLE_3D&&(Ct||ln||bn)&&!bt&&!qt,cn=typeof orientation<"u"||ct("mobile"),$t=cn&&ht,ka=cn&&ln,Ai=!window.PointerEvent&&window.MSPointerEvent,Ci=!!(window.PointerEvent||Ai),Ii="ontouchstart"in window||!!window.TouchEvent,Pa=!window.L_NO_TOUCH&&(Ii||Ci),Di=cn&&Pe,Ke=cn&&qe,It=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Mn=function(){var e=!1;try{var n=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",v,n),window.removeEventListener("testPassiveEventSupport",v,n)}catch{}return e}(),xa=function(){return!!document.createElement("canvas").getContext}(),Yn=!!(document.createElementNS&&me("svg").createSVGRect),Vs=!!Yn&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),js=!Yn&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var n=e.firstChild;return n.style.behavior="url(#default#VML)",n&&typeof n.adj=="object"}catch{return!1}}(),Js=navigator.platform.indexOf("Mac")===0,Ni=navigator.platform.indexOf("Linux")===0;function ct(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var oe={ie:ye,ielt9:Ce,edge:Fe,webkit:ht,android:Ie,android23:At,androidStock:Ve,opera:Pe,chrome:ze,gecko:qe,safari:rn,phantom:qt,opera12:bt,win:it,ie3d:Ct,webkit3d:ln,gecko3d:bn,any3d:xi,mobile:cn,mobileWebkit:$t,mobileWebkit3d:ka,msPointer:Ai,pointer:Ci,touch:Pa,touchNative:Ii,mobileOpera:Di,mobileGecko:Ke,retina:It,passiveEvents:Mn,canvas:xa,svg:Yn,vml:js,inlineSvg:Vs,mac:Js,linux:Ni},Oi=oe.msPointer?"MSPointerDown":"pointerdown",qs=oe.msPointer?"MSPointerMove":"pointermove",Ks=oe.msPointer?"MSPointerUp":"pointerup",Ys=oe.msPointer?"MSPointerCancel":"pointercancel",Aa={touchstart:Oi,touchmove:qs,touchend:Ks,touchcancel:Ys},Xs={touchstart:uc,touchmove:Fi,touchend:Fi,touchcancel:Fi},Tn={},Qs=!1;function sc(e,n,o){return n==="touchstart"&&cc(),Xs[n]?(o=Xs[n].bind(this,o),e.addEventListener(Aa[n],o,!1),o):(console.warn("wrong event specified:",n),v)}function oc(e,n,o){if(!Aa[n]){console.warn("wrong event specified:",n);return}e.removeEventListener(Aa[n],o,!1)}function rc(e){Tn[e.pointerId]=e}function lc(e){Tn[e.pointerId]&&(Tn[e.pointerId]=e)}function eo(e){delete Tn[e.pointerId]}function cc(){Qs||(document.addEventListener(Oi,rc,!0),document.addEventListener(qs,lc,!0),document.addEventListener(Ks,eo,!0),document.addEventListener(Ys,eo,!0),Qs=!0)}function Fi(e,n){if(n.pointerType!==(n.MSPOINTER_TYPE_MOUSE||"mouse")){n.touches=[];for(var o in Tn)n.touches.push(Tn[o]);n.changedTouches=[n],e(n)}}function uc(e,n){n.MSPOINTER_TYPE_TOUCH&&n.pointerType===n.MSPOINTER_TYPE_TOUCH&&Ye(n),Fi(e,n)}function dc(e){var n={},o,u;for(u in e)o=e[u],n[u]=o&&o.bind?o.bind(e):o;return e=n,n.type="dblclick",n.detail=2,n.isTrusted=!1,n._simulated=!0,n}var hc=200;function fc(e,n){e.addEventListener("dblclick",n);var o=0,u;function f(_){if(_.detail!==1){u=_.detail;return}if(!(_.pointerType==="mouse"||_.sourceCapabilities&&!_.sourceCapabilities.firesTouchEvents)){var T=so(_);if(!(T.some(function(N){return N instanceof HTMLLabelElement&&N.attributes.for})&&!T.some(function(N){return N instanceof HTMLInputElement||N instanceof HTMLSelectElement}))){var C=Date.now();C-o<=hc?(u++,u===2&&n(dc(_))):u=1,o=C}}}return e.addEventListener("click",f),{dblclick:n,simDblclick:f}}function mc(e,n){e.removeEventListener("dblclick",n.dblclick),e.removeEventListener("click",n.simDblclick)}var Ca=$i(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Xn=$i(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),to=Xn==="webkitTransition"||Xn==="OTransition"?Xn+"End":"transitionend";function no(e){return typeof e=="string"?document.getElementById(e):e}function Qn(e,n){var o=e.style[n]||e.currentStyle&&e.currentStyle[n];if((!o||o==="auto")&&document.defaultView){var u=document.defaultView.getComputedStyle(e,null);o=u?u[n]:null}return o==="auto"?null:o}function ke(e,n,o){var u=document.createElement(e);return u.className=n||"",o&&o.appendChild(u),u}function $e(e){var n=e.parentNode;n&&n.removeChild(e)}function Ri(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function En(e){var n=e.parentNode;n&&n.lastChild!==e&&n.appendChild(e)}function kn(e){var n=e.parentNode;n&&n.firstChild!==e&&n.insertBefore(e,n.firstChild)}function Ia(e,n){if(e.classList!==void 0)return e.classList.contains(n);var o=zi(e);return o.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(o)}function ve(e,n){if(e.classList!==void 0)for(var o=E(n),u=0,f=o.length;u<f;u++)e.classList.add(o[u]);else if(!Ia(e,n)){var _=zi(e);Da(e,(_?_+" ":"")+n)}}function He(e,n){e.classList!==void 0?e.classList.remove(n):Da(e,S((" "+zi(e)+" ").replace(" "+n+" "," ")))}function Da(e,n){e.className.baseVal===void 0?e.className=n:e.className.baseVal=n}function zi(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ft(e,n){"opacity"in e.style?e.style.opacity=n:"filter"in e.style&&pc(e,n)}function pc(e,n){var o=!1,u="DXImageTransform.Microsoft.Alpha";try{o=e.filters.item(u)}catch{if(n===1)return}n=Math.round(n*100),o?(o.Enabled=n!==100,o.Opacity=n):e.style.filter+=" progid:"+u+"(opacity="+n+")"}function $i(e){for(var n=document.documentElement.style,o=0;o<e.length;o++)if(e[o]in n)return e[o];return!1}function un(e,n,o){var u=n||new W(0,0);e.style[Ca]=(oe.ie3d?"translate("+u.x+"px,"+u.y+"px)":"translate3d("+u.x+"px,"+u.y+"px,0)")+(o?" scale("+o+")":"")}function Ze(e,n){e._leaflet_pos=n,oe.any3d?un(e,n):(e.style.left=n.x+"px",e.style.top=n.y+"px")}function dn(e){return e._leaflet_pos||new W(0,0)}var ei,ti,Na;if("onselectstart"in document)ei=function(){ge(window,"selectstart",Ye)},ti=function(){Ne(window,"selectstart",Ye)};else{var ni=$i(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ei=function(){if(ni){var e=document.documentElement.style;Na=e[ni],e[ni]="none"}},ti=function(){ni&&(document.documentElement.style[ni]=Na,Na=void 0)}}function Oa(){ge(window,"dragstart",Ye)}function Fa(){Ne(window,"dragstart",Ye)}var Bi,Ra;function za(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(Ui(),Bi=e,Ra=e.style.outlineStyle,e.style.outlineStyle="none",ge(window,"keydown",Ui))}function Ui(){Bi&&(Bi.style.outlineStyle=Ra,Bi=void 0,Ra=void 0,Ne(window,"keydown",Ui))}function io(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function $a(e){var n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}var gc={__proto__:null,TRANSFORM:Ca,TRANSITION:Xn,TRANSITION_END:to,get:no,getStyle:Qn,create:ke,remove:$e,empty:Ri,toFront:En,toBack:kn,hasClass:Ia,addClass:ve,removeClass:He,setClass:Da,getClass:zi,setOpacity:ft,testProp:$i,setTransform:un,setPosition:Ze,getPosition:dn,get disableTextSelection(){return ei},get enableTextSelection(){return ti},disableImageDrag:Oa,enableImageDrag:Fa,preventOutline:za,restoreOutline:Ui,getSizedParentNode:io,getScale:$a};function ge(e,n,o,u){if(n&&typeof n=="object")for(var f in n)Ua(e,f,n[f],o);else{n=E(n);for(var _=0,T=n.length;_<T;_++)Ua(e,n[_],o,u)}return this}var Dt="_leaflet_events";function Ne(e,n,o,u){if(arguments.length===1)ao(e),delete e[Dt];else if(n&&typeof n=="object")for(var f in n)Ha(e,f,n[f],o);else if(n=E(n),arguments.length===2)ao(e,function(C){return I(n,C)!==-1});else for(var _=0,T=n.length;_<T;_++)Ha(e,n[_],o,u);return this}function ao(e,n){for(var o in e[Dt]){var u=o.split(/\d/)[0];(!n||n(u))&&Ha(e,u,null,null,o)}}var Ba={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ua(e,n,o,u){var f=n+m(o)+(u?"_"+m(u):"");if(e[Dt]&&e[Dt][f])return this;var _=function(C){return o.call(u||e,C||window.event)},T=_;!oe.touchNative&&oe.pointer&&n.indexOf("touch")===0?_=sc(e,n,_):oe.touch&&n==="dblclick"?_=fc(e,_):"addEventListener"in e?n==="touchstart"||n==="touchmove"||n==="wheel"||n==="mousewheel"?e.addEventListener(Ba[n]||n,_,oe.passiveEvents?{passive:!1}:!1):n==="mouseenter"||n==="mouseleave"?(_=function(C){C=C||window.event,Wa(e,C)&&T(C)},e.addEventListener(Ba[n],_,!1)):e.addEventListener(n,T,!1):e.attachEvent("on"+n,_),e[Dt]=e[Dt]||{},e[Dt][f]=_}function Ha(e,n,o,u,f){f=f||n+m(o)+(u?"_"+m(u):"");var _=e[Dt]&&e[Dt][f];if(!_)return this;!oe.touchNative&&oe.pointer&&n.indexOf("touch")===0?oc(e,n,_):oe.touch&&n==="dblclick"?mc(e,_):"removeEventListener"in e?e.removeEventListener(Ba[n]||n,_,!1):e.detachEvent("on"+n,_),e[Dt][f]=null}function hn(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Za(e){return Ua(e,"wheel",hn),this}function ii(e){return ge(e,"mousedown touchstart dblclick contextmenu",hn),e._leaflet_disable_click=!0,this}function Ye(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function fn(e){return Ye(e),hn(e),this}function so(e){if(e.composedPath)return e.composedPath();for(var n=[],o=e.target;o;)n.push(o),o=o.parentNode;return n}function oo(e,n){if(!n)return new W(e.clientX,e.clientY);var o=$a(n),u=o.boundingClientRect;return new W((e.clientX-u.left)/o.x-n.clientLeft,(e.clientY-u.top)/o.y-n.clientTop)}var _c=oe.linux&&oe.chrome?window.devicePixelRatio:oe.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ro(e){return oe.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/_c:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function Wa(e,n){var o=n.relatedTarget;if(!o)return!0;try{for(;o&&o!==e;)o=o.parentNode}catch{return!1}return o!==e}var yc={__proto__:null,on:ge,off:Ne,stopPropagation:hn,disableScrollPropagation:Za,disableClickPropagation:ii,preventDefault:Ye,stop:fn,getPropagationPath:so,getMousePosition:oo,getWheelDelta:ro,isExternalTarget:Wa,addListener:ge,removeListener:Ne},lo=ae.extend({run:function(e,n,o,u){this.stop(),this._el=e,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(u||.5,.2),this._startPos=dn(e),this._offset=n.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=F(this._animate,this),this._step()},_step:function(e){var n=+new Date-this._startTime,o=this._duration*1e3;n<o?this._runFrame(this._easeOut(n/o),e):(this._runFrame(1),this._complete())},_runFrame:function(e,n){var o=this._startPos.add(this._offset.multiplyBy(e));n&&o._round(),Ze(this._el,o),this.fire("step")},_complete:function(){R(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),Me=ae.extend({options:{crs:Ee,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,n){n=P(this,n),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=c(this._onResize,this),this._initEvents(),n.maxBounds&&this.setMaxBounds(n.maxBounds),n.zoom!==void 0&&(this._zoom=this._limitZoom(n.zoom)),n.center&&n.zoom!==void 0&&this.setView(j(n.center),n.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Xn&&oe.any3d&&!oe.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ge(this._proxy,to,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,n,o){if(n=n===void 0?this._zoom:this._limitZoom(n),e=this._limitCenter(j(e),n,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&o!==!0){o.animate!==void 0&&(o.zoom=r({animate:o.animate},o.zoom),o.pan=r({animate:o.animate,duration:o.duration},o.pan));var u=this._zoom!==n?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,n,o.zoom):this._tryAnimatedPan(e,o.pan);if(u)return clearTimeout(this._sizeTimer),this}return this._resetView(e,n,o.pan&&o.pan.noMoveStart),this},setZoom:function(e,n){return this._loaded?this.setView(this.getCenter(),e,{zoom:n}):(this._zoom=e,this)},zoomIn:function(e,n){return e=e||(oe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,n)},zoomOut:function(e,n){return e=e||(oe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,n)},setZoomAround:function(e,n,o){var u=this.getZoomScale(n),f=this.getSize().divideBy(2),_=e instanceof W?e:this.latLngToContainerPoint(e),T=_.subtract(f).multiplyBy(1-1/u),C=this.containerPointToLatLng(f.add(T));return this.setView(C,n,{zoom:o})},_getBoundsCenterZoom:function(e,n){n=n||{},e=e.getBounds?e.getBounds():le(e);var o=J(n.paddingTopLeft||n.padding||[0,0]),u=J(n.paddingBottomRight||n.padding||[0,0]),f=this.getBoundsZoom(e,!1,o.add(u));if(f=typeof n.maxZoom=="number"?Math.min(n.maxZoom,f):f,f===1/0)return{center:e.getCenter(),zoom:f};var _=u.subtract(o).divideBy(2),T=this.project(e.getSouthWest(),f),C=this.project(e.getNorthEast(),f),N=this.unproject(T.add(C).divideBy(2).add(_),f);return{center:N,zoom:f}},fitBounds:function(e,n){if(e=le(e),!e.isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(e,n);return this.setView(o.center,o.zoom,n)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,n){return this.setView(e,this._zoom,{pan:n})},panBy:function(e,n){if(e=J(e).round(),n=n||{},!e.x&&!e.y)return this.fire("moveend");if(n.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new lo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),n.noMoveStart||this.fire("movestart"),n.animate!==!1){ve(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,o,n.duration||.25,n.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,n,o){if(o=o||{},o.animate===!1||!oe.any3d)return this.setView(e,n,o);this._stop();var u=this.project(this.getCenter()),f=this.project(e),_=this.getSize(),T=this._zoom;e=j(e),n=n===void 0?T:n;var C=Math.max(_.x,_.y),N=C*this.getZoomScale(T,n),U=f.distanceTo(u)||1,Q=1.42,ue=Q*Q;function Se(We){var Qi=We?-1:1,ou=We?N:C,ru=N*N-C*C+Qi*ue*ue*U*U,lu=2*ou*ue*U,ts=ru/lu,Zo=Math.sqrt(ts*ts+1)-ts,cu=Zo<1e-9?-18:Math.log(Zo);return cu}function at(We){return(Math.exp(We)-Math.exp(-We))/2}function je(We){return(Math.exp(We)+Math.exp(-We))/2}function pt(We){return at(We)/je(We)}var ot=Se(0);function Dn(We){return C*(je(ot)/je(ot+Q*We))}function nu(We){return C*(je(ot)*pt(ot+Q*We)-at(ot))/ue}function iu(We){return 1-Math.pow(1-We,1.5)}var au=Date.now(),Uo=(Se(1)-ot)/Q,su=o.duration?1e3*o.duration:1e3*Uo*.8;function Ho(){var We=(Date.now()-au)/su,Qi=iu(We)*Uo;We<=1?(this._flyToFrame=F(Ho,this),this._move(this.unproject(u.add(f.subtract(u).multiplyBy(nu(Qi)/U)),T),this.getScaleZoom(C/Dn(Qi),T),{flyTo:!0})):this._move(e,n)._moveEnd(!0)}return this._moveStart(!0,o.noMoveStart),Ho.call(this),this},flyToBounds:function(e,n){var o=this._getBoundsCenterZoom(e,n);return this.flyTo(o.center,o.zoom,n)},setMaxBounds:function(e){return e=le(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var n=this.options.minZoom;return this.options.minZoom=e,this._loaded&&n!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var n=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&n!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,n){this._enforcingBounds=!0;var o=this.getCenter(),u=this._limitCenter(o,this._zoom,le(e));return o.equals(u)||this.panTo(u,n),this._enforcingBounds=!1,this},panInside:function(e,n){n=n||{};var o=J(n.paddingTopLeft||n.padding||[0,0]),u=J(n.paddingBottomRight||n.padding||[0,0]),f=this.project(this.getCenter()),_=this.project(e),T=this.getPixelBounds(),C=ne([T.min.add(o),T.max.subtract(u)]),N=C.getSize();if(!C.contains(_)){this._enforcingBounds=!0;var U=_.subtract(C.getCenter()),Q=C.extend(_).getSize().subtract(N);f.x+=U.x<0?-Q.x:Q.x,f.y+=U.y<0?-Q.y:Q.y,this.panTo(this.unproject(f),n),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=r({animate:!1,pan:!0},e===!0?{animate:!0}:e);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),u=n.divideBy(2).round(),f=o.divideBy(2).round(),_=u.subtract(f);return!_.x&&!_.y?this:(e.animate&&e.pan?this.panBy(_):(e.pan&&this._rawPanBy(_),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(c(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:o}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=r({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=c(this._handleGeolocationResponse,this),o=c(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,o,e):navigator.geolocation.getCurrentPosition(n,o,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var n=e.code,o=e.message||(n===1?"permission denied":n===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:n,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var n=e.coords.latitude,o=e.coords.longitude,u=new Y(n,o),f=u.toBounds(e.coords.accuracy*2),_=this._locateOptions;if(_.setView){var T=this.getBoundsZoom(f);this.setView(u,_.maxZoom?Math.min(T,_.maxZoom):T)}var C={latlng:u,bounds:f,timestamp:e.timestamp};for(var N in e.coords)typeof e.coords[N]=="number"&&(C[N]=e.coords[N]);this.fire("locationfound",C)}},addHandler:function(e,n){if(!n)return this;var o=this[e]=new n(this);return this._handlers.push(o),this.options[e]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),$e(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(R(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)$e(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,n){var o="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),u=ke("div",o,n||this._mapPane);return e&&(this._panes[e]=u),u},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),n=this.unproject(e.getBottomLeft()),o=this.unproject(e.getTopRight());return new V(n,o)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,n,o){e=le(e),o=J(o||[0,0]);var u=this.getZoom()||0,f=this.getMinZoom(),_=this.getMaxZoom(),T=e.getNorthWest(),C=e.getSouthEast(),N=this.getSize().subtract(o),U=ne(this.project(C,u),this.project(T,u)).getSize(),Q=oe.any3d?this.options.zoomSnap:1,ue=N.x/U.x,Se=N.y/U.y,at=n?Math.max(ue,Se):Math.min(ue,Se);return u=this.getScaleZoom(at,u),Q&&(u=Math.round(u/(Q/100))*(Q/100),u=n?Math.ceil(u/Q)*Q:Math.floor(u/Q)*Q),Math.max(f,Math.min(_,u))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new W(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,n){var o=this._getTopLeftPoint(e,n);return new Z(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,n){var o=this.options.crs;return n=n===void 0?this._zoom:n,o.scale(e)/o.scale(n)},getScaleZoom:function(e,n){var o=this.options.crs;n=n===void 0?this._zoom:n;var u=o.zoom(e*o.scale(n));return isNaN(u)?1/0:u},project:function(e,n){return n=n===void 0?this._zoom:n,this.options.crs.latLngToPoint(j(e),n)},unproject:function(e,n){return n=n===void 0?this._zoom:n,this.options.crs.pointToLatLng(J(e),n)},layerPointToLatLng:function(e){var n=J(e).add(this.getPixelOrigin());return this.unproject(n)},latLngToLayerPoint:function(e){var n=this.project(j(e))._round();return n._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(j(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(le(e))},distance:function(e,n){return this.options.crs.distance(j(e),j(n))},containerPointToLayerPoint:function(e){return J(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return J(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var n=this.containerPointToLayerPoint(J(e));return this.layerPointToLatLng(n)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(j(e)))},mouseEventToContainerPoint:function(e){return oo(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var n=this._container=no(e);if(n){if(n._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ge(n,"scroll",this._onScroll,this),this._containerId=m(n)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&oe.any3d,ve(e,"leaflet-container"+(oe.touch?" leaflet-touch":"")+(oe.retina?" leaflet-retina":"")+(oe.ielt9?" leaflet-oldie":"")+(oe.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var n=Qn(e,"position");n!=="absolute"&&n!=="relative"&&n!=="fixed"&&n!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ze(this._mapPane,new W(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ve(e.markerPane,"leaflet-zoom-hide"),ve(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,n,o){Ze(this._mapPane,new W(0,0));var u=!this._loaded;this._loaded=!0,n=this._limitZoom(n),this.fire("viewprereset");var f=this._zoom!==n;this._moveStart(f,o)._move(e,n)._moveEnd(f),this.fire("viewreset"),u&&this.fire("load")},_moveStart:function(e,n){return e&&this.fire("zoomstart"),n||this.fire("movestart"),this},_move:function(e,n,o,u){n===void 0&&(n=this._zoom);var f=this._zoom!==n;return this._zoom=n,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),u?o&&o.pinch&&this.fire("zoom",o):((f||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return R(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Ze(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[m(this._container)]=this;var n=e?Ne:ge;n(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&n(window,"resize",this._onResize,this),oe.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){R(this._resizeRequest),this._resizeRequest=F(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,n){for(var o=[],u,f=n==="mouseout"||n==="mouseover",_=e.target||e.srcElement,T=!1;_;){if(u=this._targets[m(_)],u&&(n==="click"||n==="preclick")&&this._draggableMoved(u)){T=!0;break}if(u&&u.listens(n,!0)&&(f&&!Wa(_,e)||(o.push(u),f))||_===this._container)break;_=_.parentNode}return!o.length&&!T&&!f&&this.listens(n,!0)&&(o=[this]),o},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var n=e.target||e.srcElement;if(!(!this._loaded||n._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(n))){var o=e.type;o==="mousedown"&&za(n),this._fireDOMEvent(e,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,n,o){if(e.type==="click"){var u=r({},e);u.type="preclick",this._fireDOMEvent(u,u.type,o)}var f=this._findEventTargets(e,n);if(o){for(var _=[],T=0;T<o.length;T++)o[T].listens(n,!0)&&_.push(o[T]);f=_.concat(f)}if(f.length){n==="contextmenu"&&Ye(e);var C=f[0],N={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var U=C.getLatLng&&(!C._radius||C._radius<=10);N.containerPoint=U?this.latLngToContainerPoint(C.getLatLng()):this.mouseEventToContainerPoint(e),N.layerPoint=this.containerPointToLayerPoint(N.containerPoint),N.latlng=U?C.getLatLng():this.layerPointToLatLng(N.layerPoint)}for(T=0;T<f.length;T++)if(f[T].fire(n,N,!0),N.originalEvent._stopped||f[T].options.bubblingMouseEvents===!1&&I(this._mouseEvents,n)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,n=this._handlers.length;e<n;e++)this._handlers[e].disable()},whenReady:function(e,n){return this._loaded?e.call(n||this,{target:this}):this.on("load",e,n),this},_getMapPanePos:function(){return dn(this._mapPane)||new W(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,n){var o=e&&n!==void 0?this._getNewPixelOrigin(e,n):this.getPixelOrigin();return o.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,n){var o=this.getSize()._divideBy(2);return this.project(e,n)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,n,o){var u=this._getNewPixelOrigin(o,n);return this.project(e,n)._subtract(u)},_latLngBoundsToNewLayerBounds:function(e,n,o){var u=this._getNewPixelOrigin(o,n);return ne([this.project(e.getSouthWest(),n)._subtract(u),this.project(e.getNorthWest(),n)._subtract(u),this.project(e.getSouthEast(),n)._subtract(u),this.project(e.getNorthEast(),n)._subtract(u)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,n,o){if(!o)return e;var u=this.project(e,n),f=this.getSize().divideBy(2),_=new Z(u.subtract(f),u.add(f)),T=this._getBoundsOffset(_,o,n);return Math.abs(T.x)<=1&&Math.abs(T.y)<=1?e:this.unproject(u.add(T),n)},_limitOffset:function(e,n){if(!n)return e;var o=this.getPixelBounds(),u=new Z(o.min.add(e),o.max.add(e));return e.add(this._getBoundsOffset(u,n))},_getBoundsOffset:function(e,n,o){var u=ne(this.project(n.getNorthEast(),o),this.project(n.getSouthWest(),o)),f=u.min.subtract(e.min),_=u.max.subtract(e.max),T=this._rebound(f.x,-_.x),C=this._rebound(f.y,-_.y);return new W(T,C)},_rebound:function(e,n){return e+n>0?Math.round(e-n)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(n))},_limitZoom:function(e){var n=this.getMinZoom(),o=this.getMaxZoom(),u=oe.any3d?this.options.zoomSnap:1;return u&&(e=Math.round(e/u)*u),Math.max(n,Math.min(o,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){He(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,n){var o=this._getCenterOffset(e)._trunc();return(n&&n.animate)!==!0&&!this.getSize().contains(o)?!1:(this.panBy(o,n),!0)},_createAnimProxy:function(){var e=this._proxy=ke("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(n){var o=Ca,u=this._proxy.style[o];un(this._proxy,this.project(n.center,n.zoom),this.getZoomScale(n.zoom,1)),u===this._proxy.style[o]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){$e(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),n=this.getZoom();un(this._proxy,this.project(e,n),this.getZoomScale(n,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,n,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||o.animate===!1||this._nothingToAnimate()||Math.abs(n-this._zoom)>this.options.zoomAnimationThreshold)return!1;var u=this.getZoomScale(n),f=this._getCenterOffset(e)._divideBy(1-1/u);return o.animate!==!0&&!this.getSize().contains(f)?!1:(F(function(){this._moveStart(!0,o.noMoveStart||!1)._animateZoom(e,n,!0)},this),!0)},_animateZoom:function(e,n,o,u){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=n,ve(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:n,noUpdate:u}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(c(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&He(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function vc(e,n){return new Me(e,n)}var Mt=ie.extend({options:{position:"topright"},initialize:function(e){P(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var n=this._map;return n&&n.removeControl(this),this.options.position=e,n&&n.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var n=this._container=this.onAdd(e),o=this.getPosition(),u=e._controlCorners[o];return ve(n,"leaflet-control"),o.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?($e(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),ai=function(e){return new Mt(e)};Me.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},n="leaflet-",o=this._controlContainer=ke("div",n+"control-container",this._container);function u(f,_){var T=n+f+" "+n+_;e[f+_]=ke("div",T,o)}u("top","left"),u("top","right"),u("bottom","left"),u("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)$e(this._controlCorners[e]);$e(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var co=Mt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,n,o,u){return o<u?-1:u<o?1:0}},initialize:function(e,n,o){P(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var u in e)this._addLayer(e[u],u);for(u in n)this._addLayer(n[u],u,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var n=0;n<this._layers.length;n++)this._layers[n].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return Mt.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,n){return this._addLayer(e,n),this._map?this._update():this},addOverlay:function(e,n){return this._addLayer(e,n,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var n=this._getLayer(m(e));return n&&this._layers.splice(this._layers.indexOf(n),1),this._map?this._update():this},expand:function(){ve(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(ve(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):He(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return He(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",n=this._container=ke("div",e),o=this.options.collapsed;n.setAttribute("aria-haspopup",!0),ii(n),Za(n);var u=this._section=ke("section",e+"-list");o&&(this._map.on("click",this.collapse,this),ge(n,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var f=this._layersLink=ke("a",e+"-toggle",n);f.href="#",f.title="Layers",f.setAttribute("role","button"),ge(f,{keydown:function(_){_.keyCode===13&&this._expandSafely()},click:function(_){Ye(_),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=ke("div",e+"-base",u),this._separator=ke("div",e+"-separator",u),this._overlaysList=ke("div",e+"-overlays",u),n.appendChild(u)},_getLayer:function(e){for(var n=0;n<this._layers.length;n++)if(this._layers[n]&&m(this._layers[n].layer)===e)return this._layers[n]},_addLayer:function(e,n,o){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:n,overlay:o}),this.options.sortLayers&&this._layers.sort(c(function(u,f){return this.options.sortFunction(u.layer,f.layer,u.name,f.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ri(this._baseLayersList),Ri(this._overlaysList),this._layerControlInputs=[];var e,n,o,u,f=0;for(o=0;o<this._layers.length;o++)u=this._layers[o],this._addItem(u),n=n||u.overlay,e=e||!u.overlay,f+=u.overlay?0:1;return this.options.hideSingleBase&&(e=e&&f>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=n&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var n=this._getLayer(m(e.target)),o=n.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;o&&this._map.fire(o,n)},_createRadioElement:function(e,n){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(n?' checked="checked"':"")+"/>",u=document.createElement("div");return u.innerHTML=o,u.firstChild},_addItem:function(e){var n=document.createElement("label"),o=this._map.hasLayer(e.layer),u;e.overlay?(u=document.createElement("input"),u.type="checkbox",u.className="leaflet-control-layers-selector",u.defaultChecked=o):u=this._createRadioElement("leaflet-base-layers_"+m(this),o),this._layerControlInputs.push(u),u.layerId=m(e.layer),ge(u,"click",this._onInputClick,this);var f=document.createElement("span");f.innerHTML=" "+e.name;var _=document.createElement("span");n.appendChild(_),_.appendChild(u),_.appendChild(f);var T=e.overlay?this._overlaysList:this._baseLayersList;return T.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,n,o,u=[],f=[];this._handlingClick=!0;for(var _=e.length-1;_>=0;_--)n=e[_],o=this._getLayer(n.layerId).layer,n.checked?u.push(o):n.checked||f.push(o);for(_=0;_<f.length;_++)this._map.hasLayer(f[_])&&this._map.removeLayer(f[_]);for(_=0;_<u.length;_++)this._map.hasLayer(u[_])||this._map.addLayer(u[_]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,n,o,u=this._map.getZoom(),f=e.length-1;f>=0;f--)n=e[f],o=this._getLayer(n.layerId).layer,n.disabled=o.options.minZoom!==void 0&&u<o.options.minZoom||o.options.maxZoom!==void 0&&u>o.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,ge(e,"click",Ye),this.expand();var n=this;setTimeout(function(){Ne(e,"click",Ye),n._preventClick=!1})}}),wc=function(e,n,o){return new co(e,n,o)},Ga=Mt.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var n="leaflet-control-zoom",o=ke("div",n+" leaflet-bar"),u=this.options;return this._zoomInButton=this._createButton(u.zoomInText,u.zoomInTitle,n+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(u.zoomOutText,u.zoomOutTitle,n+"-out",o,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,n,o,u,f){var _=ke("a",o,u);return _.innerHTML=e,_.href="#",_.title=n,_.setAttribute("role","button"),_.setAttribute("aria-label",n),ii(_),ge(_,"click",fn),ge(_,"click",f,this),ge(_,"click",this._refocusOnMap,this),_},_updateDisabled:function(){var e=this._map,n="leaflet-disabled";He(this._zoomInButton,n),He(this._zoomOutButton,n),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(ve(this._zoomOutButton,n),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(ve(this._zoomInButton,n),this._zoomInButton.setAttribute("aria-disabled","true"))}});Me.mergeOptions({zoomControl:!0}),Me.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ga,this.addControl(this.zoomControl))});var Lc=function(e){return new Ga(e)},uo=Mt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var n="leaflet-control-scale",o=ke("div",n),u=this.options;return this._addScales(u,n+"-line",o),e.on(u.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),o},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,n,o){e.metric&&(this._mScale=ke("div",n,o)),e.imperial&&(this._iScale=ke("div",n,o))},_update:function(){var e=this._map,n=e.getSize().y/2,o=e.distance(e.containerPointToLatLng([0,n]),e.containerPointToLatLng([this.options.maxWidth,n]));this._updateScales(o)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var n=this._getRoundNum(e),o=n<1e3?n+" m":n/1e3+" km";this._updateScale(this._mScale,o,n/e)},_updateImperial:function(e){var n=e*3.2808399,o,u,f;n>5280?(o=n/5280,u=this._getRoundNum(o),this._updateScale(this._iScale,u+" mi",u/o)):(f=this._getRoundNum(n),this._updateScale(this._iScale,f+" ft",f/n))},_updateScale:function(e,n,o){e.style.width=Math.round(this.options.maxWidth*o)+"px",e.innerHTML=n},_getRoundNum:function(e){var n=Math.pow(10,(Math.floor(e)+"").length-1),o=e/n;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,n*o}}),Sc=function(e){return new uo(e)},bc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Va=Mt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(oe.inlineSvg?bc+" ":"")+"Leaflet</a>"},initialize:function(e){P(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=ke("div","leaflet-control-attribution"),ii(this._container);for(var n in e._layers)e._layers[n].getAttribution&&this.addAttribution(e._layers[n].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var n in this._attributions)this._attributions[n]&&e.push(n);var o=[];this.options.prefix&&o.push(this.options.prefix),e.length&&o.push(e.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});Me.mergeOptions({attributionControl:!0}),Me.addInitHook(function(){this.options.attributionControl&&new Va().addTo(this)});var Mc=function(e){return new Va(e)};Mt.Layers=co,Mt.Zoom=Ga,Mt.Scale=uo,Mt.Attribution=Va,ai.layers=wc,ai.zoom=Lc,ai.scale=Sc,ai.attribution=Mc;var Nt=ie.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Nt.addTo=function(e,n){return e.addHandler(n,this),this};var Tc={Events:te},ho=oe.touch?"touchstart mousedown":"mousedown",Kt=ae.extend({options:{clickTolerance:3},initialize:function(e,n,o,u){P(this,u),this._element=e,this._dragStartTarget=n||e,this._preventOutline=o},enable:function(){this._enabled||(ge(this._dragStartTarget,ho,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Kt._dragging===this&&this.finishDrag(!0),Ne(this._dragStartTarget,ho,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!Ia(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){Kt._dragging===this&&this.finishDrag();return}if(!(Kt._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(Kt._dragging=this,this._preventOutline&&za(this._element),Oa(),ei(),!this._moving)){this.fire("down");var n=e.touches?e.touches[0]:e,o=io(this._element);this._startPoint=new W(n.clientX,n.clientY),this._startPos=dn(this._element),this._parentScale=$a(o);var u=e.type==="mousedown";ge(document,u?"mousemove":"touchmove",this._onMove,this),ge(document,u?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var n=e.touches&&e.touches.length===1?e.touches[0]:e,o=new W(n.clientX,n.clientY)._subtract(this._startPoint);!o.x&&!o.y||Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,Ye(e),this._moved||(this.fire("dragstart"),this._moved=!0,ve(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ve(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Ze(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){He(document.body,"leaflet-dragging"),this._lastTarget&&(He(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ne(document,"mousemove touchmove",this._onMove,this),Ne(document,"mouseup touchend touchcancel",this._onUp,this),Fa(),ti();var n=this._moved&&this._moving;this._moving=!1,Kt._dragging=!1,n&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function fo(e,n,o){var u,f=[1,4,2,8],_,T,C,N,U,Q,ue,Se;for(_=0,Q=e.length;_<Q;_++)e[_]._code=mn(e[_],n);for(C=0;C<4;C++){for(ue=f[C],u=[],_=0,Q=e.length,T=Q-1;_<Q;T=_++)N=e[_],U=e[T],N._code&ue?U._code&ue||(Se=Hi(U,N,ue,n,o),Se._code=mn(Se,n),u.push(Se)):(U._code&ue&&(Se=Hi(U,N,ue,n,o),Se._code=mn(Se,n),u.push(Se)),u.push(N));e=u}return e}function mo(e,n){var o,u,f,_,T,C,N,U,Q;if(!e||e.length===0)throw new Error("latlngs not passed");mt(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var ue=j([0,0]),Se=le(e),at=Se.getNorthWest().distanceTo(Se.getSouthWest())*Se.getNorthEast().distanceTo(Se.getNorthWest());at<1700&&(ue=ja(e));var je=e.length,pt=[];for(o=0;o<je;o++){var ot=j(e[o]);pt.push(n.project(j([ot.lat-ue.lat,ot.lng-ue.lng])))}for(C=N=U=0,o=0,u=je-1;o<je;u=o++)f=pt[o],_=pt[u],T=f.y*_.x-_.y*f.x,N+=(f.x+_.x)*T,U+=(f.y+_.y)*T,C+=T*3;C===0?Q=pt[0]:Q=[N/C,U/C];var Dn=n.unproject(J(Q));return j([Dn.lat+ue.lat,Dn.lng+ue.lng])}function ja(e){for(var n=0,o=0,u=0,f=0;f<e.length;f++){var _=j(e[f]);n+=_.lat,o+=_.lng,u++}return j([n/u,o/u])}var Ec={__proto__:null,clipPolygon:fo,polygonCenter:mo,centroid:ja};function po(e,n){if(!n||!e.length)return e.slice();var o=n*n;return e=xc(e,o),e=Pc(e,o),e}function go(e,n,o){return Math.sqrt(si(e,n,o,!0))}function kc(e,n,o){return si(e,n,o)}function Pc(e,n){var o=e.length,u=typeof Uint8Array<"u"?Uint8Array:Array,f=new u(o);f[0]=f[o-1]=1,Ja(e,f,n,0,o-1);var _,T=[];for(_=0;_<o;_++)f[_]&&T.push(e[_]);return T}function Ja(e,n,o,u,f){var _=0,T,C,N;for(C=u+1;C<=f-1;C++)N=si(e[C],e[u],e[f],!0),N>_&&(T=C,_=N);_>o&&(n[T]=1,Ja(e,n,o,u,T),Ja(e,n,o,T,f))}function xc(e,n){for(var o=[e[0]],u=1,f=0,_=e.length;u<_;u++)Ac(e[u],e[f])>n&&(o.push(e[u]),f=u);return f<_-1&&o.push(e[_-1]),o}var _o;function yo(e,n,o,u,f){var _=u?_o:mn(e,o),T=mn(n,o),C,N,U;for(_o=T;;){if(!(_|T))return[e,n];if(_&T)return!1;C=_||T,N=Hi(e,n,C,o,f),U=mn(N,o),C===_?(e=N,_=U):(n=N,T=U)}}function Hi(e,n,o,u,f){var _=n.x-e.x,T=n.y-e.y,C=u.min,N=u.max,U,Q;return o&8?(U=e.x+_*(N.y-e.y)/T,Q=N.y):o&4?(U=e.x+_*(C.y-e.y)/T,Q=C.y):o&2?(U=N.x,Q=e.y+T*(N.x-e.x)/_):o&1&&(U=C.x,Q=e.y+T*(C.x-e.x)/_),new W(U,Q,f)}function mn(e,n){var o=0;return e.x<n.min.x?o|=1:e.x>n.max.x&&(o|=2),e.y<n.min.y?o|=4:e.y>n.max.y&&(o|=8),o}function Ac(e,n){var o=n.x-e.x,u=n.y-e.y;return o*o+u*u}function si(e,n,o,u){var f=n.x,_=n.y,T=o.x-f,C=o.y-_,N=T*T+C*C,U;return N>0&&(U=((e.x-f)*T+(e.y-_)*C)/N,U>1?(f=o.x,_=o.y):U>0&&(f+=T*U,_+=C*U)),T=e.x-f,C=e.y-_,u?T*T+C*C:new W(f,_)}function mt(e){return!z(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function vo(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),mt(e)}function wo(e,n){var o,u,f,_,T,C,N,U;if(!e||e.length===0)throw new Error("latlngs not passed");mt(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var Q=j([0,0]),ue=le(e),Se=ue.getNorthWest().distanceTo(ue.getSouthWest())*ue.getNorthEast().distanceTo(ue.getNorthWest());Se<1700&&(Q=ja(e));var at=e.length,je=[];for(o=0;o<at;o++){var pt=j(e[o]);je.push(n.project(j([pt.lat-Q.lat,pt.lng-Q.lng])))}for(o=0,u=0;o<at-1;o++)u+=je[o].distanceTo(je[o+1])/2;if(u===0)U=je[0];else for(o=0,_=0;o<at-1;o++)if(T=je[o],C=je[o+1],f=T.distanceTo(C),_+=f,_>u){N=(_-u)/f,U=[C.x-N*(C.x-T.x),C.y-N*(C.y-T.y)];break}var ot=n.unproject(J(U));return j([ot.lat+Q.lat,ot.lng+Q.lng])}var Cc={__proto__:null,simplify:po,pointToSegmentDistance:go,closestPointOnSegment:kc,clipSegment:yo,_getEdgeIntersection:Hi,_getBitCode:mn,_sqClosestPointOnSegment:si,isFlat:mt,_flat:vo,polylineCenter:wo},qa={project:function(e){return new W(e.lng,e.lat)},unproject:function(e){return new Y(e.y,e.x)},bounds:new Z([-180,-90],[180,90])},Ka={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Z([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(e){var n=Math.PI/180,o=this.R,u=e.lat*n,f=this.R_MINOR/o,_=Math.sqrt(1-f*f),T=_*Math.sin(u),C=Math.tan(Math.PI/4-u/2)/Math.pow((1-T)/(1+T),_/2);return u=-o*Math.log(Math.max(C,1e-10)),new W(e.lng*n*o,u)},unproject:function(e){for(var n=180/Math.PI,o=this.R,u=this.R_MINOR/o,f=Math.sqrt(1-u*u),_=Math.exp(-e.y/o),T=Math.PI/2-2*Math.atan(_),C=0,N=.1,U;C<15&&Math.abs(N)>1e-7;C++)U=f*Math.sin(T),U=Math.pow((1-U)/(1+U),f/2),N=Math.PI/2-2*Math.atan(_*U)-T,T+=N;return new Y(T*n,e.x*n/o)}},Ic={__proto__:null,LonLat:qa,Mercator:Ka,SphericalMercator:we},Dc=r({},X,{code:"EPSG:3395",projection:Ka,transformation:function(){var e=.5/(Math.PI*Ka.R);return Le(e,.5,-e,.5)}()}),Lo=r({},X,{code:"EPSG:4326",projection:qa,transformation:Le(1/180,1,-1/180,.5)}),Nc=r({},fe,{projection:qa,transformation:Le(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,n){var o=n.lng-e.lng,u=n.lat-e.lat;return Math.sqrt(o*o+u*u)},infinite:!0});fe.Earth=X,fe.EPSG3395=Dc,fe.EPSG3857=Ee,fe.EPSG900913=pe,fe.EPSG4326=Lo,fe.Simple=Nc;var Tt=ae.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[m(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[m(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var n=e.target;if(n.hasLayer(this)){if(this._map=n,this._zoomAnimated=n._zoomAnimated,this.getEvents){var o=this.getEvents();n.on(o,this),this.once("remove",function(){n.off(o,this)},this)}this.onAdd(n),this.fire("add"),n.fire("layeradd",{layer:this})}}});Me.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var n=m(e);return this._layers[n]?this:(this._layers[n]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var n=m(e);return this._layers[n]?(this._loaded&&e.onRemove(this),delete this._layers[n],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return m(e)in this._layers},eachLayer:function(e,n){for(var o in this._layers)e.call(n,this._layers[o]);return this},_addLayers:function(e){e=e?z(e)?e:[e]:[];for(var n=0,o=e.length;n<o;n++)this.addLayer(e[n])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[m(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var n=m(e);this._zoomBoundLayers[n]&&(delete this._zoomBoundLayers[n],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,n=-1/0,o=this._getZoomSpan();for(var u in this._zoomBoundLayers){var f=this._zoomBoundLayers[u].options;e=f.minZoom===void 0?e:Math.min(e,f.minZoom),n=f.maxZoom===void 0?n:Math.max(n,f.maxZoom)}this._layersMaxZoom=n===-1/0?void 0:n,this._layersMinZoom=e===1/0?void 0:e,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Pn=Tt.extend({initialize:function(e,n){P(this,n),this._layers={};var o,u;if(e)for(o=0,u=e.length;o<u;o++)this.addLayer(e[o])},addLayer:function(e){var n=this.getLayerId(e);return this._layers[n]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var n=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[n]&&this._map.removeLayer(this._layers[n]),delete this._layers[n],this},hasLayer:function(e){var n=typeof e=="number"?e:this.getLayerId(e);return n in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var n=Array.prototype.slice.call(arguments,1),o,u;for(o in this._layers)u=this._layers[o],u[e]&&u[e].apply(u,n);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,n){for(var o in this._layers)e.call(n,this._layers[o]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return m(e)}}),Oc=function(e,n){return new Pn(e,n)},Bt=Pn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Pn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Pn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new V;for(var n in this._layers){var o=this._layers[n];e.extend(o.getBounds?o.getBounds():o.getLatLng())}return e}}),Fc=function(e,n){return new Bt(e,n)},xn=ie.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){P(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,n){var o=this._getIconUrl(e);if(!o){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var u=this._createImg(o,n&&n.tagName==="IMG"?n:null);return this._setIconStyles(u,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(u.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),u},_setIconStyles:function(e,n){var o=this.options,u=o[n+"Size"];typeof u=="number"&&(u=[u,u]);var f=J(u),_=J(n==="shadow"&&o.shadowAnchor||o.iconAnchor||f&&f.divideBy(2,!0));e.className="leaflet-marker-"+n+" "+(o.className||""),_&&(e.style.marginLeft=-_.x+"px",e.style.marginTop=-_.y+"px"),f&&(e.style.width=f.x+"px",e.style.height=f.y+"px")},_createImg:function(e,n){return n=n||document.createElement("img"),n.src=e,n},_getIconUrl:function(e){return oe.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Rc(e){return new xn(e)}var oi=xn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof oi.imagePath!="string"&&(oi.imagePath=this._detectIconPath()),(this.options.imagePath||oi.imagePath)+xn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var n=function(o,u,f){var _=u.exec(o);return _&&_[f]};return e=n(e,/^url\((['"])?(.+)\1\)$/,2),e&&n(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=ke("div","leaflet-default-icon-path",document.body),n=Qn(e,"background-image")||Qn(e,"backgroundImage");if(document.body.removeChild(e),n=this._stripUrl(n),n)return n;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}),So=Nt.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Kt(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ve(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&He(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var n=this._marker,o=n._map,u=this._marker.options.autoPanSpeed,f=this._marker.options.autoPanPadding,_=dn(n._icon),T=o.getPixelBounds(),C=o.getPixelOrigin(),N=ne(T.min._subtract(C).add(f),T.max._subtract(C).subtract(f));if(!N.contains(_)){var U=J((Math.max(N.max.x,_.x)-N.max.x)/(T.max.x-N.max.x)-(Math.min(N.min.x,_.x)-N.min.x)/(T.min.x-N.min.x),(Math.max(N.max.y,_.y)-N.max.y)/(T.max.y-N.max.y)-(Math.min(N.min.y,_.y)-N.min.y)/(T.min.y-N.min.y)).multiplyBy(u);o.panBy(U,{animate:!1}),this._draggable._newPos._add(U),this._draggable._startPos._add(U),Ze(n._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=F(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(R(this._panRequest),this._panRequest=F(this._adjustPan.bind(this,e)))},_onDrag:function(e){var n=this._marker,o=n._shadow,u=dn(n._icon),f=n._map.layerPointToLatLng(u);o&&Ze(o,u),n._latlng=f,e.latlng=f,e.oldLatLng=this._oldLatLng,n.fire("move",e).fire("drag",e)},_onDragEnd:function(e){R(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Zi=Tt.extend({options:{icon:new oi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,n){P(this,n),this._latlng=j(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var n=this._latlng;return this._latlng=j(e),this.update(),this.fire("move",{oldLatLng:n,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,n="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=e.icon.createIcon(this._icon),u=!1;o!==this._icon&&(this._icon&&this._removeIcon(),u=!0,e.title&&(o.title=e.title),o.tagName==="IMG"&&(o.alt=e.alt||"")),ve(o,n),e.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ge(o,"focus",this._panOnFocus,this);var f=e.icon.createShadow(this._shadow),_=!1;f!==this._shadow&&(this._removeShadow(),_=!0),f&&(ve(f,n),f.alt=""),this._shadow=f,e.opacity<1&&this._updateOpacity(),u&&this.getPane().appendChild(this._icon),this._initInteraction(),f&&_&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ne(this._icon,"focus",this._panOnFocus,this),$e(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&$e(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Ze(this._icon,e),this._shadow&&Ze(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var n=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(n)},_initInteraction:function(){if(this.options.interactive&&(ve(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),So)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new So(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&ft(this._icon,e),this._shadow&&ft(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var n=this.options.icon.options,o=n.iconSize?J(n.iconSize):J(0,0),u=n.iconAnchor?J(n.iconAnchor):J(0,0);e.panInside(this._latlng,{paddingTopLeft:u,paddingBottomRight:o.subtract(u)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function zc(e,n){return new Zi(e,n)}var Yt=Tt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return P(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Wi=Yt.extend({options:{fill:!0,radius:10},initialize:function(e,n){P(this,n),this._latlng=j(e),this._radius=this.options.radius},setLatLng:function(e){var n=this._latlng;return this._latlng=j(e),this.redraw(),this.fire("move",{oldLatLng:n,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var n=e&&e.radius||this._radius;return Yt.prototype.setStyle.call(this,e),this.setRadius(n),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,n=this._radiusY||e,o=this._clickTolerance(),u=[e+o,n+o];this._pxBounds=new Z(this._point.subtract(u),this._point.add(u))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function $c(e,n){return new Wi(e,n)}var Ya=Wi.extend({initialize:function(e,n,o){if(typeof n=="number"&&(n=r({},o,{radius:n})),P(this,n),this._latlng=j(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new V(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Yt.prototype.setStyle,_project:function(){var e=this._latlng.lng,n=this._latlng.lat,o=this._map,u=o.options.crs;if(u.distance===X.distance){var f=Math.PI/180,_=this._mRadius/X.R/f,T=o.project([n+_,e]),C=o.project([n-_,e]),N=T.add(C).divideBy(2),U=o.unproject(N).lat,Q=Math.acos((Math.cos(_*f)-Math.sin(n*f)*Math.sin(U*f))/(Math.cos(n*f)*Math.cos(U*f)))/f;(isNaN(Q)||Q===0)&&(Q=_/Math.cos(Math.PI/180*n)),this._point=N.subtract(o.getPixelOrigin()),this._radius=isNaN(Q)?0:N.x-o.project([U,e-Q]).x,this._radiusY=N.y-T.y}else{var ue=u.unproject(u.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(ue).x}this._updateBounds()}});function Bc(e,n,o){return new Ya(e,n,o)}var Ut=Yt.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,n){P(this,n),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var n=1/0,o=null,u=si,f,_,T=0,C=this._parts.length;T<C;T++)for(var N=this._parts[T],U=1,Q=N.length;U<Q;U++){f=N[U-1],_=N[U];var ue=u(e,f,_,!0);ue<n&&(n=ue,o=u(e,f,_))}return o&&(o.distance=Math.sqrt(n)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return wo(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,n){return n=n||this._defaultShape(),e=j(e),n.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new V,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return mt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var n=[],o=mt(e),u=0,f=e.length;u<f;u++)o?(n[u]=j(e[u]),this._bounds.extend(n[u])):n[u]=this._convertLatLngs(e[u]);return n},_project:function(){var e=new Z;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),n=new W(e,e);this._rawPxBounds&&(this._pxBounds=new Z([this._rawPxBounds.min.subtract(n),this._rawPxBounds.max.add(n)]))},_projectLatlngs:function(e,n,o){var u=e[0]instanceof Y,f=e.length,_,T;if(u){for(T=[],_=0;_<f;_++)T[_]=this._map.latLngToLayerPoint(e[_]),o.extend(T[_]);n.push(T)}else for(_=0;_<f;_++)this._projectLatlngs(e[_],n,o)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var n=this._parts,o,u,f,_,T,C,N;for(o=0,f=0,_=this._rings.length;o<_;o++)for(N=this._rings[o],u=0,T=N.length;u<T-1;u++)C=yo(N[u],N[u+1],e,u,!0),C&&(n[f]=n[f]||[],n[f].push(C[0]),(C[1]!==N[u+1]||u===T-2)&&(n[f].push(C[1]),f++))}},_simplifyPoints:function(){for(var e=this._parts,n=this.options.smoothFactor,o=0,u=e.length;o<u;o++)e[o]=po(e[o],n)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,n){var o,u,f,_,T,C,N=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(o=0,_=this._parts.length;o<_;o++)for(C=this._parts[o],u=0,T=C.length,f=T-1;u<T;f=u++)if(!(!n&&u===0)&&go(e,C[f],C[u])<=N)return!0;return!1}});function Uc(e,n){return new Ut(e,n)}Ut._flat=vo;var An=Ut.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return mo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var n=Ut.prototype._convertLatLngs.call(this,e),o=n.length;return o>=2&&n[0]instanceof Y&&n[0].equals(n[o-1])&&n.pop(),n},_setLatLngs:function(e){Ut.prototype._setLatLngs.call(this,e),mt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return mt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,n=this.options.weight,o=new W(n,n);if(e=new Z(e.min.subtract(o),e.max.add(o)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var u=0,f=this._rings.length,_;u<f;u++)_=fo(this._rings[u],e,!0),_.length&&this._parts.push(_)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var n=!1,o,u,f,_,T,C,N,U;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(_=0,N=this._parts.length;_<N;_++)for(o=this._parts[_],T=0,U=o.length,C=U-1;T<U;C=T++)u=o[T],f=o[C],u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(n=!n);return n||Ut.prototype._containsPoint.call(this,e,!0)}});function Hc(e,n){return new An(e,n)}var Ht=Bt.extend({initialize:function(e,n){P(this,n),this._layers={},e&&this.addData(e)},addData:function(e){var n=z(e)?e:e.features,o,u,f;if(n){for(o=0,u=n.length;o<u;o++)f=n[o],(f.geometries||f.geometry||f.features||f.coordinates)&&this.addData(f);return this}var _=this.options;if(_.filter&&!_.filter(e))return this;var T=Gi(e,_);return T?(T.feature=Ji(e),T.defaultOptions=T.options,this.resetStyle(T),_.onEachFeature&&_.onEachFeature(e,T),this.addLayer(T)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=r({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(n){this._setLayerStyle(n,e)},this)},_setLayerStyle:function(e,n){e.setStyle&&(typeof n=="function"&&(n=n(e.feature)),e.setStyle(n))}});function Gi(e,n){var o=e.type==="Feature"?e.geometry:e,u=o?o.coordinates:null,f=[],_=n&&n.pointToLayer,T=n&&n.coordsToLatLng||Xa,C,N,U,Q;if(!u&&!o)return null;switch(o.type){case"Point":return C=T(u),bo(_,e,C,n);case"MultiPoint":for(U=0,Q=u.length;U<Q;U++)C=T(u[U]),f.push(bo(_,e,C,n));return new Bt(f);case"LineString":case"MultiLineString":return N=Vi(u,o.type==="LineString"?0:1,T),new Ut(N,n);case"Polygon":case"MultiPolygon":return N=Vi(u,o.type==="Polygon"?1:2,T),new An(N,n);case"GeometryCollection":for(U=0,Q=o.geometries.length;U<Q;U++){var ue=Gi({geometry:o.geometries[U],type:"Feature",properties:e.properties},n);ue&&f.push(ue)}return new Bt(f);case"FeatureCollection":for(U=0,Q=o.features.length;U<Q;U++){var Se=Gi(o.features[U],n);Se&&f.push(Se)}return new Bt(f);default:throw new Error("Invalid GeoJSON object.")}}function bo(e,n,o,u){return e?e(n,o):new Zi(o,u&&u.markersInheritOptions&&u)}function Xa(e){return new Y(e[1],e[0],e[2])}function Vi(e,n,o){for(var u=[],f=0,_=e.length,T;f<_;f++)T=n?Vi(e[f],n-1,o):(o||Xa)(e[f]),u.push(T);return u}function Qa(e,n){return e=j(e),e.alt!==void 0?[w(e.lng,n),w(e.lat,n),w(e.alt,n)]:[w(e.lng,n),w(e.lat,n)]}function ji(e,n,o,u){for(var f=[],_=0,T=e.length;_<T;_++)f.push(n?ji(e[_],mt(e[_])?0:n-1,o,u):Qa(e[_],u));return!n&&o&&f.length>0&&f.push(f[0].slice()),f}function Cn(e,n){return e.feature?r({},e.feature,{geometry:n}):Ji(n)}function Ji(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var es={toGeoJSON:function(e){return Cn(this,{type:"Point",coordinates:Qa(this.getLatLng(),e)})}};Zi.include(es),Ya.include(es),Wi.include(es),Ut.include({toGeoJSON:function(e){var n=!mt(this._latlngs),o=ji(this._latlngs,n?1:0,!1,e);return Cn(this,{type:(n?"Multi":"")+"LineString",coordinates:o})}}),An.include({toGeoJSON:function(e){var n=!mt(this._latlngs),o=n&&!mt(this._latlngs[0]),u=ji(this._latlngs,o?2:n?1:0,!0,e);return n||(u=[u]),Cn(this,{type:(o?"Multi":"")+"Polygon",coordinates:u})}}),Pn.include({toMultiPoint:function(e){var n=[];return this.eachLayer(function(o){n.push(o.toGeoJSON(e).geometry.coordinates)}),Cn(this,{type:"MultiPoint",coordinates:n})},toGeoJSON:function(e){var n=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(n==="MultiPoint")return this.toMultiPoint(e);var o=n==="GeometryCollection",u=[];return this.eachLayer(function(f){if(f.toGeoJSON){var _=f.toGeoJSON(e);if(o)u.push(_.geometry);else{var T=Ji(_);T.type==="FeatureCollection"?u.push.apply(u,T.features):u.push(T)}}}),o?Cn(this,{geometries:u,type:"GeometryCollection"}):{type:"FeatureCollection",features:u}}});function Mo(e,n){return new Ht(e,n)}var Zc=Mo,qi=Tt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,n,o){this._url=e,this._bounds=le(n),P(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ve(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){$e(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&En(this._image),this},bringToBack:function(){return this._map&&kn(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=le(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",n=this._image=e?this._url:ke("img");if(ve(n,"leaflet-image-layer"),this._zoomAnimated&&ve(n,"leaflet-zoom-animated"),this.options.className&&ve(n,this.options.className),n.onselectstart=v,n.onmousemove=v,n.onload=c(this.fire,this,"load"),n.onerror=c(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(n.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=n.src;return}n.src=this._url,n.alt=this.options.alt},_animateZoom:function(e){var n=this._map.getZoomScale(e.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;un(this._image,o,n)},_reset:function(){var e=this._image,n=new Z(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=n.getSize();Ze(e,n.min),e.style.width=o.x+"px",e.style.height=o.y+"px"},_updateOpacity:function(){ft(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Wc=function(e,n,o){return new qi(e,n,o)},To=qi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",n=this._image=e?this._url:ke("video");if(ve(n,"leaflet-image-layer"),this._zoomAnimated&&ve(n,"leaflet-zoom-animated"),this.options.className&&ve(n,this.options.className),n.onselectstart=v,n.onmousemove=v,n.onloadeddata=c(this.fire,this,"load"),e){for(var o=n.getElementsByTagName("source"),u=[],f=0;f<o.length;f++)u.push(o[f].src);this._url=o.length>0?u:[n.src];return}z(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(n.style,"objectFit")&&(n.style.objectFit="fill"),n.autoplay=!!this.options.autoplay,n.loop=!!this.options.loop,n.muted=!!this.options.muted,n.playsInline=!!this.options.playsInline;for(var _=0;_<this._url.length;_++){var T=ke("source");T.src=this._url[_],n.appendChild(T)}}});function Gc(e,n,o){return new To(e,n,o)}var Eo=qi.extend({_initImage:function(){var e=this._image=this._url;ve(e,"leaflet-image-layer"),this._zoomAnimated&&ve(e,"leaflet-zoom-animated"),this.options.className&&ve(e,this.options.className),e.onselectstart=v,e.onmousemove=v}});function Vc(e,n,o){return new Eo(e,n,o)}var Ot=Tt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,n){e&&(e instanceof Y||z(e))?(this._latlng=j(e),P(this,n)):(P(this,e),this._source=n),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&ft(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&ft(this._container,1),this.bringToFront(),this.options.interactive&&(ve(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(ft(this._container,0),this._removeTimeout=setTimeout(c($e,void 0,this._container),200)):$e(this._container),this.options.interactive&&(He(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=j(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&En(this._container),this},bringToBack:function(){return this._map&&kn(this._container),this},_prepareOpen:function(e){var n=this._source;if(!n._map)return!1;if(n instanceof Bt){n=null;var o=this._source._layers;for(var u in o)if(o[u]._map){n=o[u];break}if(!n)return!1;this._source=n}if(!e)if(n.getCenter)e=n.getCenter();else if(n.getLatLng)e=n.getLatLng();else if(n.getBounds)e=n.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,n=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof n=="string")e.innerHTML=n;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(n)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),n=J(this.options.offset),o=this._getAnchor();this._zoomAnimated?Ze(this._container,e.add(o)):n=n.add(e).add(o);var u=this._containerBottom=-n.y,f=this._containerLeft=-Math.round(this._containerWidth/2)+n.x;this._container.style.bottom=u+"px",this._container.style.left=f+"px"}},_getAnchor:function(){return[0,0]}});Me.include({_initOverlay:function(e,n,o,u){var f=n;return f instanceof e||(f=new e(u).setContent(n)),o&&f.setLatLng(o),f}}),Tt.include({_initOverlay:function(e,n,o,u){var f=o;return f instanceof e?(P(f,u),f._source=this):(f=n&&!u?n:new e(u,this),f.setContent(o)),f}});var Ki=Ot.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Ot.prototype.openOn.call(this,e)},onAdd:function(e){Ot.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Yt||this._source.on("preclick",hn))},onRemove:function(e){Ot.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Yt||this._source.off("preclick",hn))},getEvents:function(){var e=Ot.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",n=this._container=ke("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=ke("div",e+"-content-wrapper",n);if(this._contentNode=ke("div",e+"-content",o),ii(n),Za(this._contentNode),ge(n,"contextmenu",hn),this._tipContainer=ke("div",e+"-tip-container",n),this._tip=ke("div",e+"-tip",this._tipContainer),this.options.closeButton){var u=this._closeButton=ke("a",e+"-close-button",n);u.setAttribute("role","button"),u.setAttribute("aria-label","Close popup"),u.href="#close",u.innerHTML='<span aria-hidden="true">&#215;</span>',ge(u,"click",function(f){Ye(f),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,n=e.style;n.width="",n.whiteSpace="nowrap";var o=e.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),n.width=o+1+"px",n.whiteSpace="",n.height="";var u=e.offsetHeight,f=this.options.maxHeight,_="leaflet-popup-scrolled";f&&u>f?(n.height=f+"px",ve(e,_)):He(e,_),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var n=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),o=this._getAnchor();Ze(this._container,n.add(o))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,n=parseInt(Qn(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+n,u=this._containerWidth,f=new W(this._containerLeft,-o-this._containerBottom);f._add(dn(this._container));var _=e.layerPointToContainerPoint(f),T=J(this.options.autoPanPadding),C=J(this.options.autoPanPaddingTopLeft||T),N=J(this.options.autoPanPaddingBottomRight||T),U=e.getSize(),Q=0,ue=0;_.x+u+N.x>U.x&&(Q=_.x+u-U.x+N.x),_.x-Q-C.x<0&&(Q=_.x-C.x),_.y+o+N.y>U.y&&(ue=_.y+o-U.y+N.y),_.y-ue-C.y<0&&(ue=_.y-C.y),(Q||ue)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([Q,ue]))}},_getAnchor:function(){return J(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),jc=function(e,n){return new Ki(e,n)};Me.mergeOptions({closePopupOnClick:!0}),Me.include({openPopup:function(e,n,o){return this._initOverlay(Ki,e,n,o).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),Tt.include({bindPopup:function(e,n){return this._popup=this._initOverlay(Ki,this._popup,e,n),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Bt||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){fn(e);var n=e.layer||e.target;if(this._popup._source===n&&!(n instanceof Yt)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=n,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Yi=Ot.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Ot.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Ot.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Ot.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",n=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ke("div",n),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+m(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var n,o,u=this._map,f=this._container,_=u.latLngToContainerPoint(u.getCenter()),T=u.layerPointToContainerPoint(e),C=this.options.direction,N=f.offsetWidth,U=f.offsetHeight,Q=J(this.options.offset),ue=this._getAnchor();C==="top"?(n=N/2,o=U):C==="bottom"?(n=N/2,o=0):C==="center"?(n=N/2,o=U/2):C==="right"?(n=0,o=U/2):C==="left"?(n=N,o=U/2):T.x<_.x?(C="right",n=0,o=U/2):(C="left",n=N+(Q.x+ue.x)*2,o=U/2),e=e.subtract(J(n,o,!0)).add(Q).add(ue),He(f,"leaflet-tooltip-right"),He(f,"leaflet-tooltip-left"),He(f,"leaflet-tooltip-top"),He(f,"leaflet-tooltip-bottom"),ve(f,"leaflet-tooltip-"+C),Ze(f,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&ft(this._container,e)},_animateZoom:function(e){var n=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(n)},_getAnchor:function(){return J(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Jc=function(e,n){return new Yi(e,n)};Me.include({openTooltip:function(e,n,o){return this._initOverlay(Yi,e,n,o).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Tt.include({bindTooltip:function(e,n){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Yi,this._tooltip,e,n),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var n=e?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[n](o),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Bt||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var n=typeof e.getElement=="function"&&e.getElement();n&&(ge(n,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),ge(n,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var n=typeof e.getElement=="function"&&e.getElement();n&&n.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var n=this;this._map.once("moveend",function(){n._openOnceFlag=!1,n._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var n=e.latlng,o,u;this._tooltip.options.sticky&&e.originalEvent&&(o=this._map.mouseEventToContainerPoint(e.originalEvent),u=this._map.containerPointToLayerPoint(o),n=this._map.layerPointToLatLng(u)),this._tooltip.setLatLng(n)}});var ko=xn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var n=e&&e.tagName==="DIV"?e:document.createElement("div"),o=this.options;if(o.html instanceof Element?(Ri(n),n.appendChild(o.html)):n.innerHTML=o.html!==!1?o.html:"",o.bgPos){var u=J(o.bgPos);n.style.backgroundPosition=-u.x+"px "+-u.y+"px"}return this._setIconStyles(n,"icon"),n},createShadow:function(){return null}});function qc(e){return new ko(e)}xn.Default=oi;var ri=Tt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:oe.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){P(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),$e(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(En(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(kn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=p(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof W?e:new W(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var n=this.getPane().children,o=-e(-1/0,1/0),u=0,f=n.length,_;u<f;u++)_=n[u].style.zIndex,n[u]!==this._container&&_&&(o=e(o,+_));isFinite(o)&&(this.options.zIndex=o+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!oe.ielt9){ft(this._container,this.options.opacity);var e=+new Date,n=!1,o=!1;for(var u in this._tiles){var f=this._tiles[u];if(!(!f.current||!f.loaded)){var _=Math.min(1,(e-f.loaded)/200);ft(f.el,_),_<1?n=!0:(f.active?o=!0:this._onOpaqueTile(f),f.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),n&&(R(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this))}},_onOpaqueTile:v,_initContainer:function(){this._container||(this._container=ke("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,n=this.options.maxZoom;if(e!==void 0){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===e?(this._levels[o].el.style.zIndex=n-Math.abs(e-o),this._onUpdateLevel(o)):($e(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var u=this._levels[e],f=this._map;return u||(u=this._levels[e]={},u.el=ke("div","leaflet-tile-container leaflet-zoom-animated",this._container),u.el.style.zIndex=n,u.origin=f.project(f.unproject(f.getPixelOrigin()),e).round(),u.zoom=e,this._setZoomTransform(u,f.getCenter(),f.getZoom()),v(u.el.offsetWidth),this._onCreateLevel(u)),this._level=u,u}},_onUpdateLevel:v,_onRemoveLevel:v,_onCreateLevel:v,_pruneTiles:function(){if(this._map){var e,n,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)n=this._tiles[e],n.retain=n.current;for(e in this._tiles)if(n=this._tiles[e],n.current&&!n.active){var u=n.coords;this._retainParent(u.x,u.y,u.z,u.z-5)||this._retainChildren(u.x,u.y,u.z,u.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var n in this._tiles)this._tiles[n].coords.z===e&&this._removeTile(n)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)$e(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,n,o,u){var f=Math.floor(e/2),_=Math.floor(n/2),T=o-1,C=new W(+f,+_);C.z=+T;var N=this._tileCoordsToKey(C),U=this._tiles[N];return U&&U.active?(U.retain=!0,!0):(U&&U.loaded&&(U.retain=!0),T>u?this._retainParent(f,_,T,u):!1)},_retainChildren:function(e,n,o,u){for(var f=2*e;f<2*e+2;f++)for(var _=2*n;_<2*n+2;_++){var T=new W(f,_);T.z=o+1;var C=this._tileCoordsToKey(T),N=this._tiles[C];if(N&&N.active){N.retain=!0;continue}else N&&N.loaded&&(N.retain=!0);o+1<u&&this._retainChildren(f,_,o+1,u)}},_resetView:function(e){var n=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),n,n)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var n=this.options;return n.minNativeZoom!==void 0&&e<n.minNativeZoom?n.minNativeZoom:n.maxNativeZoom!==void 0&&n.maxNativeZoom<e?n.maxNativeZoom:e},_setView:function(e,n,o,u){var f=Math.round(n);this.options.maxZoom!==void 0&&f>this.options.maxZoom||this.options.minZoom!==void 0&&f<this.options.minZoom?f=void 0:f=this._clampZoom(f);var _=this.options.updateWhenZooming&&f!==this._tileZoom;(!u||_)&&(this._tileZoom=f,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),f!==void 0&&this._update(e),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(e,n)},_setZoomTransforms:function(e,n){for(var o in this._levels)this._setZoomTransform(this._levels[o],e,n)},_setZoomTransform:function(e,n,o){var u=this._map.getZoomScale(o,e.zoom),f=e.origin.multiplyBy(u).subtract(this._map._getNewPixelOrigin(n,o)).round();oe.any3d?un(e.el,f,u):Ze(e.el,f)},_resetGrid:function(){var e=this._map,n=e.options.crs,o=this._tileSize=this.getTileSize(),u=this._tileZoom,f=this._map.getPixelWorldBounds(this._tileZoom);f&&(this._globalTileRange=this._pxBoundsToTileRange(f)),this._wrapX=n.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,n.wrapLng[0]],u).x/o.x),Math.ceil(e.project([0,n.wrapLng[1]],u).x/o.y)],this._wrapY=n.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([n.wrapLat[0],0],u).y/o.x),Math.ceil(e.project([n.wrapLat[1],0],u).y/o.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var n=this._map,o=n._animatingZoom?Math.max(n._animateToZoom,n.getZoom()):n.getZoom(),u=n.getZoomScale(o,this._tileZoom),f=n.project(e,this._tileZoom).floor(),_=n.getSize().divideBy(u*2);return new Z(f.subtract(_),f.add(_))},_update:function(e){var n=this._map;if(n){var o=this._clampZoom(n.getZoom());if(e===void 0&&(e=n.getCenter()),this._tileZoom!==void 0){var u=this._getTiledPixelBounds(e),f=this._pxBoundsToTileRange(u),_=f.getCenter(),T=[],C=this.options.keepBuffer,N=new Z(f.getBottomLeft().subtract([C,-C]),f.getTopRight().add([C,-C]));if(!(isFinite(f.min.x)&&isFinite(f.min.y)&&isFinite(f.max.x)&&isFinite(f.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var U in this._tiles){var Q=this._tiles[U].coords;(Q.z!==this._tileZoom||!N.contains(new W(Q.x,Q.y)))&&(this._tiles[U].current=!1)}if(Math.abs(o-this._tileZoom)>1){this._setView(e,o);return}for(var ue=f.min.y;ue<=f.max.y;ue++)for(var Se=f.min.x;Se<=f.max.x;Se++){var at=new W(Se,ue);if(at.z=this._tileZoom,!!this._isValidTile(at)){var je=this._tiles[this._tileCoordsToKey(at)];je?je.current=!0:T.push(at)}}if(T.sort(function(ot,Dn){return ot.distanceTo(_)-Dn.distanceTo(_)}),T.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var pt=document.createDocumentFragment();for(Se=0;Se<T.length;Se++)this._addTile(T[Se],pt);this._level.el.appendChild(pt)}}}},_isValidTile:function(e){var n=this._map.options.crs;if(!n.infinite){var o=this._globalTileRange;if(!n.wrapLng&&(e.x<o.min.x||e.x>o.max.x)||!n.wrapLat&&(e.y<o.min.y||e.y>o.max.y))return!1}if(!this.options.bounds)return!0;var u=this._tileCoordsToBounds(e);return le(this.options.bounds).overlaps(u)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var n=this._map,o=this.getTileSize(),u=e.scaleBy(o),f=u.add(o),_=n.unproject(u,e.z),T=n.unproject(f,e.z);return[_,T]},_tileCoordsToBounds:function(e){var n=this._tileCoordsToNwSe(e),o=new V(n[0],n[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var n=e.split(":"),o=new W(+n[0],+n[1]);return o.z=+n[2],o},_removeTile:function(e){var n=this._tiles[e];n&&($e(n.el),delete this._tiles[e],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){ve(e,"leaflet-tile");var n=this.getTileSize();e.style.width=n.x+"px",e.style.height=n.y+"px",e.onselectstart=v,e.onmousemove=v,oe.ielt9&&this.options.opacity<1&&ft(e,this.options.opacity)},_addTile:function(e,n){var o=this._getTilePos(e),u=this._tileCoordsToKey(e),f=this.createTile(this._wrapCoords(e),c(this._tileReady,this,e));this._initTile(f),this.createTile.length<2&&F(c(this._tileReady,this,e,null,f)),Ze(f,o),this._tiles[u]={el:f,coords:e,current:!0},n.appendChild(f),this.fire("tileloadstart",{tile:f,coords:e})},_tileReady:function(e,n,o){n&&this.fire("tileerror",{error:n,tile:o,coords:e});var u=this._tileCoordsToKey(e);o=this._tiles[u],o&&(o.loaded=+new Date,this._map._fadeAnimated?(ft(o.el,0),R(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),n||(ve(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),oe.ielt9||!this._map._fadeAnimated?F(this._pruneTiles,this):setTimeout(c(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var n=new W(this._wrapX?y(e.x,this._wrapX):e.x,this._wrapY?y(e.y,this._wrapY):e.y);return n.z=e.z,n},_pxBoundsToTileRange:function(e){var n=this.getTileSize();return new Z(e.min.unscaleBy(n).floor(),e.max.unscaleBy(n).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Kc(e){return new ri(e)}var In=ri.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,n){this._url=e,n=P(this,n),n.detectRetina&&oe.retina&&n.maxZoom>0?(n.tileSize=Math.floor(n.tileSize/2),n.zoomReverse?(n.zoomOffset--,n.minZoom=Math.min(n.maxZoom,n.minZoom+1)):(n.zoomOffset++,n.maxZoom=Math.max(n.minZoom,n.maxZoom-1)),n.minZoom=Math.max(0,n.minZoom)):n.zoomReverse?n.minZoom=Math.min(n.maxZoom,n.minZoom):n.maxZoom=Math.max(n.minZoom,n.maxZoom),typeof n.subdomains=="string"&&(n.subdomains=n.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,n){return this._url===e&&n===void 0&&(n=!0),this._url=e,n||this.redraw(),this},createTile:function(e,n){var o=document.createElement("img");return ge(o,"load",c(this._tileOnLoad,this,n,o)),ge(o,"error",c(this._tileOnError,this,n,o)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(o.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(e),o},getTileUrl:function(e){var n={r:oe.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-e.y;this.options.tms&&(n.y=o),n["-y"]=o}return O(this._url,r(n,this.options))},_tileOnLoad:function(e,n){oe.ielt9?setTimeout(c(e,this,null,n),0):e(null,n)},_tileOnError:function(e,n,o){var u=this.options.errorTileUrl;u&&n.getAttribute("src")!==u&&(n.src=u),e(o,n)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,n=this.options.maxZoom,o=this.options.zoomReverse,u=this.options.zoomOffset;return o&&(e=n-e),e+u},_getSubdomain:function(e){var n=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[n]},_abortLoading:function(){var e,n;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(n=this._tiles[e].el,n.onload=v,n.onerror=v,!n.complete)){n.src=B;var o=this._tiles[e].coords;$e(n),delete this._tiles[e],this.fire("tileabort",{tile:n,coords:o})}},_removeTile:function(e){var n=this._tiles[e];if(n)return n.el.setAttribute("src",B),ri.prototype._removeTile.call(this,e)},_tileReady:function(e,n,o){if(!(!this._map||o&&o.getAttribute("src")===B))return ri.prototype._tileReady.call(this,e,n,o)}});function Po(e,n){return new In(e,n)}var xo=In.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,n){this._url=e;var o=r({},this.defaultWmsParams);for(var u in n)u in this.options||(o[u]=n[u]);n=P(this,n);var f=n.detectRetina&&oe.retina?2:1,_=this.getTileSize();o.width=_.x*f,o.height=_.y*f,this.wmsParams=o},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var n=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[n]=this._crs.code,In.prototype.onAdd.call(this,e)},getTileUrl:function(e){var n=this._tileCoordsToNwSe(e),o=this._crs,u=ne(o.project(n[0]),o.project(n[1])),f=u.min,_=u.max,T=(this._wmsVersion>=1.3&&this._crs===Lo?[f.y,f.x,_.y,_.x]:[f.x,f.y,_.x,_.y]).join(","),C=In.prototype.getTileUrl.call(this,e);return C+x(this.wmsParams,C,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+T},setParams:function(e,n){return r(this.wmsParams,e),n||this.redraw(),this}});function Yc(e,n){return new xo(e,n)}In.WMS=xo,Po.wms=Yc;var Zt=Tt.extend({options:{padding:.1},initialize:function(e){P(this,e),m(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ve(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,n){var o=this._map.getZoomScale(n,this._zoom),u=this._map.getSize().multiplyBy(.5+this.options.padding),f=this._map.project(this._center,n),_=u.multiplyBy(-o).add(f).subtract(this._map._getNewPixelOrigin(e,n));oe.any3d?un(this._container,_,o):Ze(this._container,_)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,n=this._map.getSize(),o=this._map.containerPointToLayerPoint(n.multiplyBy(-e)).round();this._bounds=new Z(o,o.add(n.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ao=Zt.extend({options:{tolerance:0},getEvents:function(){var e=Zt.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Zt.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");ge(e,"mousemove",this._onMouseMove,this),ge(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ge(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){R(this._redrawRequest),delete this._ctx,$e(this._container),Ne(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var n in this._layers)e=this._layers[n],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Zt.prototype._update.call(this);var e=this._bounds,n=this._container,o=e.getSize(),u=oe.retina?2:1;Ze(n,e.min),n.width=u*o.x,n.height=u*o.y,n.style.width=o.x+"px",n.style.height=o.y+"px",oe.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){Zt.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[m(e)]=e;var n=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=n),this._drawLast=n,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var n=e._order,o=n.next,u=n.prev;o?o.prev=u:this._drawLast=u,u?u.next=o:this._drawFirst=o,delete e._order,delete this._layers[m(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var n=e.options.dashArray.split(/[, ]+/),o=[],u,f;for(f=0;f<n.length;f++){if(u=Number(n[f]),isNaN(u))return;o.push(u)}e.options._dashArray=o}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||F(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var n=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Z,this._redrawBounds.extend(e._pxBounds.min.subtract([n,n])),this._redrawBounds.extend(e._pxBounds.max.add([n,n]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var n=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,n.x,n.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,n=this._redrawBounds;if(this._ctx.save(),n){var o=n.getSize();this._ctx.beginPath(),this._ctx.rect(n.min.x,n.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var u=this._drawFirst;u;u=u.next)e=u.layer,(!n||e._pxBounds&&e._pxBounds.intersects(n))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,n){if(this._drawing){var o,u,f,_,T=e._parts,C=T.length,N=this._ctx;if(C){for(N.beginPath(),o=0;o<C;o++){for(u=0,f=T[o].length;u<f;u++)_=T[o][u],N[u?"lineTo":"moveTo"](_.x,_.y);n&&N.closePath()}this._fillStroke(N,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var n=e._point,o=this._ctx,u=Math.max(Math.round(e._radius),1),f=(Math.max(Math.round(e._radiusY),1)||u)/u;f!==1&&(o.save(),o.scale(1,f)),o.beginPath(),o.arc(n.x,n.y/f,u,0,Math.PI*2,!1),f!==1&&o.restore(),this._fillStroke(o,e)}},_fillStroke:function(e,n){var o=n.options;o.fill&&(e.globalAlpha=o.fillOpacity,e.fillStyle=o.fillColor||o.color,e.fill(o.fillRule||"evenodd")),o.stroke&&o.weight!==0&&(e.setLineDash&&e.setLineDash(n.options&&n.options._dashArray||[]),e.globalAlpha=o.opacity,e.lineWidth=o.weight,e.strokeStyle=o.color,e.lineCap=o.lineCap,e.lineJoin=o.lineJoin,e.stroke())},_onClick:function(e){for(var n=this._map.mouseEventToLayerPoint(e),o,u,f=this._drawFirst;f;f=f.next)o=f.layer,o.options.interactive&&o._containsPoint(n)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(o))&&(u=o);this._fireEvent(u?[u]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var n=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,n)}},_handleMouseOut:function(e){var n=this._hoveredLayer;n&&(He(this._container,"leaflet-interactive"),this._fireEvent([n],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,n){if(!this._mouseHoverThrottled){for(var o,u,f=this._drawFirst;f;f=f.next)o=f.layer,o.options.interactive&&o._containsPoint(n)&&(u=o);u!==this._hoveredLayer&&(this._handleMouseOut(e),u&&(ve(this._container,"leaflet-interactive"),this._fireEvent([u],e,"mouseover"),this._hoveredLayer=u)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(c(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,n,o){this._map._fireDOMEvent(n,o||n.type,e)},_bringToFront:function(e){var n=e._order;if(n){var o=n.next,u=n.prev;if(o)o.prev=u;else return;u?u.next=o:o&&(this._drawFirst=o),n.prev=this._drawLast,this._drawLast.next=n,n.next=null,this._drawLast=n,this._requestRedraw(e)}},_bringToBack:function(e){var n=e._order;if(n){var o=n.next,u=n.prev;if(u)u.next=o;else return;o?o.prev=u:u&&(this._drawLast=u),n.prev=null,n.next=this._drawFirst,this._drawFirst.prev=n,this._drawFirst=n,this._requestRedraw(e)}}});function Co(e){return oe.canvas?new Ao(e):null}var li=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Xc={_initContainer:function(){this._container=ke("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Zt.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var n=e._container=li("shape");ve(n,"leaflet-vml-shape "+(this.options.className||"")),n.coordsize="1 1",e._path=li("path"),n.appendChild(e._path),this._updateStyle(e),this._layers[m(e)]=e},_addPath:function(e){var n=e._container;this._container.appendChild(n),e.options.interactive&&e.addInteractiveTarget(n)},_removePath:function(e){var n=e._container;$e(n),e.removeInteractiveTarget(n),delete this._layers[m(e)]},_updateStyle:function(e){var n=e._stroke,o=e._fill,u=e.options,f=e._container;f.stroked=!!u.stroke,f.filled=!!u.fill,u.stroke?(n||(n=e._stroke=li("stroke")),f.appendChild(n),n.weight=u.weight+"px",n.color=u.color,n.opacity=u.opacity,u.dashArray?n.dashStyle=z(u.dashArray)?u.dashArray.join(" "):u.dashArray.replace(/( *, *)/g," "):n.dashStyle="",n.endcap=u.lineCap.replace("butt","flat"),n.joinstyle=u.lineJoin):n&&(f.removeChild(n),e._stroke=null),u.fill?(o||(o=e._fill=li("fill")),f.appendChild(o),o.color=u.fillColor||u.color,o.opacity=u.fillOpacity):o&&(f.removeChild(o),e._fill=null)},_updateCircle:function(e){var n=e._point.round(),o=Math.round(e._radius),u=Math.round(e._radiusY||o);this._setPath(e,e._empty()?"M0 0":"AL "+n.x+","+n.y+" "+o+","+u+" 0,"+65535*360)},_setPath:function(e,n){e._path.v=n},_bringToFront:function(e){En(e._container)},_bringToBack:function(e){kn(e._container)}},Xi=oe.vml?li:me,ci=Zt.extend({_initContainer:function(){this._container=Xi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Xi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){$e(this._container),Ne(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Zt.prototype._update.call(this);var e=this._bounds,n=e.getSize(),o=this._container;(!this._svgSize||!this._svgSize.equals(n))&&(this._svgSize=n,o.setAttribute("width",n.x),o.setAttribute("height",n.y)),Ze(o,e.min),o.setAttribute("viewBox",[e.min.x,e.min.y,n.x,n.y].join(" ")),this.fire("update")}},_initPath:function(e){var n=e._path=Xi("path");e.options.className&&ve(n,e.options.className),e.options.interactive&&ve(n,"leaflet-interactive"),this._updateStyle(e),this._layers[m(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){$e(e._path),e.removeInteractiveTarget(e._path),delete this._layers[m(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var n=e._path,o=e.options;n&&(o.stroke?(n.setAttribute("stroke",o.color),n.setAttribute("stroke-opacity",o.opacity),n.setAttribute("stroke-width",o.weight),n.setAttribute("stroke-linecap",o.lineCap),n.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?n.setAttribute("stroke-dasharray",o.dashArray):n.removeAttribute("stroke-dasharray"),o.dashOffset?n.setAttribute("stroke-dashoffset",o.dashOffset):n.removeAttribute("stroke-dashoffset")):n.setAttribute("stroke","none"),o.fill?(n.setAttribute("fill",o.fillColor||o.color),n.setAttribute("fill-opacity",o.fillOpacity),n.setAttribute("fill-rule",o.fillRule||"evenodd")):n.setAttribute("fill","none"))},_updatePoly:function(e,n){this._setPath(e,ce(e._parts,n))},_updateCircle:function(e){var n=e._point,o=Math.max(Math.round(e._radius),1),u=Math.max(Math.round(e._radiusY),1)||o,f="a"+o+","+u+" 0 1,0 ",_=e._empty()?"M0 0":"M"+(n.x-o)+","+n.y+f+o*2+",0 "+f+-o*2+",0 ";this._setPath(e,_)},_setPath:function(e,n){e._path.setAttribute("d",n)},_bringToFront:function(e){En(e._path)},_bringToBack:function(e){kn(e._path)}});oe.vml&&ci.include(Xc);function Io(e){return oe.svg||oe.vml?new ci(e):null}Me.include({getRenderer:function(e){var n=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return n||(n=this._renderer=this._createRenderer()),this.hasLayer(n)||this.addLayer(n),n},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var n=this._paneRenderers[e];return n===void 0&&(n=this._createRenderer({pane:e}),this._paneRenderers[e]=n),n},_createRenderer:function(e){return this.options.preferCanvas&&Co(e)||Io(e)}});var Do=An.extend({initialize:function(e,n){An.prototype.initialize.call(this,this._boundsToLatLngs(e),n)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=le(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Qc(e,n){return new Do(e,n)}ci.create=Xi,ci.pointsToPath=ce,Ht.geometryToLayer=Gi,Ht.coordsToLatLng=Xa,Ht.coordsToLatLngs=Vi,Ht.latLngToCoords=Qa,Ht.latLngsToCoords=ji,Ht.getFeature=Cn,Ht.asFeature=Ji,Me.mergeOptions({boxZoom:!0});var No=Nt.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){ge(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ne(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){$e(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ei(),Oa(),this._startPoint=this._map.mouseEventToContainerPoint(e),ge(document,{contextmenu:fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=ke("div","leaflet-zoom-box",this._container),ve(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var n=new Z(this._point,this._startPoint),o=n.getSize();Ze(this._box,n.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&($e(this._box),He(this._container,"leaflet-crosshair")),ti(),Fa(),Ne(document,{contextmenu:fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(c(this._resetState,this),0);var n=new V(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(n).fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Me.addInitHook("addHandler","boxZoom",No),Me.mergeOptions({doubleClickZoom:!0});var Oo=Nt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var n=this._map,o=n.getZoom(),u=n.options.zoomDelta,f=e.originalEvent.shiftKey?o-u:o+u;n.options.doubleClickZoom==="center"?n.setZoom(f):n.setZoomAround(e.containerPoint,f)}});Me.addInitHook("addHandler","doubleClickZoom",Oo),Me.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Fo=Nt.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new Kt(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}ve(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){He(this._map._container,"leaflet-grab"),He(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var n=le(this._map.options.maxBounds);this._offsetLimit=ne(this._map.latLngToContainerPoint(n.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(n.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var n=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(n),this._prunePositions(n)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),n=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=n.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,n){return e-(e-n)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),n=this._offsetLimit;e.x<n.min.x&&(e.x=this._viscousLimit(e.x,n.min.x)),e.y<n.min.y&&(e.y=this._viscousLimit(e.y,n.min.y)),e.x>n.max.x&&(e.x=this._viscousLimit(e.x,n.max.x)),e.y>n.max.y&&(e.y=this._viscousLimit(e.y,n.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,n=Math.round(e/2),o=this._initialWorldOffset,u=this._draggable._newPos.x,f=(u-n+o)%e+n-o,_=(u+n+o)%e-n-o,T=Math.abs(f+o)<Math.abs(_+o)?f:_;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=T},_onDragEnd:function(e){var n=this._map,o=n.options,u=!o.inertia||e.noInertia||this._times.length<2;if(n.fire("dragend",e),u)n.fire("moveend");else{this._prunePositions(+new Date);var f=this._lastPos.subtract(this._positions[0]),_=(this._lastTime-this._times[0])/1e3,T=o.easeLinearity,C=f.multiplyBy(T/_),N=C.distanceTo([0,0]),U=Math.min(o.inertiaMaxSpeed,N),Q=C.multiplyBy(U/N),ue=U/(o.inertiaDeceleration*T),Se=Q.multiplyBy(-ue/2).round();!Se.x&&!Se.y?n.fire("moveend"):(Se=n._limitOffset(Se,n.options.maxBounds),F(function(){n.panBy(Se,{duration:ue,easeLinearity:T,noMoveStart:!0,animate:!0})}))}}});Me.addInitHook("addHandler","dragging",Fo),Me.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Ro=Nt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),ge(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ne(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,n=document.documentElement,o=e.scrollTop||n.scrollTop,u=e.scrollLeft||n.scrollLeft;this._map._container.focus(),window.scrollTo(u,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var n=this._panKeys={},o=this.keyCodes,u,f;for(u=0,f=o.left.length;u<f;u++)n[o.left[u]]=[-1*e,0];for(u=0,f=o.right.length;u<f;u++)n[o.right[u]]=[e,0];for(u=0,f=o.down.length;u<f;u++)n[o.down[u]]=[0,e];for(u=0,f=o.up.length;u<f;u++)n[o.up[u]]=[0,-1*e]},_setZoomDelta:function(e){var n=this._zoomKeys={},o=this.keyCodes,u,f;for(u=0,f=o.zoomIn.length;u<f;u++)n[o.zoomIn[u]]=e;for(u=0,f=o.zoomOut.length;u<f;u++)n[o.zoomOut[u]]=-e},_addHooks:function(){ge(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ne(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=e.keyCode,o=this._map,u;if(n in this._panKeys){if(!o._panAnim||!o._panAnim._inProgress)if(u=this._panKeys[n],e.shiftKey&&(u=J(u).multiplyBy(3)),o.options.maxBounds&&(u=o._limitOffset(J(u),o.options.maxBounds)),o.options.worldCopyJump){var f=o.wrapLatLng(o.unproject(o.project(o.getCenter()).add(u)));o.panTo(f)}else o.panBy(u)}else if(n in this._zoomKeys)o.setZoom(o.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else if(n===27&&o._popup&&o._popup.options.closeOnEscapeKey)o.closePopup();else return;fn(e)}}});Me.addInitHook("addHandler","keyboard",Ro),Me.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var zo=Nt.extend({addHooks:function(){ge(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ne(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var n=ro(e),o=this._map.options.wheelDebounceTime;this._delta+=n,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var u=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(c(this._performZoom,this),u),fn(e)},_performZoom:function(){var e=this._map,n=e.getZoom(),o=this._map.options.zoomSnap||0;e._stop();var u=this._delta/(this._map.options.wheelPxPerZoomLevel*4),f=4*Math.log(2/(1+Math.exp(-Math.abs(u))))/Math.LN2,_=o?Math.ceil(f/o)*o:f,T=e._limitZoom(n+(this._delta>0?_:-_))-n;this._delta=0,this._startTime=null,T&&(e.options.scrollWheelZoom==="center"?e.setZoom(n+T):e.setZoomAround(this._lastMousePos,n+T))}});Me.addInitHook("addHandler","scrollWheelZoom",zo);var eu=600;Me.mergeOptions({tapHold:oe.touchNative&&oe.safari&&oe.mobile,tapTolerance:15});var $o=Nt.extend({addHooks:function(){ge(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ne(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var n=e.touches[0];this._startPos=this._newPos=new W(n.clientX,n.clientY),this._holdTimeout=setTimeout(c(function(){this._cancel(),this._isTapValid()&&(ge(document,"touchend",Ye),ge(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",n))},this),eu),ge(document,"touchend touchcancel contextmenu",this._cancel,this),ge(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Ne(document,"touchend",Ye),Ne(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Ne(document,"touchend touchcancel contextmenu",this._cancel,this),Ne(document,"touchmove",this._onMove,this)},_onMove:function(e){var n=e.touches[0];this._newPos=new W(n.clientX,n.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,n){var o=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:n.screenX,screenY:n.screenY,clientX:n.clientX,clientY:n.clientY});o._simulated=!0,n.target.dispatchEvent(o)}});Me.addInitHook("addHandler","tapHold",$o),Me.mergeOptions({touchZoom:oe.touch,bounceAtZoomLimits:!0});var Bo=Nt.extend({addHooks:function(){ve(this._map._container,"leaflet-touch-zoom"),ge(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){He(this._map._container,"leaflet-touch-zoom"),Ne(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var n=this._map;if(!(!e.touches||e.touches.length!==2||n._animatingZoom||this._zooming)){var o=n.mouseEventToContainerPoint(e.touches[0]),u=n.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=n.getSize()._divideBy(2),this._startLatLng=n.containerPointToLatLng(this._centerPoint),n.options.touchZoom!=="center"&&(this._pinchStartLatLng=n.containerPointToLatLng(o.add(u)._divideBy(2))),this._startDist=o.distanceTo(u),this._startZoom=n.getZoom(),this._moved=!1,this._zooming=!0,n._stop(),ge(document,"touchmove",this._onTouchMove,this),ge(document,"touchend touchcancel",this._onTouchEnd,this),Ye(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var n=this._map,o=n.mouseEventToContainerPoint(e.touches[0]),u=n.mouseEventToContainerPoint(e.touches[1]),f=o.distanceTo(u)/this._startDist;if(this._zoom=n.getScaleZoom(f,this._startZoom),!n.options.bounceAtZoomLimits&&(this._zoom<n.getMinZoom()&&f<1||this._zoom>n.getMaxZoom()&&f>1)&&(this._zoom=n._limitZoom(this._zoom)),n.options.touchZoom==="center"){if(this._center=this._startLatLng,f===1)return}else{var _=o._add(u)._divideBy(2)._subtract(this._centerPoint);if(f===1&&_.x===0&&_.y===0)return;this._center=n.unproject(n.project(this._pinchStartLatLng,this._zoom).subtract(_),this._zoom)}this._moved||(n._moveStart(!0,!1),this._moved=!0),R(this._animRequest);var T=c(n._move,n,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=F(T,this,!0),Ye(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,R(this._animRequest),Ne(document,"touchmove",this._onTouchMove,this),Ne(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Me.addInitHook("addHandler","touchZoom",Bo),Me.BoxZoom=No,Me.DoubleClickZoom=Oo,Me.Drag=Fo,Me.Keyboard=Ro,Me.ScrollWheelZoom=zo,Me.TapHold=$o,Me.TouchZoom=Bo,a.Bounds=Z,a.Browser=oe,a.CRS=fe,a.Canvas=Ao,a.Circle=Ya,a.CircleMarker=Wi,a.Class=ie,a.Control=Mt,a.DivIcon=ko,a.DivOverlay=Ot,a.DomEvent=yc,a.DomUtil=gc,a.Draggable=Kt,a.Evented=ae,a.FeatureGroup=Bt,a.GeoJSON=Ht,a.GridLayer=ri,a.Handler=Nt,a.Icon=xn,a.ImageOverlay=qi,a.LatLng=Y,a.LatLngBounds=V,a.Layer=Tt,a.LayerGroup=Pn,a.LineUtil=Cc,a.Map=Me,a.Marker=Zi,a.Mixin=Tc,a.Path=Yt,a.Point=W,a.PolyUtil=Ec,a.Polygon=An,a.Polyline=Ut,a.Popup=Ki,a.PosAnimation=lo,a.Projection=Ic,a.Rectangle=Do,a.Renderer=Zt,a.SVG=ci,a.SVGOverlay=Eo,a.TileLayer=In,a.Tooltip=Yi,a.Transformation=re,a.Util=G,a.VideoOverlay=To,a.bind=c,a.bounds=ne,a.canvas=Co,a.circle=Bc,a.circleMarker=$c,a.control=ai,a.divIcon=qc,a.extend=r,a.featureGroup=Fc,a.geoJSON=Mo,a.geoJson=Zc,a.gridLayer=Kc,a.icon=Rc,a.imageOverlay=Wc,a.latLng=j,a.latLngBounds=le,a.layerGroup=Oc,a.map=vc,a.marker=zc,a.point=J,a.polygon=Hc,a.polyline=Uc,a.popup=jc,a.rectangle=Qc,a.setOptions=P,a.stamp=m,a.svg=Io,a.svgOverlay=Vc,a.tileLayer=Po,a.tooltip=Jc,a.transformation=Le,a.version=s,a.videoOverlay=Gc;var tu=window.L;a.noConflict=function(){return window.L=tu,this},window.L=a})}(mi,mi.exports)),mi.exports}var Sh=Lh();const K=vh(Sh);async function Us(){if(!l.lastLat||!l.lastLng){b.handleMessage("Please select a location first.");return}if(!g.state.userSettings.selectedEnsembleModels||g.state.userSettings.selectedEnsembleModels.length===0){l.ensembleModelsData=null,vn(),console.log("No ensemble models selected. Cleared ensemble data and visualizations.");return}const i=l.lastLat,t=l.lastLng,a=g.state.userSettings.selectedEnsembleModels;console.log(`Fetching ensemble weather data for models: ${a.join(", ")} at ${i}, ${t}`);const s=document.getElementById("loading");s&&(s.style.display="block");const r=a.join(","),d=["surface_pressure","temperature_2m","relative_humidity_2m","wind_speed_10m","wind_direction_10m","geopotential_height_1000hPa","temperature_1000hPa","relative_humidity_1000hPa","wind_speed_1000hPa","wind_direction_1000hPa","geopotential_height_950hPa","temperature_950hPa","relative_humidity_950hPa","wind_speed_950hPa","wind_direction_950hPa","geopotential_height_925hPa","temperature_925hPa","relative_humidity_925hPa","wind_speed_925hPa","wind_direction_925hPa","geopotential_height_900hPa","temperature_900hPa","relative_humidity_900hPa","wind_speed_900hPa","wind_direction_900hPa","geopotential_height_850hPa","temperature_850hPa","relative_humidity_850hPa","wind_speed_850hPa","wind_direction_850hPa","geopotential_height_800hPa","temperature_800hPa","relative_humidity_800hPa","wind_speed_800hPa","wind_direction_800hPa","geopotential_height_700hPa","temperature_700hPa","relative_humidity_700hPa","wind_speed_700hPa","wind_direction_700hPa","geopotential_height_600hPa","temperature_600hPa","relative_humidity_600hPa","wind_speed_600hPa","wind_direction_600hPa","geopotential_height_500hPa","temperature_500hPa","relative_humidity_500hPa","wind_speed_500hPa","wind_direction_500hPa","geopotential_height_400hPa","temperature_400hPa","relative_humidity_400hPa","wind_speed_400hPa","wind_direction_400hPa","geopotential_height_300hPa","temperature_300hPa","relative_humidity_300hPa","wind_speed_300hPa","wind_direction_300hPa","geopotential_height_250hPa","temperature_250hPa","relative_humidity_250hPa","wind_speed_250hPa","wind_direction_250hPa","geopotential_height_200hPa","temperature_200hPa","relative_humidity_200hPa","wind_speed_200hPa","wind_direction_200hPa"],c=d.join(","),h=document.getElementById("historicalDatePicker"),m=h?h.value:null,p=m?se.fromISO(m,{zone:"utc"}):null,y=se.utc().startOf("day"),v=p&&p<y;let w,S,E=yi.FORECAST;if(v)E=yi.HISTORICAL,w=p.toFormat("yyyy-MM-dd"),S=w;else{const x=se.utc();w=x.toFormat("yyyy-MM-dd"),S=x.plus({days:7}).toFormat("yyyy-MM-dd")}const P=`${E}?latitude=${i}&longitude=${t}&hourly=${c}&models=${r}&start_date=${w}&end_date=${S}`;console.log("Constructed ensemble URL:",P);try{const x=await fetch(P);if(!x.ok){const z=await x.text();throw new Error(`API request failed: ${x.status} - ${z}`)}const A=await x.json();if(console.log("Raw data from OpenMeteo for ensemble request:",JSON.stringify(A,null,2)),console.log("Models requested:",a),l.ensembleModelsData={},A.error&&A.reason)throw new Error(`API Error: ${A.reason}`);if(!A.hourly){let z='Unexpected data format: "hourly" field missing in API response.';throw A&&typeof A.latitude<"u"&&(z="Received metadata but no 'hourly' data for any requested ensemble model."),console.error(z,A),new Error(z)}const O=A.hourly.time;if(!O)throw new Error("Shared 'time' array missing in hourly data.");if(a.forEach(z=>{const I={time:[...O]};let B=!1;d.forEach(H=>{const $=`${H}_${z}`;A.hourly[$]?(I[H]=A.hourly[$],B=!0):a.length===1&&A.hourly[H]?(I[H]=A.hourly[H],B=!0):I[H]=null}),B?(l.ensembleModelsData[z]=I,console.log(`Successfully processed and stored data for model: ${z}`)):console.warn(`No data found for model ${z} with suffixed keys in the 'hourly' object. Available keys for this model might be missing or the model is unavailable for this specific request. Hourly keys in response:`,Object.keys(A.hourly))}),Object.keys(l.ensembleModelsData).length===0&&a.length>0){const z="Could not retrieve and process data for any of the selected ensemble models. They might be unavailable or the API response structure was not as expected for these models.";console.warn(z,"Original API response:",A),b.handleMessage(z)}else console.log("Ensemble weather data processed and stored in AppState.ensembleModelsData:",l.ensembleModelsData);ga()}catch(x){console.error("Error in fetchEnsembleWeatherData:",x),b.handleError(`Failed to fetch ensemble weather data: ${x.message}`),l.ensembleModelsData=null,vn()}finally{s&&(s.style.display="none")}}function vn(){l.ensembleLayerGroup&&l.map.removeLayer(l.ensembleLayerGroup),l.heatmapLayer&&l.map.removeLayer(l.heatmapLayer),l.heatmapLayer=null,l.ensembleScenarioCircles={},l.ensembleLayerGroup=K.layerGroup().addTo(l.map),console.log("Ensemble visualizations cleared and a new, clean layer group was created.")}function ga(){if(vn(),!l.ensembleModelsData||Object.keys(l.ensembleModelsData).length===0){console.log("No ensemble data to process."),g.state.userSettings.selectedEnsembleModels.length>0&&g.state.userSettings.currentEnsembleScenario!=="all_models"&&(b.handleMessage("Data for selected ensemble models not yet available. Fetching..."),Us());return}const i=g.state.userSettings.currentEnsembleScenario,t=zt();if(console.log(`Processing ensemble scenario: ${i} for slider index: ${t}`),i==="heatmap")Eh();else if(i==="all_models"){for(const a in l.ensembleModelsData)if(Object.hasOwnProperty.call(l.ensembleModelsData,a)){const r={hourly:l.ensembleModelsData[a]},d=xs(a,r);if(d){const c=bh(a);Mr(d,c,a)}}}else{const a=Th(i);if(a){const s=xs(i,a);if(s){const r=Mh(i);Mr(s,r,i.replace("_"," "))}}else console.warn(`Could not calculate profile for scenario: ${i}`),b.handleMessage(`Could not generate '${i.replace("_"," ")}' profile. Not enough data?`)}}function bh(i){let t=0;for(let s=0;s<i.length;s++)t=i.charCodeAt(s)+((t<<5)-t),t=t&t;return`hsl(${t%360}, 70%, 60%)`}function Mh(i){return i==="min_wind"?vt.SCENARIO_COLORS.MIN_WIND:i==="mean_wind"?vt.SCENARIO_COLORS.MEAN_WIND:i==="max_wind"?vt.SCENARIO_COLORS.MAX_WIND:"rgba(128, 128, 128, 0.7)"}function Mr(i,t,a){var P,x;if(!l.map||!i||!l.ensembleLayerGroup)return;const s=[i.centerLat,i.centerLng],r=K.circle(s,{radius:i.radius,color:t,fillColor:t,fillOpacity:.15,weight:2,dashArray:"5, 10"}).addTo(l.ensembleLayerGroup),d=g.getValue("windUnit","radio","kt");let c="N/A";if(i.meanWindSpeedMps!=="N/A"&&Number.isFinite(i.meanWindSpeedMps)){const A=b.convertWind(i.meanWindSpeedMps,d,"m/s");A!=="N/A"&&Number.isFinite(A)&&(c=d==="bft"?Math.round(A):A.toFixed(1))}const h=parseInt((P=document.getElementById("openingAltitude"))==null?void 0:P.value)||g.state.userSettings.openingAltitude||1200,m=parseInt((x=document.getElementById("legHeightDownwind"))==null?void 0:x.value)||g.state.userSettings.legHeightDownwind||0,p=h-200,y=g.getValue("heightUnit","radio","m"),v=Math.round(b.convertHeight(m,y)),w=Math.round(b.convertHeight(p,y)),S=i.meanWindDir!=="N/A"&&Number.isFinite(i.meanWindDir)?b.roundToTens(i.meanWindDir):"N/A",E=`<strong>${a}</strong><br>Mean Wind ${v}-${w} ${y} AGL:<br>${S}° ${c} ${d}`;r.bindTooltip(E,{permanent:!1,direction:"top",className:"wind-tooltip",opacity:.9}),l.ensembleScenarioCircles[a]=r,console.log(`Drew ensemble circle for ${a} at [${s.join(", ")}], radius ${i.radius}`)}function Th(i){var p;if(!l.ensembleModelsData||Object.keys(l.ensembleModelsData).length===0)return console.warn("No ensemble data available for profile calculation."),null;if(Object.keys(l.ensembleModelsData).length===0)return null;console.log(`Calculating full time-series ensemble profile for: ${i}`);const a={},s=Object.keys(l.ensembleModelsData)[0],r=(p=l.ensembleModelsData[s])==null?void 0:p.time;if(!r||r.length===0)return console.error("Time data missing or empty in the first ensemble model for profile calculation."),null;a.time=[...r];const d=a.time.length,c=["surface_pressure","temperature_2m","relative_humidity_2m","geopotential_height_1000hPa","temperature_1000hPa","relative_humidity_1000hPa","geopotential_height_950hPa","temperature_950hPa","relative_humidity_950hPa","geopotential_height_925hPa","temperature_925hPa","relative_humidity_925hPa","geopotential_height_900hPa","temperature_900hPa","relative_humidity_900hPa","geopotential_height_850hPa","temperature_850hPa","relative_humidity_850hPa","geopotential_height_800hPa","temperature_800hPa","relative_humidity_800hPa","geopotential_height_700hPa","temperature_700hPa","relative_humidity_700hPa","geopotential_height_600hPa","temperature_600hPa","relative_humidity_600hPa","geopotential_height_500hPa","temperature_500hPa","relative_humidity_500hPa","geopotential_height_400hPa","temperature_400hPa","relative_humidity_400hPa","geopotential_height_300hPa","temperature_300hPa","relative_humidity_300hPa","geopotential_height_250hPa","temperature_250hPa","relative_humidity_250hPa","geopotential_height_200hPa","temperature_200hPa","relative_humidity_200hPa"],h=[["wind_speed_10m","wind_direction_10m"]];[1e3,950,925,900,850,800,700,600,500,400,300,250,200].forEach(y=>{h.push([`wind_speed_${y}hPa`,`wind_direction_${y}hPa`])}),c.forEach(y=>{a[y]=new Array(d).fill(null)}),h.forEach(y=>{a[y[0]]=new Array(d).fill(null),a[y[1]]=new Array(d).fill(null)});for(let y=0;y<d;y++)c.forEach(v=>{const w=[];for(const S in l.ensembleModelsData){const E=l.ensembleModelsData[S];if(E&&E[v]){const P=E[v][y];P!=null&&!isNaN(P)&&w.push(P)}}w.length>0&&(i==="min_wind"?a[v][y]=Math.min(...w):i==="max_wind"?a[v][y]=Math.max(...w):a[v][y]=w.reduce((S,E)=>S+E,0)/w.length)}),h.forEach(v=>{const w=v[0],S=v[1];let E=[],P=[],x=[],A=[];for(const O in l.ensembleModelsData){const z=l.ensembleModelsData[O];if(z&&z[w]&&z[S]){const I=z[w][y],B=z[S][y];I!=null&&!isNaN(I)&&B!==null&&B!==void 0&&!isNaN(B)&&(x.push(I),A.push(B),E.push(-I*Math.sin(B*Math.PI/180)),P.push(-I*Math.cos(B*Math.PI/180)))}}if(x.length>0)if(i==="min_wind"){const O=Math.min(...x),z=x.indexOf(O);a[w][y]=O,a[S][y]=A[z]}else if(i==="max_wind"){const O=Math.max(...x),z=x.indexOf(O);a[w][y]=O,a[S][y]=A[z]}else{const O=E.reduce((I,B)=>I+B,0)/E.length,z=P.reduce((I,B)=>I+B,0)/P.length;a[w][y]=b.windSpeed(O,z),a[S][y]=b.windDirection(O,z)}});return{hourly:a}}function xs(i,t=null){var c,h;console.log(`Calculating exit circle for ensemble profile/model: ${i}`);let a;if(t)a=t;else if(l.ensembleModelsData&&l.ensembleModelsData[i])a={hourly:l.ensembleModelsData[i]};else return console.warn(`No data for profile/model ${i} in calculateExitCircleForEnsemble found.`),null;if(!a.hourly||!l.lastLat||!l.lastLng||l.lastAltitude==="N/A")return console.warn(`Incomplete data for calculateExitCircleForEnsemble: ${i}`),null;const s=l.weatherData;l.weatherData=a.hourly;let r=null,d={meanWindDir:"N/A",meanWindSpeedMps:"N/A"};try{const m=g.state.userSettings.calculateJump,p=g.state.userSettings.showExitArea;g.state.userSettings.calculateJump=!0,g.state.userSettings.showExitArea=!0;const y=zt(),v=Sn(y);if(r=Fr(v),v&&v.length>0){const w=v.map(B=>B.height),S=v.map(B=>-b.convertWind(B.spd,"m/s","km/h")*Math.sin(B.dir*Math.PI/180)),E=v.map(B=>-b.convertWind(B.spd,"m/s","km/h")*Math.cos(B.dir*Math.PI/180)),P=parseInt((c=document.getElementById("openingAltitude"))==null?void 0:c.value)||1200,x=parseInt((h=document.getElementById("legHeightDownwind"))==null?void 0:h.value)||0,A=Math.round(l.lastAltitude),O=A+P-200,z=A+x,I=b.calculateMeanWind(w,S,E,z,O);I&&Number.isFinite(I[0])&&Number.isFinite(I[1])&&(d={meanWindDir:I[0],meanWindSpeedMps:I[1]})}g.state.userSettings.calculateJump=m,g.state.userSettings.showExitArea=p}catch(m){console.error(`Error in calculateExitCircle for profile ${i}:`,m),r=null}finally{l.weatherData=s}return r?{centerLat:r.darkGreenLat,centerLng:r.darkGreenLng,radius:r.darkGreenRadius,freeFallDirection:r.freeFallDirection,freeFallDistance:r.freeFallDistance,freeFallTime:r.freeFallTime,meanWindDir:d.meanWindDir,meanWindSpeedMps:d.meanWindSpeedMps,profileIdentifier:i}:(console.warn(`calculateExitCircle returned null for profile ${i}`),null)}function Eh(){if(vn(),l.heatmapLayer&&(l.map.removeLayer(l.heatmapLayer),l.heatmapLayer=null),!l.ensembleModelsData||Object.keys(l.ensembleModelsData).length<2){b.handleMessage("Please select at least two ensemble models to generate a heatmap.");return}const i=[];for(const p in l.ensembleModelsData)if(Object.hasOwnProperty.call(l.ensembleModelsData,p)){const y=l.ensembleModelsData[p],v=xs(p,{hourly:y});v&&i.push({centerLat:v.centerLat,centerLng:v.centerLng,radius:v.radius})}if(i.length===0){console.warn("Could not calculate any circles for the heatmap.");return}console.log(`[Heatmap] Calculated ${i.length} model circles.`);let t=90,a=-90,s=180,r=-180;const d=111320;i.forEach(p=>{const y=p.radius/d,v=p.radius/(d*Math.cos(p.centerLat*Math.PI/180));t=Math.min(t,p.centerLat-y),a=Math.max(a,p.centerLat+y),s=Math.min(s,p.centerLng-v),r=Math.max(r,p.centerLng+v)});const c=40,h=c/d,m=[];console.log("[Heatmap] Starting grid calculation...");for(let p=t;p<=a;p+=h){const y=c/(d*Math.cos(p*Math.PI/180));for(let v=s;v<=r;v+=y){let w=0;const S=K.latLng(p,v);i.forEach(E=>{const P=K.latLng(E.centerLat,E.centerLng);l.map.distance(S,P)<=E.radius&&w++}),w>0&&m.push([p,v,w])}}if(console.log(`[Heatmap] Finished grid calculation. Generated ${m.length} heatmap points.`),m.length>0){const p=i.length,y={};if(p===1)y[1]="lime";else for(let w=1;w<=p;w++){const S=w/p;w===1?y[S]="red":w<p?y[S]="yellow":y[S]="lime"}console.log("[Heatmap] Using gradient:",y),l.heatmapLayer&&l.map.removeLayer(l.heatmapLayer);const v=b.calculateDynamicRadius(vt.HEATMAP_BASE_RADIUS,vt.HEATMAP_REFERENCE_ZOOM);l.heatmapLayer=K.heatLayer(m,{radius:v,blur:10,max:p,minOpacity:.01,gradient:y}).addTo(l.map)}else b.handleMessage("No overlapping landing areas found for the selected models.")}function wi(){const i=window.innerWidth<wt.MOBILE_BREAKPOINT_PX;return console.log(`isMobileDevice check: window.innerWidth=${window.innerWidth}, isMobile=${i}`),i}function yt(i){console.log("displayMessage called with:",i);let t=document.getElementById("message");t||(t=document.createElement("div"),t.id="message",t.style.position="fixed",t.style.top="5px",t.style.right="5px",t.style.width=wi()?"70%":"30%",t.style.backgroundColor="#ccffcc",t.style.borderRadius="5px 5px 5px 5px",t.style.color="#000000",t.style.padding="6px",t.style.zIndex="9998",t.style.textAlign="center",document.body.appendChild(t),window.addEventListener("resize",()=>{t.style.width=wi()?"70%":"30%"})),t.textContent=i,t.style.display="block",clearTimeout(window.messageTimeout),window.messageTimeout=setTimeout(()=>{t.style.display="none"},wt.MESSAGE_TIMEOUT_MS)}function _a(i,t,a){const s=Math.round(i/t*100);let r=document.getElementById("progress");r||(r=document.createElement("div"),r.id="progress",r.style.position="fixed",r.style.top="5px",r.style.right="5px",r.style.width=wi()?"70%":"30%",r.style.backgroundColor="#ccffcc",r.style.borderRadius="5px 5px 5px 5px",r.style.color="#000000",r.style.padding="6px",r.style.zIndex="9998",r.style.display="flex",r.style.alignItems="center",r.style.gap="10px",document.body.appendChild(r),window.addEventListener("resize",()=>{r.style.width=wi()?"70%":"30%"}));const d=document.createElement("div");d.style.flex="1",d.style.display="flex",d.style.flexDirection="column",d.style.gap="3px";const c=document.createElement("div");c.textContent=`Caching (${i}/${t}, ${s}%)`,c.style.fontSize="12px",c.style.textAlign="center";const h=document.createElement("div");h.style.width="100%",h.style.height="8px",h.style.backgroundColor="#e0e0e0",h.style.borderRadius="3px",h.style.overflow="hidden";const m=document.createElement("div");m.style.width=`${s}%`,m.style.height="100%",m.style.backgroundColor="#4caf50",m.style.transition="width 0.3s ease-in-out",h.appendChild(m),d.appendChild(c),d.appendChild(h);let p=document.getElementById("cancel-caching");p||(p=document.createElement("button"),p.id="cancel-caching",p.textContent="Cancel",p.style.backgroundColor="#ff4444",p.style.color="#ffffff",p.style.border="none",p.style.borderRadius="3px",p.style.padding="5px 3px",p.style.cursor="pointer",p.style.fontSize="12px",p.addEventListener("click",()=>{a(),r.style.display="none",b.handleMessage("Caching cancelled.")})),r.innerHTML="",r.appendChild(d),r.appendChild(p),r.style.display="flex"}function Bl(){const i=document.getElementById("progress");i&&(i.style.display="none")}function As(){console.log("updateOfflineIndicator called, navigator.onLine:",navigator.onLine);let i=document.getElementById("offline-indicator");i||(i=document.createElement("div"),i.id="offline-indicator",document.body.appendChild(i),console.log("Offline indicator created and appended")),i.style.display=navigator.onLine?"none":"block",i.textContent="Offline Mode"}function Gn(i){console.log("displayError called with:",i);let t=document.getElementById("error-message");t||(t=document.createElement("div"),t.id="error-message",document.body.appendChild(t),window.addEventListener("resize",()=>{t.style.width=wi()?"70%":"30%"})),t.textContent=i,t.style.display="block",console.log("Error element state:",{display:t.style.display,text:t.textContent,position:t.style.position,zIndex:t.style.zIndex}),clearTimeout(window.errorTimeout),window.errorTimeout=setTimeout(()=>{t.style.display="none",console.log("Error hidden after 3s")},wt.MESSAGE_TIMEOUT_MS)}function zt(){var i;return parseInt((i=document.getElementById("timeSlider"))==null?void 0:i.value)||0}function kh(i){const t=document.getElementById("modelSelect");if(!t)return;const a=t.value;t.innerHTML="",i.forEach(s=>{const r=document.createElement("option");r.value=s,r.textContent=s.replace(/_/g," ").toUpperCase(),t.appendChild(r)}),i.includes(g.state.userSettings.model)?t.value=g.state.userSettings.model:i.includes(a)?t.value=a:i.length>0&&(t.value=i[0])}function Ph(i){const t=document.getElementById("ensembleModelsSubmenu");t&&(t.innerHTML="",i.forEach(a=>{const s=document.createElement("li"),r=document.createElement("label");r.className="radio-label";const d=document.createElement("input");d.type="checkbox",d.name="ensembleModel",d.value=a,d.checked=g.state.userSettings.selectedEnsembleModels.includes(a),d.addEventListener("change",()=>{const c=Array.from(t.querySelectorAll("input:checked")).map(h=>h.value);g.state.userSettings.selectedEnsembleModels=c,g.save(),Us()}),r.append(d,` ${a.replace(/_/g," ").toUpperCase()}`),s.appendChild(r),t.appendChild(s)}))}function xh(i){let t=g.state.userSettings.selectedEnsembleModels||[],a=t.filter(s=>i.includes(s));t.length!==a.length&&(g.state.userSettings.selectedEnsembleModels=a,g.save())}const Un=65,rt=73,_t=79;function Ul(i,t){if(t=typeof t=="number"?t:5,!Array.isArray(i))throw new TypeError("forward did not receive an array");if(typeof i[0]=="string"||typeof i[1]=="string")throw new TypeError("forward received an array of strings, but it only accepts an array of numbers.");const[a,s]=i;if(a<-180||a>180)throw new TypeError("forward received an invalid longitude of "+a);if(s<-90||s>90)throw new TypeError("forward received an invalid latitude of "+s);if(s<-80||s>84)throw new TypeError(`forward received a latitude of ${s}, but this library does not support conversions of points in polar regions below 80°S and above 84°N`);return function(r,d){const c="00000"+r.easting,h="00000"+r.northing;return r.zoneNumber+r.zoneLetter+function(m,p,y){const v=Zl(y),w=Math.floor(m/1e5),S=Math.floor(p/1e5)%20;return function(E,P,x){const A=x-1,O="AJSAJS".charCodeAt(A),z="AFAFAF".charCodeAt(A);let I=O+E-1,B=z+P,H=!1;return I>90&&(I=I-90+Un-1,H=!0),(I===rt||O<rt&&I>rt||(I>rt||O<rt)&&H)&&I++,(I===_t||O<_t&&I>_t||(I>_t||O<_t)&&H)&&(I++,I===rt&&I++),I>90&&(I=I-90+Un-1),B>86?(B=B-86+Un-1,H=!0):H=!1,(B===rt||z<rt&&B>rt||(B>rt||z<rt)&&H)&&B++,(B===_t||z<_t&&B>_t||(B>_t||z<_t)&&H)&&(B++,B===rt&&B++),B>86&&(B=B-86+Un-1),String.fromCharCode(I)+String.fromCharCode(B)}(w,S,v)}(r.easting,r.northing,r.zoneNumber)+c.substr(c.length-5,d)+h.substr(h.length-5,d)}(function(r){const d=r.lat,c=r.lon,h=6378137,m=hs(d),p=hs(c);let y;y=Math.floor((c+180)/6)+1,c===180&&(y=60),d>=56&&d<64&&c>=3&&c<12&&(y=32),d>=72&&d<84&&(c>=0&&c<9?y=31:c>=9&&c<21?y=33:c>=21&&c<33?y=35:c>=33&&c<42&&(y=37));const v=hs(6*(y-1)-180+3),w=h/Math.sqrt(1-.00669438*Math.sin(m)*Math.sin(m)),S=Math.tan(m)*Math.tan(m),E=.006739496752268451*Math.cos(m)*Math.cos(m),P=Math.cos(m)*(p-v),x=h*(.9983242984503243*m-.002514607064228144*Math.sin(2*m)+2639046602129982e-21*Math.sin(4*m)-3418046101696858e-24*Math.sin(6*m)),A=.9996*w*(P+(1-S+E)*P*P*P/6+(5-18*S+S*S+72*E-.39089081163157013)*P*P*P*P*P/120)+5e5;let O=.9996*(x+w*Math.tan(m)*(P*P/2+(5-S+9*E+4*E*E)*P*P*P*P/24+(61-58*S+S*S+600*E-2.2240339282485886)*P*P*P*P*P*P/720));return d<0&&(O+=1e7),{northing:Math.trunc(O),easting:Math.trunc(A),zoneNumber:y,zoneLetter:Hl(d)}}({lat:s,lon:a}),t)}function Ah(i){const t=Zs(Wl(i.toUpperCase()));return typeof t.lat=="number"&&typeof t.lon=="number"?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function Hs(i){if(i==="")throw new TypeError("toPoint received a blank string");const t=Zs(Wl(i.toUpperCase()));return typeof t.lat=="number"&&typeof t.lon=="number"?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function hs(i){return i*(Math.PI/180)}function Tr(i){return i/Math.PI*180}function Zs(i){const t=i.northing,a=i.easting,{zoneLetter:s,zoneNumber:r}=i;if(r<0||r>60)return null;const d=6378137,c=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),h=a-5e5;let m=t;s<"N"&&(m-=1e7);const p=6*(r-1)-180+3,y=m/.9996/6367449145945056e-9,v=y+(3*c/2-27*c*c*c/32)*Math.sin(2*y)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*y)+151*c*c*c/96*Math.sin(6*y),w=d/Math.sqrt(1-.00669438*Math.sin(v)*Math.sin(v)),S=Math.tan(v)*Math.tan(v),E=.006739496752268451*Math.cos(v)*Math.cos(v),P=.99330562*d/Math.pow(1-.00669438*Math.sin(v)*Math.sin(v),1.5),x=h/(.9996*w);let A=v-w*Math.tan(v)/P*(x*x/2-(5+3*S+10*E-4*E*E-.06065547077041606)*x*x*x*x/24+(61+90*S+298*E+45*S*S-1.6983531815716497-3*E*E)*x*x*x*x*x*x/720);A=Tr(A);let O,z=(x-(1+2*S+E)*x*x*x/6+(5-2*E+28*S-3*E*E+.05391597401814761+24*S*S)*x*x*x*x*x/120)/Math.cos(v);if(z=p+Tr(z),typeof i.accuracy=="number"){const I=Zs({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});O={top:I.lat,right:I.lon,bottom:A,left:z}}else O={lat:A,lon:z};return O}function Hl(i){return i<=84&&i>=72?"X":i<72&&i>=-80?"CDEFGHJKLMNPQRSTUVWX"[Math.floor((i- -80)/8)]:i>84||i<-80?"Z":void 0}function Zl(i){let t=i%6;return t===0&&(t=6),t}function Wl(i){if(i&&i.length===0)throw new TypeError("MGRSPoint coverting from nothing");i=i.replace(/ /g,"");const{length:t}=i;let a,s=null,r="",d=0;for(;!/[A-Z]/.test(a=i.charAt(d));){if(d>=2)throw new Error("MGRSPoint bad conversion from: "+i);r+=a,d++}const c=parseInt(r,10);if(d===0||d+3>t)throw new Error("MGRSPoint bad conversion from "+i);const h=i.charAt(d++);if(h<="A"||h==="B"||h==="Y"||h>="Z"||h==="I"||h==="O")throw new Error(`MGRSPoint zone letter ${h} not handled: ${i}`);s=i.substring(d,d+=2);const m=Zl(c),p=function(O,z){let I="AJSAJS".charCodeAt(z-1),B=1e5,H=!1;for(;I!==O.charCodeAt(0);){if(I++,I===rt&&I++,I===_t&&I++,I>90){if(H)throw new Error("Bad character: "+O);I=Un,H=!0}B+=1e5}return B}(s.charAt(0),m);let y=function(O,z){if(O>"V")throw new TypeError("MGRSPoint given invalid Northing "+O);let I="AFAFAF".charCodeAt(z-1),B=0,H=!1;for(;I!==O.charCodeAt(0);){if(I++,I===rt&&I++,I===_t&&I++,I>86){if(H)throw new Error("Bad character: "+O);I=Un,H=!0}B+=1e5}return B}(s.charAt(1),m);for(;y<Ch(h);)y+=2e6;const v=t-d;if(v%2!=0)throw new Error(`MGRSPoint has to have an even number
of digits after the zone letter and two 100km letters - front
half for easting meters, second half for
northing meters `+i);const w=v/2;let S,E,P,x=0,A=0;return w>0&&(S=1e5/Math.pow(10,w),E=i.substring(d,d+w),x=parseFloat(E)*S,P=i.substring(d+w),A=parseFloat(P)*S),{easting:x+p,northing:A+y,zoneLetter:h,zoneNumber:c,accuracy:S}}function Ch(i){let t;switch(i){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw new TypeError("Invalid zone letter: "+i)}const Ih=Object.freeze(Object.defineProperty({__proto__:null,forward:Ul,getLetterDesignator:Hl,inverse:Ah,toPoint:Hs},Symbol.toStringTag,{value:"Module"}));var _e;let b=(_e=class{static formatTime(t){return se.fromISO(t,{zone:"UTC"}).toFormat("yyyy-MM-dd HHmm")+"Z"}static roundToTens(t){return Math.round(t/10)*10}static convertTemperature(t,a){const s=parseFloat(t);return isNaN(s)?"N/A":a==="°F"?s*9/5+32:s}static convertHeight(t,a){const s=parseFloat(t);return isNaN(s)?"N/A":a==="ft"?parseFloat((t*Qe.METERS_TO_FEET).toFixed(0)):t}static convertWind(t,a,s="km/h"){if(t==null||isNaN(t))return"N/A";let r;switch(s){case"km/h":r=t;break;case"m/s":r=t*3.6;break;case"kt":r=t*Qe.KNOTS_TO_KMH;break;case"mph":r=t*1.60934;break;case"bft":r=_e.beaufortToKnots(t)*Qe.KNOTS_TO_KMH;break;default:r=t;break}switch(a){case"km/h":return r;case"m/s":return r/3.6;case"kt":return r/Qe.KNOTS_TO_KMH;case"mph":return r/1.60934;case"bft":return _e.knotsToBeaufort(r/Qe.KNOTS_TO_KMH);default:return r/Qe.KNOTS_TO_KMH}}static knotsToBeaufort(t){const a=jo.KNOT_THRESHOLDS.findIndex(s=>t<s);return a===-1?12:a}static beaufortToKnots(t){return jo.BEAUFORT_THRESHOLDS[t]||63}static calculateDewpoint(t,a){const s=ea.A_LIQUID,r=ea.B_LIQUID,d=ea.A_ICE,c=ea.B_ICE;let h,m;return t>=0?(h=s*t/(r+t)+Math.log(a/100),m=r*h/(s-h)):(h=d*t/(c+t)+Math.log(a/100),m=c*h/(d-h)),isNaN(m)?null:m}static gaussianInterpolation(t,a,s,r,d){if(s===d)return t;if(r===d)return a;let c=1/Math.abs(s-d),h=1/Math.abs(r-d);return(c*t+h*a)/(c+h)}static interpolateWindAtAltitude(t,a,s,r,d){if(a.length!=s.length||a.length!=r.length||a.length!=d.length)return{u:"Invalid input",v:"Invalid input"};const c=a.map(v=>Math.log(v)),h=_e.linearInterpolate(s,c,t);if(typeof h=="string"&&h.includes("error"))return{u:"Interpolation error",v:"Interpolation error"};const m=Math.exp(h),p=_e.linearInterpolate(c,r,Math.log(m)),y=_e.linearInterpolate(c,d,Math.log(m));return typeof p=="string"&&p.includes("error")||typeof y=="string"&&y.includes("error")?{u:"Interpolation error",v:"Interpolation error"}:{u:p,v:y}}static interpolatePressure(t,a,s){if(!a||!s||a.length!==s.length||a.length<2||t<s[0]||t>s[s.length-1])return"N/A";for(let r=0;r<s.length-1;r++)if(t>=s[r]&&t<=s[r+1]){const d=s[r],c=s[r+1],h=a[r],m=a[r+1];return h+(m-h)*(t-d)/(c-d)}return"N/A"}static linearInterpolate(t,a,s){if(!(t!=null&&t.length)||!(a!=null&&a.length)||t.length!==a.length)return"invalid input for linearInterpolate";let r=!1;t[1]>t[0]&&(a=[...a].reverse(),t=[...t].reverse(),r=!0);const d=t.length-1;try{if(s>t[0]||s<t[d]){let c,h;return s>t[0]?(c=(a[1]-a[0])/(t[1]-t[0]),h=a[1]-c*t[1]):(c=(a[d]-a[d-1])/(t[d]-t[d-1]),h=a[d]-c*t[d]),c*s+h}else{let c;for(c=1;c<=d&&!(s>=t[c]);c++);const h=(a[c]-a[c-1])/(t[c]-t[c-1]),m=a[c]-h*t[c];return h*s+m}}catch{return"interpolation error"}finally{r&&(a.reverse(),t.reverse())}}static windSpeed(t,a){return Math.sqrt(t*t+a*a)}static windDirection(t,a){return(Math.atan2(-t,-a)*180/Math.PI+360)%360}static calculateMeanWind(t,a,s,r,d){try{if(!t||!a||!s||t.length<2)throw new Error("Invalid input data for calculateMeanWind");const c=new Array(4);let h=[d],m=[Number(_e.linearInterpolate(t,a,d))],p=[Number(_e.linearInterpolate(t,s,d))];const y=Number(_e.linearInterpolate(t,a,r)),v=Number(_e.linearInterpolate(t,s,r));for(let A=0;A<t.length;A++)t[A]<d&&t[A]>r&&(h.push(t[A]),m.push(a[A]),p.push(s[A]));h.push(r),m.push(y),p.push(v);const w=h.map((A,O)=>O);w.sort((A,O)=>h[O]-h[A]),h=w.map(A=>h[A]),m=w.map(A=>m[A]),p=w.map(A=>p[A]);let S=0,E=0;for(let A=0;A<h.length-1;A++)S+=.5*(m[A]+m[A+1])*(h[A]-h[A+1]),E+=.5*(p[A]+p[A+1])*(h[A]-h[A+1]);const P=S/(h[0]-h[h.length-1]),x=E/(h[0]-h[h.length-1]);return c[2]=P,c[3]=x,c[1]=_e.windSpeed(P,x),c[0]=_e.windDirection(P,x),c}catch(c){return console.error("Error in calculateMeanWind:",c,{heights:t,xComponents:a,yComponents:s,lowerLimit:r,upperLimit:d}),_e.handleError("Failed to calculate mean wind: "+c.message),null}}static async getLocationData(t,a){const s=`${t.toFixed(4)},${a.toFixed(4)}`;if(_e.locationCache.has(s))return _e.locationCache.get(s);try{const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${a}&timezone=auto`);if(!r.ok)throw new Error(`Open-Meteo fetch failed: ${r.status}`);const d=await r.json(),c={timezone:d.timezone||"GMT",timezone_abbreviation:d.timezone_abbreviation||"GMT",elevation:d.elevation!==void 0?d.elevation:"N/A"};return _e.locationCache.set(s,c),console.log(`Fetched location data for ${s}:`,c),c}catch(r){return console.error("Error fetching location data:",r.message),{timezone:"UTC",elevation:"N/A"}}}static async formatLocalTime(t,a,s){const{timezone:r,timezone_abbreviation:d}=await _e.getLocationData(a,s);return se.fromISO(t,{zone:"UTC"}).setZone(r).toFormat("yyyy-MM-dd HHmm")+` ${d}`}static normalizeAngle(t){return(t%360+360)%360}static calculateWindAngle(t,a){let s=_e.normalizeAngle(a-t);return s>180&&(s-=360),s}static calculateWindComponents(t,a){const s=a*(Math.PI/180),r=t*Math.sin(s),d=t*Math.cos(s);return{crosswind:r,headwind:d}}static calculateWCA(t,a){const r=Math.abs(Math.asin(t/a))*(180/Math.PI);return isNaN(r)?0:r}static calculateGroundSpeed(t,a){return t-a}static calculateCourseFromHeading(t,a,s,r){const d=_e.calculateWindAngle(t,a),{crosswind:c,headwind:h}=_e.calculateWindComponents(s,d),m=r*Math.sin(t*Math.PI/180),p=r*Math.cos(t*Math.PI/180),y=(a+180)%360,v=s*Math.sin(y*Math.PI/180),w=s*Math.cos(y*Math.PI/180),S=m+v,E=p+w,P=Math.atan2(S,E)*(180/Math.PI),x=_e.normalizeAngle(P),A=Math.sqrt(S*S+E*E),O=_e.calculateWCA(c,r)*(c<0?-1:1);return{trueCourse:Number(x.toFixed(2)),groundSpeed:Number(A.toFixed(2)),wca:Number(O.toFixed(2)),crosswind:Number(c.toFixed(2)),headwind:Number(h.toFixed(2))}}static calculateFlightParameters(t,a,s,r){const d=_e.calculateWindAngle(t,a),{crosswind:c,headwind:h}=_e.calculateWindComponents(s,d),m=_e.calculateWCA(c,r),p=_e.calculateGroundSpeed(r,h);return{crosswind:Number(c.toFixed(2)),headwind:Number(h.toFixed(2)),wca:Number(m.toFixed(2)),groundSpeed:Number(p.toFixed(2))}}static handleError(t,a=!0){a&&console.error(t),typeof Gn=="function"?Gn(t):(console.warn("Utils.js: displayError function is not available, logging to console only."),console.error("Error message:",t))}static dmsToDecimal(t,a,s,r){if(isNaN(t)||isNaN(a)||isNaN(s)||!r)throw console.warn("Invalid DMS inputs:",{deg:t,min:a,sec:s,dir:r}),new Error("Invalid DMS values");let d=t+a/60+s/3600;if((r==="S"||r==="W")&&(d=-d),isNaN(d))throw console.warn("DMS to decimal conversion failed:",{deg:t,min:a,sec:s,dir:r}),new Error("Failed to convert DMS to decimal");return d}static decimalToDms(t,a){if(isNaN(t)||t===null||t===void 0)throw console.warn("Invalid decimal value for DMS conversion:",t),new Error("Invalid coordinate for DMS conversion");const s=Math.abs(t),r=Math.floor(s),d=Math.floor((s-r)*60),c=(s-r)*3600-d*60,h=a?t>=0?"N":"S":t>=0?"E":"W";if(isNaN(r)||isNaN(d)||isNaN(c))throw console.warn("DMS calculation resulted in invalid values:",{deg:r,min:d,sec:c}),new Error("Failed to convert to DMS");return{deg:r,min:d,sec:c,dir:h}}static decimalToMgrs(t,a){try{return Ul([a,t])}catch(s){return console.error("Error converting to MGRS:",s),"Invalid MGRS"}}static mgrsToDecimal(t){try{const[a,s]=Hs(t);return{lat:s,lng:a}}catch(a){return console.error("Error converting MGRS to decimal:",a),null}}static convertCoords(t,a,s="Decimal"){if(t===null||a===null||t===void 0||a===void 0)return{lat:"N/A",lng:"N/A"};const r={Decimal:{lat:t.toFixed(6),lng:a.toFixed(6)},DMS:{lat:_e.decimalToDms(t,!0),lng:_e.decimalToDms(a,!1)},MGRS:_e.decimalToMgrs(t,a)};switch(s){case"DMS":return r.DMS;case"MGRS":return{lat:r.MGRS,lng:r.MGRS};case"Decimal":default:return r.Decimal}}static calculateTAS(t,a){if(isNaN(t)||isNaN(a)||t<0||a<0)return console.warn("Invalid inputs for calculateTAS:",{ias:t,heightFt:a}),"N/A";const s=_n.LAPSE_RATE,r=_n.SEA_LEVEL_TEMP_KELVIN,d=_n.GRAVITY,c=_n.GAS_CONSTANT_AIR,h=Qe.FEET_TO_METERS,m=a*h,p=r-s*m,y=p/r,v=1-s*m/r,w=d/(s*c)-1,S=Math.pow(v,w),E=t/Math.sqrt(S);return console.log("calculateTAS debug:",{ias:t,heightFt:a,heightM:m,tempAtAltitude:p,tempRatio:y,base:v,exponent:w,densityRatio:S,tas:E,tasRounded:Number(E.toFixed(2))}),Number(E.toFixed(2))}static calculateTASFromGroundSpeed(t,a,s,r,d){if(isNaN(t)||isNaN(a)||isNaN(s)||isNaN(r))return"N/A";const c=_e.convertWind(t,"kt","m/s"),h=_e.convertWind(a,"kt","m/s"),m=_e.calculateWindAngle(r,s),{crosswind:p,headwind:y}=_e.calculateWindComponents(h,m),v=c+y,w=_e.calculateTAS(v,d);return Number(w.toFixed(1))}static handleMessage(t){const a=document.getElementById("info");a?(a.textContent=t,a.style.display="block",setTimeout(()=>{a.style.display="none"},3e3),console.log("Displayed message:",t)):(console.warn("Info div not found for handleMessage, using alert"),alert(t))}static calculateQFE(t,a,s,r=15){if(!t||a==="N/A"||s==="N/A"||isNaN(t)||isNaN(a)||isNaN(s))return"N/A";console.log("QFE reference elevation: ",s);const d=_n.GRAVITY,c=Vo.MOLAR_MASS_AIR,h=Vo.UNIVERSAL_GAS_CONSTANT,m=r+Qe.CELSIUS_TO_KELVIN,p=_n.LAPSE_RATE,y=t*100,v=a-s,w=d*c/(h*p),S=y*Math.pow(1-p*v/m,w);console.log(t,a,s);const E=Math.round(S/100);return isNaN(E)?"N/A":E}static calculateNewCenter(t,a,s,r){const d=fu,c=t*Math.PI/180,h=a*Math.PI/180,m=r*Math.PI/180,p=s/d,y=Math.asin(Math.sin(c)*Math.cos(p)+Math.cos(c)*Math.sin(p)*Math.cos(m)),v=h+Math.atan2(Math.sin(m)*Math.sin(p)*Math.cos(c),Math.cos(p)-Math.sin(c)*Math.sin(y)),w=y*180/Math.PI,E=(v*180/Math.PI+540)%360-180;return[w,E]}static debounce(t,a){let s;return function(...r){clearTimeout(s),s=setTimeout(()=>t.apply(this,r),a)}}static calculateBearing(t,a,s,r){const d=v=>v*Math.PI/180,c=v=>v*180/Math.PI,h=d(r-a),m=Math.sin(h)*Math.cos(d(s)),p=Math.cos(d(t))*Math.sin(d(s))-Math.sin(d(t))*Math.cos(d(s))*Math.cos(h);let y=c(Math.atan2(m,p));return y=(y+360)%360,y}static async getAltitude(t,a){const{elevation:s}=await _e.getLocationData(t,a);return console.log("Fetched elevation from Open-Meteo:",s),s!=="N/A"?s:"N/A"}static getLastFullHourUTC(){const t=new Date,a=t.getUTCFullYear(),s=t.getUTCMonth(),r=t.getUTCDate(),d=t.getUTCHours(),c=new Date(Date.UTC(a,s,r,d,0,0));return console.log("Last full hour UTC:",c.toISOString()),c}static async getDisplayTime(t,a,s){var d;return(((d=document.querySelector('input[name="timeZone"]:checked'))==null?void 0:d.value)||"Z")==="Z"||!a||!s?_e.formatTime(t):await _e.formatLocalTime(t,a,s)}static calculateDynamicRadius(t=vt.HEATMAP_SCALING_BASE,a=vt.HEATMAP_REFERENCE_ZOOM){const s=l.map.getZoom(),r=vt.HEATMAP_SCALING_BASE,d=Math.pow(r,s-a),c=t*d,h=vt.HEATMAP_MIN_RADIUS_PX,m=vt.HEATMAP_MAX_RADIUS_PX,p=Math.max(h,Math.min(m,c));return console.log("[calculateDynamicRadius] Calculated dynamic radius:",{currentZoom:s,baseRadius:t,scaleFactor:d,dynamicRadius:c,adjustedRadius:p}),p}static interpolateColor(t,a=0,s=3e3){const r=Math.min(Math.max((t-a)/(s-a),0),1);return t<0||isNaN(t)?"#808080":r<=.5?`rgb(255, ${Math.round(255*(r*2))}, 0)`:`rgb(${Math.round(255*(1-(r-.5)*2))}, 255, 0)`}static generateWindBarb(t,a,s=null){const r=Math.round(a),d=40,c=40,h=d/2,m=c/2,p=20,v=(typeof s=="number"&&!isNaN(s)?s>=0:!0)?-1:1;let w=Math.floor(r/50),S=r%50,E=Math.floor(S/10),P=Math.floor(S%10/5);r<5?(E=0,P=0):r<10&&P>0&&(P=1);let x=`<svg width="${d}" height="${c}" viewBox="0 0 ${d} ${c}">`;const A=t+180;x+=`<g transform="translate(${h}, ${m}) rotate(${A})">`,x+=`<line x1="0" y1="${p/2}" x2="0" y2="${-p/2}" stroke="black" stroke-width="1"/>`;let O=p/2;const z=4;for(let I=0;I<w;I++)x+=`<polygon points="0,${O-5} 0,${O+5} ${10*v},${O}" fill="black"/>`,O-=z+5;for(let I=0;I<E;I++)x+=`<line x1="0" y1="${O}" x2="${10*v}" y2="${O}" stroke="black" stroke-width="1"/>`,O-=z;return P>0&&(x+=`<line x1="0" y1="${O}" x2="${5*v}" y2="${O}" stroke="black" stroke-width="1"/>`),r<5&&(x+='<circle cx="0" cy="0" r="3" fill="none" stroke="black" stroke-width="1"/>'),x+="</g></svg>",x}},Wo(_e,"locationCache",new Map),_e);window.Utils=b;const nt={dbName:"SkydivingTileCache",storeName:"tiles",db:null,async init(){return new Promise((i,t)=>{const a=indexedDB.open(this.dbName,1);a.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"url"})},a.onsuccess=s=>{this.db=s.target.result,i()},a.onerror=s=>{console.error("IndexedDB initialization failed:",s),t(s)}})},async storeTile(i,t){return this.db||await this.init(),new Promise((a,s)=>{const c=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({url:i,blob:t,timestamp:Date.now()});c.onsuccess=()=>{console.log(`Stored tile: ${i}`),a(!0)},c.onerror=h=>{console.warn(`Failed to store tile: ${i}`,h),b.handleError("Failed to store some tiles. Try clearing cache."),s(h)}})},async getTile(i){return this.db||await this.init(),new Promise((t,a)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),d=r.get(i);d.onsuccess=c=>{const h=c.target.result;if(h)t(h.blob);else{const m=[i.replace("https://tile.opentopomap.org","https://a.tile.opentopomap.org"),i.replace("https://tile.opentopomap.org","https://b.tile.opentopomap.org"),i.replace("https://tile.opentopomap.org","https://c.tile.opentopomap.org"),i.replace("https://tile.openstreetmap.org","https://a.tile.openstreetmap.org"),i.replace("https://tile.openstreetmap.org","https://b.tile.openstreetmap.org"),i.replace("https://tile.openstreetmap.org","https://c.tile.openstreetmap.org"),i.replace("https://basemaps.cartocdn.com","https://a.basemaps.cartocdn.com"),i.replace("https://basemaps.cartocdn.com","https://b.basemaps.cartocdn.com"),i.replace("https://basemaps.cartocdn.com","https://c.basemaps.cartocdn.com"),i.replace("https://basemaps.cartocdn.com","https://d.basemaps.cartocdn.com")];let p=null;for(const y of m){if(y===i)continue;const v=r.get(y);v.onsuccess=w=>{const S=w.target.result;S&&(p=S.blob,t(p))},v.onerror=()=>{}}setTimeout(()=>{p||t(null)},100)}},d.onerror=c=>{console.warn(`Failed to retrieve tile: ${i}`,c),a(c)}})},async clearCache(){return this.db||await this.init(),new Promise((i,t)=>{const r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();r.onsuccess=()=>{console.log("Tile cache cleared"),i()},r.onerror=d=>{console.error("Failed to clear cache:",d),t(d)}})},async clearOldTiles(i=bi.MAX_AGE_DAYS){this.db||await this.init();const t=i*24*60*60*1e3;return new Promise((a,s)=>{const c=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).openCursor();let h=0,m=0;c.onsuccess=p=>{const y=p.target.result;if(y)Date.now()-y.value.timestamp>t&&(m+=y.value.blob.size||0,y.delete(),h++),y.continue();else{const v=m/1048576;console.log(`Cleared ${h} old tiles, freed ${v.toFixed(2)} MB`),a({deletedCount:h,deletedSizeMB:v})}},c.onerror=p=>{console.error("Failed to clear old tiles:",p),s(p)}})},async getCacheSize(){return this.db||await this.init(),new Promise((i,t)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).openCursor();let d=0,c=0;r.onsuccess=h=>{var p;const m=h.target.result;if(m)try{const y=((p=m.value.blob)==null?void 0:p.size)||0;typeof y!="number"||isNaN(y)?console.warn(`Invalid blob size for tile: ${m.value.url}, size: ${y}`):(d+=y,c++),m.continue()}catch(y){console.warn(`Error processing tile during size calculation: ${m.value.url}`,y),m.continue()}else{const y=d/1048576;console.log(`Cache size calculation completed: ${y.toFixed(2)} MB, ${c} tiles`),i(y)}},r.onerror=h=>{console.error("Failed to calculate cache size:",h),t(h)}})},async migrateTiles(){return this.db||await this.init(),new Promise((i,t)=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),r=s.openCursor();let d=0;r.onsuccess=c=>{const h=c.target.result;if(h){const{url:m,blob:p,timestamp:y}=h.value,v=m.replace(/^(https?:\/\/[a-c]\.tile\.openstreetmap\.org)/,"https://tile.openstreetmap.org").replace(/^(https?:\/\/[a-d]\.basemaps\.cartocdn\.com)/,"https://basemaps.cartocdn.com").replace(/^(https?:\/\/[a-c]\.tile\.opentopomap\.org)/,"https://tile.opentopomap.org");m!==v&&(h.delete(),s.put({url:v,blob:p,timestamp:y}),d++),h.continue()}else console.log(`Migrated ${d} tiles to normalized URLs`),i()},r.onerror=c=>{console.error("Failed to migrate tiles:",c),t(c)}})}};K.TileLayer.Cached=K.TileLayer.extend({createTile(i,t){const a=document.createElement("img");K.DomEvent.on(a,"load",()=>{console.log("Tile loaded:",this.getTileUrl(i)),t(null,a)}),K.DomEvent.on(a,"error",()=>{console.warn("Tile error:",this.getTileUrl(i)),t(new Error("Failed to load tile"),a)});const s=this.getTileUrl(i);a.setAttribute("role","presentation");const r=s.replace(/^(https?:\/\/[a-c]\.tile\.openstreetmap\.org)/,"https://tile.openstreetmap.org").replace(/^(https?:\/\/[a-d]\.basemaps\.cartocdn\.com)/,"https://basemaps.cartocdn.com").replace(/^(https?:\/\/[a-c]\.tile\.opentopomap\.org)/,"https://tile.opentopomap.org");return!navigator.onLine&&(i.z<11||i.z>14)?(console.log(`Skipping tile request outside cached zoom levels (11–14): ${s}`),b.handleError("Offline: Zoom restricted to levels 11–14 for cached tiles."),t(new Error("Zoom level not cached"),a),a):(navigator.onLine?(a.src=s,fetch(s,{signal:AbortSignal.timeout(bi.FETCH_TIMEOUT_MS)}).then(d=>{if(!d.ok)throw new Error(`HTTP ${d.status}`);return d.blob()}).then(d=>{nt.storeTile(r,d).catch(c=>console.warn("Failed to cache tile during rendering:",r,c))}).catch(d=>{console.warn("Fetch error for tile during rendering:",s,d),nt.getTile(r).then(c=>{c?(a.src=URL.createObjectURL(c),console.log(`Tile loaded from cache (fallback): ${r}`)):t(d,a)}).catch(c=>{console.warn("Cache fallback error:",r,c),t(c,a)})})):nt.getTile(r).then(d=>{d?(a.src=URL.createObjectURL(d),console.log(`Tile loaded from cache: ${r}`)):(console.warn(`Tile not in cache: ${r}`),b.handleError("This area is not cached. Please cache more tiles while online."),t(new Error("Tile not in cache"),a))}).catch(d=>{console.warn("Cache error for offline tile:",r,d),b.handleError("This area is not cached. Please cache more tiles while online."),t(d,a)}),a)}});K.tileLayer.cached=function(i,t){return new K.TileLayer.Cached(i,t)};function Dh(i,t,a,s,r){if(!r)return console.warn("Map not initialized, cannot calculate tiles"),[];const d=new Set,c=40075016686e-3,h=a*1e3;return s.forEach(m=>{const p=r.project([i,t],m),y=256,v=p.x/y,w=p.y/y,S=i*Math.PI/180,E=c*Math.cos(S)/(y*Math.pow(2,m)),P=Math.ceil(h/(E*y))+1,x=Math.pow(2,m);for(let A=Math.floor(v-P);A<=Math.ceil(v+P);A++)for(let O=Math.floor(w-P);O<=Math.ceil(w+P);O++)A>=0&&A<x&&O>=0&&O<x&&d.add(`${m}/${A}/${O}`)}),Array.from(d).map(m=>{const[p,y,v]=m.split("/").map(Number);return{zoom:p,x:y,y:v}})}async function Gl(i,t=3){let a=null;for(let s=1;s<=t;s++){try{const r=new AbortController,d=setTimeout(()=>r.abort(),bi.FETCH_TIMEOUT_MS),c=await fetch(i,{signal:r.signal});if(clearTimeout(d),c.ok)return{success:!0,blob:await c.blob()};console.warn(`Attempt ${s} failed for ${i}: HTTP ${c.status}`),a=new Error(`HTTP ${c.status}`)}catch(r){console.warn(`Attempt ${s} error for ${i}: ${r.message}`),a=r,r.name==="AbortError"&&console.warn(`Fetch timeout after 15s for ${i}`)}s<t&&await new Promise(r=>setTimeout(r,1e3))}return{success:!1,error:a}}async function Nh({map:i,lastLat:t,lastLng:a,baseMaps:s}){if(!i){console.warn("Map not initialized, cannot cache tiles"),yt("Map not initialized, cannot cache tiles.");return}if(console.log("cacheTilesForDIP called with:",{lastLat:t,lastLng:a,cacheRadiusKm:g.state.userSettings.cacheRadiusKm,cacheZoomLevels:g.state.userSettings.cacheZoomLevels}),!t||!a){console.warn("No DIP coordinates for caching, skipping"),yt("Please select a location to cache map tiles.");return}if(!g.state.userSettings.baseMaps||!s[g.state.userSettings.baseMaps]){console.warn(`Base map ${g.state.userSettings.baseMaps} not found, skipping caching`),yt("Selected base map not available for caching.");return}const r=g.state.userSettings.cacheRadiusKm||g.defaultSettings.cacheRadiusKm,d=g.state.userSettings.cacheZoomLevels||g.defaultSettings.cacheZoomLevels,c=Dh(t,a,r,d,i);console.log(`Caching ${c.length} tiles for DIP:`,{lat:t,lng:a,radiusKm:r,zoomLevels:d,baseMap:g.state.userSettings.baseMaps});const h=[];if(g.state.userSettings.baseMaps==="Esri Satellite + OSM")h.push({name:"Esri Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",normalizedUrl:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{name:"OSM Overlay",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],normalizedUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"});else{const w=s[g.state.userSettings.baseMaps];h.push({name:g.state.userSettings.baseMaps,url:w.options.url||w._url,subdomains:w.options.subdomains,normalizedUrl:(w.options.url||w._url).replace(/{s}\./,"")})}let m=0,p=0;const y=c.length*h.length,v=[];l.isCachingCancelled=!1,console.log("Calling displayProgress with initial values:",{cachedCount:m,failedCount:p,totalTiles:y}),_a(m+p,y,()=>{l.isCachingCancelled=!0});try{for(const w of h){if(console.log("Processing layer:",w.name),l.isCachingCancelled){console.log("Caching cancelled by user");break}const S=c.map(async(E,P)=>{if(l.isCachingCancelled){console.log("Caching cancelled during tile processing");return}const x=w.url.replace("{z}",E.zoom).replace("{x}",E.x).replace("{y}",E.y).replace("{s}",w.subdomains?w.subdomains[Math.floor(Math.random()*w.subdomains.length)]:""),A=w.normalizedUrl.replace("{z}",E.zoom).replace("{x}",E.x).replace("{y}",E.y);if(console.log(`Processing tile ${P+1}/${c.length} for layer ${w.name}:`,{url:x,normalizedUrl:A}),await nt.getTile(A).catch(I=>(console.error(`Error retrieving tile from cache: ${A}`,I),null)))m++,console.log(`Tile ${P+1} already in cache`);else{const I=await Gl(x);I.success?await nt.storeTile(A,I.blob).catch(H=>(console.error(`Error storing tile: ${A}`,H),!1))?(m++,console.log(`Tile ${P+1} cached successfully`)):(p++,v.push(x),console.log(`Tile ${P+1} failed to store`)):(p++,v.push(x),console.log(`Tile ${P+1} failed to fetch:`,I.error.message))}const z=m+p;((P+1)%10===0||P===c.length-1)&&(console.log("Updating progress:",{currentCount:z,totalTiles:y}),_a(z,y,()=>{l.isCachingCancelled=!0}))});console.log(`Processing batch of ${c.length} tiles for layer ${w.name}`);for(let E=0;E<S.length;E+=20){if(l.isCachingCancelled){console.log("Caching cancelled during batch processing");break}const P=S.slice(E,E+20);await Promise.all(P).catch(x=>{console.error("Error processing batch of tiles:",x)}),console.log(`Completed batch ${E/20+1} for layer ${w.name}`)}}}catch(w){console.error("Unexpected error in cacheTilesForDIP:",w),b.handleError("Failed to cache map tiles: "+w.message)}finally{console.log("Hiding progress bar"),Bl()}v.length>0&&console.warn(`Failed to cache ${v.length} tiles:`,v),console.log(`DIP caching complete: ${m} tiles cached, ${p} failed`),l.isCachingCancelled?yt(`Caching cancelled: ${m} tiles cached, ${p} failed.`):p>0?yt(`Cached ${m} tiles around DIP (${p} failed). Pan or zoom to cache more tiles.`):yt(`Cached ${m} tiles around DIP successfully.`);try{const w=await nt.getCacheSize();console.log(`Cache size after DIP caching: ${w.toFixed(2)} MB`),w>bi.SIZE_LIMIT_MB_WARNING&&b.handleError(`Cache size large (${w.toFixed(2)} MB). Consider clearing cache to free up space.`)}catch(w){console.error("Failed to check cache size after DIP caching:",w),b.handleError("Unable to check cache size. Consider clearing cache to free up space.")}}b.debounce(async({map:i,baseMaps:t})=>{if(!i||!navigator.onLine){console.log("Skipping visible tile caching: offline or map not initialized");return}const a=i.getBounds(),s=i.getZoom(),r=g.state.userSettings.cacheZoomLevels||g.defaultSettings.cacheZoomLevels;if(!r.includes(s)){console.log(`Skipping caching: zoom ${s} not in cacheZoomLevels`,r);return}const d=256,c=i.project(a.getSouthWest(),s),h=i.project(a.getNorthEast(),s),m=Math.floor(c.x/d),p=Math.floor(h.x/d),y=Math.floor(h.y/d),v=Math.floor(c.y/d),w=[];for(let O=m;O<=p;O++)for(let z=y;z<=v;z++){const I=2**s;O>=0&&O<I&&z>=0&&z<I&&w.push({zoom:s,x:O,y:z})}console.log(`Caching ${w.length} visible tiles at zoom ${s} for ${g.state.userSettings.baseMaps}`);const S=[];if(!t[g.state.userSettings.baseMaps]){console.warn(`Base map ${g.state.userSettings.baseMaps} not found, skipping caching`),yt("Selected base map not available for caching.");return}if(g.state.userSettings.baseMaps==="Esri Satellite + OSM")S.push({name:"Esri Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",normalizedUrl:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{name:"OSM Overlay",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],normalizedUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"});else{const O=t[g.state.userSettings.baseMaps];S.push({name:g.state.userSettings.baseMaps,url:O.options.url||O._url,subdomains:O.options.subdomains,normalizedUrl:(O.options.url||O._url).replace(/{s}\./,"")})}let E=0,P=0;const x=w.length*S.length,A=[];l.isCachingCancelled=!1,_a(E+P,x,()=>{l.isCachingCancelled=!0});for(const O of S){if(l.isCachingCancelled){console.log("Visible tile caching cancelled by user");break}const z=w.map(async(I,B)=>{if(l.isCachingCancelled)return;const H=O.url.replace("{z}",I.zoom).replace("{x}",I.x).replace("{y}",I.y).replace("{s}",O.subdomains?O.subdomains[Math.floor(Math.random()*O.subdomains.length)]:""),$=O.normalizedUrl.replace("{z}",I.zoom).replace("{x}",I.x).replace("{y}",I.y);if(await nt.getTile($).catch(()=>null))E++;else{const D=await Gl(H);D.success&&await nt.storeTile($,D.blob).catch(()=>!1)?E++:(P++,A.push(H))}const k=E+P;((B+1)%10===0||B===w.length-1)&&_a(k,x,()=>{l.isCachingCancelled=!0})});for(let I=0;I<z.length&&!l.isCachingCancelled;I+=20){const B=z.slice(I,I+20);await Promise.all(B)}}Bl(),A.length>0&&console.warn(`Failed to cache ${A.length} visible tiles:`,A),l.isCachingCancelled?yt(`Visible tile caching cancelled: ${E} tiles cached.`):yt("Visible map tiles cached.");try{const O=await nt.getCacheSize();console.log(`Cache size after visible tiles caching: ${O.toFixed(2)} MB`),O>bi.SIZE_LIMIT_MB_WARNING&&b.handleError(`Cache size large (${O.toFixed(2)} MB). Consider clearing cache to free up space.`)}catch(O){console.error("Failed to check cache size after visible tiles caching:",O),b.handleError("Unable to check cache size. Consider clearing cache to free up space.")}},1e3);window.L=K;async function Oh(){return console.log("MapManager: Starte Karteninitialisierung..."),await Fh(),console.log("MapManager: Karteninitialisierung abgeschlossen."),l.map}async function Fh(){if(l.ismapInitialized||l.map){console.warn("Map already initialized or init in progress.");return}l.ismapInitialized=!0,console.log("initMap started...");const i=wt.DEFAULT_MAP_CENTER,t=wt.DEFAULT_MAP_ZOOM;Rh(i,t),l.jumpVisualizationLayerGroup=K.layerGroup().addTo(l.map),l.landingPatternLayerGroup=K.layerGroup().addTo(l.map),l.jumpRunTrackLayerGroup=K.layerGroup().addTo(l.map),zh(),$h(),Bh(),Uh(),Hh(i),jh(),Promise.all([Zh(),Gh(i,t)]).then(()=>{console.log("Initial tile caching and geolocation promise resolved.")}).catch(a=>{console.error("Error during parallel initialization of cache/geolocation:",a)}),As(),console.log("initMap finished.")}function Rh(i,t){l.lastLat=l.lastLat||i[0],l.lastLng=l.lastLng||i[1],l.map=K.map("map",{center:i,zoom:t,zoomControl:!1,doubleClickZoom:!1,maxZoom:19,minZoom:navigator.onLine?6:11}),console.log("Map instance created.")}function zh(){l.baseMaps={OpenStreetMap:K.tileLayer.cached("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}),OpenTopoMap:K.tileLayer.cached("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'© <a href="https://www.openstreetmap.org/copyright">OSM</a>, <a href="https://opentopomap.org">OpenTopoMap</a> (CC-BY-SA)',subdomains:["a","b","c"]}),"Esri Satellite":K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USDA, USGS"}),"Esri Street":K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USGS"}),"Esri Topo":K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USGS"}),"Esri Satellite + OSM":K.layerGroup([K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USDA, USGS",zIndex:1}),K.tileLayer.cached("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',opacity:.5,zIndex:2,updateWhenIdle:!0,keepBuffer:2,subdomains:["a","b","c"]})],{attribution:'© Esri, USDA, USGS | © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'})},l.map&&l.map.attributionControl&&l.map.attributionControl.addAttribution('Weather data by <a href="https://open-meteo.com">Open-Meteo</a>');const t=g.state.userSettings.baseMaps in l.baseMaps?g.state.userSettings.baseMaps:"Esri Street",a=l.baseMaps[t];a&&typeof a.on=="function"?(a.on("tileerror",()=>{if(!navigator.onLine){l.hasTileErrorSwitched||(console.warn(`${t} tiles unavailable offline. Zoom restricted.`),b.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles."),l.hasTileErrorSwitched=!0);return}if(!l.hasTileErrorSwitched&&l.map.hasLayer(a)){const s="OpenStreetMap";console.warn(`${t} tiles unavailable, switching to ${s}`),l.map.removeLayer(a),l.baseMaps[s].addTo(l.map),g.state.userSettings.baseMaps=s,g.save(),b.handleMessage(`${t} tiles unavailable. Switched to ${s}.`),l.hasTileErrorSwitched=!0}else l.hasTileErrorSwitched||console.warn(`Tile error in ${t}, attempting to continue.`)}),a.addTo(l.map)):(console.error(`Default base map "${t}" could not be added.`),l.baseMaps.OpenStreetMap.addTo(l.map)),l.map&&l.map.invalidateSize(),window.addEventListener("online",()=>{l.hasTileErrorSwitched=!1,l.map&&(l.map.options.minZoom=6),As()}),window.addEventListener("offline",()=>{l.map&&(l.map.options.minZoom=9),As()}),console.log("Base layers and online/offline handlers set up.")}function $h(){if(!l.map){console.error("Karte nicht initialisiert, bevor Controls hinzugefügt werden können.");return}K.control.layers(l.baseMaps,null,{position:"topright"}).addTo(l.map),l.map.on("baselayerchange",function(i){console.log(`Base map changed to: ${i.name}`),g&&g.state&&g.state.userSettings?(g.state.userSettings.baseMaps=i.name,g.save(),console.log(`Saved selected base map "${i.name}" to settings.`)):console.error("Settings object not properly available to save base map choice."),l.hasTileErrorSwitched=!1,l.lastLat&&l.lastLng&&typeof cacheTilesForDIP=="function"&&cacheTilesForDIP({map:l.map,lastLat:l.lastLat,lastLng:l.lastLng,baseMaps:l.baseMaps})}),K.control.zoom({position:"topright"}).addTo(l.map),K.control.polylineMeasure({position:"topright",unit:"kilometres",showBearings:!0,clearMeasurementsOnStop:!1,showClearControl:!0,showUnitControl:!0,tooltipTextFinish:"Click to finish the line<br>",tooltipTextDelete:"Shift-click to delete point",tooltipTextMove:"Drag to move point<br>",tooltipTextResume:"Click to resume line<br>",tooltipTextAdd:"Click to add point<br>",measureControlTitleOn:"Start measuring distance and bearing",measureControlTitleOff:"Stop measuring"}).addTo(l.map),K.control.scale({position:"bottomleft",metric:!0,imperial:!1,maxWidth:100}).addTo(l.map),console.log("Standard map controls and baselayerchange handler added.")}function Bh(){l.map.createPane("gpxTrackPane"),l.map.getPane("gpxTrackPane").style.zIndex=650,l.map.getPane("tooltipPane").style.zIndex=700,l.map.getPane("popupPane").style.zIndex=700,console.log("Custom map panes created.")}function Uh(){l.livePositionControl=new af({position:"bottomright"}).addTo(l.map),console.log("Initialized livePositionControl and hid by default")}async function Hh(i,t){console.log("MapManager: Initialisiere den Standard-Marker..."),await Ma(i[0],i[1]),l.isManualPanning=!1,console.log("Default marker initialized using the new standard method.")}async function Zh(){try{if(await nt.init(),await nt.migrateTiles(),await nt.getCacheSize()>500){const t=await nt.clearOldTiles(3);b.handleMessage(`Cleared ${t.deletedCount} old tiles: ${t.deletedSizeMB.toFixed(2)} MB freed.`)}else await nt.clearOldTiles()}catch(i){console.error("Failed to initialize or manage tile cache:",i),b.handleError("Tile caching setup failed.")}console.log("Tile cache logic initialized.")}async function Wh(i,t){const{latitude:a,longitude:s}=i.coords;console.log("MapManager: Geolocation erfolgreich. Sende Event."),l.lastLat=a,l.lastLng=s,l.lastAltitude=await b.getAltitude(a,s),l.map.setView([a,s],t);const r=new CustomEvent("location:selected",{detail:{lat:a,lng:s,source:"geolocation"},bubbles:!0,cancelable:!0});l.map.getContainer().dispatchEvent(r)}async function Er(i,t,a){console.warn(`Geolocation error: ${i.message}`),b.handleMessage("Unable to retrieve your location. Using default location."),await Ma(t[0],t[1]),l.map.setView(t,a),Vn(!0),l.isManualPanning=!1;const s=new CustomEvent("location:selected",{detail:{lat:t[0],lng:t[1],source:"geolocation_fallback"},bubbles:!0,cancelable:!0});l.map.getContainer().dispatchEvent(s),console.log("Dispatched 'location:selected' event from geolocation fallback.")}async function Gh(i,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>Wh(a,t),a=>Er(a,i,t),{enableHighAccuracy:!0,timeout:wt.GEOLOCATION_TIMEOUT_MS,maximumAge:0}):(console.warn("Geolocation not supported."),await Er({message:"Geolocation not supported by this browser."},i,t))}function Vh(i){const{lat:t,lng:a}=i.latlng,s=new CustomEvent("map:mousemove",{detail:{lat:t,lng:a},bubbles:!0,cancelable:!0});l.map.getContainer().dispatchEvent(s)}function jh(){if(!l.map){console.error("Karte nicht initialisiert in _setupCoreMapEventHandlers");return}l.coordsControl||(l.coordsControl=new K.Control.Coordinates,l.coordsControl.addTo(l.map),console.log("CoordsControl initialized in _setupCoreMapEventHandlers.")),l.map.on("mousemove",Vh),l.map.on("mouseout",function(){l.coordsControl&&l.coordsControl.getContainer()&&(l.coordsControl.getContainer().innerHTML="Move mouse over map")}),l.map.on("dblclick",kr),l.map.on("zoomstart",t=>{if(!navigator.onLine){const a=t.target._zoom||l.map.getZoom();a<11?(t.target._zoom=11,l.map.setZoom(11),b.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles.")):a>14&&(t.target._zoom=14,l.map.setZoom(14),b.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles."))}}),l.map.on("zoomend",()=>{const t=l.map.getZoom(),a=new CustomEvent("map:zoomend",{detail:{zoom:t},bubbles:!0,cancelable:!0});if(l.map.getContainer().dispatchEvent(a),l.jumpRunTrackLayer&&g.state.userSettings.showJumpRunTrack){const s=l.jumpRunTrackLayer.getLayers().find(r=>{var d;return((d=r.options.icon)==null?void 0:d.options.className)==="jrt-anchor-marker"});if(s){const r=t<=11?10:t<=12?12:t<=13?14:16;s.setIcon(K.divIcon({className:"jrt-anchor-marker",html:`<div style="background-color: orange; width: ${r}px; height: ${r}px; border-radius: 50%; border: 2px solid white; opacity: 0.8;"></div>`,iconSize:[r,r],iconAnchor:[r/2,r/2],tooltipAnchor:[0,-(r/2+5)]}))}}if(l.heatmapLayer){const s=b.calculateDynamicRadius(vt.HEATMAP_BASE_RADIUS,vt.HEATMAP_REFERENCE_ZOOM);l.heatmapLayer.setOptions({radius:s}),console.log("Heatmap radius updated on zoom:",{currentZoom:l.map.getZoom(),newRadius:s})}}),l.map.on("movestart",t=>{t.target===l.map&&(!t.originalEvent||t.originalEvent.target===l.map.getContainer())&&(l.isManualPanning=!0,console.log("Manual map panning detected."))}),l.map.on("contextmenu",t=>{if(!g.state.userSettings.showCutAwayFinder||!g.state.userSettings.calculateJump)return;const{lat:a,lng:s}=t.latlng;l.cutAwayMarker?l.cutAwayMarker.setLatLng([a,s]):(l.cutAwayMarker=Xh(a,s).addTo(l.map),Qh(l.cutAwayMarker)),l.cutAwayLat=a,l.cutAwayLng=s,Vl(l.cutAwayMarker,a,s);const r=new CustomEvent("cutaway:marker_placed",{bubbles:!0});l.map.getContainer().dispatchEvent(r)});const i=l.map.getContainer();i.addEventListener("touchstart",async t=>{if(t.touches.length!==1||t.target.closest(".leaflet-marker-icon"))return;const a=new Date().getTime(),s=a-lastTapTime;if(s<300&&s>0){t.preventDefault();const d=i.getBoundingClientRect(),c=t.touches[0].clientX-d.left,h=t.touches[0].clientY-d.top,m=l.map.containerPointToLatLng([c,h]);await kr({latlng:m,containerPoint:K.point(c,h),layerPoint:l.map.latLngToLayerPoint(m)})}lastTapTime=a},{passive:!1}),l.map.on("click",t=>{}),l.map.on("mousedown",t=>{}),console.log("All core map event handlers have been set up.")}function kr(i){const{lat:t,lng:a}=i.latlng;console.log('MapManager: Doppelklick erkannt. Sende "location:selected"-Event.');const s=new CustomEvent("location:selected",{detail:{lat:t,lng:a,source:"dblclick"},bubbles:!0,cancelable:!0});l.map.getContainer().dispatchEvent(s)}function ca(i){if(Jh(),l.labelZoomListener&&l.map&&(l.map.off("zoomend",l.labelZoomListener),l.labelZoomListener=null),!i||!l.jumpVisualizationLayerGroup)return;const t=[];i.exitCircles&&i.exitCircles.forEach(s=>{const r=K.circle(s.center,{radius:s.radius,color:s.color,fillColor:s.fillColor,fillOpacity:s.fillOpacity,weight:s.weight||2}).addTo(l.jumpVisualizationLayerGroup);s.tooltip&&r.bindTooltip(s.tooltip,{direction:"top",offset:[0,0],className:"wind-tooltip"})}),i.canopyCircles&&i.canopyCircles.forEach(s=>{K.circle(s.center,s).addTo(l.jumpVisualizationLayerGroup)});function a(s,r){const d=K.latLng(s[0],s[1]),h=r/6378137*(180/Math.PI),m=K.latLng(s[0]+h,s[1]),p=l.map.latLngToLayerPoint(d),y=l.map.latLngToLayerPoint(m);return[25,p.y-y.y+10]}if(i.canopyLabels){const s=l.map.getZoom();i.canopyLabels.forEach(r=>{const d=s<=11,c=K.marker(r.center,{icon:K.divIcon({className:`isoline-label ${d?"isoline-label-small":"isoline-label-large"}`,html:`<span style="font-size: ${d?"8px":"10px"}">${r.text}</span>`,iconSize:d?[50,12]:[60,14],iconAnchor:a(r.center,r.radius)}),zIndexOffset:2100}).addTo(l.jumpVisualizationLayerGroup);t.push({marker:c,center:r.center,radius:r.radius,text:r.text})})}t.length>0&&(l.labelZoomListener=function(){const r=l.map.getZoom()<=11;t.forEach(d=>{d.marker.setIcon(K.divIcon({className:`isoline-label ${r?"isoline-label-small":"isoline-label-large"}`,html:`<span style="font-size: ${r?"8px":"10px"}">${d.text}</span>`,iconSize:r?[50,12]:[60,14],iconAnchor:a(d.center,d.radius)}))})},l.map.on("zoomend",l.labelZoomListener))}function Jh(){l.map&&l.jumpVisualizationLayerGroup&&l.map.removeLayer(l.jumpVisualizationLayerGroup),l.jumpVisualizationLayerGroup=K.layerGroup().addTo(l.map)}function qh(){l.landingPatternLayerGroup&&l.landingPatternLayerGroup.clearLayers()}function pi(i){qh(),i&&(i.legs.forEach(t=>{K.polyline(t.path,{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}).addTo(l.landingPatternLayerGroup)}),i.arrows.forEach(t=>{const a=Kh(t.position[0],t.position[1],t.bearing,t.color);K.marker(t.position,{icon:a}).addTo(l.landingPatternLayerGroup).bindTooltip(t.tooltipText,{offset:[10,0],direction:"right",className:"wind-tooltip"})}))}function Kh(i,t,a,s){const r=(a+360)%360,d=`
        <svg width="40" height="20" viewBox="0 0 40 20" xmlns="http://www.w3.org/2000/svg">
            <line x1="0" y1="10" x2="30" y2="10" stroke="${s}" stroke-width="4" />
            <polygon points="30,5 40,10 30,15" fill="${s}" />
        </svg>
    `;return K.divIcon({html:`<div style="transform: rotate(${r}deg); ...">${d}</div>`,className:"wind-arrow-icon",iconSize:[40,20],iconAnchor:[20,10]})}function Yh(){l.map&&l.jumpRunTrackLayerGroup&&l.map.removeLayer(l.jumpRunTrackLayerGroup),l.jumpRunTrackLayerGroup=K.layerGroup().addTo(l.map)}function Xh(i,t){const a=K.icon({iconUrl:Is.CUTAWAY_MARKER,iconSize:[25,25],iconAnchor:[12,12],popupAnchor:[0,-12],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,41]});return K.marker([i,t],{icon:a,draggable:!0})}function Qh(i){i.on("dragend",t=>{const a=i.getLatLng();l.cutAwayLat=a.lat,l.cutAwayLng=a.lng,console.log("Cut-away marker dragged to:",{lat:l.cutAwayLat,lng:l.cutAwayLng}),Vl(i,l.cutAwayLat,l.cutAwayLng);const s=new CustomEvent("cutaway:marker_placed",{bubbles:!0});l.map.getContainer().dispatchEvent(s)})}function Vl(i,t,a,s=!1){const r=g.getValue("coordFormat","radio","Decimal"),d=b.convertCoords(t,a,r);let c="<b>Cut-Away Start</b><br>";if(r==="MGRS")c+=`MGRS: ${d.lat}`;else{const h=m=>`${m.deg}°${m.min}'${m.sec.toFixed(0)}" ${m.dir}`;r==="DMS"?c+=`Lat: ${h(b.decimalToDms(t,!0))}<br>Lng: ${h(b.decimalToDms(a,!1))}`:c+=`Lat: ${t.toFixed(5)}<br>Lng: ${a.toFixed(5)}`}Ws(i,c,s)}function Cs(i){l.cutAwayCircle&&(l.map.removeLayer(l.cutAwayCircle),l.cutAwayCircle=null),i&&(l.cutAwayCircle=K.circle(i.center,{radius:i.radius,color:"purple",fillColor:"purple",fillOpacity:.2,weight:2}).addTo(l.map),l.cutAwayCircle.bindTooltip(i.tooltipContent,{permanent:!1,direction:"center",className:"cutaway-tooltip"}))}function ef(){l.cutAwayMarker&&(l.map.removeLayer(l.cutAwayMarker),l.cutAwayMarker=null),Cs(null)}function ua(i){var d,c,h,m;if(Yh(),!i||!l.jumpRunTrackLayerGroup){console.warn("No valid trackData or AppState.jumpRunTrackLayerGroup");return}if(!((c=(d=i.path)==null?void 0:d.latlngs)!=null&&c.length)||!((h=i.airplane)!=null&&h.position)){console.warn("Invalid trackData structure:",i);return}const t=K.polyline(i.path.latlngs,i.path.options).bindTooltip(i.path.tooltipText).addTo(l.jumpRunTrackLayerGroup);let a=null;(m=i.approachPath)!=null&&m.latlngs&&(a=K.polyline(i.approachPath.latlngs,i.approachPath.options).bindTooltip(i.approachPath.tooltipText).addTo(l.jumpRunTrackLayerGroup));const s=K.icon({iconUrl:Is.AIRPLANE_MARKER,iconSize:[32,32],iconAnchor:[16,16],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,32]}),r=K.marker(i.airplane.position,{icon:s,rotationAngle:i.airplane.bearing,rotationOrigin:"center center",draggable:!0,zIndexOffset:2e3}).bindTooltip("Drag to move Jump Run Track").addTo(l.jumpRunTrackLayerGroup);r.on("mousedown",()=>l.map.dragging.disable()),r.on("mouseup",()=>l.map.dragging.enable()),r.on("drag",p=>{var P;const y=p.target.getLatLng(),v=i.airplane.originalPosition;if(!v||!Number.isFinite(v.lat)||!Number.isFinite(v.lng)){console.warn("Invalid originalPosition:",v);return}const w=y.lat-v.lat,S=y.lng-v.lng;if(!Number.isFinite(w)||!Number.isFinite(S)){console.warn("Invalid delta values:",{deltaLat:w,deltaLng:S});return}const E=i.path.originalLatLngs.map(x=>[Number.isFinite(x[0])?x[0]+w:x[0],Number.isFinite(x[1])?x[1]+S:x[1]]);if(t.setLatLngs(E),a&&((P=i.approachPath)!=null&&P.originalLatLngs)){const x=i.approachPath.originalLatLngs.map(A=>[Number.isFinite(A[0])?A[0]+w:A[0],Number.isFinite(A[1])?A[1]+S:A[1]]);a.setLatLngs(x)}}),r.on("dragend",p=>{const y=p.target.getLatLng();if(!Number.isFinite(y.lat)||!Number.isFinite(y.lng)){console.warn("Invalid new position in dragend:",y);return}const v=new CustomEvent("track:dragend",{detail:{newPosition:y,originalTrackData:i},bubbles:!0});l.map.getContainer().dispatchEvent(v)})}async function Ma(i,t){if(console.log("MapManager: Befehl erhalten, Marker zu erstellen/bewegen bei",i,t),typeof i!="number"||typeof t!="number"||i<-90||i>90||t<-180||t>180){console.error("MapManager: Ungültige Koordinaten:",{lat:i,lng:t});return}const a=await b.getAltitude(i,t);if(l.currentMarker)console.log("MapManager: Marker existiert, bewege ihn jetzt mit setLatLng."),l.currentMarker.setLatLng([i,t]);else{console.log("MapManager: Kein Marker vorhanden, erstelle einen neuen.");const r=tf(i,t);nf(r),l.currentMarker=r,l.currentMarker.addTo(l.map)}const s=`Lat: ${i.toFixed(5)}<br>Lng: ${t.toFixed(5)}<br>Alt: ${a} m`;Ws(l.currentMarker,s),l.lastLat=i,l.lastLng=t,l.lastAltitude=a,l.map.invalidateSize()}function tf(i,t){const a=K.icon({iconUrl:Is.DEFAULT_MARKER,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,32]});return K.marker([i,t],{icon:a,draggable:!0})}function nf(i){i.on("dragend",t=>{const a=i.getLatLng(),s=new CustomEvent("location:selected",{detail:{lat:a.lat,lng:a.lng,source:"marker_drag"},bubbles:!0});l.map.getContainer().dispatchEvent(s)})}function Ws(i,t,a=!1){var r;if(!i)return;const s=((r=i.getPopup())==null?void 0:r.isOpen())||a;i.unbindPopup().bindPopup(t),s&&i.openPopup()}function Vn(i=!1){l.isManualPanning&&!i||l.map&&l.currentMarker&&l.map.panTo(l.currentMarker.getLatLng())}const af=K.Control.extend({options:{position:"bottomright"},onAdd:function(i){const t=K.DomUtil.create("div","leaflet-control-live-position");return t.style.display="none",t.style.background="rgba(255, 255, 255, 0.8)",t.style.padding="5px",t.style.borderRadius="4px",this._container=t,t},update:function(i){if(!i||i.latitude===null||i.latitude===void 0){this._container.style.display="none";return}const{latitude:t,longitude:a,deviceAltitude:s,altitudeAccuracy:r,accuracy:d,speedMs:c,direction:h,showJumpMasterLine:m,jumpMasterLineData:p,heightUnit:y,effectiveWindUnit:v,coordFormat:w,refLevel:S}=i,E=b.convertCoords(t,a,w),P=w==="MGRS"?`MGRS: ${E.lat}<br>`:`Lat: ${t.toFixed(5)}<br>Lng: ${a.toFixed(5)}<br>`;let x="Altitude: N/A<br>";if(s!==null){let B=S==="AGL"&&l.lastAltitude?s-parseFloat(l.lastAltitude):s,H=S==="AGL"&&l.lastAltitude?"abv DIP":S;const $=Math.round(b.convertHeight(B,y)),M=Math.round(b.convertHeight(r,y));x=`Altitude: ${$} ${y} ${H} (±${M||"N/A"} ${y})<br>`}const A=`Accuracy: ${Math.round(b.convertHeight(d,y))} ${y}<br>`,O=`Speed: ${b.convertWind(c,v,"m/s").toFixed(1)} ${v}<br>`,z=`Direction: ${h}°`;let I=`<span style="font-weight: bold;">Live Position</span><br>${P}${x}${A}${O}${z}`;if(m&&p){const B=Math.round(b.convertHeight(p.distance,y)),H=p.tot!=="N/A"&&p.tot<1200?`TOT: X - ${p.tot} s`:"TOT: N/A";I+=`<br><br><span style="font-weight: bold;">Jump Master Line to ${p.target}</span><br>`,I+=`Bearing: ${p.bearing}°<br>`,I+=`Distance: ${B} ${y}<br>`,I+=H}this._container.innerHTML=I,this._container.style.display="block"}});function sf(i,t){const a=[[i.lat,i.lng],[t.lat,t.lng]];l.jumpMasterLine?l.jumpMasterLine.setLatLngs(a):l.jumpMasterLine=K.polyline(a,{color:"blue",weight:3,dashArray:"5, 5"}).addTo(l.map)}function Pr(){l.jumpMasterLine&&(l.map.removeLayer(l.jumpMasterLine),l.jumpMasterLine=null)}function of(){l.livePositionControl&&l.livePositionControl.update(null)}function rf(i){l.livePositionControl&&l.livePositionControl.update(i)}function jl(i){if(!l.isPlacingHarp)return;const{lat:t,lng:a}=i.latlng;l.harpMarker?(l.harpMarker.setLatLng([t,a]),console.log("Updated HARP marker position:",{lat:t,lng:a})):(l.harpMarker=lf(t,a).addTo(l.map),console.log("Placed new HARP marker:",{lat:t,lng:a})),g.state.userSettings.harpLat=t,g.state.userSettings.harpLng=a,g.save(),l.isPlacingHarp=!1,l.map.off("click",jl),console.log("HARP placement mode deactivated");const s=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');s&&(s.disabled=!1,console.log("Enabled HARP radio button"))}function lf(i,t){const a=K.marker([i,t],{icon:K.divIcon({className:"harp-marker",html:'<div style="background-color: green; width: 10px; height: 10px; border-radius: 50%;"></div>',iconSize:[10,10],iconAnchor:[5,5]}),pane:"markerPane"});return console.log("Created HARP marker at:",{latitude:i,longitude:t}),a}function cf(){if(!l.map){console.warn("Map not initialized, cannot clear HARP marker"),b.handleMessage("Map not initialized, cannot clear HARP marker.");return}l.harpMarker&&(l.map.removeLayer(l.harpMarker),l.harpMarker=null,console.log("Removed HARP marker")),g.state.userSettings.harpLat=null,g.state.userSettings.harpLng=null,g.save();const i=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');if(i&&(i.disabled=!0,console.log("Disabled HARP radio button")),g.state.userSettings.jumpMasterLineTarget==="HARP"&&g.state.userSettings.showJumpMasterLine){l.jumpMasterLine&&(l.map.removeLayer(l.jumpMasterLine),l.jumpMasterLine=null,console.log("Removed Jump Master Line: HARP marker cleared")),g.state.userSettings.jumpMasterLineTarget="DIP";const t=document.querySelector('input[name="jumpMasterLineTarget"][value="DIP"]');t&&(t.checked=!0,console.log("Switched Jump Master Line to DIP")),g.save(),l.liveMarker&&l.currentMarker&&l.lastLat!==null&&l.lastLng!==null&&debouncedPositionUpdate({coords:{latitude:l.lastLatitude,longitude:l.lastLongitude,accuracy:l.lastAccuracy,altitude:l.lastDeviceAltitude,altitudeAccuracy:l.lastAltitudeAccuracy}})}b.handleMessage("HARP marker cleared")}async function Ta(){if(!l.currentMarker||l.lastLat===null)return;const i=l.lastLat,t=l.lastLng,a=l.lastAltitude,s=g.getValue("coordFormat","radio","Decimal"),r=zt(),d=b.convertCoords(i,t,s);let c;if(s==="MGRS")c=`MGRS: ${d.lat}<br>Alt: ${a} m`;else{const h=m=>`${m.deg}°${m.min}'${m.sec.toFixed(0)}" ${m.dir}`;s==="DMS"?c=`Lat: ${h(b.decimalToDms(i,!0))}<br>Lng: ${h(b.decimalToDms(t,!1))}<br>Alt: ${a} m`:c=`Lat: ${i.toFixed(5)}<br>Lng: ${t.toFixed(5)}<br>Alt: ${a} m`}if(l.weatherData&&l.weatherData.surface_pressure){const h=l.weatherData.surface_pressure[r];h?c+=` QFE: ${h.toFixed(0)} hPa`:c+=" QFE: N/A"}else c+=" QFE: N/A";Ws(l.currentMarker,c)}async function Ea(i,t=null){var S;if(console.log(`updateWeatherDisplay called with index: ${i}, Time: ${l.weatherData.time[i]}`),!l.weatherData||!l.weatherData.time||i<0||i>=l.weatherData.time.length){console.error("No weather data available or index out of bounds:",i),document.getElementById("info").innerHTML="No weather data available",document.getElementById("selectedTime").innerHTML="Selected Time: ";const E=document.getElementById("timeSlider");E&&(E.value=0);return}l.landingWindDir=l.weatherData.wind_direction_10m[i]||null,console.log("landingWindDir updated to:",l.landingWindDir);const a=document.getElementById("customLandingDirectionLL"),s=document.getElementById("customLandingDirectionRR");a&&s&&l.landingWindDir!==null&&(a.value=Math.round(l.landingWindDir),s.value=Math.round(l.landingWindDir));const r=((S=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:S.value)||"AGL",d=g.getValue("heightUnit","radio","m"),c=g.getValue("windUnit","radio","kt"),h=g.getValue("temperatureUnit","radio","C"),m=await b.getDisplayTime(l.weatherData.time[i],l.lastLat,l.lastLng),p=Sn(i),y=r==="AMSL"&&l.lastAltitude!=="N/A"?Math.round(l.lastAltitude):0;if(!g.state.userSettings.showTable){document.getElementById("info").innerHTML="",document.getElementById("selectedTime").innerHTML=`Selected Time: ${m}`;return}const v=p.map(E=>{const P=parseFloat(E.spd);let x="";if(c==="bft"){const F=b.convertWind(P,"kt","km/h"),R=b.knotsToBeaufort(F);R<=1?x="wind-low":R<=3?x="wind-moderate":R<=4?x="wind-high":x="wind-very-high"}else{const F=b.convertWind(P,"kt","km/h");F<=3?x="wind-low":F<=10?x="wind-moderate":F<=16?x="wind-high":x="wind-very-high"}const A=E.rh;let O="";A!=="N/A"&&Number.isFinite(A)&&(A<65?O="humidity-low":A>=65&&A<=85?O="humidity-moderate":A>85&&A<100?O="humidity-high":A===100&&(O="humidity-saturated"));const z=r==="AMSL"?E.displayHeight+(d==="ft"?Math.round(y*3.28084):y):E.displayHeight,I=b.convertTemperature(E.temp,h==="C"?"°C":"°F"),B=I==="N/A"?"N/A":I.toFixed(0),H=b.convertWind(P,c,"km/h");let $;const M=r==="AMSL"?d==="ft"?Math.round(y*3.28084):y:0;if(Math.round(z)===M&&l.weatherData.wind_gusts_10m[i]!==void 0&&Number.isFinite(l.weatherData.wind_gusts_10m[i])){const F=l.weatherData.wind_gusts_10m[i],R=b.convertWind(F,c,"km/h"),G=c==="bft"?Math.round(H):H.toFixed(0),ie=c==="bft"?Math.round(R):R.toFixed(0);$=`${G} G ${ie}`}else $=H==="N/A"?"N/A":c==="bft"?Math.round(H):H.toFixed(0);const k=Math.round(b.convertWind(P,"kt","km/h")/5)*5,D=E.dir==="N/A"||isNaN(k)?"N/A":b.generateWindBarb(E.dir,k);return`<tr class="${x} ${O}">
                    <td>${Math.round(z)}</td>
                    <td>${b.roundToTens(E.dir)}</td>
                    <td>${$}</td>
                    <td>${D}</td>
                    <td>${B}</td>
                </tr>`}).join(""),w=`
        <table id="weatherTable">
            <thead>
                <tr>
                    <th>Height (${d} ${r})</th>
                    <th>Dir (deg)</th>
                    <th>Spd (${c})</th>
                    <th>Wind</th>
                    <th>T (${h==="C"?"°C":"°F"})</th>
                </tr>
            </thead>
            <tbody>
                ${v}
            </tbody>
        </table>`;document.getElementById("info").innerHTML=w,document.getElementById("selectedTime").innerHTML=`Selected Time: ${m}`}function on(){var Di;if(!l.currentMarker||typeof l.currentMarker.getLatLng!="function"){console.warn("Landing pattern update skipped: AppState.currentMarker is not a valid marker object yet.",l.currentMarker);return}const i=l.currentMarker.getLatLng();if(!i){console.error("Could not get LatLng from the current marker. Aborting landing pattern update.",l.currentMarker);return}if(!g.state.isLandingPatternUnlocked||!g.state.userSettings.showLandingPattern){pi(null);return}if(!l.weatherData||!l.lastLat){pi(null);return}const t=l.map.getZoom();if(t<wt.LANDING_PATTERN_MIN_ZOOM){console.log("Landing pattern not displayed - zoom too low:",t),pi(null);return}const a=parseInt(document.getElementById("timeSlider").value)||0,s=((Di=document.querySelector('input[name="landingDirection"]:checked'))==null?void 0:Di.value)||"LL",r=document.getElementById("customLandingDirectionLL"),d=document.getElementById("customLandingDirectionRR"),c=r?parseInt(r.value,10):null,h=d?parseInt(d.value,10):null,m=parseInt(document.getElementById("canopySpeed").value)||20,p=parseFloat(document.getElementById("descentRate").value)||3.5,y=parseInt(document.getElementById("legHeightFinal").value)||100,v=parseInt(document.getElementById("legHeightBase").value)||200,w=parseInt(document.getElementById("legHeightDownwind").value)||300,S=i.lat,E=i.lng,P=Math.round(l.lastAltitude),x=Sn(a);if(!x||x.length===0)return;const A=x.map(Ke=>Ke.height),O=x.map(Ke=>Number.isFinite(Ke.dir)?parseFloat(Ke.dir):0),z=x.map(Ke=>b.convertWind(parseFloat(Ke.spd)||0,"kt","km/h")),I=z.map((Ke,It)=>-Ke*Math.sin(O[It]*Math.PI/180)),B=z.map((Ke,It)=>-Ke*Math.cos(O[It]*Math.PI/180));let H;if(s==="LL"&&Number.isFinite(c)&&c>=0&&c<=359?H=c:s==="RR"&&Number.isFinite(h)&&h>=0&&h<=359?H=h:H=Number.isFinite(l.landingWindDir)?l.landingWindDir:O[0],!Number.isFinite(H)){console.warn("Invalid landing wind direction:",H);return}function $(Ke){const It=g.getValue("windUnit","radio","kt"),Mn=b.convertWind(Ke,It,"kt");return It==="bft"?Math.round(Mn):Mn.toFixed(1)}const M=(Ke,It,Mn,xa,Yn)=>{const Ni=xa*1.852/3.6*Yn/111e3,ct=Mn*Math.PI/180,oe=Ni*Math.cos(ct),Oi=Ni*Math.sin(ct)/Math.cos(Ke*Math.PI/180);return[Ke+oe,It+Oi]},k=[P,P+y];console.log("Final limits:",k);const D=b.calculateMeanWind(A,I,B,...k),F=D[0],R=D[1];if(!Number.isFinite(R)||!Number.isFinite(F)){console.warn("Invalid mean wind for final leg:",D);return}let G=null;R<=3?G="lightblue":R<=10?G="lightgreen":R<=16?G="#f5f34f":G="#ffcccc";const ie=H,be=b.calculateWindAngle(ie,F),{crosswind:te,headwind:ae}=b.calculateWindComponents(R,be),W=b.calculateWCA(te,m)*(te>=0?1:-1),ee=b.normalizeAngle(ie-W),Z=b.calculateCourseFromHeading(ee,F,R,m).groundSpeed,ne=y/p,V=Z*1.852/3.6*ne,le=(H+180)%360,Y=M(S,E,le,Z,ne);(S+Y[0])/2,(E+Y[1])/2;const j=[P+y,P+v],fe=b.calculateMeanWind(A,I,B,...j),X=fe[0],de=fe[1];if(!Number.isFinite(de)||!Number.isFinite(X)){console.warn("Invalid mean wind for base leg:",fe);return}let we=null;de<=3?we="lightblue":de<=10?we="lightgreen":de<=16?we="#f5f34f":we="#ffcccc",console.log("********* Landing Direction: ",s,"Effective Landing Wind Dir:",H);let re=0;s==="LL"?(re=(H+90)%360,console.log("Base Heading:",re)):s==="RR"&&(re=(H-90+360)%360,console.log("Base Heading:",re));const Le=b.calculateCourseFromHeading(re,X,de,m),Ee=Le.trueCourse,pe=Le.groundSpeed;let me=(Ee+180)%360;pe<0&&(me=(me+180)%360,console.log("Base ground speed is negative:",pe,"New course:",me));const ce=(v-y)/p,De=pe*1.852/3.6*ce;console.log("Base Course:",Ee);const ye=b.calculateWindAngle(Ee,X),{crosswind:Ce,headwind:Fe}=b.calculateWindComponents(de,ye),ht=b.calculateWCA(Ce,m)*(Ce>=0?1:-1),Ie=M(Y[0],Y[1],me,pe,ce);(Y[0]+Ie[0])/2,(Y[1]+Ie[1])/2;const At=[P+v,P+w],Re=b.calculateMeanWind(A,I,B,...At),Ve=Re[0],Pe=Re[1];if(!Number.isFinite(Pe)||!Number.isFinite(Ve)){console.warn("Invalid mean wind for downwind leg:",Re);return}let ze=null;Pe<=3?ze="lightblue":Pe<=10?ze="lightgreen":Pe<=16?ze="#f5f34f":ze="#ffcccc";const qe=H,rn=b.calculateWindAngle(qe,Ve),{crosswind:qt,headwind:bt}=b.calculateWindComponents(Pe,rn),it=b.calculateWCA(qt,m)*(qt>=0?1:-1),Ct=b.normalizeAngle((qe-it+180)%360),bn=b.calculateCourseFromHeading(Ct,Ve,Pe,m).groundSpeed,xi=(w-v)/p,cn=bn*1.852/3.6*xi,$t=M(Ie[0],Ie[1],qe,bn,xi),ka=[(S+Y[0])/2,(E+Y[1])/2],Ai=[(Y[0]+Ie[0])/2,(Y[1]+Ie[1])/2],Ci=[(Ie[0]+$t[0])/2,(Ie[1]+$t[1])/2];(Ie[0]+$t[0])/2,(Ie[1]+$t[1])/2,console.log(`Landing Pattern Updated:
        Final Leg: Wind: ${F.toFixed(1)}° @ ${R.toFixed(1)}kt, Course: ${ie.toFixed(1)}°, WCA: ${W.toFixed(1)}°, GS: ${Z.toFixed(1)}kt, HW: ${ae.toFixed(1)}kt, Length: ${V.toFixed(1)}m
        Base Leg: Wind: ${X.toFixed(1)}° @ ${de.toFixed(1)}kt, Course: ${Ee.toFixed(1)}°, WCA: ${ht.toFixed(1)}°, GS: ${pe.toFixed(1)}kt, HW: ${Fe.toFixed(1)}kt, Length: ${De.toFixed(1)}m
        Downwind Leg: Wind: ${Ve.toFixed(1)}° @ ${Pe.toFixed(1)}kt, Course: ${qe.toFixed(1)}°, WCA: ${it.toFixed(1)}°, GS: ${bn.toFixed(1)}kt, HW: ${bt.toFixed(1)}kt, Length: ${cn.toFixed(1)}m`);const Ii=l.weatherData.time[a];console.log("+++++++++ Koordinaten Pattern:",Ii),console.log("Coordinates DIP: ",S,E,"Altitude DIP:",P),console.log("Coordinates final end: ",Y[0],Y[1],"Leg Height:",P+y),console.log("Coordinates base end: ",Ie[0],Ie[1],"Leg Height:",P+v),console.log("Coordinates downwind end: ",$t[0],$t[1],"Leg Height:",P+w);const Pa={legs:[{path:[[S,E],Y],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}},{path:[Y,Ie],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}},{path:[Ie,$t],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}}],arrows:[{position:ka,bearing:(F-90+180)%360,color:G,tooltipText:`${Math.round(F)}° ${$(R)}${g.getValue("windUnit","radio","kt")}`},{position:Ai,bearing:(fe[0]-90+180)%360,color:we,tooltipText:`${Math.round(X)}° ${$(de)}${g.getValue("windUnit","radio","kt")}`},{position:Ci,bearing:(Re[0]-90+180)%360,color:ze,tooltipText:`${Math.round(Ve)}° ${$(Pe)}${g.getValue("windUnit","radio","kt")}`}]};pi(Pa)}function Je(){var r,d,c,h,m,p,y,v;if(console.log("updateJumpRunTrackDisplay called"),!l.map){console.warn("Map not initialized, cannot update jump run track display");return}if(!(g.state.userSettings.showJumpRunTrack&&l.weatherData&&l.lastLat&&l.lastLng&&g.state.isCalculateJumpUnlocked&&g.state.userSettings.calculateJump)){console.log("Conditions not met to show JRT, clearing display."),ua(null),l.lastTrackData=null;return}const t=zt(),a=Sn(t),s=ya(a);if(s&&((r=s.latlngs)==null?void 0:r.length)===2&&s.latlngs.every(w=>Number.isFinite(w[0])&&Number.isFinite(w[1]))){console.log("Drawing jump run track with data:",s);const w={path:{latlngs:s.latlngs,options:{color:"orange",weight:5,opacity:.8},tooltipText:`Jump Run Track: ${s.direction}°, Length: ${s.trackLength} m`,originalLatLngs:((c=(d=l.lastTrackData)==null?void 0:d.latlngs)==null?void 0:c.length)===2?l.lastTrackData.latlngs:s.latlngs},approachPath:((h=s.approachLatLngs)==null?void 0:h.length)===2&&s.approachLatLngs.every(S=>Number.isFinite(S[0])&&Number.isFinite(S[1]))?{latlngs:s.approachLatLngs,options:{color:"orange",weight:5,opacity:.8,dashArray:"5, 10"},tooltipText:`Approach Path: ${s.direction}°, Length: ${s.approachLength} m`,originalLatLngs:((p=(m=l.lastTrackData)==null?void 0:m.approachLatLngs)==null?void 0:p.length)===2?l.lastTrackData.approachLatLngs:s.approachLatLngs}:null,trackLength:s.trackLength,airplane:{position:L.latLng(s.latlngs[1][0],s.latlngs[1][1]),bearing:s.direction,originalPosition:(v=(y=l.lastTrackData)==null?void 0:y.latlngs)!=null&&v[1]&&Number.isFinite(l.lastTrackData.latlngs[1][0])?L.latLng(l.lastTrackData.latlngs[1][0],l.lastTrackData.latlngs[1][1]):L.latLng(s.latlngs[1][0],s.latlngs[1][1])}};ua(w),l.lastTrackData={latlngs:s.latlngs,approachLatLngs:s.approachLatLngs,direction:s.direction,trackLength:s.trackLength,approachLength:s.approachLength},console.log("Updated AppState.lastTrackData:",l.lastTrackData)}else console.warn("No valid track data to display:",s),ua(null),l.lastTrackData=null}let jt=!1;function Jl(){const i=document.getElementById("locationSearchInput"),t=document.getElementById("locationResults"),a=document.getElementById("saveCurrentLocationBtn");if(!i||!t||!a){console.error("Einige UI-Elemente für die Ortssuche wurden nicht gefunden.");return}const s=b.debounce(uf,300);i.addEventListener("input",()=>{s(i.value)}),i.addEventListener("focus",()=>{i.value.trim()||Rt(),t.style.display="block"}),i.addEventListener("blur",()=>{setTimeout(()=>{t.style.display="none"},200)}),a._clickHandler&&(a.removeEventListener("click",a._clickHandler),console.log("Entfernte bestehenden click-Listener für saveCurrentLocationBtn")),a._clickHandler=r=>{if(r.stopPropagation(),l.lastLat===null||l.lastLng===null){b.handleError("Please select a location on the map first.");return}if(jt){console.log("saveFavoriteBtn Klick blockiert: Ein Favorit wird bereits hinzugefügt.");return}const d=`DIP at ${l.lastLat.toFixed(4)}, ${l.lastLng.toFixed(4)}`,c=prompt("Enter a name for this favorite:",d);if(c){jt=!0;try{ql(l.lastLat,l.lastLng,c),Gs(l.lastLat,l.lastLng,c,!0)}finally{jt=!1,console.log("saveFavoriteBtn Aktion abgeschlossen, Sperre aufgehoben.")}}},a.addEventListener("click",a._clickHandler),console.log("Neuer click-Listener für saveCurrentLocationBtn hinzugefügt"),document.addEventListener("click",r=>{!i.contains(r.target)&&!t.contains(r.target)&&(t.style.display="none")})}async function uf(i){if(console.log("performSearch: Suche nach:",i),!i.trim()){console.log("performSearch: Leere Eingabe, zeige Favoriten/Verlauf."),Rt();return}let t=[];const a=df(i);if(a)console.log("performSearch: Koordinaten gefunden:",a),t.push({display_name:`Koordinate: ${a.lat.toFixed(5)}, ${a.lng.toFixed(5)}`,lat:a.lat,lon:a.lng,type:"coordinate"}),Rt(t);else{console.log("performSearch: Keine Koordinaten, starte Nominatim-Suche.");try{const s=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(i)}&format=json&limit=5&addressdetails=1`,r=await fetch(s,{method:"GET",headers:{"User-Agent":"Skydiving-Weather-App/1.0 (anonymous)"}});if(!r.ok)throw new Error(`Nominatim API Fehler: ${r.statusText}`);const d=await r.json();console.log("performSearch: Nominatim Ergebnisse:",d),t=d,Rt(t)}catch(s){console.error("Fehler bei der Geocoding-Suche:",s),b.handleError("Could not find location."),Rt([])}}}function df(i){console.log("parseQueryAsCoordinates: Eingabe:",i);const t=i.trim(),s=t.replace(/[,;\t]+/," ").trim().match(/^(-?\d{1,3}(?:\.\d+)?)\s+(-?\d{1,3}(?:\.\d+)?)$/);if(s){const c=parseFloat(s[1]),h=parseFloat(s[3]);if(console.log("parseQueryAsCoordinates: Dezimalgraden erkannt:",{lat:c,lng:h}),c>=-90&&c<=90&&h>=-180&&h<=180)return{lat:c,lng:h};console.warn("parseQueryAsCoordinates: Ungültige Koordinatenbereiche:",{lat:c,lng:h})}const r=t.replace(/\s/g,"").toUpperCase(),d=/^[0-9]{1,2}[C-HJ-NP-X][A-HJ-NP-Z]{2}(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})$/;if(typeof Ih>"u")return console.warn("parseQueryAsCoordinates: MGRS-Bibliothek nicht geladen."),null;if(d.test(r))try{const[c,h]=Hs(r);if(console.log("parseQueryAsCoordinates: MGRS erkannt:",{lat:h,lng:c}),!isNaN(h)&&!isNaN(c))return{lat:h,lng:c};console.warn("parseQueryAsCoordinates: Ungültige MGRS-Koordinaten:",{lat:h,lng:c})}catch(c){return console.warn("parseQueryAsCoordinates: MGRS-Parsing fehlgeschlagen:",c.message),null}return console.log("parseQueryAsCoordinates: Keine Koordinaten erkannt."),null}function Rt(i=[]){const t=document.getElementById("locationResults");if(!t){console.error("resultsList nicht gefunden.");return}t.innerHTML="";const a=Pi(),s=a.filter(c=>c.isFavorite),r=a.filter(c=>!c.isFavorite);console.log("renderResultsList: Favoriten:",s),console.log("renderResultsList: Verlauf (nicht Favoriten):",r),console.log("renderResultsList: Suchergebnisse:",i);const d=c=>{const h=document.createElement("li"),m=parseFloat(c.lat),p=parseFloat(c.lng||c.lon);if(isNaN(m)||isNaN(p))return console.error("Ungültige Koordinaten in createListItem:",c),null;console.log("createListItem: Verarbeite Eintrag:",{lat:m,lng:p,label:c.display_name||c.label}),h.dataset.lat=m,h.dataset.lon=p;const y=document.createElement("span");y.className="location-name",y.textContent=c.display_name||c.label,h.appendChild(y),y.addEventListener("mousedown",E=>{const P=new CustomEvent("location:selected",{detail:{lat:m,lng:p},bubbles:!0,cancelable:!0});h.dispatchEvent(P),Gs(m,p,c.display_name||c.label,c.isFavorite||!1),t.style.display="none"});const v=document.createElement("div");v.className="location-item-buttons";const w=document.createElement("button");w.className="favorite-toggle",w.innerHTML=c.isFavorite?"★":"☆",c.isFavorite&&w.classList.add("is-favorite"),w.title="Als Favorit markieren/entfernen",v.appendChild(w),w.addEventListener("click",E=>{E.stopPropagation(),console.log("favToggle Klick für:",{lat:m,lng:p,label:c.display_name||c.label}),hf(m,p,c.display_name||c.label)});const S=document.createElement("button");return S.className="delete-location-btn",S.textContent="×",S.title="Diesen Eintrag löschen",v.appendChild(S),S.addEventListener("click",E=>{E.stopPropagation(),confirm(`Möchten Sie "${c.display_name||c.label}" wirklich löschen?`)&&ff(m,p)}),h.appendChild(v),h};if(i.length>0){const c=document.createElement("li");c.className="results-heading",c.textContent="Results",c.style.fontWeight="bold",c.style.background="#f0f0f0",t.appendChild(c),i.forEach(h=>{const m=parseFloat(h.lat),p=parseFloat(h.lon),y=s.find(S=>Math.abs(S.lat-m)<.001&&Math.abs(S.lng-p)<.001);h.isFavorite=!!y,y&&(h.display_name=y.label);const v={lat:m,lng:p,display_name:h.display_name,isFavorite:h.isFavorite},w=d(v);w&&t.appendChild(w)})}if(s.length>0){const c=document.createElement("li");c.className="results-heading",c.textContent="Favorites",c.style.fontWeight="bold",c.style.background="#f0f0f0",t.appendChild(c),s.forEach(h=>{const m=d(h);m&&t.appendChild(m)})}if(r.length>0){const c=document.createElement("li");c.className="results-heading",c.textContent="Previous Locations",c.style.fontWeight="bold",c.style.background="#f0f0f0",t.appendChild(c),r.forEach(h=>{const m=d(h);m&&t.appendChild(m)})}console.log("renderResultsList: Liste gerendert.")}function Pi(){try{return JSON.parse(localStorage.getItem("coordHistory"))||[]}catch{return[]}}function Li(i){try{localStorage.setItem("coordHistory",JSON.stringify(i))}catch(t){console.error("Error saving history:",t)}}function Gs(i,t,a,s=!1){if(isNaN(i)||isNaN(t))return;let r=Pi();const d=parseFloat(i.toFixed(5)),c=parseFloat(t.toFixed(5));r=r.filter(p=>Math.abs(p.lat-d)>1e-4||Math.abs(p.lng-c)>1e-4),r.unshift({lat:d,lng:c,label:a,isFavorite:s,timestamp:Date.now()});const h=r.filter(p=>p.isFavorite),m=r.filter(p=>!p.isFavorite).slice(0,5);Li([...h,...m]),Rt()}function ql(i,t,a,s=!1){if(isNaN(i)||isNaN(t)){console.error("Ungültige Koordinaten in addOrUpdateFavorite:",{lat:i,lng:t});return}if(jt){console.log("addOrUpdateFavorite blockiert.");return}jt=!0;try{let r=Pi();const d=parseFloat(i.toFixed(5)),c=parseFloat(t.toFixed(5));console.log("addOrUpdateFavorite: Verarbeite:",{newLat:d,newLng:c,name:a});const h=r.find(m=>Math.abs(m.lat-d)<1e-4&&Math.abs(m.lng-c)<1e-4);if(h)console.log("addOrUpdateFavorite: Aktualisiere bestehenden Eintrag:",h),h.isFavorite=!0,h.label=a;else{const m={lat:d,lng:c,label:a,isFavorite:!0,timestamp:Date.now()};console.log("addOrUpdateFavorite: Füge neuen Eintrag hinzu:",m),r.unshift(m)}Li(r),console.log("addOrUpdateFavorite: Verlauf nach Speicherung:",JSON.stringify(r)),s||b.handleMessage(`"${a}" als Favorit gespeichert.`),Rt()}catch(r){console.error("Fehler in addOrUpdateFavorite:",r)}finally{jt=!1,console.log("addOrUpdateFavorite abgeschlossen.")}}function hf(i,t,a){if(isNaN(i)||isNaN(t)){console.error("Ungültige Koordinaten in toggleFavorite:",{lat:i,lng:t});return}if(jt){console.log("toggleFavorite blockiert: Ein Favorit wird bereits hinzugefügt.");return}let s=Pi();const r=parseFloat(i.toFixed(5)),d=parseFloat(t.toFixed(5));console.log("toggleFavorite: Suche nach Eintrag mit:",{newLat:r,newLng:d,label:a});const c=s.find(h=>{const m=parseFloat(h.lat),p=parseFloat(h.lng);return Math.abs(m-r)<1e-4&&Math.abs(p-d)<1e-4});if(c)if(console.log("toggleFavorite: Bestehender Eintrag gefunden:",c),c.isFavorite)c.isFavorite=!1,b.handleMessage(`"${c.label}" ist kein Favorit mehr.`),Li(s),Rt();else{jt=!0;try{const h=prompt("Please enter a name for this favorite:",c.label||a);if(h)c.isFavorite=!0,c.label=h,b.handleMessage(`"${h}" als Favorit gespeichert.`),Li(s),Rt();else{c.isFavorite=!1;return}}finally{jt=!1,console.log("toggleFavorite abgeschlossen, Sperre aufgehoben.")}}else{console.log("toggleFavorite: Kein bestehender Eintrag, füge neuen Favoriten hinzu.");const h=prompt("Please enter a name for this favorite:",a);h&&ql(r,d,h)}}function ff(i,t){if(isNaN(i)||isNaN(t))return;const s=Pi().filter(r=>{const d=parseFloat(r.lat),c=parseFloat(r.lng||r.lon);return Math.abs(d-i)>1e-4||Math.abs(c-t)>1e-4});Li(s),b.handleMessage("Location deleted."),Rt()}var da={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var mf=da.exports,xr;function pf(){return xr||(xr=1,function(i,t){((a,s)=>{i.exports=s()})(mf,function a(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},r,d=!s.document&&!!s.postMessage,c=s.IS_PAPA_WORKER||!1,h={},m=0,p={};function y(M){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(k){var D=B(k);D.chunkSize=parseInt(D.chunkSize),k.step||k.chunk||(D.chunkSize=null),this._handle=new P(D),(this._handle.streamer=this)._config=D}).call(this,M),this.parseChunk=function(k,D){var F=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<F){let G=this._config.newline;G||(R=this._config.quoteChar||'"',G=this._handle.guessLineEndings(k,R)),k=[...k.split(G).slice(F)].join(G)}this.isFirstChunk&&$(this._config.beforeFirstChunk)&&(R=this._config.beforeFirstChunk(k))!==void 0&&(k=R),this.isFirstChunk=!1,this._halted=!1;var F=this._partialLine+k,R=(this._partialLine="",this._handle.parse(F,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(k=R.meta.cursor,F=(this._finished||(this._partialLine=F.substring(k-this._baseIndex),this._baseIndex=k),R&&R.data&&(this._rowCount+=R.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),c)s.postMessage({results:R,workerId:p.WORKER_ID,finished:F});else if($(this._config.chunk)&&!D){if(this._config.chunk(R,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=R=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(R.data),this._completeResults.errors=this._completeResults.errors.concat(R.errors),this._completeResults.meta=R.meta),this._completed||!F||!$(this._config.complete)||R&&R.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),F||R&&R.meta.paused||this._nextChunk(),R}this._halted=!0},this._sendError=function(k){$(this._config.error)?this._config.error(k):c&&this._config.error&&s.postMessage({workerId:p.WORKER_ID,error:k,finished:!1})}}function v(M){var k;(M=M||{}).chunkSize||(M.chunkSize=p.RemoteChunkSize),y.call(this,M),this._nextChunk=d?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(D){this._input=D,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(k=new XMLHttpRequest,this._config.withCredentials&&(k.withCredentials=this._config.withCredentials),d||(k.onload=H(this._chunkLoaded,this),k.onerror=H(this._chunkError,this)),k.open(this._config.downloadRequestBody?"POST":"GET",this._input,!d),this._config.downloadRequestHeaders){var D,F=this._config.downloadRequestHeaders;for(D in F)k.setRequestHeader(D,F[D])}var R;this._config.chunkSize&&(R=this._start+this._config.chunkSize-1,k.setRequestHeader("Range","bytes="+this._start+"-"+R));try{k.send(this._config.downloadRequestBody)}catch(G){this._chunkError(G.message)}d&&k.status===0&&this._chunkError()}},this._chunkLoaded=function(){k.readyState===4&&(k.status<200||400<=k.status?this._chunkError():(this._start+=this._config.chunkSize||k.responseText.length,this._finished=!this._config.chunkSize||this._start>=(D=>(D=D.getResponseHeader("Content-Range"))!==null?parseInt(D.substring(D.lastIndexOf("/")+1)):-1)(k),this.parseChunk(k.responseText)))},this._chunkError=function(D){D=k.statusText||D,this._sendError(new Error(D))}}function w(M){(M=M||{}).chunkSize||(M.chunkSize=p.LocalChunkSize),y.call(this,M);var k,D,F=typeof FileReader<"u";this.stream=function(R){this._input=R,D=R.slice||R.webkitSlice||R.mozSlice,F?((k=new FileReader).onload=H(this._chunkLoaded,this),k.onerror=H(this._chunkError,this)):k=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var R=this._input,G=(this._config.chunkSize&&(G=Math.min(this._start+this._config.chunkSize,this._input.size),R=D.call(R,this._start,G)),k.readAsText(R,this._config.encoding));F||this._chunkLoaded({target:{result:G}})},this._chunkLoaded=function(R){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(R.target.result)},this._chunkError=function(){this._sendError(k.error)}}function S(M){var k;y.call(this,M=M||{}),this.stream=function(D){return k=D,this._nextChunk()},this._nextChunk=function(){var D,F;if(!this._finished)return D=this._config.chunkSize,k=D?(F=k.substring(0,D),k.substring(D)):(F=k,""),this._finished=!k,this.parseChunk(F)}}function E(M){y.call(this,M=M||{});var k=[],D=!0,F=!1;this.pause=function(){y.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){y.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(R){this._input=R,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){F&&k.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),k.length?this.parseChunk(k.shift()):D=!0},this._streamData=H(function(R){try{k.push(typeof R=="string"?R:R.toString(this._config.encoding)),D&&(D=!1,this._checkIsFinished(),this.parseChunk(k.shift()))}catch(G){this._streamError(G)}},this),this._streamError=H(function(R){this._streamCleanUp(),this._sendError(R)},this),this._streamEnd=H(function(){this._streamCleanUp(),F=!0,this._streamData("")},this),this._streamCleanUp=H(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function P(M){var k,D,F,R,G=Math.pow(2,53),ie=-G,be=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,te=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,ae=this,W=0,ee=0,J=!1,Z=!1,ne=[],V={data:[],errors:[],meta:{}};function le(X){return M.skipEmptyLines==="greedy"?X.join("").trim()==="":X.length===1&&X[0].length===0}function Y(){if(V&&F&&(fe("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+p.DefaultDelimiter+"'"),F=!1),M.skipEmptyLines&&(V.data=V.data.filter(function(Le){return!le(Le)})),j()){let Le=function(Ee,pe){$(M.transformHeader)&&(Ee=M.transformHeader(Ee,pe)),ne.push(Ee)};var re=Le;if(V)if(Array.isArray(V.data[0])){for(var X=0;j()&&X<V.data.length;X++)V.data[X].forEach(Le);V.data.splice(0,1)}else V.data.forEach(Le)}function de(Le,Ee){for(var pe=M.header?{}:[],me=0;me<Le.length;me++){var ce=me,De=Le[me],De=((ye,Ce)=>(Fe=>(M.dynamicTypingFunction&&M.dynamicTyping[Fe]===void 0&&(M.dynamicTyping[Fe]=M.dynamicTypingFunction(Fe)),(M.dynamicTyping[Fe]||M.dynamicTyping)===!0))(ye)?Ce==="true"||Ce==="TRUE"||Ce!=="false"&&Ce!=="FALSE"&&((Fe=>{if(be.test(Fe)&&(Fe=parseFloat(Fe),ie<Fe&&Fe<G))return 1})(Ce)?parseFloat(Ce):te.test(Ce)?new Date(Ce):Ce===""?null:Ce):Ce)(ce=M.header?me>=ne.length?"__parsed_extra":ne[me]:ce,De=M.transform?M.transform(De,ce):De);ce==="__parsed_extra"?(pe[ce]=pe[ce]||[],pe[ce].push(De)):pe[ce]=De}return M.header&&(me>ne.length?fe("FieldMismatch","TooManyFields","Too many fields: expected "+ne.length+" fields but parsed "+me,ee+Ee):me<ne.length&&fe("FieldMismatch","TooFewFields","Too few fields: expected "+ne.length+" fields but parsed "+me,ee+Ee)),pe}var we;V&&(M.header||M.dynamicTyping||M.transform)&&(we=1,!V.data.length||Array.isArray(V.data[0])?(V.data=V.data.map(de),we=V.data.length):V.data=de(V.data,0),M.header&&V.meta&&(V.meta.fields=ne),ee+=we)}function j(){return M.header&&ne.length===0}function fe(X,de,we,re){X={type:X,code:de,message:we},re!==void 0&&(X.row=re),V.errors.push(X)}$(M.step)&&(R=M.step,M.step=function(X){V=X,j()?Y():(Y(),V.data.length!==0&&(W+=X.data.length,M.preview&&W>M.preview?D.abort():(V.data=V.data[0],R(V,ae))))}),this.parse=function(X,de,we){var re=M.quoteChar||'"',re=(M.newline||(M.newline=this.guessLineEndings(X,re)),F=!1,M.delimiter?$(M.delimiter)&&(M.delimiter=M.delimiter(X),V.meta.delimiter=M.delimiter):((re=((Le,Ee,pe,me,ce)=>{var De,ye,Ce,Fe;ce=ce||[",","	","|",";",p.RECORD_SEP,p.UNIT_SEP];for(var ht=0;ht<ce.length;ht++){for(var Ie,At=ce[ht],Re=0,Ve=0,Pe=0,ze=(Ce=void 0,new A({comments:me,delimiter:At,newline:Ee,preview:10}).parse(Le)),qe=0;qe<ze.data.length;qe++)pe&&le(ze.data[qe])?Pe++:(Ie=ze.data[qe].length,Ve+=Ie,Ce===void 0?Ce=Ie:0<Ie&&(Re+=Math.abs(Ie-Ce),Ce=Ie));0<ze.data.length&&(Ve/=ze.data.length-Pe),(ye===void 0||Re<=ye)&&(Fe===void 0||Fe<Ve)&&1.99<Ve&&(ye=Re,De=At,Fe=Ve)}return{successful:!!(M.delimiter=De),bestDelimiter:De}})(X,M.newline,M.skipEmptyLines,M.comments,M.delimitersToGuess)).successful?M.delimiter=re.bestDelimiter:(F=!0,M.delimiter=p.DefaultDelimiter),V.meta.delimiter=M.delimiter),B(M));return M.preview&&M.header&&re.preview++,k=X,D=new A(re),V=D.parse(k,de,we),Y(),J?{meta:{paused:!0}}:V||{meta:{paused:!1}}},this.paused=function(){return J},this.pause=function(){J=!0,D.abort(),k=$(M.chunk)?"":k.substring(D.getCharIndex())},this.resume=function(){ae.streamer._halted?(J=!1,ae.streamer.parseChunk(k,!0)):setTimeout(ae.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,D.abort(),V.meta.aborted=!0,$(M.complete)&&M.complete(V),k=""},this.guessLineEndings=function(Le,re){Le=Le.substring(0,1048576);var re=new RegExp(x(re)+"([^]*?)"+x(re),"gm"),we=(Le=Le.replace(re,"")).split("\r"),re=Le.split(`
`),Le=1<re.length&&re[0].length<we[0].length;if(we.length===1||Le)return`
`;for(var Ee=0,pe=0;pe<we.length;pe++)we[pe][0]===`
`&&Ee++;return Ee>=we.length/2?`\r
`:"\r"}}function x(M){return M.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function A(M){var k=(M=M||{}).delimiter,D=M.newline,F=M.comments,R=M.step,G=M.preview,ie=M.fastMode,be=null,te=!1,ae=M.quoteChar==null?'"':M.quoteChar,W=ae;if(M.escapeChar!==void 0&&(W=M.escapeChar),(typeof k!="string"||-1<p.BAD_DELIMITERS.indexOf(k))&&(k=","),F===k)throw new Error("Comment character same as delimiter");F===!0?F="#":(typeof F!="string"||-1<p.BAD_DELIMITERS.indexOf(F))&&(F=!1),D!==`
`&&D!=="\r"&&D!==`\r
`&&(D=`
`);var ee=0,J=!1;this.parse=function(Z,ne,V){if(typeof Z!="string")throw new Error("Input must be a string");var le=Z.length,Y=k.length,j=D.length,fe=F.length,X=$(R),de=[],we=[],re=[],Le=ee=0;if(!Z)return Re();if(ie||ie!==!1&&Z.indexOf(ae)===-1){for(var Ee=Z.split(D),pe=0;pe<Ee.length;pe++){if(re=Ee[pe],ee+=re.length,pe!==Ee.length-1)ee+=D.length;else if(V)return Re();if(!F||re.substring(0,fe)!==F){if(X){if(de=[],Fe(re.split(k)),Ve(),J)return Re()}else Fe(re.split(k));if(G&&G<=pe)return de=de.slice(0,G),Re(!0)}}return Re()}for(var me=Z.indexOf(k,ee),ce=Z.indexOf(D,ee),De=new RegExp(x(W)+x(ae),"g"),ye=Z.indexOf(ae,ee);;)if(Z[ee]===ae)for(ye=ee,ee++;;){if((ye=Z.indexOf(ae,ye+1))===-1)return V||we.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:de.length,index:ee}),Ie();if(ye===le-1)return Ie(Z.substring(ee,ye).replace(De,ae));if(ae===W&&Z[ye+1]===W)ye++;else if(ae===W||ye===0||Z[ye-1]!==W){me!==-1&&me<ye+1&&(me=Z.indexOf(k,ye+1));var Ce=ht((ce=ce!==-1&&ce<ye+1?Z.indexOf(D,ye+1):ce)===-1?me:Math.min(me,ce));if(Z.substr(ye+1+Ce,Y)===k){re.push(Z.substring(ee,ye).replace(De,ae)),Z[ee=ye+1+Ce+Y]!==ae&&(ye=Z.indexOf(ae,ee)),me=Z.indexOf(k,ee),ce=Z.indexOf(D,ee);break}if(Ce=ht(ce),Z.substring(ye+1+Ce,ye+1+Ce+j)===D){if(re.push(Z.substring(ee,ye).replace(De,ae)),At(ye+1+Ce+j),me=Z.indexOf(k,ee),ye=Z.indexOf(ae,ee),X&&(Ve(),J))return Re();if(G&&de.length>=G)return Re(!0);break}we.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:de.length,index:ee}),ye++}}else if(F&&re.length===0&&Z.substring(ee,ee+fe)===F){if(ce===-1)return Re();ee=ce+j,ce=Z.indexOf(D,ee),me=Z.indexOf(k,ee)}else if(me!==-1&&(me<ce||ce===-1))re.push(Z.substring(ee,me)),ee=me+Y,me=Z.indexOf(k,ee);else{if(ce===-1)break;if(re.push(Z.substring(ee,ce)),At(ce+j),X&&(Ve(),J))return Re();if(G&&de.length>=G)return Re(!0)}return Ie();function Fe(Pe){de.push(Pe),Le=ee}function ht(Pe){var ze=0;return ze=Pe!==-1&&(Pe=Z.substring(ye+1,Pe))&&Pe.trim()===""?Pe.length:ze}function Ie(Pe){return V||(Pe===void 0&&(Pe=Z.substring(ee)),re.push(Pe),ee=le,Fe(re),X&&Ve()),Re()}function At(Pe){ee=Pe,Fe(re),re=[],ce=Z.indexOf(D,ee)}function Re(Pe){if(M.header&&!ne&&de.length&&!te){var ze=de[0],qe=Object.create(null),rn=new Set(ze);let qt=!1;for(let bt=0;bt<ze.length;bt++){let it=ze[bt];if(qe[it=$(M.transformHeader)?M.transformHeader(it,bt):it]){let Ct,ln=qe[it];for(;Ct=it+"_"+ln,ln++,rn.has(Ct););rn.add(Ct),ze[bt]=Ct,qe[it]++,qt=!0,(be=be===null?{}:be)[Ct]=it}else qe[it]=1,ze[bt]=it;rn.add(it)}qt&&console.warn("Duplicate headers found and renamed."),te=!0}return{data:de,errors:we,meta:{delimiter:k,linebreak:D,aborted:J,truncated:!!Pe,cursor:Le+(ne||0),renamedHeaders:be}}}function Ve(){R(Re()),de=[],we=[]}},this.abort=function(){J=!0},this.getCharIndex=function(){return ee}}function O(M){var k=M.data,D=h[k.workerId],F=!1;if(k.error)D.userError(k.error,k.file);else if(k.results&&k.results.data){var R={abort:function(){F=!0,z(k.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if($(D.userStep)){for(var G=0;G<k.results.data.length&&(D.userStep({data:k.results.data[G],errors:k.results.errors,meta:k.results.meta},R),!F);G++);delete k.results}else $(D.userChunk)&&(D.userChunk(k.results,R,k.file),delete k.results)}k.finished&&!F&&z(k.workerId,k.results)}function z(M,k){var D=h[M];$(D.userComplete)&&D.userComplete(k),D.terminate(),delete h[M]}function I(){throw new Error("Not implemented.")}function B(M){if(typeof M!="object"||M===null)return M;var k,D=Array.isArray(M)?[]:{};for(k in M)D[k]=B(M[k]);return D}function H(M,k){return function(){M.apply(k,arguments)}}function $(M){return typeof M=="function"}return p.parse=function(M,k){var D=(k=k||{}).dynamicTyping||!1;if($(D)&&(k.dynamicTypingFunction=D,D={}),k.dynamicTyping=D,k.transform=!!$(k.transform)&&k.transform,!k.worker||!p.WORKERS_SUPPORTED)return D=null,p.NODE_STREAM_INPUT,typeof M=="string"?(M=(F=>F.charCodeAt(0)!==65279?F:F.slice(1))(M),D=new(k.download?v:S)(k)):M.readable===!0&&$(M.read)&&$(M.on)?D=new E(k):(s.File&&M instanceof File||M instanceof Object)&&(D=new w(k)),D.stream(M);(D=(()=>{var F;return!!p.WORKERS_SUPPORTED&&(F=(()=>{var R=s.URL||s.webkitURL||null,G=a.toString();return p.BLOB_URL||(p.BLOB_URL=R.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",G,")();"],{type:"text/javascript"})))})(),(F=new s.Worker(F)).onmessage=O,F.id=m++,h[F.id]=F)})()).userStep=k.step,D.userChunk=k.chunk,D.userComplete=k.complete,D.userError=k.error,k.step=$(k.step),k.chunk=$(k.chunk),k.complete=$(k.complete),k.error=$(k.error),delete k.worker,D.postMessage({input:M,config:k,workerId:D.id})},p.unparse=function(M,k){var D=!1,F=!0,R=",",G=`\r
`,ie='"',be=ie+ie,te=!1,ae=null,W=!1,ee=((()=>{if(typeof k=="object"){if(typeof k.delimiter!="string"||p.BAD_DELIMITERS.filter(function(ne){return k.delimiter.indexOf(ne)!==-1}).length||(R=k.delimiter),typeof k.quotes!="boolean"&&typeof k.quotes!="function"&&!Array.isArray(k.quotes)||(D=k.quotes),typeof k.skipEmptyLines!="boolean"&&typeof k.skipEmptyLines!="string"||(te=k.skipEmptyLines),typeof k.newline=="string"&&(G=k.newline),typeof k.quoteChar=="string"&&(ie=k.quoteChar),typeof k.header=="boolean"&&(F=k.header),Array.isArray(k.columns)){if(k.columns.length===0)throw new Error("Option columns is empty");ae=k.columns}k.escapeChar!==void 0&&(be=k.escapeChar+ie),k.escapeFormulae instanceof RegExp?W=k.escapeFormulae:typeof k.escapeFormulae=="boolean"&&k.escapeFormulae&&(W=/^[=+\-@\t\r].*$/)}})(),new RegExp(x(ie),"g"));if(typeof M=="string"&&(M=JSON.parse(M)),Array.isArray(M)){if(!M.length||Array.isArray(M[0]))return J(null,M,te);if(typeof M[0]=="object")return J(ae||Object.keys(M[0]),M,te)}else if(typeof M=="object")return typeof M.data=="string"&&(M.data=JSON.parse(M.data)),Array.isArray(M.data)&&(M.fields||(M.fields=M.meta&&M.meta.fields||ae),M.fields||(M.fields=Array.isArray(M.data[0])?M.fields:typeof M.data[0]=="object"?Object.keys(M.data[0]):[]),Array.isArray(M.data[0])||typeof M.data[0]=="object"||(M.data=[M.data])),J(M.fields||[],M.data||[],te);throw new Error("Unable to serialize unrecognized input");function J(ne,V,le){var Y="",j=(typeof ne=="string"&&(ne=JSON.parse(ne)),typeof V=="string"&&(V=JSON.parse(V)),Array.isArray(ne)&&0<ne.length),fe=!Array.isArray(V[0]);if(j&&F){for(var X=0;X<ne.length;X++)0<X&&(Y+=R),Y+=Z(ne[X],X);0<V.length&&(Y+=G)}for(var de=0;de<V.length;de++){var we=(j?ne:V[de]).length,re=!1,Le=j?Object.keys(V[de]).length===0:V[de].length===0;if(le&&!j&&(re=le==="greedy"?V[de].join("").trim()==="":V[de].length===1&&V[de][0].length===0),le==="greedy"&&j){for(var Ee=[],pe=0;pe<we;pe++){var me=fe?ne[pe]:pe;Ee.push(V[de][me])}re=Ee.join("").trim()===""}if(!re){for(var ce=0;ce<we;ce++){0<ce&&!Le&&(Y+=R);var De=j&&fe?ne[ce]:ce;Y+=Z(V[de][De],ce)}de<V.length-1&&(!le||0<we&&!Le)&&(Y+=G)}}return Y}function Z(ne,V){var le,Y;return ne==null?"":ne.constructor===Date?JSON.stringify(ne).slice(1,25):(Y=!1,W&&typeof ne=="string"&&W.test(ne)&&(ne="'"+ne,Y=!0),le=ne.toString().replace(ee,be),(Y=Y||D===!0||typeof D=="function"&&D(ne,V)||Array.isArray(D)&&D[V]||((j,fe)=>{for(var X=0;X<fe.length;X++)if(-1<j.indexOf(fe[X]))return!0;return!1})(le,p.BAD_DELIMITERS)||-1<le.indexOf(R)||le.charAt(0)===" "||le.charAt(le.length-1)===" ")?ie+le+ie:le)}},p.RECORD_SEP="",p.UNIT_SEP="",p.BYTE_ORDER_MARK="\uFEFF",p.BAD_DELIMITERS=["\r",`
`,'"',p.BYTE_ORDER_MARK],p.WORKERS_SUPPORTED=!d&&!!s.Worker,p.NODE_STREAM_INPUT=1,p.LocalChunkSize=10485760,p.RemoteChunkSize=5242880,p.DefaultDelimiter=",",p.Parser=A,p.ParserHandle=P,p.NetworkStreamer=v,p.FileStreamer=w,p.StringStreamer=S,p.ReadableStreamStreamer=E,s.jQuery&&((r=s.jQuery).fn.parse=function(M){var k=M.config||{},D=[];return this.each(function(G){if(!(r(this).prop("tagName").toUpperCase()==="INPUT"&&r(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var ie=0;ie<this.files.length;ie++)D.push({file:this.files[ie],inputElem:this,instanceConfig:r.extend({},k)})}),F(),this;function F(){if(D.length===0)$(M.complete)&&M.complete();else{var G,ie,be,te,ae=D[0];if($(M.before)){var W=M.before(ae.file,ae.inputElem);if(typeof W=="object"){if(W.action==="abort")return G="AbortError",ie=ae.file,be=ae.inputElem,te=W.reason,void($(M.error)&&M.error({name:G},ie,be,te));if(W.action==="skip")return void R();typeof W.config=="object"&&(ae.instanceConfig=r.extend(ae.instanceConfig,W.config))}else if(W==="skip")return void R()}var ee=ae.instanceConfig.complete;ae.instanceConfig.complete=function(J){$(ee)&&ee(J,ae.file,ae.inputElem),R()},p.parse(ae.file,ae.instanceConfig)}}function R(){D.splice(0,1),F()}}),c&&(s.onmessage=function(M){M=M.data,p.WORKER_ID===void 0&&M&&(p.WORKER_ID=M.workerId),typeof M.input=="string"?s.postMessage({workerId:p.WORKER_ID,results:p.parse(M.input,M.config),finished:!0}):(s.File&&M.input instanceof File||M.input instanceof Object)&&(M=p.parse(M.input,M.config))&&s.postMessage({workerId:p.WORKER_ID,results:M,finished:!0})}),(v.prototype=Object.create(y.prototype)).constructor=v,(w.prototype=Object.create(y.prototype)).constructor=w,(S.prototype=Object.create(S.prototype)).constructor=S,(E.prototype=Object.create(y.prototype)).constructor=E,p})}(da)),da.exports}var gf=pf();function _f(i,t,a,s){if(!l.map)return console.warn("Map not initialized for getTooltipContent"),"Map not initialized";const r=g.getValue("coordFormat","radio","Decimal"),d=g.getValue("windUnit","radio","kt"),c=g.getValue("heightUnit","radio","m"),h=b.convertCoords(i.lat,i.lng,r);let m=r==="MGRS"?`MGRS: ${h.lat}`:`Lat: ${h.lat}<br>Lng: ${h.lng}`;const p=i.ele;let y=p!==null&&s!==null?p-s:null;if(y!==null){const S=c||g.state.userSettings.heightUnit||"m";y=b.convertHeight(y,S),y=Math.round(y),m+=`<br>Altitude: ${y} ${S} AGL`}else m+="<br>Altitude: N/A";let v="N/A",w="N/A";if(t>0&&i.time&&a[t-1].time&&i.ele!==null&&a[t-1].ele!==null){const S=(i.time.toMillis()-a[t-1].time.toMillis())/1e3;if(S>0){const P=l.map.distance([a[t-1].lat,a[t-1].lng],[i.lat,i.lng])/S;v=b.convertWind(P,d,"m/s"),v=d==="bft"?Math.round(v):v.toFixed(1),w=((i.ele-a[t-1].ele)/S).toFixed(1)}}return m+=`<br>Speed: ${v} ${d}`,m+=`<br>Descent Rate: ${w} m/s`,m}async function yf(i){if(!l.map)return b.handleError("Map not initialized."),null;l.isLoadingGpx=!0;const t=new FileReader;return new Promise((a,s)=>{t.onload=async function(r){var d,c;try{const h=r.target.result,y=new DOMParser().parseFromString(h,"text/xml").getElementsByTagName("trkpt"),v=[];for(let S=0;S<y.length;S++){const E=parseFloat(y[S].getAttribute("lat")),P=parseFloat(y[S].getAttribute("lon"));if(isNaN(E)||isNaN(P))continue;const x=(d=y[S].getElementsByTagName("ele")[0])==null?void 0:d.textContent,A=(c=y[S].getElementsByTagName("time")[0])==null?void 0:c.textContent;v.push({lat:E,lng:P,ele:x?parseFloat(x):null,time:A?se.fromISO(A,{zone:"utc"}):null})}if(v.length<2)throw new Error("GPX track has insufficient points.");const w=await Kl(v,i.name);a(w)}catch(h){console.error("[trackManager] Error in loadGpxTrack:",h),b.handleError("Error parsing GPX file: "+h.message),a(null)}finally{l.isLoadingGpx=!1}},t.onerror=()=>{b.handleError("Error reading GPX file."),l.isLoadingGpx=!1,s(new Error("Error reading GPX file."))},t.readAsText(i)})}async function vf(i){if(!l.map)return b.handleError("Map not initialized."),null;l.isLoadingGpx=!0;const t=new FileReader;return new Promise((a,s)=>{t.onload=async function(r){try{const d=r.target.result,c=[];gf.parse(d,{skipEmptyLines:!0,step:function(h){const m=h.data;if(m[0]&&m[0].toUpperCase()==="$GNSS"&&m.length>=5){let p=m[1];const y=parseFloat(m[2]),v=parseFloat(m[3]),w=parseFloat(m[4]);if(isNaN(y)||isNaN(v)||isNaN(w))return;let S=null;try{S=se.fromISO(p,{setZone:!0}).toUTC(),S.isValid||(S=null)}catch{S=null}c.push({lat:y,lng:v,ele:w,time:S})}},complete:async function(){if(c.length<2)throw new Error("CSV track has insufficient points.");const h=await Kl(c,i.name);a(h)},error:function(h){throw new Error("Error parsing CSV: "+h.message)}})}catch(d){console.error("[trackManager] Error in loadCsvTrackUTC:",d),b.handleError("Error parsing CSV file: "+d.message),a(null)}finally{l.isLoadingGpx=!1}},t.onerror=()=>{b.handleError("Error reading CSV file."),l.isLoadingGpx=!1,s(new Error("Error reading CSV file."))},t.readAsText(i)})}async function Kl(i,t){try{if(console.log(`[trackManager] renderTrack called for ${t} with ${i.length} points.`),!l.map)return console.warn("[trackManager] Map object in AppState is not available in renderTrack."),b.handleError("Map not initialized. Cannot render track."),null;l.gpxLayer&&l.map.hasLayer(l.gpxLayer)&&l.map.removeLayer(l.gpxLayer),l.gpxLayer=null,l.gpxPoints=i,l.isTrackLoaded=!1;const a={finalPointData:null,timestampToUseForWeather:null,historicalDateString:null,summaryForInfoElement:"",success:!1};if(i.length>0){const r=i[i.length-1];if(l.lastLat=r.lat,l.lastLng=r.lng,l.lastAltitude=await b.getAltitude(l.lastLat,l.lastLng),a.finalPointData={lat:l.lastLat,lng:l.lastLng,altitude:l.lastAltitude},i[0].time&&i[0].time.isValid){const y=i[0].time,v=se.utc().startOf("day"),w=y.startOf("day");w<v&&(a.historicalDateString=w.toFormat("yyyy-MM-dd"));let S=y.startOf("hour");y.minute>=30&&(S=S.plus({hours:1})),a.timestampToUseForWeather=S.toISO()}const d=(i.reduce((y,v,w)=>{if(w===0||!l.map)return 0;const S=i[w-1];return y+l.map.distance([S.lat,S.lng],[v.lat,v.lng])},0)/1e3).toFixed(2),c=i.map(y=>y.ele).filter(y=>y!==null),h=c.length?Math.min(...c).toFixed(0):"N/A",m=c.length?Math.max(...c).toFixed(0):"N/A",p=new CustomEvent("track:loaded",{detail:{lat:l.lastLat,lng:l.lastLng,altitude:l.lastAltitude,timestamp:a.timestampToUseForWeather,historicalDate:a.historicalDateString,summary:`<br><strong>Track:</strong> Distance: ${d} km, Min Elevation: ${h} m, Max Elevation: ${m} m (Source: ${t})`},bubbles:!0,cancelable:!0});l.map.getContainer().dispatchEvent(p)}l.gpxLayer=K.layerGroup([],{pane:"gpxTrackPane"});const s=l.lastAltitude!=="N/A"&&!isNaN(l.lastAltitude)?parseFloat(l.lastAltitude):null;for(let r=0;r<i.length-1;r++){const d=i[r],c=i[r+1],h=d.ele,m=c.ele;let p="#808080";if(s!==null&&h!==null&&m!==null){const v=h-s,w=m-s,S=(v+w)/2;p=b.interpolateColor(S)}const y=K.polyline([[d.lat,d.lng],[c.lat,c.lng]],{color:p,weight:4,opacity:.75,pane:"gpxTrackPane"}).bindTooltip("",{sticky:!0});y.on("mousemove",function(v){const w=v.latlng;let S=i[0],E=1/0,P=0;i.forEach((x,A)=>{const O=Math.sqrt(Math.pow(x.lat-w.lat,2)+Math.pow(x.lng-w.lng,2));O<E&&(E=O,S=x,P=A)}),y.setTooltipContent(_f(S,P,i,s)).openTooltip(w)}),l.gpxLayer.addLayer(y)}if(l.map&&l.gpxLayer.addTo(l.map),l.isTrackLoaded=!0,i.length>0&&l.map){const r=K.latLngBounds(i.map(d=>[d.lat,d.lng]));r.isValid()?l.map.fitBounds(r,{padding:[50,50],maxZoom:l.map.getMaxZoom()||18}):b.handleError("Unable to display track: invalid coordinates.")}return a.success=!0,console.log("[trackManager] renderTrack finished successfully."),a}catch(a){return console.error("[trackManager] Error in renderTrack:",a),b.handleError("Error rendering track: "+a.message),l.gpxPoints=[],l.gpxLayer&&l.map&&l.map.hasLayer(l.gpxLayer)&&l.map.removeLayer(l.gpxLayer),l.gpxLayer=null,l.isTrackLoaded=!1,{success:!1,error:a.message}}}function wf(i,t){return K.marker([i,t],{icon:K.divIcon({className:"live-marker",html:'<div style="background-color: blue; width: 10px; height: 10px; border-radius: 50%;"></div>',iconSize:[10,10],iconAnchor:[5,5]}),zIndexOffset:1e3})}function Lf(i,t,a){l.accuracyCircle&&l.map.removeLayer(l.accuracyCircle),l.accuracyCircle=K.circle([i,t],{radius:a,color:"blue",fillOpacity:.1,weight:1,dashArray:"5, 5"}).addTo(l.map)}const Sf=b.debounce(async i=>{if(console.log("[LiveTrackingManager] Received position data:",i),!l.map){console.warn("[LiveTrackingManager] Map not initialized, skipping position update.");return}const{latitude:t,longitude:a,accuracy:s,altitude:r,altitudeAccuracy:d}=i.coords;if(console.log("[LiveTrackingManager] Position details:",{latitude:t,longitude:a,accuracy:s,deviceAltitude:r,altitudeAccuracy:d}),s>wt.GEOLOCATION_ACCURACY_THRESHOLD_M){console.log("[LiveTrackingManager] Skipping position update due to low accuracy:",s);return}const c=Date.now();let h=0,m="N/A";if(l.prevLat!==null&&l.prevLng!==null&&l.prevTime!==null){const v=l.map.distance([l.prevLat,l.prevLng],[t,a]),w=(c-l.prevTime)/1e3;w>na.MIN_TIME_DIFF_FOR_SPEED_CALC_S&&(h=v/w,m=b.calculateBearing(l.prevLat,l.prevLng,t,a).toFixed(0))}const p=h<na.SPEED_SMOOTHING_TRESHOLD?na.SPEED_SMOOTHING_LOW:na.SPEED_SMOOTHING_HIGH;l.lastSmoothedSpeedMs=p*h+(1-p)*l.lastSmoothedSpeedMs,l.liveMarker?l.liveMarker.setLatLng([t,a]):l.liveMarker=wf(t,a).addTo(l.map),s&&Lf(t,a,s),l.prevLat=t,l.prevLng=a,l.prevTime=c;const y=new CustomEvent("tracking:positionUpdated",{detail:{latitude:t,longitude:a,deviceAltitude:r,altitudeAccuracy:d,accuracy:s,speedMs:l.lastSmoothedSpeedMs,direction:m},bubbles:!0,cancelable:!0});console.log("[LiveTrackingManager] Dispatching tracking:positionUpdated event:",y.detail),document.dispatchEvent(y)},300);function bf(){if(l.watchId===null){if(!navigator.geolocation){b.handleError("Geolocation is not supported by your browser."),document.dispatchEvent(new CustomEvent("tracking:stopped"));return}console.log("[LiveTrackingManager] Starting position tracking..."),l.watchId=navigator.geolocation.watchPosition(Sf,i=>{b.handleError(`Geolocation error: ${i.message}`),Yl()},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),document.dispatchEvent(new CustomEvent("tracking:started"))}}function Yl(){l.watchId!==null&&(navigator.geolocation.clearWatch(l.watchId),l.watchId=null),l.liveMarker&&l.map.removeLayer(l.liveMarker),l.accuracyCircle&&l.map.removeLayer(l.accuracyCircle),l.liveMarker=null,l.accuracyCircle=null,l.prevLat=null,l.prevLng=null,l.prevTime=null,l.lastSmoothedSpeedMs=0,document.dispatchEvent(new CustomEvent("tracking:stopped")),console.log("[LiveTrackingManager] Stopped position tracking and cleaned up.")}function Ar(){if(l.autoupdateInterval){console.log("[AutoupdateManager] Autoupdate is already running.");return}if(!navigator.onLine){b.handleError("Cannot enable autoupdate while offline.");const i=document.getElementById("autoupdateCheckbox");i&&(i.checked=!1),g.state.userSettings.autoupdate=!1,g.save();return}console.log("[AutoupdateManager] Starting autoupdate interval."),document.dispatchEvent(new CustomEvent("autoupdate:tick",{detail:{isInitialTick:!0}})),l.autoupdateInterval=setInterval(()=>{console.log("[AutoupdateManager] Tick..."),document.dispatchEvent(new CustomEvent("autoupdate:tick",{detail:{isInitialTick:!1}}))},60*1e3),yt("Autoupdate enabled")}function Xl(){l.autoupdateInterval&&(clearInterval(l.autoupdateInterval),l.autoupdateInterval=null,console.log("[AutoupdateManager] Stopped autoupdate interval."),yt("Autoupdate disabled"))}function Mf(){var t;const i=document.getElementById("autoupdateCheckbox");if(!i){console.warn("[AutoupdateManager] Autoupdate checkbox not found.");return}i.checked=g.state.userSettings.autoupdate,i.addEventListener("change",()=>{g.state.userSettings.autoupdate=i.checked,g.save();const a=document.getElementById("historicalDatePicker");if(i.checked&&(a!=null&&a.value)){i.checked=!1,g.state.userSettings.autoupdate=!1,g.save(),Gn("Autoupdate cannot be enabled with a historical date set.");return}i.checked?Ar():Xl()}),g.state.userSettings.autoupdate&&!((t=document.getElementById("historicalDatePicker"))!=null&&t.value)&&Ar()}window.L=K;function Ql(i,t={}){console.log(`[EventManager] Dispatching event: ${i}`,t);const a=new CustomEvent(i,{detail:t,bubbles:!0,cancelable:!0});document.dispatchEvent(a)}const gi=()=>g.getValue("heightUnit","radio","m"),fs=()=>g.getValue("windUnit","radio","kt"),ec=()=>g.getValue("coordFormat","radio","Decimal");function zn(i,t,a){console.log(`setupCheckbox called for id: ${i}`);const s=document.getElementById(i);s?(s._changeHandler&&(s.removeEventListener("change",s._changeHandler),console.log(`Removed previous change listener for ${i}`)),s._changeHandler=r=>{console.log(`Change event fired for ${i}, checked: ${s.checked}, event:`,r),r.stopPropagation(),a(s)},s.addEventListener("change",s._changeHandler),s.addEventListener("click",r=>{console.log(`Click event on ${i}, checked: ${s.checked}, target:`,r.target)}),console.log(`Attached change and click listeners to ${i}`),i==="showLandingPattern"&&!(g.isFeatureUnlocked("landingPattern")&&g.state.isLandingPatternUnlocked)&&(s.style.opacity="0.5",s.title="Feature locked. Click to enter password.")):console.warn(`Checkbox ${i} not found`)}function ms(i,t,a){if(console.log(`toggleSubmenu called for ${i.textContent||i.id}: ${a?"show":"hide"}`),t){t.classList.contains("submenu")||t.classList.add("submenu"),t.classList.toggle("hidden",!a),i.setAttribute("aria-expanded",a),console.log(`Submenu toggled for ${i.textContent||i.id}: ${a?"shown":"hidden"}`);let s=0;const r=5,d=()=>{const c={isHidden:t.classList.contains("hidden"),displayStyle:window.getComputedStyle(t).display};a&&(c.isHidden||c.displayStyle==="none")&&(console.warn(`Submenu for ${i.textContent||i.id} was hidden unexpectedly. Forcing it to be visible.`),t.classList.remove("hidden"),t.style.display="block",s++,s<r&&setTimeout(d,100))};setTimeout(d,100)}else console.warn(`Submenu for ${i.textContent||i.id} not found`)}function Wt(i,t){document.querySelectorAll(`input[name="${i}"]`).forEach(s=>{s.addEventListener("change",()=>{const r=g.getValue(i,"radio",g.defaultSettings[i]);if(g.state.userSettings[i]=r,g.save(),console.log(`${i} changed to: ${r} and saved to localStorage`),i==="landingDirection"){const d=document.getElementById("customLandingDirectionLL"),c=document.getElementById("customLandingDirectionRR"),h=g.state.userSettings.landingDirection;d&&(d.disabled=h!=="LL"),c&&(c.disabled=h!=="RR"),h==="LL"&&d&&!d.value&&g.state.userSettings.customLandingDirectionLL===""&&(d.value=Math.round(l.landingWindDir||0),g.state.userSettings.customLandingDirectionLL=parseInt(d.value),g.save(),console.log(`Set customLandingDirectionLL to ${d.value}`)),h==="RR"&&c&&!c.value&&g.state.userSettings.customLandingDirectionRR===""&&(c.value=Math.round(l.landingWindDir||0),g.state.userSettings.customLandingDirectionRR=parseInt(c.value),g.save(),console.log(`Set customLandingDirectionRR to ${c.value}`))}t()})})}function Xe(i,t,a,s){const r=document.getElementById(i);if(!r){console.warn(`Input element ${i} not found`);return}r.addEventListener(t,b.debounce(()=>{const d=r.type==="number"?parseFloat(r.value):r.value;g.state.userSettings[i]=d,g.save(),console.log(`${i} changed to: ${d} and saved to localStorage`),s(d)},a))}function ps(i,t){const a=document.getElementById(i);if(!a){console.warn(`Input element ${i} not found`);return}a.addEventListener("blur",()=>{const s=parseInt(a.value)||t;console.log(`Attempting to update ${i} to ${s}`),g.state.userSettings[i]=s,g.save();const r=document.getElementById("legHeightFinal"),d=document.getElementById("legHeightBase"),c=document.getElementById("legHeightDownwind");if(!isNaN(s)&&s>=50&&s<=1e3&&Vf(r,d,c))console.log(`Valid ${i}: ${s}, updating displays`),lt(),l.weatherData&&l.lastLat&&l.lastLng&&i==="legHeightDownwind"&&g.state.userSettings.calculateJump&&nn();else{let h=t;const m=parseInt(r==null?void 0:r.value)||100,p=parseInt(d==null?void 0:d.value)||200,y=parseInt(c==null?void 0:c.value)||300;i==="legHeightFinal"&&(h=Math.min(p-1,100)),i==="legHeightBase"&&(h=Math.max(m+1,Math.min(y-1,200))),i==="legHeightDownwind"&&(h=Math.max(p+1,300)),a.value=h,g.state.userSettings[i]=h,g.save(),console.log(`Adjusted ${i} to ${h} due to invalid input`),b.handleError(`Adjusted ${i} to ${h} to maintain valid leg order.`)}})}function Tf(){console.log("setupMenuEvents wird aufgerufen für allgemeine Menü-Logik.");const i=document.getElementById("hamburgerBtn"),t=document.getElementById("menu");!i||!t||(i.addEventListener("click",a=>{a.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",a=>{!t.contains(a.target)&&!i.contains(a.target)&&t.classList.add("hidden")}),t.addEventListener("click",a=>{const s=a.target;if(s.matches("li > span")||s.matches("li > label")){a.preventDefault(),a.stopPropagation();const d=s.closest("li").querySelector("ul.submenu");d&&d.classList.toggle("hidden")}}))}function Ef(){if(!l.map){console.warn("Map not initialized, skipping setupCheckboxEvents");return}zn("showTableCheckbox","showTable",c=>{g.state.userSettings.showTable=c.checked,g.save(),console.log("showTableCheckbox changed:",c.checked);const h=document.getElementById("info");h&&(h.style.display=c.checked?"block":"none",console.log("Info display set to:",h.style.display)),c.checked&&l.weatherData&&l.lastLat&&l.lastLng&&Ea(zt()),Vn()}),zn("showExitAreaCheckbox","showExitArea",c=>{g.state.userSettings.showExitArea=c.checked,g.save(),console.log("Show Exit Area set to:",g.state.userSettings.showExitArea),l.weatherData&&l.lastLat&&l.lastLng&&g.state.userSettings.calculateJump&&dt()}),zn("showCanopyAreaCheckbox","showCanopyArea",c=>{g.state.userSettings.showCanopyArea=c.checked,g.save(),console.log("Show Canopy Area set to:",g.state.userSettings.showCanopyArea),l.weatherData&&l.lastLat&&l.lastLng&&g.state.userSettings.calculateJump&&dt()}),zn("showJumpRunTrack","showJumpRunTrack",c=>{if(g.state.userSettings.showJumpRunTrack=c.checked,g.save(),c.checked=g.state.userSettings.showJumpRunTrack,console.log("showJumpRunTrack changed:",c.checked),c.checked&&l.weatherData&&l.lastLat&&l.lastLng&&g.state.isCalculateJumpUnlocked&&g.state.userSettings.calculateJump)Gf();else{l.jumpRunTrackLayer&&(l.jumpRunTrackLayer.airplaneMarker&&l.map&&typeof l.map.removeLayer=="function"&&(l.map.removeLayer(l.jumpRunTrackLayer.airplaneMarker),l.jumpRunTrackLayer.airplaneMarker=null),l.jumpRunTrackLayer.approachLayer&&l.map&&typeof l.map.removeLayer=="function"&&(l.map.removeLayer(l.jumpRunTrackLayer.approachLayer),l.jumpRunTrackLayer.approachLayer=null),l.map&&typeof l.map.removeLayer=="function"&&l.map.removeLayer(l.jumpRunTrackLayer),l.jumpRunTrackLayer=null,console.log("Removed JRT polyline"));const h=document.getElementById("jumpRunTrackDirection");if(h){const m=ya();h.value=m?m.direction:"",console.log("Updated jumpRunTrackDirection value:",(m==null?void 0:m.direction)||"")}}}),zn("showCutAwayFinder","showCutAwayFinder",c=>{var m;g.state.userSettings.showCutAwayFinder=c.checked,g.save(),console.log("Show Cut Away Finder set to:",c.checked);const h=(m=c.closest("li"))==null?void 0:m.querySelector("ul.submenu");c.checked?h&&h.classList.remove("hidden"):(h&&h.classList.add("hidden"),ef(),l.cutAwayLat=null,l.cutAwayLng=null),l.weatherData&&l.lastLat&&l.lastLng&&g.state.userSettings.calculateJump&&dt()}),zn("showLandingPattern","showLandingPattern",c=>{const h="landingPattern",m=()=>{var v;g.state.userSettings.showLandingPattern=!0,g.save();const y=(v=c.closest("li"))==null?void 0:v.querySelector("ul");ms(c,y,!0),on()},p=()=>{var v;g.state.userSettings.showLandingPattern=!1,g.save(),c.checked=!1;const y=(v=c.closest("li"))==null?void 0:v.querySelector("ul");ms(c,y,!1),pi(null)};c.checked?g.isFeatureUnlocked(h)?m():g.showPasswordModal(h,m,p):p()});const i=document.getElementById("showJumpMasterLine");i&&(i.disabled=!g.state.userSettings.trackPosition,i.style.opacity=i.disabled?"0.5":"1",i.addEventListener("change",()=>{var m;const c=i.checked;if(c&&i.disabled){i.checked=!1,b.handleError("Please start Live Tracking first.");return}g.state.userSettings.showJumpMasterLine=c,g.save(),Ql("ui:showJumpMasterLineChanged",{isChecked:c});const h=(m=i.closest("li"))==null?void 0:m.querySelector("ul.submenu");h&&ms(i,h,c)}));const t=document.getElementById("trackPositionCheckbox");t&&t.addEventListener("change",()=>{const c=t.checked;g.state.userSettings.trackPosition=c,g.save(),c?bf():Yl()});const a=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');a&&(a.disabled=!g.state.userSettings.harpLat||!g.state.userSettings.harpLng,console.log("HARP radio button initialized, disabled:",a.disabled));const s=document.getElementById("placeHarpButton");s&&s.addEventListener("click",()=>{l.isPlacingHarp=!0,console.log("HARP placement mode activated"),l.map.on("click",jl),b.handleMessage("Click the map to place the HARP marker")});const r=document.getElementById("clearHarpButton");r&&r.addEventListener("click",cf);const d=document.querySelector(".hamburger-menu");d&&d.addEventListener("click",c=>{console.log("Menu click:",c.target,"class:",c.target.className,"id:",c.target.id)})}function kf(){const i=document.getElementById("timeSlider");if(!i){console.warn("Time slider not found:",{id:"timeSlider"});return}i.addEventListener("input",async()=>{var a,s,r;const t=parseInt(i.value)||0;if(console.log("Time slider moved to index:",t),l.weatherData&&l.lastLat&&l.lastLng)await Ea(t),await Ta(),l.lastAltitude!=="N/A"&&Si(),g.state.userSettings.showLandingPattern&&(console.log("Updating landing pattern for slider index:",t),on()),g.state.userSettings.calculateJump&&(console.log("Recalculating jump for slider index:",t),dt(),Gt()),g.state.userSettings.showJumpRunTrack&&(console.log("Updating jump run track for slider index:",t),Je()),Vt();else{let d="N/A";if((s=(a=l.weatherData)==null?void 0:a.time)!=null&&s[t])d=await b.getDisplayTime(l.weatherData.time[t],l.lastLat,l.lastLng);else if(l.ensembleModelsData&&Object.keys(l.ensembleModelsData).length>0){const h=Object.keys(l.ensembleModelsData)[0],m=(r=l.ensembleModelsData[h])==null?void 0:r.time;m!=null&&m[t]&&(d=await b.getDisplayTime(m[t],l.lastLat,l.lastLng))}const c=document.getElementById("selectedTime");c&&(c.innerHTML=`Selected Time: ${d}`)}g.state.userSettings.selectedEnsembleModels&&g.state.userSettings.selectedEnsembleModels.length>0&&(console.log("Time slider change triggering ensemble update for index:",t),l.ensembleModelsData&&Object.keys(l.ensembleModelsData).length>0?ga():console.warn("Ensemble update skipped: AppState.ensembleModelsData is not populated yet."))}),i.addEventListener("change",async()=>{var r,d,c;const t=parseInt(i.value)||0;let a="N/A";if((d=(r=l.weatherData)==null?void 0:r.time)!=null&&d[t])a=await b.getDisplayTime(l.weatherData.time[t],l.lastLat,l.lastLng);else if(l.ensembleModelsData&&Object.keys(l.ensembleModelsData).length>0){const h=Object.keys(l.ensembleModelsData)[0],m=(c=l.ensembleModelsData[h])==null?void 0:c.time;m!=null&&m[t]&&(a=await b.getDisplayTime(m[t],l.lastLat,l.lastLng))}const s=document.getElementById("selectedTime");s&&(s.innerHTML=`Selected Time: ${a}`,console.log("Time slider change event, updated selectedTime label to:",a))})}function Pf(){const i=document.getElementById("modelSelect");if(!i){console.warn("modelSelect element not found");return}i.addEventListener("change",async()=>{var t,a;if(console.log("Model select changed to:",i.value),g.state.userSettings.model=i.value,g.save(),l.lastLat&&l.lastLng){const s=zt(),r=((a=(t=l.weatherData)==null?void 0:t.time)==null?void 0:a[s])||null,d=await Ln(l.lastLat,l.lastLng,r);d&&await ac(d)}else b.handleError("Please select a position on the map first.")})}function xf(){if(Wt("refLevel",()=>{g.updateUnitLabels(),lt()}),Wt("heightUnit",()=>{if(g.updateUnitLabels(),lt(),Vt(),l.lastMouseLatLng&&l.coordsControl){const s=ec(),r=l.lastMouseLatLng.lat,d=l.lastMouseLatLng.lng;let c;s==="MGRS"?c=`MGRS: ${b.decimalToMgrs(r,d)}`:c=`Lat: ${r.toFixed(5)}, Lng: ${d.toFixed(5)}`,nc(r,d,{lat:r,lng:d},(h,m)=>{if(l.lastMouseLatLng){const p=Math.abs(l.lastMouseLatLng.lat-m.lat),y=Math.abs(l.lastMouseLatLng.lng-m.lng),v=.05;if(p<v&&y<v){const w=gi();let S=h==="N/A"?"N/A":h;S!=="N/A"&&(S=b.convertHeight(S,w),S=Math.round(S)),console.log("Updating elevation display after heightUnit change:",{lat:r,lng:d,elevation:h,heightUnit:w,displayElevation:S}),l.coordsControl.update(`${c}<br>Elevation: ${S} ${S==="N/A"?"":w}`)}}})}if(l.gpxLayer&&l.gpxPoints.length>0){const s=l.lastAltitude!=="N/A"&&!isNaN(l.lastAltitude)?parseFloat(l.lastAltitude):null,r=fs(),d=gi();l.gpxLayer.eachLayer(c=>{c instanceof K.Polyline&&c.on("mousemove",function(h){const m=h.latlng;let p=l.gpxPoints[0],y=1/0,v=0;l.gpxPoints.forEach((w,S)=>{const E=Math.sqrt(Math.pow(w.lat-m.lat,2)+Math.pow(w.lng-m.lng,2));E<y&&(y=E,p=w,v=S)}),c.setTooltipContent(getTooltipContent(p,v,l.gpxPoints,s,r,d)).openTooltip(m)})})}}),Wt("temperatureUnit",()=>{lt()}),Wt("windUnit",()=>{if(g.updateUnitLabels(),lt(),Vt(),l.gpxLayer&&l.gpxPoints.length>0){const s=l.lastAltitude!=="N/A"&&!isNaN(l.lastAltitude)?parseFloat(l.lastAltitude):null,r=fs(),d=gi();l.gpxLayer.eachLayer(c=>{c instanceof K.Polyline&&c.on("mousemove",function(h){const m=h.latlng;let p=l.gpxPoints[0],y=1/0,v=0;l.gpxPoints.forEach((w,S)=>{const E=Math.sqrt(Math.pow(w.lat-m.lat,2)+Math.pow(w.lng-m.lng,2));E<y&&(y=E,p=w,v=S)}),c.setTooltipContent(getTooltipContent(p,v,l.gpxPoints,s,r,d)).openTooltip(m)})})}}),Wt("timeZone",async()=>{lt()}),Wt("coordFormat",()=>{l.lastLat&&l.lastLng&&Ta(),Vt()}),Wt("downloadFormat",()=>{console.log("Download format changed:",tc())}),Wt("landingDirection",()=>{const s=document.getElementById("customLandingDirectionLL"),r=document.getElementById("customLandingDirectionRR"),d=g.state.userSettings.landingDirection;console.log("landingDirection changed:",{landingDirection:d,customLL:s==null?void 0:s.value,customRR:r==null?void 0:r.value}),s&&(s.disabled=d!=="LL",d==="LL"&&!s.value&&l.landingWindDir!==null&&(s.value=Math.round(l.landingWindDir),g.state.userSettings.customLandingDirectionLL=parseInt(s.value),g.save())),r&&(r.disabled=d!=="RR",d==="RR"&&!r.value&&l.landingWindDir!==null&&(r.value=Math.round(l.landingWindDir),g.state.userSettings.customLandingDirectionRR=parseInt(r.value),g.save())),ic(),lt()}),Wt("jumpMasterLineTarget",()=>{g.state.userSettings.jumpMasterLineTarget=g.getValue("jumpMasterLineTarget","radio","DIP"),g.save(),console.log("jumpMasterLineTarget changed:",g.state.userSettings.jumpMasterLineTarget),Ql("jml:targetChanged");const s=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');s&&(s.disabled=!l.harpMarker||g.state.userSettings.harpLat===null||g.state.userSettings.harpLng===null,console.log("HARP radio button disabled:",s.disabled))}),l.gpxLayer&&l.gpxPoints.length>0){const s=l.lastAltitude!=="N/A"&&!isNaN(l.lastAltitude)?parseFloat(l.lastAltitude):null,r=fs(),d=gi();l.gpxLayer.eachLayer(c=>{c instanceof K.Polyline&&c.on("mousemove",function(h){const m=h.latlng;let p=l.gpxPoints[0],y=1/0,v=0;l.gpxPoints.forEach((w,S)=>{const E=Math.sqrt(Math.pow(w.lat-m.lat,2)+Math.pow(w.lng-m.lng,2));E<y&&(y=E,p=w,v=S)}),c.setTooltipContent(getTooltipContent(p,v,l.gpxPoints,s,r,d)).openTooltip(m)})})}document.querySelectorAll('input[name="ensembleScenario"]').forEach(s=>{s.addEventListener("change",()=>{if(s.checked)if(g.state.userSettings.currentEnsembleScenario=s.value,l.currentEnsembleScenario=s.value,g.save(),console.log("Ensemble scenario changed to:",s.value),g.state.userSettings.selectedEnsembleModels.length>0){const r=g.state.userSettings.selectedEnsembleModels.every(d=>l.ensembleModelsData&&l.ensembleModelsData[d]);!r&&s.value!=="all_models"?Us():!r&&s.value==="all_models"&&l.ensembleModelsData&&Object.keys(l.ensembleModelsData).length>0||r?ga():(b.handleMessage("Please select models and ensure data is fetched."),vn())}else s.value!=="all_models"&&b.handleMessage("Please select models from the 'Ensemble > Models' menu first."),vn()})});const t=g.state.userSettings.currentEnsembleScenario||"all_models",a=document.querySelector(`input[name="ensembleScenario"][value="${t}"]`);a&&(a.checked=!0,l.currentEnsembleScenario=t),l.map&&!l.ensembleLayerGroup&&(l.ensembleLayerGroup=K.layerGroup().addTo(l.map))}function Af(){Xe("lowerLimit","change",300,i=>{l.weatherData&&l.lastLat&&l.lastLng&&l.lastAltitude!=="N/A"&&Si()}),Xe("upperLimit","change",300,i=>{l.weatherData&&l.lastLat&&l.lastLng&&l.lastAltitude!=="N/A"&&Si()}),Xe("openingAltitude","change",300,i=>{!isNaN(i)&&i>=500&&i<=15e3?g.state.userSettings.calculateJump&&l.weatherData&&l.lastLat&&l.lastLng&&(nn(),Gt()):(b.handleError("Opening altitude must be between 500 and 15000 meters."),Oe("openingAltitude",1200),g.state.userSettings.openingAltitude=1200,g.save())}),Xe("exitAltitude","change",300,i=>{!isNaN(i)&&i>=500&&i<=15e3?g.state.userSettings.calculateJump&&l.weatherData&&l.lastLat&&l.lastLng&&nn():(b.handleError("Exit altitude must be between 500 and 15000 meters."),Oe("exitAltitude",3e3),g.state.userSettings.exitAltitude=3e3,g.save())}),Xe("canopySpeed","change",300,i=>{!isNaN(i)&&i>=5&&i<=50?lt():(b.handleError("Canopy speed must be between 5 and 50 kt."),Oe("canopySpeed",20),g.state.userSettings.canopySpeed=20,g.save())}),Xe("descentRate","change",300,i=>{!isNaN(i)&&i>=1&&i<=10?lt():(b.handleError("Descent rate must be between 1 and 10 m/s."),Oe("descentRate",3),g.state.userSettings.descentRate=3,g.save())}),Xe("interpStepSelect","change",300,i=>{lt()}),ps("legHeightFinal",100),ps("legHeightBase",200),ps("legHeightDownwind",300),Xe("customLandingDirectionLL","input",100,i=>{const t=parseInt(i,10);console.log("customLandingDirectionLL input:",{value:i,customDir:t}),!isNaN(t)&&t>=0&&t<=359?(g.state.userSettings.customLandingDirectionLL=t,g.save(),g.state.userSettings.landingDirection==="LL"&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Updating landing pattern for LL:",t),on(),Vn())):(b.handleError("Landing direction must be between 0 and 359°."),Oe("customLandingDirectionLL",g.state.userSettings.customLandingDirectionLL||0))}),Xe("customLandingDirectionRR","input",100,i=>{const t=parseInt(i,10);console.log("customLandingDirectionRR input:",{value:i,customDir:t}),!isNaN(t)&&t>=0&&t<=359?(g.state.userSettings.customLandingDirectionRR=t,g.save(),g.state.userSettings.landingDirection==="RR"&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Updating landing pattern for RR:",t),on(),Vn())):(b.handleError("Landing direction must be between 0 and 359°."),Oe("customLandingDirectionRR",g.state.userSettings.customLandingDirectionRR||0))}),Xe("jumpRunTrackDirection","change",0,i=>{const t=parseInt(i,10);if(console.log("jumpRunTrackDirection change event:",{value:i,customDir:t,jumpRunTrackOffset:g.state.userSettings.jumpRunTrackOffset}),!isNaN(t)&&t>=0&&t<=359)l.customJumpRunDirection=t,console.log("Set custom direction from input:",t),l.weatherData&&l.lastLat&&l.lastLng?(g.state.userSettings.showJumpRunTrack&&(console.log("Updating JRT for custom direction input"),Je()),g.state.userSettings.calculateJump&&(console.log("Recalculating jump for custom JRT direction"),nn(),Gt())):console.warn("Cannot update JRT or jump: missing conditions",{weatherData:!!l.weatherData,lastLat:l.lastLat,lastLng:l.lastLng});else{console.log("Invalid direction input, resetting to calculated"),b.handleError("Jump run direction must be between 0 and 359°."),l.customJumpRunDirection=null;const a=document.getElementById("jumpRunTrackDirection");a&&a.addEventListener("change",()=>{const s=parseFloat(a.value);Number.isFinite(s)&&s>=0&&s<=359?(g.state.userSettings.customJumpRunDirection=s,console.log("Setting 'customJumpRunDirection' on change to:",s)):(g.state.userSettings.customJumpRunDirection=null,a.value="",console.log("Invalid direction, resetting to calculated.")),g.save(),Je()}),l.weatherData&&l.lastLat&&l.lastLng&&(g.state.userSettings.showJumpRunTrack&&(console.log("Updating JRT for invalid direction input"),Je()),g.state.userSettings.calculateJump&&(console.log("Recalculating jump for reset JRT direction"),nn(),Gt()))}}),Xe("jumpRunTrackOffset","change",0,i=>{const t=parseInt(i,10);if(console.log("jumpRunTrackOffset change event:",{value:i,offset:t}),!isNaN(t)&&t>=-5e4&&t<=5e4&&t%100===0)g.state.userSettings.jumpRunTrackOffset=t,g.save(),g.state.userSettings.calculateJump&&g.state.userSettings.showJumpRunTrack&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Updating JRT for offset change"),Je());else{b.handleError("Offset must be between -50000 and 50000 in steps of 100.");const a=document.getElementById("jumpRunTrackOffset");a&&(a.value=0),g.state.userSettings.jumpRunTrackOffset=0,g.save(),g.state.userSettings.calculateJump&&g.state.userSettings.showJumpRunTrack&&(console.log("Resetting JRT for invalid offset"),Je())}}),Xe("jumpRunTrackForwardOffset","change",0,i=>{const t=parseInt(i,10);if(console.log("jumpRunTrackForwardOffset change event:",{value:i,offset:t}),!isNaN(t)&&t>=-5e4&&t<=5e4&&t%100===0)g.state.userSettings.jumpRunTrackForwardOffset=t,g.save(),g.state.userSettings.calculateJump&&g.state.userSettings.showJumpRunTrack&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Updating JRT for forward offset change"),Je());else{b.handleError("Forward offset must be between -50000 and 50000 in steps of 100.");const a=document.getElementById("jumpRunTrackForwardOffset");a&&(a.value=0),g.state.userSettings.jumpRunTrackForwardOffset=0,g.save(),g.state.userSettings.calculateJump&&g.state.userSettings.showJumpRunTrack&&(console.log("Resetting JRT for invalid forward offset"),Je())}}),Xe("aircraftSpeedKt","change",300,i=>{const t=Nr(i);document.getElementById("jumperSeparation").value=t,g.state.userSettings.jumperSeparation=t,g.state.userSettings.aircraftSpeedKt=parseFloat(i),g.save(),dt(),Je()}),Xe("numberOfJumpers","change",300,i=>{const t=parseFloat(i);!isNaN(t)&&t>=1&&t<=50?(g.state.userSettings.numberOfJumpers=t,g.save(),g.state.userSettings.calculateJump&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Recalculating jump for jumper number change"),nn(),Gt())):(b.handleError("Jumper number must be between 1 and 50."),Oe("numberOfJumpers",defaultSettings.numberOfJumpers),g.state.userSettings.numberOfJumpers=defaultSettings.numberOfJumpers,g.save())}),Xe("jumperSeparation","change",300,i=>{const t=parseFloat(i);!isNaN(t)&&t>=1&&t<=50?(g.state.userSettings.jumperSeparation=t,l.isJumperSeparationManual=!0,g.save(),console.log(`jumperSeparation manually set to ${t}s`),g.state.userSettings.calculateJump&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Recalculating jump for jumper separation change"),nn(),Gt())):(b.handleError("Jumper separation must be between 1 and 50 seconds."),Oe("jumperSeparation",defaultSettings.jumperSeparation),g.state.userSettings.jumperSeparation=defaultSettings.jumperSeparation,l.isJumperSeparationManual=!1,g.save())}),Xe("cutAwayAltitude","change",300,i=>{!isNaN(i)&&i>=400&&i<=15e3?(g.state.userSettings.cutAwayAltitude=i,g.save(),g.state.userSettings.showCutAwayFinder&&l.weatherData&&l.lastLat&&l.lastLng&&(console.log("Recalculating jump for cut-away altitude change"),dt())):(b.handleError("Cut away altitude must be between 400 and 15000 meters."),Oe("cutAwayAltitude",1e3),g.state.userSettings.cutAwayAltitude=1e3,g.save())}),Xe("historicalDatePicker","change",300,i=>{console.log("historicalDatePicker changed to:",i),l.lastLat&&l.lastLng?Ln(l.lastLat,l.lastLng,i?`${i}T00:00:00Z`:null).then(t=>{t&&(l.weatherData=t,lt())}):b.handleError("Please select a position on the map first.")})}function Cf(){const i=document.getElementById("downloadButton");i&&i.addEventListener("click",()=>{const t=tc();Zf(t)})}function If(){const i=document.getElementById("clearHistoricalDate");i&&i.addEventListener("click",()=>{const t=document.getElementById("historicalDatePicker");t&&(t.value="",console.log("Cleared historical date, refetching forecast data"),l.lastLat&&l.lastLng&&Ln(l.lastLat,l.lastLng,null).then(a=>{a&&(l.weatherData=a,lt())}))})}function Df(){Jl(),console.log("Coordinate events setup complete.")}function Nf(){const i=document.querySelectorAll('input[name="cutAwayState"]');if(i.length===0)return;const t=g.state.userSettings.cutAwayState||"Partially",a=document.querySelector(`input[name="cutAwayState"][value="${t}"]`);a&&(a.checked=!0),i.forEach(s=>{s.addEventListener("change",()=>{s.checked&&(console.log(`Cut Away State changed to: ${s.value}`),g.state.userSettings.cutAwayState=s.value,g.save(),l.weatherData&&l.lastLat&&l.lastLng&&g.state.userSettings.calculateJump&&dt())})})}function Of(){console.log("App: Richte Event-Listener für Track-Einstellungen ein.");const i=(s,r)=>{const d=document.getElementById(s);d&&(d.value=g.state.userSettings[r]||0,console.log(`Set ${s} to initial value:`,d.value),d.addEventListener("input",()=>{const c=parseFloat(d.value);isNaN(c)||(g.state.userSettings[r]=c,g.save(),Je())}))};i("numberOfJumpers","numberOfJumpers"),i("jumperSeparation","jumperSeparation"),i("jumpRunTrackOffset","jumpRunTrackOffset"),i("jumpRunTrackForwardOffset","jumpRunTrackForwardOffset");const t=document.getElementById("jumpRunTrackDirection");t&&(t.value=g.state.userSettings.customJumpRunDirection||"",t.addEventListener("change",()=>{const s=parseFloat(t.value);Number.isFinite(s)&&s>=0&&s<=359?(g.state.userSettings.customJumpRunDirection=s,console.log("Setting 'customJumpRunDirection' on change to:",s)):(g.state.userSettings.customJumpRunDirection=null,t.value="",console.log("Invalid direction, resetting to calculated.")),g.save(),Je()}));const a=document.getElementById("showJumpRunTrack");a&&a.addEventListener("change",s=>{g.state.userSettings.showJumpRunTrack=s.target.checked,g.save(),Je()})}function Ff(){console.log("App: Richte Event-Listener für Karten-Events ein."),document.addEventListener("map:location_selected",async i=>{const{lat:t,lng:a,source:s}=i.detail;console.log(`App: Event 'map:location_selected' von '${s}' empfangen.`),l.lastLat=t,l.lastLng=a,l.lastAltitude=await b.getAltitude(t,a),Gs(t,a),resetJumpRunDirection(!0),await Ln(t,a),g.state.userSettings.calculateJump&&(dt(),Gt()),Vn(!0),l.isManualPanning=!1,Je(),on()}),document.addEventListener("map:mousemove",i=>{const{lat:t,lng:a}=i.detail;l.lastMouseLatLng={lat:t,lng:a};const s=ec();let r;if(s==="MGRS")r=`MGRS: ${b.decimalToMgrs(t,a)||"N/A"}`;else if(s==="DMS"){const d=c=>`${c.deg}°${c.min}'${c.sec.toFixed(0)}" ${c.dir}`;r=`Lat: ${d(b.decimalToDms(t,!0))}, Lng: ${d(b.decimalToDms(a,!1))}`}else r=`Lat: ${t.toFixed(5)}, Lng: ${a.toFixed(5)}`;l.coordsControl&&l.coordsControl.update(`${r}<br>Elevation: Fetching...<br>QFE: Fetching...`),nc(t,a,{lat:t,lng:a},({elevation:d,qfe:c},h)=>{if(l.lastMouseLatLng&&l.coordsControl){const m=Math.abs(l.lastMouseLatLng.lat-h.lat),p=Math.abs(l.lastMouseLatLng.lng-h.lng),y=.05;if(m<y&&p<y){const v=gi();let w=d==="N/A"?"N/A":d;w!=="N/A"&&(w=b.convertHeight(w,v),w=Math.round(w));const S=c==="N/A"?"N/A":`${c} hPa`;l.coordsControl.update(`${r}<br>Elevation: ${w} ${w==="N/A"?"":v}<br>QFE: ${S}`)}}})})}function Rf(){console.log("setupMenuItemEvents wird aufgerufen für 'Calculate Jump'.");const i=Array.from(document.querySelectorAll(".menu-label")).find(s=>s.textContent.trim()==="Calculate Jump");if(!i){console.error("Calculate Jump menu item not found");return}const t=i.closest("li").querySelector("ul.submenu"),a=()=>{g.isFeatureUnlocked("calculateJump")?(i.style.opacity="1",i.title="Click to open/close jump calculation settings"):(i.style.opacity="0.5",i.title="Feature locked. Click to enter password.",t&&t.classList.add("hidden"))};a(),i.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),g.isFeatureUnlocked("calculateJump")?t&&t.classList.toggle("hidden"):g.showPasswordModal("calculateJump",()=>{a(),t&&t.classList.remove("hidden")},()=>{a()})})}function zf(){const i=document.getElementById("resetCutAwayMarker");i&&i.addEventListener("click",()=>{if(!l.map){console.warn("Map not initialized, cannot reset cut-away marker");return}l.cutAwayMarker&&(l.map.removeLayer(l.cutAwayMarker),l.cutAwayMarker=null,l.cutAwayLat=null,l.cutAwayLng=null,console.log("Cut-away marker reset"),l.cutAwayCircle&&(l.map.removeLayer(l.cutAwayCircle),l.cutAwayCircle=null,console.log("Cleared cut-away circle")),document.getElementById("info").innerHTML="Right-click map to place cut-away marker")})}function $f(){console.log("[app.js] Setting up track events");const i=document.getElementById("trackFileInput"),t=document.getElementById("loading");i&&i.addEventListener("change",async s=>{const r=s.target.files[0];if(t&&(t.style.display="block"),!r){b.handleError("No file selected."),t&&(t.style.display="none");return}const d=r.name.split(".").pop().toLowerCase();let c=null;try{d==="gpx"?c=await yf(r):d==="csv"?c=await vf(r):(b.handleError("Unsupported file type. Please upload a .gpx or .csv file."),t&&(t.style.display="none"))}catch(h){console.error("Error during track file processing:",h),b.handleError("Failed to process track file."),t&&(t.style.display="none")}});const a=document.getElementById("clearTrack");a&&a.addEventListener("click",()=>{if(!l.map){b.handleError("Cannot clear track: map not initialized.");return}if(l.gpxLayer)try{l.map.hasLayer(l.gpxLayer)&&l.map.removeLayer(l.gpxLayer),l.gpxLayer=null,l.gpxPoints=[],l.isTrackLoaded=!1;const s=document.getElementById("info");if(s){const r=/(<br><strong>Available Models:<\/strong><ul>.*?<\/ul>|<br><strong>Available Models:<\/strong> None)/s,c=s.innerHTML.match(r);s.innerHTML="Click on the map to fetch weather data."+(c?c[0]:"")}i&&(i.value="")}catch(s){b.handleError("Failed to clear track: "+s.message)}else b.handleMessage("No track to clear.")}),l.map&&l.map.getContainer().addEventListener("track:loaded",async s=>{try{const{lat:r,lng:d,timestamp:c,historicalDate:h,summary:m}=s.detail;if(console.log('Event "track:loaded" empfangen, starte Aktionen.'),h){console.log("Historischer Track geladen, deaktiviere Autoupdate.");const v=document.getElementById("autoupdateCheckbox");v&&(v.checked=!1),Xl(),g.state.userSettings.autoupdate=!1,g.save(),b.handleMessage("Autoupdate disabled for historical track viewing.")}await Ma(r,d);const p=await Ln(r,d,c);if(p){l.weatherData=p;const v=document.getElementById("timeSlider");if(v&&l.weatherData.time){v.max=l.weatherData.time.length-1,v.disabled=v.max<=0;const w=new Date(c).getTime();let S=0,E=1/0;l.weatherData.time.forEach((P,x)=>{const A=Math.abs(new Date(P).getTime()-w);A<E&&(E=A,S=x)}),v.value=S}}await lt(),g.state.isCalculateJumpUnlocked&&g.state.userSettings.calculateJump&&dt(),g.state.isLandingPatternUnlocked&&g.state.userSettings.showLandingPattern&&on();const y=document.getElementById("info");if(y&&m){const v=/(<br><strong>Available Models:<\/strong><ul>.*?<\/ul>|<br><strong>Available Models:<\/strong> None)/s,w=y.innerHTML.match(v);y.innerHTML=m+(w?w[0]:"")}if(h){const v=document.getElementById("historicalDatePicker");v&&(v.value=h)}}catch(r){console.error("Fehler bei der Verarbeitung von track:loaded:",r),b.handleError("Konnte Track-Daten nicht vollständig verarbeiten.")}finally{t&&(t.style.display="none")}})}function Bf(){const i=document.getElementById("bottom-container");if(!i){console.error("Bottom container not found; cannot create settings/cache buttons.");return}const t=document.createElement("div");t.id="settings-cache-buttons",t.className="button-wrapper";const a=document.createElement("button");a.id="resetButton",a.textContent="Reset Settings",a.title="Resets all settings to their default values and locks all features",a.addEventListener("click",()=>{confirm("Are you sure you want to reset all settings and lock all features?")&&(localStorage.removeItem("unlockedFeatures"),localStorage.removeItem("upperWindsSettings"),window.location.reload())}),t.appendChild(a);const s=document.createElement("button");s.id="clearCacheButton",s.textContent="Clear Tile Cache",s.title="Clears cached map tiles. Pan/zoom to cache more tiles for offline use.",s.addEventListener("click",async()=>{try{const r=await nt.getCacheSize();await nt.clearCache(),b.handleMessage(`Tile cache cleared successfully (freed ${r.toFixed(2)} MB).`),console.log("Tile cache cleared")}catch(r){b.handleError("Failed to clear tile cache: "+r.message)}}),t.appendChild(s),i.appendChild(t)}function Uf(){const i=document.getElementById("cacheRadiusSelect");i?(i.addEventListener("change",()=>{if(!g.state||!g.state.userSettings){console.error("Settings not properly initialized");return}g.state.userSettings.cacheRadiusKm=parseInt(i.value,10),g.save(),console.log("Updated cacheRadiusKm:",g.state.userSettings.cacheRadiusKm)}),console.log("cacheRadiusSelect listener attached, initial value:",i.value)):console.warn("cacheRadiusSelect not found in DOM");const t=document.getElementById("cacheZoomLevelsSelect");t?(t.addEventListener("change",()=>{const[s,r]=t.value.split("-").map(Number);g.state.userSettings.cacheZoomLevels=Array.from({length:r-s+1},(d,c)=>s+c),g.save(),console.log("Updated cacheZoomLevels:",g.state.userSettings.cacheZoomLevels)}),console.log("cacheZoomLevelsSelect listener attached, initial value:",t.value)):console.warn("cacheZoomLevelsSelect not found in DOM");const a=document.getElementById("recacheNowButton");a?(a.addEventListener("click",s=>{if(s.stopPropagation(),console.log("Recache Now button clicked"),!navigator.onLine){b.handleError("Cannot recache while offline.");return}const{map:r,lastLat:d,lastLng:c,baseMaps:h}=l;if(!r){console.warn("Map not initialized, cannot recache tiles"),b.handleMessage("Map not initialized, cannot recache tiles.");return}Nh({map:r,lastLat:d,lastLng:c,baseMaps:h})}),console.log("recacheNowButton listener attached")):console.warn("recacheNowButton not found in DOM")}function Hf(){console.log("Initializing all UI event listeners..."),Tf(),Ef(),kf(),Pf(),xf(),Af(),Cf(),$f(),If(),Df(),Nf(),Of(),Ff(),Rf(),zf(),Bf(),Uf()}const nn=b.debounce(dt,300),tc=()=>g.getValue("downloadFormat","radio","csv");b.handleMessage=yt;K.Control.Coordinates=K.Control.extend({options:{position:"bottomleft"},onAdd:function(i){var t=K.DomUtil.create("div","leaflet-control-coordinates");return t.style.background="rgba(255, 255, 255, 0.8)",t.style.padding="5px",t.style.borderRadius="4px",t.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",t.innerHTML="Move mouse over map",this._container=t,t},update:function(i){this._container.innerHTML=i}});let gs=new Map,_s=new Map;const nc=b.debounce(async(i,t,a,s)=>{var p,y,v,w;const r=`${i.toFixed(5)},${t.toFixed(5)}`,d=zt(),c=`${r}-${d}`;let h,m;if(gs.has(r))h=gs.get(r);else try{h=await b.getAltitude(i,t),gs.set(r,h)}catch(S){console.warn("Failed to fetch elevation:",S),h="N/A"}if(_s.has(c))m=_s.get(c);else if(l.weatherData&&l.weatherData.surface_pressure&&d>=0&&d<l.weatherData.surface_pressure.length){const S=l.weatherData.surface_pressure[d],E=((p=l.weatherData.temperature_2m)==null?void 0:p[d])||16.1,P=l.lastAltitude!=="N/A"?l.lastAltitude:339;m=b.calculateQFE(S,h,P,E),_s.set(c,m),console.log("Calculated QFE:",{lat:i,lng:t,surfacePressure:S,elevation:h,referenceElevation:P,temperature:E,qfe:m})}else console.warn("Surface pressure not available for QFE:",{hasWeatherData:!!l.weatherData,hasSurfacePressure:!!((y=l.weatherData)!=null&&y.surface_pressure),sliderIndexValid:d>=0&&d<(((w=(v=l.weatherData)==null?void 0:v.surface_pressure)==null?void 0:w.length)||0)}),m="N/A";s({elevation:h,qfe:m},a)},500);function Si(){var $;console.log("Calculating mean wind with model:",document.getElementById("modelSelect").value,"weatherData:",l.weatherData);const i=document.getElementById("timeSlider").value||0,t=Sn(i);let a=parseFloat(document.getElementById("lowerLimit").value)||0,s=parseFloat(document.getElementById("upperLimit").value);const r=(($=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:$.value)||"AGL",d=g.getValue("heightUnit","radio","m"),c=g.getValue("windUnit","radio","kt"),h=Math.round(l.lastAltitude);if(!l.weatherData||l.lastAltitude==="N/A"){handleError("Cannot calculate mean wind: missing data or altitude");return}a=d==="ft"?a/3.28084:a,s=d==="ft"?s/3.28084:s,r==="AMSL"&&a<h&&(b.handleError(`Lower limit adjusted to terrain altitude (${h} m ${r}) as it cannot be below ground level in ${r} mode.`),a=h,document.getElementById("lowerLimit").value=b.convertHeight(a,d));const m=r==="AGL"?a+h:a,p=r==="AGL"?s+h:s;if(isNaN(a)||isNaN(s)||a>=s){b.handleError("Invalid layer limits. Ensure Lower < Upper and both are numbers.");return}if(!t||t.length===0){b.handleError("No valid weather data available to calculate mean wind.");return}const y=t.map(M=>M.height),v=t.map(M=>parseFloat(M.dir)||0),w=t.map(M=>b.convertWind(parseFloat(M.spd)||0,c,"km/h")),S=w.map((M,k)=>-M*Math.sin(v[k]*Math.PI/180)),E=w.map((M,k)=>-M*Math.cos(v[k]*Math.PI/180)),P=b.calculateMeanWind(y,S,E,m,p),[x,A]=P,O=b.roundToTens(x)===0&&x>=0&&x<5?360:b.roundToTens(x),z=Math.round(b.convertHeight(a,d)),I=Math.round(b.convertHeight(s,d));b.convertWind(A,c,"kt");const B=Number.isFinite(A)?c==="bft"?Math.round(A):A.toFixed(1):"N/A",H=`Mean wind (${z}-${I} ${d} ${r}): ${O}° ${B} ${c}`;document.getElementById("meanWindResult").innerHTML=H,console.log("Calculated Mean Wind:",H,"u:",P[2],"v:",P[3])}function Zf(i){var J,Z,ne,V,le,Y;if(!l.weatherData||!l.weatherData.time){b.handleError("No weather data available to download.");return}const t=document.getElementById("timeSlider").value||0,a=document.getElementById("modelSelect").value.toUpperCase(),s=b.formatTime(l.weatherData.time[t]).replace(" ","_"),r=`${s}_${a}_${i}.txt`,d={ATAK:{interpStep:1e3,heightUnit:"ft",refLevel:"AGL",windUnit:"kt"},Windwatch:{interpStep:100,heightUnit:"ft",refLevel:"AGL",windUnit:"km/h"},HEIDIS:{interpStep:100,heightUnit:"m",refLevel:"AGL",temperatureUnit:"C",windUnit:"m/s"},Customized:{}},c={interpStep:Dr(),heightUnit:g.getValue("heightUnit","radio","m"),refLevel:((J=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:J.value)||"AGL",windUnit:g.getValue("windUnit","radio","kt"),temperatureUnit:g.getValue("temperatureUnit","radio","C")};let h={...c};const m=d[i];if(m&&Object.keys(m).length>0){let j=!1;for(const[fe,X]of Object.entries(m))if(h[fe]!==X){switch(j=!0,fe){case"interpStep":document.getElementById("interpStepSelect").value=X,g.state.userSettings.interpStep=X;break;case"heightUnit":document.querySelector(`input[name="heightUnit"][value="${X}"]`).checked=!0,g.state.userSettings.heightUnit=X;break;case"refLevel":document.querySelector(`input[name="refLevel"][value="${X}"]`).checked=!0,g.state.userSettings.refLevel=X;break;case"windUnit":document.querySelector(`input[name="windUnit"][value="${X}"]`).checked=!0,g.state.userSettings.windUnit=X;break;case"temperatureUnit":document.querySelector(`input[name="temperatureUnit"][value="${X}"]`).checked=!0,g.state.userSettings.temperatureUnit=X;break}h[fe]=X}j&&(g.save(),console.log(`Adjusted settings for ${i} compatibility:`,m),g.updateUnitLabels(),g.updateUnitLabels(),g.updateUnitLabels())}let p="",y=" ";const v=g.getValue("heightUnit","radio","m"),w=g.getValue("temperatureUnit","radio","C"),S=g.getValue("windUnit","radio","kt"),E=((Z=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:Z.value)||"AGL";if(i==="ATAK")p=`Alt Dir Spd
${v}${E}
`;else if(i==="Windwatch"){const j=Math.round(v==="ft"?l.lastAltitude*3.28084:l.lastAltitude);p=`Version 1.0, ID = 9999999999
${s}, Ground Level: ${j} ft
Windsond ${a}
 AGL[ft] Wind[°] Speed[km/h]
`}else if(i==="HEIDIS"){const j=E==="AGL"?`h(${v}AGL)`:`h(${v}AMSL)`,fe=w==="C"?"°C":"°F";p=`${j} p(hPa) T(${fe}) Dew(${fe}) Dir(°) Spd(${S}) RH(%)`}else if(i==="Customized"){const j=E==="AGL"?`h(${v}AGL)`:`h(${v}AMSL)`,fe=w==="C"?"°C":"°F";p=`${j} p(hPa) T(${fe}) Dew(${fe}) Dir(°) Spd(${S}) RH(%)`}const P=Math.round(l.lastAltitude),x=E==="AGL"?0:P,A=(ne=l.weatherData.temperature_2m)==null?void 0:ne[t],O=(V=l.weatherData.relative_humidity_2m)==null?void 0:V[t],z=(le=l.weatherData.wind_speed_10m)==null?void 0:le[t],I=(Y=l.weatherData.wind_direction_10m)==null?void 0:Y[t],B=b.calculateDewpoint(A,O),H=l.weatherData.surface_pressure[t],$=Math.round(b.convertHeight(x,v)),M=b.convertTemperature(A,w),k=b.convertTemperature(B,w),D=b.convertWind(z,S,"km/h"),F=M==="N/A"?"N/A":M.toFixed(1),R=k==="N/A"?"N/A":k.toFixed(1),G=D==="N/A"?"N/A":S==="bft"?Math.round(D):D.toFixed(1),ie=I==="N/A"||I===void 0?"N/A":Math.round(I),be=O==="N/A"||O===void 0?"N/A":Math.round(O);i==="ATAK"?p+=`${$}${y}${ie}${y}${G}
`:i==="Windwatch"?p+=`${$}${y}${ie}${y}${G}
`:i==="HEIDIS"?p+=`
${$}${y}${H==="N/A"?"N/A":H.toFixed(1)}${y}${F}${y}${R}${y}${ie}${y}${G}${y}${be}
`:i==="Customized"&&(p+=`
${$}${y}${H==="N/A"?"N/A":H.toFixed(1)}${y}${F}${y}${R}${y}${ie}${y}${G}${y}${be}
`);const te=Sn(t);if(!te||te.length===0){b.handleError("No interpolated data available to download.");return}te.forEach(j=>{if(j.displayHeight!==x){const fe=Math.round(b.convertHeight(j.displayHeight,v)),X=j.pressure==="N/A"?"N/A":j.pressure.toFixed(1),de=b.convertTemperature(j.temp,w),we=b.convertTemperature(j.dew,w),re=b.convertWind(j.spd,S,g.getValue("windUnit","radio","kt")),Le=de==="N/A"?"N/A":de.toFixed(1),Ee=we==="N/A"?"N/A":we.toFixed(1),pe=re==="N/A"?"N/A":S==="bft"?Math.round(re):re.toFixed(1),me=j.dir==="N/A"?"N/A":Math.round(j.dir),ce=j.rh==="N/A"?"N/A":Math.round(j.rh);i==="ATAK"?p+=`${fe}${y}${me}${y}${pe}
`:i==="Windwatch"?p+=`${fe}${y}${me}${y}${pe}
`:i==="HEIDIS"?p+=`${fe}${y}${X}${y}${Le}${y}${Ee}${y}${me}${y}${pe}${y}${ce}
`:i==="Customized"&&(p+=`${fe}${y}${X}${y}${Le}${y}${Ee}${y}${me}${y}${pe}${y}${ce}
`)}});const ae=new Blob([p],{type:"text/plain"}),W=window.URL.createObjectURL(ae),ee=document.createElement("a");ee.href=W,ee.download=r,document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),window.URL.revokeObjectURL(W),document.getElementById("interpStepSelect").value=c.interpStep,document.querySelector(`input[name="heightUnit"][value="${c.heightUnit}"]`).checked=!0,document.querySelector(`input[name="refLevel"][value="${c.refLevel}"]`).checked=!0,document.querySelector(`input[name="windUnit"][value="${c.windUnit}"]`).checked=!0,document.querySelector(`input[name="temperatureUnit"][value="${c.temperatureUnit}"]`).checked=!0,g.state.userSettings.interpStep=c.interpStep,g.state.userSettings.heightUnit=c.heightUnit,g.state.userSettings.refLevel=c.refLevel,g.state.userSettings.windUnit=c.windUnit,g.state.userSettings.temperatureUnit=c.temperatureUnit,g.save(),g.updateUnitLabels(),g.updateUnitLabels(),g.updateUnitLabels()}async function Wf(){if(!l.lastLat||!l.lastLng){console.warn("No location selected, cannot update weather data"),b.handleError("Please select a location to enable autoupdate."),stopAutoupdate(),document.getElementById("autoupdateCheckbox").checked=!1,g.state.userSettings.autoupdate=!1,g.save();return}if(!navigator.onLine){console.warn("Cannot update weather data: offline"),b.handleError("Cannot update weather data while offline."),stopAutoupdate(),document.getElementById("autoupdateCheckbox").checked=!1,g.state.userSettings.autoupdate=!1,g.save();return}const i=document.getElementById("timeSlider");if(!i){console.warn("Time slider not found, cannot update to current hour");return}const a=new Date().getUTCHours();i.value=a,console.log(`Set slider to current hour: ${a}`);try{await Ln(l.lastLat,l.lastLng,null,!1),console.log("Weather data fetched for current hour"),await Ea(a),l.lastAltitude!=="N/A"&&Si(),g.state.userSettings.calculateJump&&g.state.isCalculateJumpUnlocked&&(nn(),Gt(),g.state.userSettings.showJumpRunTrack&&Je()),console.log("Updated all displays for current hour")}catch(s){console.error("Error updating to current hour:",s),b.handleError("Failed to update weather data: "+s.message)}}function dt(){if(!g.state.isCalculateJumpUnlocked||!g.state.userSettings.calculateJump){ca(null),Cs(null);return}if(!l.weatherData||!l.lastLat||!l.lastLng){ca(null);return}const i=zt(),t=Sn(i),a={exitCircles:[],canopyCircles:[],canopyLabels:[]};if(g.state.userSettings.showExitArea){const r=Fr(t);if(r){a.exitCircles.push({center:[r.greenLat,r.greenLng],radius:r.greenRadius,color:"green",fillColor:"green",fillOpacity:.2,weight:2});const d=`
                Exit areas calculated with:<br>
                Throw/Drift: ${Number.isFinite(r.freeFallDirection)?Math.round(r.freeFallDirection):"N/A"}° ${Number.isFinite(r.freeFallDistance)?Math.round(r.freeFallDistance):"N/A"} m<br>
                Free Fall Time: ${r.freeFallTime!=null&&!isNaN(r.freeFallTime)?Math.round(r.freeFallTime):"N/A"} sec
            `;a.exitCircles.push({center:[r.darkGreenLat,r.darkGreenLng],radius:r.darkGreenRadius,color:"darkgreen",fillColor:"darkgreen",fillOpacity:.2,weight:2,tooltip:d})}}if(g.state.userSettings.showCanopyArea){const r=gu(t);if(r){const d=b.calculateNewCenter(r.redLat,r.redLng,r.displacementFull,r.directionFull);a.canopyCircles.push({center:d,radius:r.radiusFull,color:"red",weight:2,opacity:.8,fillOpacity:0}),r.additionalBlueRadii.forEach((c,h)=>{const m=b.calculateNewCenter(r.blueLat,r.blueLng,r.additionalBlueDisplacements[h],r.additionalBlueDirections[h]);a.canopyCircles.push({center:m,radius:c,color:"blue",weight:1,fillColor:"blue",fillOpacity:.1,opacity:1}),a.canopyLabels.push({center:m,radius:c,text:`${Math.round(r.additionalBlueUpperLimits[h])}m`})})}}ca(a);let s=null;if(g.state.userSettings.showCutAwayFinder&&l.cutAwayLat!==null){const r=Gt(t);r&&(s={center:r.center,radius:r.radius,tooltipContent:r.tooltipContent})}Cs(s)}function Gf(){return!g.state.userSettings.showJumpRunTrack||!g.state.userSettings.calculateJump||!l.weatherData||!l.lastLat||!l.lastLng?(console.log("Skipping calculateJumpRunTrack: conditions not met"),null):(console.log("Calculating jump run track..."),Je(),ya())}function Vf(i,t,a){const s=parseInt(i.value)||100,r=parseInt(t.value)||200,d=parseInt(a.value)||300;return r<=s?(b.handleError("Base leg must start higher than final leg."),!1):d<=r?(b.handleError("Downwind leg must start higher than base leg."),!1):!0}function Vt(i=null){const t=g.state.userSettings.showJumpMasterLine;if(!t){Pr(),of();return}if(!l.liveMarker){Pr();return}const a=l.liveMarker.getLatLng();if(!a)return;const s=i||{latitude:a.lat,longitude:a.lng,speedMs:l.lastSmoothedSpeedMs,direction:l.lastDirection,deviceAltitude:l.lastDeviceAltitude,altitudeAccuracy:l.lastAltitudeAccuracy,accuracy:l.lastAccuracy};let r=null,d=null,c="";if(g.state.userSettings.jumpMasterLineTarget==="HARP"&&l.harpMarker?(d=l.harpMarker.getLatLng(),c="HARP"):l.currentMarker&&(d=l.currentMarker.getLatLng(),c="DIP"),d){const m=l.map.distance(a,d),p=Math.round(b.calculateBearing(a.lat,a.lng,d.lat,d.lng)),y=s.speedMs>1?s.speedMs:1,v=Math.round(m/y);r={distance:m,bearing:p,tot:v,target:c},sf(a,d)}const h={heightUnit:g.getValue("heightUnit","radio","m"),effectiveWindUnit:g.getValue("windUnit","radio","kt")==="bft"?"kt":g.getValue("windUnit","radio","kt"),coordFormat:g.getValue("coordFormat","radio","Decimal"),refLevel:g.getValue("refLevel","radio","AGL")};rf({...s,showJumpMasterLine:t,jumpMasterLineData:r,...h})}function jf(){if(g.initialize(),g.state.isLandingPatternUnlocked=g.state.unlockedFeatures.landingPattern,g.state.isCalculateJumpUnlocked=g.state.unlockedFeatures.calculateJump,g.state.userSettings.showJumpMasterLine=!1,console.log("Initial unlock status:",{isLandingPatternUnlocked:g.state.isLandingPatternUnlocked,isCalculateJumpUnlocked:g.state.isCalculateJumpUnlocked}),l.isInitialized){console.log("App already initialized, skipping");return}l.isInitialized=!0,console.log("Initializing app")}function Jf(){qf("modelSelect",g.state.userSettings.model),en("refLevel",g.state.userSettings.refLevel),en("heightUnit",g.state.userSettings.heightUnit),en("temperatureUnit",g.state.userSettings.temperatureUnit),en("windUnit",g.state.userSettings.windUnit),en("timeZone",g.state.userSettings.timeZone),en("coordFormat",g.state.userSettings.coordFormat),en("downloadFormat",g.state.userSettings.downloadFormat),en("landingDirection",g.state.userSettings.landingDirection),Oe("canopySpeed",g.state.userSettings.canopySpeed),Oe("descentRate",g.state.userSettings.descentRate),Oe("legHeightDownwind",g.state.userSettings.legHeightDownwind),Oe("legHeightBase",g.state.userSettings.legHeightBase),Oe("legHeightFinal",g.state.userSettings.legHeightFinal),Oe("customLandingDirectionLL",g.state.userSettings.customLandingDirectionLL),Oe("customLandingDirectionRR",g.state.userSettings.customLandingDirectionRR),Oe("lowerLimit",g.state.userSettings.lowerLimit),Oe("upperLimit",g.state.userSettings.upperLimit),Oe("openingAltitude",g.state.userSettings.openingAltitude),Oe("exitAltitude",g.state.userSettings.exitAltitude),Oe("interpStepSelect",g.state.userSettings.interpStep),Oe("aircraftSpeedKt",g.state.userSettings.aircraftSpeedKt),Oe("jumpRunTrackOffset",g.state.userSettings.jumpRunTrackOffset),Oe("numberOfJumpers",g.state.userSettings.numberOfJumpers),$n("showTableCheckbox",g.state.userSettings.showTable),$n("calculateJumpCheckbox",g.state.userSettings.calculateJump),$n("showLandingPattern",g.state.userSettings.showLandingPattern),$n("showJumpRunTrack",g.state.userSettings.showJumpRunTrack),$n("showCanopyAreaCheckbox",g.state.userSettings.showCanopyArea),$n("showExitAreaCheckbox",g.state.userSettings.showExitArea),g.state.userSettings.isCustomJumpRunDirection=g.state.userSettings.isCustomJumpRunDirection||!1;const i=document.getElementById("customLandingDirectionLL"),t=document.getElementById("customLandingDirectionRR");i&&g.state.userSettings.customLandingDirectionLL!==""&&!isNaN(g.state.userSettings.customLandingDirectionLL)&&(i.value=g.state.userSettings.customLandingDirectionLL),t&&g.state.userSettings.customLandingDirectionRR!==""&&!isNaN(g.state.userSettings.customLandingDirectionRR)&&(t.value=g.state.userSettings.customLandingDirectionRR);const a=Nr(g.state.userSettings.aircraftSpeedKt);Oe("jumperSeparation",a),g.state.userSettings.jumperSeparation=a,g.save();const s=document.getElementById("showLandingPattern"),r=document.getElementById("calculateJumpCheckbox");s&&(s.title=g.isFeatureUnlocked("landingPattern")&&g.state.isLandingPatternUnlocked?"":"Feature locked. Click to enter password.",s.style.opacity=g.isFeatureUnlocked("landingPattern")&&g.state.isLandingPatternUnlocked?"1":"0.5",console.log("Initialized showLandingPattern UI:",{checked:s.checked,opacity:s.style.opacity})),r&&(r.title=g.isFeatureUnlocked("calculateJump")&&g.state.isCalculateJumpUnlocked?"":"Feature locked. Click to enter password.",r.style.opacity=g.isFeatureUnlocked("calculateJump")&&g.state.isCalculateJumpUnlocked?"1":"0.5",console.log("Initialized calculateJumpCheckbox UI:",{checked:r.checked,opacity:r.style.opacity}));const d=document.getElementById("showJumpMasterLine");d&&(d.disabled=!g.state.userSettings.trackPosition,d.style.opacity=d.disabled?"0.5":"1",d.title=d.disabled?"Enable Live Tracking to use Jump Master Line":"");const c=document.getElementById("jumpRunTrackDirection");c&&(c.textContent="-"),ic()}function ic(){const i=document.getElementById("info");i&&(i.style.display=g.state.userSettings.showTable?"block":"none");const t=document.getElementById("customLandingDirectionLL"),a=document.getElementById("customLandingDirectionRR"),s=document.getElementById("showJumpRunTrack"),r=document.getElementById("showExitAreaCheckbox");t&&(t.disabled=g.state.userSettings.landingDirection!=="LL"),a&&(a.disabled=g.state.userSettings.landingDirection!=="RR"),s&&(s.disabled=!g.state.userSettings.calculateJump),r&&(r.disabled=!g.state.userSettings.calculateJump),g.updateUnitLabels()}async function ac(i){l.weatherData=i;const t=document.getElementById("timeSlider");if(!t)return;const s=(h=>{const m=h==null?void 0:h.temperature_2m;if(!m||m.length===0)return 0;for(let p=m.length-1;p>=0;p--)if(m[p]!==null&&m[p]!==void 0)return p;return 0})(i);console.log(`Daten sind gültig bis Index: ${s}. Setze Slider-Maximum.`),t.max=s,t.disabled=t.max<=0;const r=new Date().getTime();let d=0,c=1/0;i.time.forEach((h,m)=>{if(m<=s){const p=Math.abs(new Date(h).getTime()-r);p<c&&(c=p,d=m)}}),t.value=d,await lt(),g.updateModelRunInfo(l.lastModelRun,l.lastLat,l.lastLng)}async function lt(){console.log("updateAllDisplays called");try{const i=zt();l.weatherData&&l.lastLat&&l.lastLng&&(await Ea(i),await Ta(),l.lastAltitude!=="N/A"&&Si(),on(),g.state.userSettings.calculateJump&&dt(),g.state.userSettings.showJumpRunTrack&&Je())}catch(i){console.error("Error in updateAllDisplays:",i),Gn(i.message)}}function $n(i,t){const a=document.getElementById(i);a&&(a.checked=t)}function qf(i,t){const a=document.getElementById(i);a?a.value=t:console.warn(`Element ${i} not found`)}function Oe(i,t){const a=document.getElementById(i);a&&(a.value=t)}function Cr(i,t){const a=document.getElementById(i);if(a){const s=a.value;a.value=t,console.log(`Set ${i} silently:`,{old:s,new:t})}}function en(i,t){const a=document.querySelector(`input[name="${i}"][value="${t}"]`);a?a.checked=!0:console.warn(`Radio ${i} with value ${t} not found`)}function Kf(){console.log("[App] Setting up application event listeners..."),document.addEventListener("tracking:started",()=>{const i=document.getElementById("showJumpMasterLine");i&&(i.disabled=!1,i.style.opacity="1",i.title="")}),document.addEventListener("tracking:stopped",()=>{const i=document.getElementById("showJumpMasterLine");i&&(i.checked=!1,i.disabled=!0,i.style.opacity="0.5",i.title="Enable Live Tracking to use Jump Master Line"),g.state.userSettings.showJumpMasterLine&&(g.state.userSettings.showJumpMasterLine=!1,g.save()),Vt()}),document.addEventListener("ui:showJumpMasterLineChanged",()=>{Vt()}),document.addEventListener("jml:targetChanged",()=>{Vt()}),document.addEventListener("tracking:positionUpdated",i=>{Vt(i.detail)})}document.addEventListener("DOMContentLoaded",async()=>{jf(),Jf(),await Oh(),Kf(),Mf(),Hf(),Jl(),document.addEventListener("cutaway:marker_placed",()=>{console.log("App: Event 'cutaway:marker_placed' empfangen. Neuberechnung wird ausgelöst."),l.weatherData&&l.lastLat&&l.lastLng&&dt()}),document.addEventListener("track:dragend",i=>{console.log("App: Event 'track:dragend' empfangen. Neuberechnung der Offsets relativ zum DIP.");const{newPosition:t,originalTrackData:a}=i.detail,s=K.latLng(l.lastLat,l.lastLng),r=a.trackLength,d=a.airplane.bearing,c=t,[h,m]=b.calculateNewCenter(c.lat,c.lng,r/2,(d+180)%360),p=K.latLng(h,m),y=l.map.distance(s,p);let w=b.calculateBearing(s.lat,s.lng,p.lat,p.lng)-d;w=(w+180)%360-180;const S=w*(Math.PI/180),E=Math.round(y*Math.cos(S)),P=Math.round(y*Math.sin(S));g.state.userSettings.jumpRunTrackOffset=P,g.state.userSettings.jumpRunTrackForwardOffset=E,g.save(),Cr("jumpRunTrackOffset",P),Cr("jumpRunTrackForwardOffset",E),Je()}),document.addEventListener("location:selected",async i=>{var d,c;const{lat:t,lng:a,source:s}=i.detail;console.log(`App: Event 'location:selected' empfangen. Quelle: ${s}`);const r=document.getElementById("loading");r&&(r.style.display="block");try{const h=zt(),m=((c=(d=l.weatherData)==null?void 0:d.time)==null?void 0:c[h])||null,p=await Ln(t,a,m);p?await ac(p):l.weatherData=null,await Ma(t,a),await Ta(),Vn(!0),l.isManualPanning=!1,g.state.userSettings.showJumpMasterLine&&Vt()}catch(h){console.error('Fehler beim Verarbeiten von "location:selected":',h),Gn(h.message)}finally{r&&(r.style.display="none")}}),document.addEventListener("map:zoomend",i=>{console.log("App: Event 'map:zoomend' empfangen.");const t=l.map.getZoom();g.state.userSettings.calculateJump&&l.weatherData&&l.lastLat&&(t>=wt.MIN_ZOOM&&t<=wt.MAX_ZOOM?dt():ca(null)),g.state.userSettings.showJumpRunTrack&&(t>=wt.MIN_ZOOM&&t<=wt.MAX_ZOOM?Je():ua(null)),g.state.userSettings.showLandingPattern&&on()}),document.addEventListener("autoupdate:tick",async i=>{if(!g.state.userSettings.autoupdate)return;const t=new Date,a=document.getElementById("timeSlider");if(!a)return;const s=t.getUTCHours(),r=parseInt(a.value,10);(s!==r||i.detail.isInitialTick)&&(console.log(`[App] Autoupdate triggered. Current Hour: ${s}, Slider Hour: ${r}`),await Wf())})});
