var gu=Object.defineProperty;var _u=(n,e,o)=>e in n?gu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var js=(n,e,o)=>_u(n,typeof e!="symbol"?e+"":e,o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const u={isInitialized:!1,coordsControl:null,lastMouseLatLng:null,landingWindDir:null,cutAwayMarker:null,cutAwayLat:null,cutAwayLng:null,cutAwayCircle:null,isJumperSeparationManual:!1,weatherData:null,lastModelRun:null,gpxLayer:null,gpxPoints:[],isLoadingGpx:!1,isTrackLoaded:!1,liveMarker:null,jumpMasterLine:null,isPlacingHarp:!1,harpMarker:null,watchId:null,prevLat:null,prevLng:null,prevTime:null,livePositionControl:null,lastLatitude:null,lastLongitude:null,lastDeviceAltitude:null,lastAltitudeAccuracy:null,lastAccuracy:null,lastSpeed:"N/A",lastEffectiveWindUnit:"kt",lastDirection:"N/A",lastTerrainAltitude:"N/A",lastSmoothedSpeedMs:0,map:null,baseMaps:{},lastLat:null,lastLng:null,lastAltitude:null,currentMarker:null,isManualPanning:!1,autoupdateInterval:null,accuracyCircle:null,ensembleModelsData:null,selectedEnsembleModels:[],currentEnsembleScenario:"all_models",ensembleLayerGroup:null,ensembleScenarioCircles:{},heatmapLayer:null,ismapInitialized:!1,hasTileErrorSwitched:!1,isCachingCancelled:!1,jumpVisualizationLayerGroup:null,landingPatternLayerGroup:null,jumpRunTrackLayerGroup:null,labelZoomListener:null},yu="skydiver2025",qs={135:5,130:5,125:5,120:5,115:5,110:5,105:5,100:6,95:7,90:7,85:7,80:8,75:8,70:9,65:10,60:10,55:11,50:12,45:14,40:15,35:17,30:20,25:24,20:30,15:40,10:60,5:119},Fr={LIST:["icon_seamless","icon_global","icon_eu","icon_d2","ecmwf_ifs025","ecmwf_aifs025_single","gfs_seamless","gfs_global","gfs_hrrr","arome_france","gem_hrdps_continental","gem_regional"],API_MAP:{icon_seamless:"dwd_icon",icon_global:"dwd_icon",icon_eu:"dwd_icon_eu",icon_d2:"dwd_icon_d2",ecmwf_ifs025:"ecmwf_ifs025",ecmwf_aifs025_single:"ecmwf_aifs025_single",gfs_seamless:"ncep_gfs013",gfs_global:"ncep_gfs025",gfs_hrrr:"ncep_hrrr_conus",arome_france:"meteofrance_arome_france0025",gem_hrdps_continental:"cmc_gem_hrdps",gem_regional:"cmc_gem_rdps"}},zt={METERS_TO_FEET:3.28084,FEET_TO_METERS:.3048,KNOTS_TO_MPS:.514444,KNOTS_TO_KMH:1.852,CELSIUS_TO_KELVIN:273.15},Ks={MOLAR_MASS_AIR:.0289644,UNIVERSAL_GAS_CONSTANT:8.31446261815324},an={LAPSE_RATE:.0065,SEA_LEVEL_TEMP_KELVIN:288.15,GRAVITY:9.80665,GAS_CONSTANT_AIR:287.05},Xi={A_LIQUID:17.27,B_LIQUID:237.7,A_ICE:21.87,B_ICE:265.5},vu=6371e3,Ys={KNOT_THRESHOLDS:[1,4,7,11,17,22,28,34,41,48,56,64],BEAUFORT_THRESHOLDS:[0,1,3,6,10,16,21,27,33,40,47,55,63]},ci={FORECAST:"https://api.open-meteo.com/v1/forecast",HISTORICAL:"https://historical-forecast-api.open-meteo.com/v1/forecast"},re={SCENARIO_COLORS:{MIN_WIND:"rgba(0, 0, 255, 0.7)",MEAN_WIND:"rgba(0, 255, 0, 0.7)",MAX_WIND:"rgba(255, 0, 0, 0.7)"},HEATMAP_MIN_RADIUS_PX:5,HEATMAP_MAX_RADIUS_PX:50,HEATMAP_SCALING_BASE:1.42,HEATMAP_BASE_RADIUS:20,HEATMAP_REFERENCE_ZOOM:13},wu=[1e3,950,925,900,850,800,700,600,500,400,300,250,200],Me=200,ia={OPEN:4.1,PARTIALLY:12.8,COLLAPSED:39.2},Lu=150,Qi={DEFAULT_AREA_VERTICAL:.5,DEFAULT_AREA_HORIZONTAL:.5,DEFAULT_MASS_KG:80,DEFAULT_DRAG_COEFFICIENT:1},bn={MIN_TRACK_LENGTH_M:100,MAX_TRACK_LENGTH_M:1e4,MIN_APPROACH_LENGTH_M:100,MAX_APPROACH_LENGTH_M:2e4,APPROACH_TIME_SECONDS:120},le={MESSAGE_TIMEOUT_MS:3e3,MOBILE_BREAKPOINT_PX:768,DEFAULT_MAP_CENTER:[48.0179,11.1923],DEFAULT_MAP_ZOOM:11,GEOLOCATION_TIMEOUT_MS:2e4,GEOLOCATION_ACCURACY_THRESHOLD_M:100,MIN_ZOOM:11,MAX_ZOOM:14,LANDING_PATTERN_MIN_ZOOM:14},to={MIN_TIME_DIFF_FOR_SPEED_CALC_S:.5,SPEED_SMOOTHING_LOW:.5,SPEED_SMOOTHING_HIGH:.2,SPEED_SMOOTHING_TRESHOLD:25},mi={TILE_MAX_AGE_DAYS:7,FETCH_TIMEOUT_MS:15e3,SIZE_LIMIT_MB_WARNING:500},Ra={DEFAULT_MARKER:"favicon.ico",CUTAWAY_MARKER:"schere_purple.png",AIRPLANE_MARKER:"airplane_orange.png"},Rr=()=>_.getValue("interpStepSelect","select",200),_={FEATURE_PASSWORD:"skydiver2025",defaultSettings:{model:"icon_global",refLevel:"AGL",heightUnit:"m",temperatureUnit:"C",windUnit:"kt",timeZone:"Z",coordFormat:"Decimal",downloadFormat:"HEIDIS",showTable:!1,canopySpeed:20,descentRate:3.5,showLandingPattern:!1,landingDirection:"LL",customLandingDirectionLL:"",customLandingDirectionRR:"",legHeightDownwind:300,legHeightBase:200,legHeightFinal:100,interpStep:"200",lowerLimit:0,upperLimit:3e3,baseMaps:"Esri Street",calculateJump:!0,openingAltitude:1200,exitAltitude:3e3,showJumpRunTrack:!1,showExitArea:!1,showCanopyArea:!1,jumpRunTrackOffset:0,jumpRunTrackForwardOffset:0,aircraftSpeedKt:90,jumperSeparation:5,numberOfJumpers:5,cutAwayAltitude:1e3,cutAwayState:"Partially",trackPosition:!1,showJumpMasterLine:!1,jumpMasterLineTarget:"DIP",harpLat:null,harpLng:null,cacheRadiusKm:10,cacheZoomLevels:[11,12,13,14],autoupdate:!1,selectedEnsembleModels:[],currentEnsembleScenario:"all_models"},state:{userSettings:null,unlockedFeatures:{landingPattern:!1,calculateJump:!1},isJumperSeparationManual:!1,isLandingPatternUnlocked:!1,isCalculateJumpUnlocked:!1},initialize(){let n={},e={landingPattern:!1,calculateJump:!1};try{const a=localStorage.getItem("upperWindsSettings");a?(n=JSON.parse(a),console.log("Loaded settings from localStorage:",n)):console.log("No settings found in localStorage, using defaults")}catch(a){this.handleError(a,"Failed to load settings. Using defaults.")}try{const a=localStorage.getItem("unlockedFeatures");a?(e=JSON.parse(a),console.log("Loaded unlocked features from localStorage:",e)):console.log("No unlocked features found in localStorage, using defaults")}catch(a){this.handleError(a,"Failed to load unlocked features. Using defaults.")}this.state.userSettings={...this.defaultSettings,...n},console.log("Initialized userSettings:",this.state.userSettings),this.state.userSettings.harpLat=null,this.state.userSettings.harpLng=null,console.log("Reset HARP coordinates to null at startup"),this.state.userSettings.jumpMasterLineTarget==="HARP"&&(console.log("Reset jumpMasterLineTarget to DIP due to cleared HARP coordinates"),this.state.userSettings.jumpMasterLineTarget="DIP"),this.state.userSettings.selectedEnsembleModels=[...this.defaultSettings.selectedEnsembleModels],this.state.userSettings.currentEnsembleScenario=this.defaultSettings.currentEnsembleScenario,this.state.unlockedFeatures={landingPattern:e.landingPattern||!1,calculateJump:e.calculateJump||!1},["OpenStreetMap","OpenTopoMap","Esri Satellite","Esri Street","Esri Topo","Esri Satellite + OSM"].includes(this.state.userSettings.baseMaps)||(console.warn(`Invalid baseMaps setting: ${this.state.userSettings.baseMaps}, resetting to default`),this.state.userSettings.baseMaps=this.defaultSettings.baseMaps)},save(){const n={...this.state.userSettings};delete n.customJumpRunDirection;try{localStorage.setItem("upperWindsSettings",JSON.stringify(n)),console.log("Settings saved to localStorage:",n)}catch(e){console.error("Failed to save settings to localStorage:",e)}},saveUnlockStatus(n,e){try{n==="landingPattern"?(this.state.unlockedFeatures.landingPattern=e,this.state.isLandingPatternUnlocked=e):n==="calculateJump"&&(this.state.unlockedFeatures.calculateJump=e,this.state.isCalculateJumpUnlocked=e),this.saveUnlockedFeatures(),console.log("Saved unlock status:",{landingPattern:this.state.isLandingPatternUnlocked,calculateJump:this.state.isCalculateJumpUnlocked})}catch{Utils.handleError("Failed to save unlock status.")}},showPasswordModal(n,e,o){console.log("Entering showPasswordModal for feature:",n);const a=document.getElementById("passwordModal"),r=document.getElementById("passwordInput"),c=document.getElementById("passwordError"),l=document.getElementById("passwordSubmit"),d=document.getElementById("passwordCancel"),f=document.getElementById("modalHeader"),p=document.getElementById("modalMessage");if(!a||!r||!l||!d||!f||!p){console.error("Modal elements not found:",{modal:a,input:r,submitBtn:l,cancelBtn:d,header:f,message:p});return}const g=n==="landingPattern"?"Landing Pattern":"Calculate Jump";f.textContent=`${g} Access`,p.textContent=`Please enter the password to enable ${g.toLowerCase()}:`,r.value="",c.style.display="none",a.style.display="flex",console.log("Password modal should now be visible:",{modalDisplay:a.style.display});const y=()=>{if(console.log("Password modal submit clicked, entered value:",r.value),r.value===yu){if(a.style.display="none",this.saveUnlockStatus(n,!0),n==="landingPattern"){const v=document.getElementById("showLandingPattern");v&&(v.style.opacity="1",v.title="")}else if(n==="calculateJump"){const v=document.querySelector('.menu-label[data-label="calculateJump"]');v&&(v.style.opacity="1",v.title="")}console.log("Feature unlocked:",n),e()}else c.textContent="Incorrect password",c.style.display="block",console.log("Incorrect password entered")};l.onclick=y,r.onkeypress=v=>{v.key==="Enter"&&y()},d.onclick=()=>{a.style.display="none",console.log("Password modal cancelled"),o()}},saveUnlockedFeatures(){try{const n=JSON.stringify(this.state.unlockedFeatures);localStorage.setItem("unlockedFeatures",n),console.log("Unlocked features saved:",JSON.parse(n))}catch(n){this.handleError(n,"Failed to save unlocked features to localStorage.")}},getValue(n,e="radio",o){const a=e==="radio"?`input[name="${n}"]:checked`:`#${n}`,r=document.querySelector(a);if(!r)return console.warn(`Setting element not found: ${a}`),o;const c=r.value;return console.log(`Retrieved setting ${n}: ${c}`),c},updateUnitLabels(){const n=this.getValue("heightUnit","radio","m"),e=this.getValue("windUnit","radio","kt"),o=this.getValue("refLevel","radio","AGL"),a=document.querySelector('#controls-row label[for="interpStepSelect"]');a&&(a.textContent=`Step (${n}):`,console.log(`Updated step label to: Step (${n})`));const r=document.querySelector('label[for="lowerLimit"]'),c=document.querySelector('label[for="upperLimit"]');r&&(r.textContent=`Lower Limit (${n}):`,console.log(`Updated lower limit label to: Lower Limit (${n})`)),c&&(c.textContent=`Upper Limit (${n}):`,console.log(`Updated upper limit label to: Upper Limit (${n})`));const l=document.getElementById("meanWindResult");if(l!=null&&l.innerHTML){let d=l.innerHTML;const f=/\((\d+)-(\d+) m\b[^)]*\)/;if(f.test(d)){const[g,y,v]=d.match(f),M=this.convertHeight(parseFloat(y),n),b=this.convertHeight(parseFloat(v),n);d=d.replace(f,`(${Math.round(M)}-${Math.round(b)} ${n} ${o})`),console.log(`Updated mean wind height: (${Math.round(M)}-${Math.round(b)} ${n} ${o})`)}const p=/: (\d+(?:\.\d+)?)\s*([a-zA-Z\/]+)$/;if(p.test(d)){const[g,y,v]=d.match(p),M=parseFloat(y);if(!isNaN(M)){const b=this.convertWind(M,e,v),S=b==="N/A"?"N/A":e==="bft"?Math.round(b):b.toFixed(1);d=d.replace(p,`: ${S} ${e}`),console.log(`Updated mean wind speed: ${S} ${e}`)}}l.innerHTML=d}},updateModelRunInfo(n,e,o){const a=document.getElementById("modelLabel"),r=document.getElementById("modelSelect");if(!a||!r){console.warn("Model run info elements missing:",{modelLabel:a,modelSelect:r,lastModelRun:n,lastLat:e,lastLng:o});return}if(!n){console.log("lastModelRun is falsy, setting default model run info:",{lastModelRun:n,lastLat:e,lastLng:o}),a.title=`Model: ${r.value.replace("_"," ").toUpperCase()}
Run: Not available`;return}const c=r.value,l=`Model: ${c.replace("_"," ").toUpperCase()}
Run: ${n}`;a.title=l,console.log(`Updated model run info: ${l}`,{lastModelRun:n,model:c,lastLat:e,lastLng:o})},handleError(n,e="An error occurred. Please try again."){console.error("Settings Error:",n),Utils.handleError(e)},convertHeight(n,e){return isNaN(n)?n:e==="ft"?n*3.28084:n},convertWind(n,e,o){var r,c;return isNaN(n)?"N/A":((c=(r={kt:{"m/s":l=>l*.514444,"km/h":l=>l*1.852,mph:l=>l*1.15078,bft:l=>this.ktToBeaufort(l)},"m/s":{kt:l=>l/.514444,"km/h":l=>l*3.6,mph:l=>l*2.23694,bft:l=>this.ktToBeaufort(l/.514444)}}[o])==null?void 0:r[e])==null?void 0:c.call(r,n))||n},ktToBeaufort(n){return n<1?0:n<=3?1:n<=6?2:n<=10?3:n<=16?4:n<=21?5:n<=27?6:n<=33?7:n<=40?8:n<=47?9:n<=55?10:n<=63?11:12},isFeatureUnlocked(n){return!!this.state.unlockedFeatures[n]}};function zr(n){const e=_.state.userSettings.exitAltitude*zt.METERS_TO_FEET,o=T.calculateTAS(n,e);if(o==="N/A")return console.warn("TAS calculation failed, using default separation"),_.defaultSettings.jumperSeparation;const a=Object.keys(qs).map(Number).sort((l,d)=>d-l);let r=a[0];for(const l of a)if(o<=l)r=l;else break;return qs[r]||7}function $r(n,e,o,a,r,c,l){if(!n||!n.time||!a||a.length===0||!Number.isFinite(r)||!Number.isFinite(c)||!Number.isFinite(l))return null;const d=l+e,f=l+o-Me,p=yo(a),g=p?p.direction:0,y=_.state.userSettings.aircraftSpeedKt,v=e/.3048,M=T.calculateTAS(y,v);let b=M==="N/A"?y*zt.KNOTS_TO_MPS:M*zt.KNOTS_TO_MPS;const S=Math.cos(g*Math.PI/180)*b,k=Math.sin(g*Math.PI/180)*b,E=a.map(z=>z.height),C=a.map(z=>Number.isFinite(z.dir)?parseFloat(z.dir):0),I=a.map(z=>T.convertWind(parseFloat(z.spd)||0,"m/s","km/h")),x=a.map(z=>z.temp),N=[{time:0,height:d,vz:0,vxGround:S,vyGround:k,x:0,y:0}],R=n.surface_pressure[0]||1013.25;let F=N[0];for(;F.height>f;){const z=T.linearInterpolate(E,C,F.height),B=T.linearInterpolate(E,I,F.height),nt=T.linearInterpolate(E,x,F.height)+zt.CELSIUS_TO_KELVIN,wt=an.GAS_CONSTANT_AIR,q=.5,Lt=R*100*Math.exp(-9.80665*(F.height-l)/(wt*nt))/(wt*nt),H=(z+180)%360,vt=B*Math.cos(H*Math.PI/180),V=B*Math.sin(H*Math.PI/180),tt=F.vxGround-vt,pt=F.vyGround-V,gt=Math.sqrt(tt*tt+pt*pt),mt=1,X=Qi.DEFAULT_AREA_VERTICAL,W=Qi.DEFAULT_MASS_KG,ht=Qi.DEFAULT_DRAG_COEFFICIENT,rt=Qi.DEFAULT_AREA_HORIZONTAL,Ft=.5*mt*X*Lt/W,Zt=.5*ht*rt*Lt/W,Rt=-9.80665-Ft*F.vz*Math.abs(F.vz),qt=-Zt*gt*tt,Kt=-Zt*gt*pt;let At=F.height+F.vz*q,Ht=F.vz+Rt*q,he=F.time+q;if(At<=f){const Pe=(F.height-f)/(F.height-At);he=F.time+q*Pe,At=f,Ht=F.vz+Rt*q*Pe}const Se={time:he,height:At,vz:Ht,vxGround:S===0?vt:F.vxGround+qt*q,vyGround:k===0?V:F.vyGround+Kt*q,x:F.x+(S===0?vt:F.vxGround)*q,y:F.y+(k===0?V:F.vyGround)*q};if(N.push(Se),F=Se,Se.height===f)break}const $=N[N.length-1],G=Math.sqrt($.x*$.x+$.y*$.y);let K=Math.atan2($.y,$.x)*180/Math.PI;return K=(K+360)%360,{time:$.time,distance:G,directionDeg:K,path:N.map(z=>({latLng:T.calculateNewCenter(r,c,Math.sqrt(z.x*z.x+z.y*z.y),Math.atan2(z.y,z.x)*180/Math.PI),height:z.height,time:z.time}))}}function Br(n){var G,K,z,B,Y;if(!_.state.userSettings.showExitArea||!_.state.userSettings.calculateJump||!u.weatherData||!u.lastLat||!u.lastLng||!n||n.length===0)return null;const e=parseInt((G=document.getElementById("exitAltitude"))==null?void 0:G.value)||3e3,o=parseInt((K=document.getElementById("openingAltitude"))==null?void 0:K.value)||1200,a=parseInt((z=document.getElementById("legHeightDownwind"))==null?void 0:z.value)||300,r=parseFloat((B=document.getElementById("descentRate"))==null?void 0:B.value)||3.5,c=(parseFloat((Y=document.getElementById("canopySpeed"))==null?void 0:Y.value)||20)*zt.KNOTS_TO_MPS,l=n.map(nt=>nt.height),d=n.map(nt=>-T.convertWind(nt.spd,"m/s","km/h")*Math.sin(nt.dir*Math.PI/180)),f=n.map(nt=>-T.convertWind(nt.spd,"m/s","km/h")*Math.cos(nt.dir*Math.PI/180)),p=Math.round(u.lastAltitude),g=(o-Me-a)/r,y=g*c,v=(o-Me)/r,M=v*c,b=T.calculateMeanWind(l,d,f,p+a,p+o-Me),S=T.calculateMeanWind(l,d,f,p,p+o-Me),k=Ur(u.lastLat,u.lastLng,n);let{downwindLat:E,downwindLng:C}=k;Number.isFinite(E)||(E=u.lastLat,C=u.lastLng);const I=T.calculateNewCenter(E,C,b[1]*g,b[0]),x=T.calculateNewCenter(u.lastLat,u.lastLng,S[1]*v,S[0]),N=$r(u.weatherData,e,o,n,u.lastLat,u.lastLng,p);if(!N)return null;const R=(N.directionDeg+180)%360,F=T.calculateNewCenter(x[0],x[1],N.distance,R),$=T.calculateNewCenter(I[0],I[1],N.distance,R);return{greenLat:F[0],greenLng:F[1],darkGreenLat:$[0],darkGreenLng:$[1],greenRadius:M,darkGreenRadius:y,freeFallDirection:N.directionDeg,freeFallDistance:N.distance,freeFallTime:N.time}}function De(n){if(!u.map||u.cutAwayLat===null||u.cutAwayLng===null||!u.weatherData||u.lastAltitude==="N/A"||!n||n.length===0)return null;const e=Math.round(u.lastAltitude),o=_.state.userSettings.cutAwayAltitude,a=e,r=e+o,c=n.map(x=>x.height),l=n.map(x=>-T.convertWind(x.spd,"m/s","km/h")*Math.sin(x.dir*Math.PI/180)),d=n.map(x=>-T.convertWind(x.spd,"m/s","km/h")*Math.cos(x.dir*Math.PI/180)),f=T.calculateMeanWind(c,l,d,a,r);if(!f)return null;const[p,g]=f,y={Open:ia.OPEN,Partially:ia.PARTIALLY,Collapsed:ia.COLLAPSED},v=y[_.state.userSettings.cutAwayState]||y.Partially,M=o/v,b=g*M,S=(p+180)%360,[k,E]=T.calculateNewCenter(u.cutAwayLat,u.cutAwayLng,b,S),I=`<b>Cut-Away (${_.state.userSettings.cutAwayState.replace(/([A-Z])/g," $1").trim()})</b><br>Cut-Away Altitude: ${o} m<br>Displacement: ${p.toFixed(0)}°, ${b.toFixed(0)} m<br>Descent Time/Speed: ${M.toFixed(0)} s at ${v.toFixed(1)} m/s<br>`;return{center:[k,E],radius:Lu,tooltipContent:I}}function Mu(n){var z,B,Y,nt,wt;if(!_.state.userSettings.showCanopyArea||!_.state.userSettings.calculateJump||!u.weatherData||!u.lastLat||!u.lastLng||!n||n.length===0)return null;const e=parseInt((z=document.getElementById("exitAltitude"))==null?void 0:z.value)||3e3,o=parseInt((B=document.getElementById("openingAltitude"))==null?void 0:B.value)||1200,a=parseInt((Y=document.getElementById("legHeightDownwind"))==null?void 0:Y.value)||300,r=parseFloat((nt=document.getElementById("descentRate"))==null?void 0:nt.value)||3.5,c=(parseFloat((wt=document.getElementById("canopySpeed"))==null?void 0:wt.value)||20)*zt.KNOTS_TO_MPS,l=n.map(q=>q.height),d=n.map(q=>-T.convertWind(q.spd,"m/s","km/h")*Math.sin(q.dir*Math.PI/180)),f=n.map(q=>-T.convertWind(q.spd,"m/s","km/h")*Math.cos(q.dir*Math.PI/180)),p=Math.round(u.lastAltitude),g=(o-Me-a)/r,y=g*c,v=(o-Me)/r,M=v*c,b=T.calculateMeanWind(l,d,f,p+a,p+o-Me),S=T.calculateMeanWind(l,d,f,p,p+o-Me),k=$r(u.weatherData,e,o,n,u.lastLat,u.lastLng,p);if(!k)return null;const E=Ur(u.lastLat,u.lastLng,n);let{downwindLat:C,downwindLng:I}=E;Number.isFinite(C)||(C=u.lastLat,I=u.lastLng);const x=p+o-Me,N=p+a,R=[],F=[],$=[],G=[];let K=x-N<=1e3?200:500;for(let q=x;q>=N+200;q-=K){const Lt=(q-N)/r,H=Lt*c;if(H>0){const vt=T.calculateMeanWind(l,d,f,N,q);R.push(H),F.push(vt[1]*Lt),$.push(vt[0]),G.push(q-p)}}return{blueLat:C,blueLng:I,redLat:u.lastLat,redLng:u.lastLng,radius:y,radiusFull:M,additionalBlueRadii:R,additionalBlueDisplacements:F,additionalBlueDirections:$,additionalBlueUpperLimits:G,displacement:b[1]*g,direction:b[0],displacementFull:S[1]*v,directionFull:S[0],meanWindForFullCanopyDir:S[0],meanWindForFullCanopySpeedMps:S[1],freeFallDirection:k.directionDeg,freeFallDistance:k.distance,freeFallTime:k.time}}function yo(n){var K,z;if(!u.weatherData||!u.lastLat||!u.lastLng||u.lastAltitude==="N/A"||!n||n.length===0)return null;const e=parseInt((K=document.getElementById("openingAltitude"))==null?void 0:K.value)||1e3,o=Math.round(u.lastAltitude),a=n.map(B=>B.height),r=n.map(B=>-T.convertWind(B.spd,"m/s","km/h")*Math.sin(B.dir*Math.PI/180)),c=n.map(B=>-T.convertWind(B.spd,"m/s","km/h")*Math.cos(B.dir*Math.PI/180)),l=T.calculateMeanWind(a,r,c,o,o+e);if(!l)return null;let d=Math.round(l[0]);const f=parseFloat(_.state.userSettings.customJumpRunDirection);Number.isFinite(f)&&f>=0&&f<=359&&(d=f);const p=parseInt((z=document.getElementById("exitAltitude"))==null?void 0:z.value)||3e3,g=o+p,y=T.calculateTAS(_.state.userSettings.aircraftSpeedKt||90,g/.3048);let v=null,M=2e3,b=2e3,S=null;if(y!=="N/A"&&Number.isFinite(y)){const B=T.linearInterpolate(a.map(tt=>tt-o),n.map(tt=>tt.dir),p),Y=T.linearInterpolate(a.map(tt=>tt-o),n.map(tt=>T.convertWind(tt.spd,"m/s","km/h")),p),nt=y*zt.KNOTS_TO_MPS,wt=(B+180)*Math.PI/180,q=Y*Math.sin(wt),Lt=Y*Math.cos(wt),H=d*Math.PI/180,vt=nt*Math.sin(H),V=nt*Math.cos(H);v=Math.sqrt(Math.pow(vt+q,2)+Math.pow(V+Lt,2)),M=Math.max(bn.MIN_TRACK_LENGTH_M,Math.min(bn.MAX_TRACK_LENGTH_M,Math.round((_.state.userSettings.numberOfJumpers||10)*(_.state.userSettings.jumperSeparation||5)*v))),b=Math.max(bn.MIN_APPROACH_LENGTH_M,Math.min(bn.MAX_APPROACH_LENGTH_M,Math.round(v*bn.APPROACH_TIME_SECONDS)))}const k=_.state.userSettings.jumpRunTrackOffset||0,E=_.state.userSettings.jumpRunTrackForwardOffset||0,C=(Math.atan2(k,E)*180/Math.PI+360)%360,I=Math.sqrt(k**2+E**2),x=(d+C+360)%360,[N,R]=T.calculateNewCenter(u.lastLat,u.lastLng,I,x),F=M/2,$=T.calculateNewCenter(N,R,F,(d+180)%360),G=T.calculateNewCenter(N,R,F,d);if(v){const B=T.calculateNewCenter($[0],$[1],b,(d+180)%360);S=[$,B]}return{direction:d,trackLength:M,meanWindDirection:l[0],meanWindSpeed:l[1],latlngs:[$,G],approachLatLngs:S,approachLength:b,approachTime:bn.APPROACH_TIME_SECONDS}}function Ur(n,e,o){var z,B;if(!o||o.length===0)return{downwindLat:n,downwindLng:e};const a=parseInt(document.getElementById("canopySpeed").value)||20,r=parseFloat(document.getElementById("descentRate").value)||3.5,c=parseInt(document.getElementById("legHeightFinal").value)||100,l=parseInt(document.getElementById("legHeightBase").value)||200,d=parseInt(document.getElementById("legHeightDownwind").value)||300,f=Math.round(u.lastAltitude),p=o.map(Y=>Y.height),g=o.map(Y=>-T.convertWind(Y.spd,"kt","km/h")*Math.sin(Y.dir*Math.PI/180)),y=o.map(Y=>-T.convertWind(Y.spd,"kt","km/h")*Math.cos(Y.dir*Math.PI/180)),v=((z=document.querySelector('input[name="landingDirection"]:checked'))==null?void 0:z.value)||"LL",M=parseInt((B=document.getElementById(v==="LL"?"customLandingDirectionLL":"customLandingDirectionRR"))==null?void 0:B.value,10);let b=Number.isFinite(M)?M:Number.isFinite(u.landingWindDir)?u.landingWindDir:o[0].dir;const S=(Y,nt,wt,q,Lt)=>{const vt=q*zt.KNOTS_TO_MPS*Lt,[V,tt]=T.calculateNewCenter(Y,nt,vt,wt);return[V,tt]},k=T.calculateMeanWind(p,g,y,f,f+c),E=(b+180)%360,C=T.calculateGroundSpeed(a,T.calculateWindComponents(k[1],T.calculateWindAngle(E,k[0])).headwind),I=S(n,e,E,C,c/r),x=T.calculateMeanWind(p,g,y,f+c,f+l),N=(b+(v==="LL"?90:-90)+360)%360,R=T.calculateCourseFromHeading(N,x[0],x[1],a),F=S(I[0],I[1],(R.trueCourse+180)%360,R.groundSpeed,(l-c)/r),$=T.calculateMeanWind(p,g,y,f+l,f+d),G=T.calculateGroundSpeed(a,T.calculateWindComponents($[1],T.calculateWindAngle(b,$[0])).headwind),K=S(F[0],F[1],b,G,(d-l)/r);return{downwindLat:K[0],downwindLng:K[1]}}class ln extends Error{}class bu extends ln{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Tu extends ln{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Su extends ln{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Cn extends ln{}class Zr extends ln{constructor(e){super(`Invalid unit ${e}`)}}class $t extends ln{}class Be extends ln{constructor(){super("Zone is an abstract class")}}const U="numeric",_e="short",Xt="long",ho={year:U,month:U,day:U},Hr={year:U,month:_e,day:U},Pu={year:U,month:_e,day:U,weekday:_e},Wr={year:U,month:Xt,day:U},Gr={year:U,month:Xt,day:U,weekday:Xt},Vr={hour:U,minute:U},Jr={hour:U,minute:U,second:U},jr={hour:U,minute:U,second:U,timeZoneName:_e},qr={hour:U,minute:U,second:U,timeZoneName:Xt},Kr={hour:U,minute:U,hourCycle:"h23"},Yr={hour:U,minute:U,second:U,hourCycle:"h23"},Xr={hour:U,minute:U,second:U,hourCycle:"h23",timeZoneName:_e},Qr={hour:U,minute:U,second:U,hourCycle:"h23",timeZoneName:Xt},tl={year:U,month:U,day:U,hour:U,minute:U},el={year:U,month:U,day:U,hour:U,minute:U,second:U},nl={year:U,month:_e,day:U,hour:U,minute:U},il={year:U,month:_e,day:U,hour:U,minute:U,second:U},ku={year:U,month:_e,day:U,weekday:_e,hour:U,minute:U},ol={year:U,month:Xt,day:U,hour:U,minute:U,timeZoneName:_e},al={year:U,month:Xt,day:U,hour:U,minute:U,second:U,timeZoneName:_e},sl={year:U,month:Xt,day:U,weekday:Xt,hour:U,minute:U,timeZoneName:Xt},rl={year:U,month:Xt,day:U,weekday:Xt,hour:U,minute:U,second:U,timeZoneName:Xt};class pi{get type(){throw new Be}get name(){throw new Be}get ianaName(){return this.name}get isUniversal(){throw new Be}offsetName(e,o){throw new Be}formatOffset(e,o){throw new Be}offset(e){throw new Be}equals(e){throw new Be}get isValid(){throw new Be}}let oa=null;class vo extends pi{static get instance(){return oa===null&&(oa=new vo),oa}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:o,locale:a}){return yl(e,o,a)}formatOffset(e,o){return li(this.offset(e),o)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}const La=new Map;function Eu(n){let e=La.get(n);return e===void 0&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),La.set(n,e)),e}const Cu={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function xu(n,e){const o=n.format(e).replace(/\u200E/g,""),a=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(o),[,r,c,l,d,f,p,g]=a;return[l,r,c,d,f,p,g]}function Au(n,e){const o=n.formatToParts(e),a=[];for(let r=0;r<o.length;r++){const{type:c,value:l}=o[r],d=Cu[c];c==="era"?a[d]=l:et(d)||(a[d]=parseInt(l,10))}return a}const aa=new Map;class Fe extends pi{static create(e){let o=aa.get(e);return o===void 0&&aa.set(e,o=new Fe(e)),o}static resetCache(){aa.clear(),La.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Fe.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:o,locale:a}){return yl(e,o,a,this.name)}formatOffset(e,o){return li(this.offset(e),o)}offset(e){if(!this.valid)return NaN;const o=new Date(e);if(isNaN(o))return NaN;const a=Eu(this.name);let[r,c,l,d,f,p,g]=a.formatToParts?Au(a,o):xu(a,o);d==="BC"&&(r=-Math.abs(r)+1);const v=Lo({year:r,month:c,day:l,hour:f===24?0:f,minute:p,second:g,millisecond:0});let M=+o;const b=M%1e3;return M-=b>=0?b:1e3+b,(v-M)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Xs={};function Iu(n,e={}){const o=JSON.stringify([n,e]);let a=Xs[o];return a||(a=new Intl.ListFormat(n,e),Xs[o]=a),a}const Ma=new Map;function ba(n,e={}){const o=JSON.stringify([n,e]);let a=Ma.get(o);return a===void 0&&(a=new Intl.DateTimeFormat(n,e),Ma.set(o,a)),a}const Ta=new Map;function Du(n,e={}){const o=JSON.stringify([n,e]);let a=Ta.get(o);return a===void 0&&(a=new Intl.NumberFormat(n,e),Ta.set(o,a)),a}const Sa=new Map;function Nu(n,e={}){const{base:o,...a}=e,r=JSON.stringify([n,a]);let c=Sa.get(r);return c===void 0&&(c=new Intl.RelativeTimeFormat(n,e),Sa.set(r,c)),c}let ni=null;function Ou(){return ni||(ni=new Intl.DateTimeFormat().resolvedOptions().locale,ni)}const Pa=new Map;function ll(n){let e=Pa.get(n);return e===void 0&&(e=new Intl.DateTimeFormat(n).resolvedOptions(),Pa.set(n,e)),e}const ka=new Map;function Fu(n){let e=ka.get(n);if(!e){const o=new Intl.Locale(n);e="getWeekInfo"in o?o.getWeekInfo():o.weekInfo,"minimalDays"in e||(e={...cl,...e}),ka.set(n,e)}return e}function Ru(n){const e=n.indexOf("-x-");e!==-1&&(n=n.substring(0,e));const o=n.indexOf("-u-");if(o===-1)return[n];{let a,r;try{a=ba(n).resolvedOptions(),r=n}catch{const f=n.substring(0,o);a=ba(f).resolvedOptions(),r=f}const{numberingSystem:c,calendar:l}=a;return[r,c,l]}}function zu(n,e,o){return(o||e)&&(n.includes("-u-")||(n+="-u"),o&&(n+=`-ca-${o}`),e&&(n+=`-nu-${e}`)),n}function $u(n){const e=[];for(let o=1;o<=12;o++){const a=J.utc(2009,o,1);e.push(n(a))}return e}function Bu(n){const e=[];for(let o=1;o<=7;o++){const a=J.utc(2016,11,13+o);e.push(n(a))}return e}function eo(n,e,o,a){const r=n.listingMode();return r==="error"?null:r==="en"?o(e):a(e)}function Uu(n){return n.numberingSystem&&n.numberingSystem!=="latn"?!1:n.numberingSystem==="latn"||!n.locale||n.locale.startsWith("en")||ll(n.locale).numberingSystem==="latn"}class Zu{constructor(e,o,a){this.padTo=a.padTo||0,this.floor=a.floor||!1;const{padTo:r,floor:c,...l}=a;if(!o||Object.keys(l).length>0){const d={useGrouping:!1,...a};a.padTo>0&&(d.minimumIntegerDigits=a.padTo),this.inf=Du(e,d)}}format(e){if(this.inf){const o=this.floor?Math.floor(e):e;return this.inf.format(o)}else{const o=this.floor?Math.floor(e):Za(e,3);return Et(o,this.padTo)}}}class Hu{constructor(e,o,a){this.opts=a,this.originalZone=void 0;let r;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const l=-1*(e.offset/60),d=l>=0?`Etc/GMT+${l}`:`Etc/GMT${l}`;e.offset!==0&&Fe.create(d).valid?(r=d,this.dt=e):(r="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const c={...this.opts};c.timeZone=c.timeZone||r,this.dtf=ba(o,c)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(o=>{if(o.type==="timeZoneName"){const a=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...o,value:a}}else return o}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Wu{constructor(e,o,a){this.opts={style:"long",...a},!o&&gl()&&(this.rtf=Nu(e,a))}format(e,o){return this.rtf?this.rtf.format(e,o):dh(o,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,o){return this.rtf?this.rtf.formatToParts(e,o):[]}}const cl={firstDay:1,minimalDays:4,weekend:[6,7]};class ft{static fromOpts(e){return ft.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,o,a,r,c=!1){const l=e||Tt.defaultLocale,d=l||(c?"en-US":Ou()),f=o||Tt.defaultNumberingSystem,p=a||Tt.defaultOutputCalendar,g=Ca(r)||Tt.defaultWeekSettings;return new ft(d,f,p,g,l)}static resetCache(){ni=null,Ma.clear(),Ta.clear(),Sa.clear(),Pa.clear(),ka.clear()}static fromObject({locale:e,numberingSystem:o,outputCalendar:a,weekSettings:r}={}){return ft.create(e,o,a,r)}constructor(e,o,a,r,c){const[l,d,f]=Ru(e);this.locale=l,this.numberingSystem=o||d||null,this.outputCalendar=a||f||null,this.weekSettings=r,this.intl=zu(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=c,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Uu(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),o=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&o?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:ft.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,Ca(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,o=!1){return eo(this,e,Ll,()=>{const a=o?{month:e,day:"numeric"}:{month:e},r=o?"format":"standalone";return this.monthsCache[r][e]||(this.monthsCache[r][e]=$u(c=>this.extract(c,a,"month"))),this.monthsCache[r][e]})}weekdays(e,o=!1){return eo(this,e,Tl,()=>{const a=o?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=o?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=Bu(c=>this.extract(c,a,"weekday"))),this.weekdaysCache[r][e]})}meridiems(){return eo(this,void 0,()=>Sl,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[J.utc(2016,11,13,9),J.utc(2016,11,13,19)].map(o=>this.extract(o,e,"dayperiod"))}return this.meridiemCache})}eras(e){return eo(this,e,Pl,()=>{const o={era:e};return this.eraCache[e]||(this.eraCache[e]=[J.utc(-40,1,1),J.utc(2017,1,1)].map(a=>this.extract(a,o,"era"))),this.eraCache[e]})}extract(e,o,a){const r=this.dtFormatter(e,o),c=r.formatToParts(),l=c.find(d=>d.type.toLowerCase()===a);return l?l.value:null}numberFormatter(e={}){return new Zu(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,o={}){return new Hu(e,this.intl,o)}relFormatter(e={}){return new Wu(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Iu(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||ll(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:_l()?Fu(this.locale):cl}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let sa=null;class Gt extends pi{static get utcInstance(){return sa===null&&(sa=new Gt(0)),sa}static instance(e){return e===0?Gt.utcInstance:new Gt(e)}static parseSpecifier(e){if(e){const o=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(o)return new Gt(Mo(o[1],o[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${li(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${li(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,o){return li(this.fixed,o)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Gu extends pi{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Ge(n,e){if(et(n)||n===null)return e;if(n instanceof pi)return n;if(Yu(n)){const o=n.toLowerCase();return o==="default"?e:o==="local"||o==="system"?vo.instance:o==="utc"||o==="gmt"?Gt.utcInstance:Gt.parseSpecifier(o)||Fe.create(n)}else return Ve(n)?Gt.instance(n):typeof n=="object"&&"offset"in n&&typeof n.offset=="function"?n:new Gu(n)}const za={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Qs={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Vu=za.hanidec.replace(/[\[|\]]/g,"").split("");function Ju(n){let e=parseInt(n,10);if(isNaN(e)){e="";for(let o=0;o<n.length;o++){const a=n.charCodeAt(o);if(n[o].search(za.hanidec)!==-1)e+=Vu.indexOf(n[o]);else for(const r in Qs){const[c,l]=Qs[r];a>=c&&a<=l&&(e+=a-c)}}return parseInt(e,10)}else return e}const Ea=new Map;function ju(){Ea.clear()}function me({numberingSystem:n},e=""){const o=n||"latn";let a=Ea.get(o);a===void 0&&(a=new Map,Ea.set(o,a));let r=a.get(e);return r===void 0&&(r=new RegExp(`${za[o]}${e}`),a.set(e,r)),r}let tr=()=>Date.now(),er="system",nr=null,ir=null,or=null,ar=60,sr,rr=null;class Tt{static get now(){return tr}static set now(e){tr=e}static set defaultZone(e){er=e}static get defaultZone(){return Ge(er,vo.instance)}static get defaultLocale(){return nr}static set defaultLocale(e){nr=e}static get defaultNumberingSystem(){return ir}static set defaultNumberingSystem(e){ir=e}static get defaultOutputCalendar(){return or}static set defaultOutputCalendar(e){or=e}static get defaultWeekSettings(){return rr}static set defaultWeekSettings(e){rr=Ca(e)}static get twoDigitCutoffYear(){return ar}static set twoDigitCutoffYear(e){ar=e%100}static get throwOnInvalid(){return sr}static set throwOnInvalid(e){sr=e}static resetCaches(){ft.resetCache(),Fe.resetCache(),J.resetCache(),ju()}}class ge{constructor(e,o){this.reason=e,this.explanation=o}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const ul=[0,31,59,90,120,151,181,212,243,273,304,334],hl=[0,31,60,91,121,152,182,213,244,274,305,335];function ce(n,e){return new ge("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${n}, which is invalid`)}function $a(n,e,o){const a=new Date(Date.UTC(n,e-1,o));n<100&&n>=0&&a.setUTCFullYear(a.getUTCFullYear()-1900);const r=a.getUTCDay();return r===0?7:r}function dl(n,e,o){return o+(gi(n)?hl:ul)[e-1]}function fl(n,e){const o=gi(n)?hl:ul,a=o.findIndex(c=>c<e),r=e-o[a];return{month:a+1,day:r}}function Ba(n,e){return(n-e+7)%7+1}function fo(n,e=4,o=1){const{year:a,month:r,day:c}=n,l=dl(a,r,c),d=Ba($a(a,r,c),o);let f=Math.floor((l-d+14-e)/7),p;return f<1?(p=a-1,f=ui(p,e,o)):f>ui(a,e,o)?(p=a+1,f=1):p=a,{weekYear:p,weekNumber:f,weekday:d,...bo(n)}}function lr(n,e=4,o=1){const{weekYear:a,weekNumber:r,weekday:c}=n,l=Ba($a(a,1,e),o),d=An(a);let f=r*7+c-l-7+e,p;f<1?(p=a-1,f+=An(p)):f>d?(p=a+1,f-=An(a)):p=a;const{month:g,day:y}=fl(p,f);return{year:p,month:g,day:y,...bo(n)}}function ra(n){const{year:e,month:o,day:a}=n,r=dl(e,o,a);return{year:e,ordinal:r,...bo(n)}}function cr(n){const{year:e,ordinal:o}=n,{month:a,day:r}=fl(e,o);return{year:e,month:a,day:r,...bo(n)}}function ur(n,e){if(!et(n.localWeekday)||!et(n.localWeekNumber)||!et(n.localWeekYear)){if(!et(n.weekday)||!et(n.weekNumber)||!et(n.weekYear))throw new Cn("Cannot mix locale-based week fields with ISO-based week fields");return et(n.localWeekday)||(n.weekday=n.localWeekday),et(n.localWeekNumber)||(n.weekNumber=n.localWeekNumber),et(n.localWeekYear)||(n.weekYear=n.localWeekYear),delete n.localWeekday,delete n.localWeekNumber,delete n.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function qu(n,e=4,o=1){const a=wo(n.weekYear),r=ue(n.weekNumber,1,ui(n.weekYear,e,o)),c=ue(n.weekday,1,7);return a?r?c?!1:ce("weekday",n.weekday):ce("week",n.weekNumber):ce("weekYear",n.weekYear)}function Ku(n){const e=wo(n.year),o=ue(n.ordinal,1,An(n.year));return e?o?!1:ce("ordinal",n.ordinal):ce("year",n.year)}function ml(n){const e=wo(n.year),o=ue(n.month,1,12),a=ue(n.day,1,mo(n.year,n.month));return e?o?a?!1:ce("day",n.day):ce("month",n.month):ce("year",n.year)}function pl(n){const{hour:e,minute:o,second:a,millisecond:r}=n,c=ue(e,0,23)||e===24&&o===0&&a===0&&r===0,l=ue(o,0,59),d=ue(a,0,59),f=ue(r,0,999);return c?l?d?f?!1:ce("millisecond",r):ce("second",a):ce("minute",o):ce("hour",e)}function et(n){return typeof n>"u"}function Ve(n){return typeof n=="number"}function wo(n){return typeof n=="number"&&n%1===0}function Yu(n){return typeof n=="string"}function Xu(n){return Object.prototype.toString.call(n)==="[object Date]"}function gl(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function _l(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function Qu(n){return Array.isArray(n)?n:[n]}function hr(n,e,o){if(n.length!==0)return n.reduce((a,r)=>{const c=[e(r),r];return a&&o(a[0],c[0])===a[0]?a:c},null)[1]}function th(n,e){return e.reduce((o,a)=>(o[a]=n[a],o),{})}function Dn(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ca(n){if(n==null)return null;if(typeof n!="object")throw new $t("Week settings must be an object");if(!ue(n.firstDay,1,7)||!ue(n.minimalDays,1,7)||!Array.isArray(n.weekend)||n.weekend.some(e=>!ue(e,1,7)))throw new $t("Invalid week settings");return{firstDay:n.firstDay,minimalDays:n.minimalDays,weekend:Array.from(n.weekend)}}function ue(n,e,o){return wo(n)&&n>=e&&n<=o}function eh(n,e){return n-e*Math.floor(n/e)}function Et(n,e=2){const o=n<0;let a;return o?a="-"+(""+-n).padStart(e,"0"):a=(""+n).padStart(e,"0"),a}function He(n){if(!(et(n)||n===null||n===""))return parseInt(n,10)}function nn(n){if(!(et(n)||n===null||n===""))return parseFloat(n)}function Ua(n){if(!(et(n)||n===null||n==="")){const e=parseFloat("0."+n)*1e3;return Math.floor(e)}}function Za(n,e,o=!1){const a=10**e;return(o?Math.trunc:Math.round)(n*a)/a}function gi(n){return n%4===0&&(n%100!==0||n%400===0)}function An(n){return gi(n)?366:365}function mo(n,e){const o=eh(e-1,12)+1,a=n+(e-o)/12;return o===2?gi(a)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][o-1]}function Lo(n){let e=Date.UTC(n.year,n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond);return n.year<100&&n.year>=0&&(e=new Date(e),e.setUTCFullYear(n.year,n.month-1,n.day)),+e}function dr(n,e,o){return-Ba($a(n,1,e),o)+e-1}function ui(n,e=4,o=1){const a=dr(n,e,o),r=dr(n+1,e,o);return(An(n)-a+r)/7}function xa(n){return n>99?n:n>Tt.twoDigitCutoffYear?1900+n:2e3+n}function yl(n,e,o,a=null){const r=new Date(n),c={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};a&&(c.timeZone=a);const l={timeZoneName:e,...c},d=new Intl.DateTimeFormat(o,l).formatToParts(r).find(f=>f.type.toLowerCase()==="timezonename");return d?d.value:null}function Mo(n,e){let o=parseInt(n,10);Number.isNaN(o)&&(o=0);const a=parseInt(e,10)||0,r=o<0||Object.is(o,-0)?-a:a;return o*60+r}function vl(n){const e=Number(n);if(typeof n=="boolean"||n===""||Number.isNaN(e))throw new $t(`Invalid unit value ${n}`);return e}function po(n,e){const o={};for(const a in n)if(Dn(n,a)){const r=n[a];if(r==null)continue;o[e(a)]=vl(r)}return o}function li(n,e){const o=Math.trunc(Math.abs(n/60)),a=Math.trunc(Math.abs(n%60)),r=n>=0?"+":"-";switch(e){case"short":return`${r}${Et(o,2)}:${Et(a,2)}`;case"narrow":return`${r}${o}${a>0?`:${a}`:""}`;case"techie":return`${r}${Et(o,2)}${Et(a,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function bo(n){return th(n,["hour","minute","second","millisecond"])}const nh=["January","February","March","April","May","June","July","August","September","October","November","December"],wl=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ih=["J","F","M","A","M","J","J","A","S","O","N","D"];function Ll(n){switch(n){case"narrow":return[...ih];case"short":return[...wl];case"long":return[...nh];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Ml=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],bl=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],oh=["M","T","W","T","F","S","S"];function Tl(n){switch(n){case"narrow":return[...oh];case"short":return[...bl];case"long":return[...Ml];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Sl=["AM","PM"],ah=["Before Christ","Anno Domini"],sh=["BC","AD"],rh=["B","A"];function Pl(n){switch(n){case"narrow":return[...rh];case"short":return[...sh];case"long":return[...ah];default:return null}}function lh(n){return Sl[n.hour<12?0:1]}function ch(n,e){return Tl(e)[n.weekday-1]}function uh(n,e){return Ll(e)[n.month-1]}function hh(n,e){return Pl(e)[n.year<0?0:1]}function dh(n,e,o="always",a=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},c=["hours","minutes","seconds"].indexOf(n)===-1;if(o==="auto"&&c){const y=n==="days";switch(e){case 1:return y?"tomorrow":`next ${r[n][0]}`;case-1:return y?"yesterday":`last ${r[n][0]}`;case 0:return y?"today":`this ${r[n][0]}`}}const l=Object.is(e,-0)||e<0,d=Math.abs(e),f=d===1,p=r[n],g=a?f?p[1]:p[2]||p[1]:f?r[n][0]:n;return l?`${d} ${g} ago`:`in ${d} ${g}`}function fr(n,e){let o="";for(const a of n)a.literal?o+=a.val:o+=e(a.val);return o}const fh={D:ho,DD:Hr,DDD:Wr,DDDD:Gr,t:Vr,tt:Jr,ttt:jr,tttt:qr,T:Kr,TT:Yr,TTT:Xr,TTTT:Qr,f:tl,ff:nl,fff:ol,ffff:sl,F:el,FF:il,FFF:al,FFFF:rl};class Bt{static create(e,o={}){return new Bt(e,o)}static parseFormat(e){let o=null,a="",r=!1;const c=[];for(let l=0;l<e.length;l++){const d=e.charAt(l);d==="'"?(a.length>0&&c.push({literal:r||/^\s+$/.test(a),val:a}),o=null,a="",r=!r):r||d===o?a+=d:(a.length>0&&c.push({literal:/^\s+$/.test(a),val:a}),a=d,o=d)}return a.length>0&&c.push({literal:r||/^\s+$/.test(a),val:a}),c}static macroTokenToFormatOpts(e){return fh[e]}constructor(e,o){this.opts=o,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,o){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...o}).format()}dtFormatter(e,o={}){return this.loc.dtFormatter(e,{...this.opts,...o})}formatDateTime(e,o){return this.dtFormatter(e,o).format()}formatDateTimeParts(e,o){return this.dtFormatter(e,o).formatToParts()}formatInterval(e,o){return this.dtFormatter(e.start,o).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,o){return this.dtFormatter(e,o).resolvedOptions()}num(e,o=0){if(this.opts.forceSimple)return Et(e,o);const a={...this.opts};return o>0&&(a.padTo=o),this.loc.numberFormatter(a).format(e)}formatDateTimeFromString(e,o){const a=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",c=(M,b)=>this.loc.extract(e,M,b),l=M=>e.isOffsetFixed&&e.offset===0&&M.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,M.format):"",d=()=>a?lh(e):c({hour:"numeric",hourCycle:"h12"},"dayperiod"),f=(M,b)=>a?uh(e,M):c(b?{month:M}:{month:M,day:"numeric"},"month"),p=(M,b)=>a?ch(e,M):c(b?{weekday:M}:{weekday:M,month:"long",day:"numeric"},"weekday"),g=M=>{const b=Bt.macroTokenToFormatOpts(M);return b?this.formatWithSystemDefault(e,b):M},y=M=>a?hh(e,M):c({era:M},"era"),v=M=>{switch(M){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return l({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return l({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return l({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return d();case"d":return r?c({day:"numeric"},"day"):this.num(e.day);case"dd":return r?c({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return p("short",!0);case"cccc":return p("long",!0);case"ccccc":return p("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return p("short",!1);case"EEEE":return p("long",!1);case"EEEEE":return p("narrow",!1);case"L":return r?c({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?c({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return f("short",!0);case"LLLL":return f("long",!0);case"LLLLL":return f("narrow",!0);case"M":return r?c({month:"numeric"},"month"):this.num(e.month);case"MM":return r?c({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return f("short",!1);case"MMMM":return f("long",!1);case"MMMMM":return f("narrow",!1);case"y":return r?c({year:"numeric"},"year"):this.num(e.year);case"yy":return r?c({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?c({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?c({year:"numeric"},"year"):this.num(e.year,6);case"G":return y("short");case"GG":return y("long");case"GGGGG":return y("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return g(M)}};return fr(Bt.parseFormat(o),v)}formatDurationFromString(e,o){const a=f=>{switch(f[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=f=>p=>{const g=a(p);return g?this.num(f.get(g),p.length):p},c=Bt.parseFormat(o),l=c.reduce((f,{literal:p,val:g})=>p?f:f.concat(g),[]),d=e.shiftTo(...l.map(a).filter(f=>f));return fr(c,r(d))}}const kl=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Fn(...n){const e=n.reduce((o,a)=>o+a.source,"");return RegExp(`^${e}$`)}function Rn(...n){return e=>n.reduce(([o,a,r],c)=>{const[l,d,f]=c(e,r);return[{...o,...l},d||a,f]},[{},null,1]).slice(0,2)}function zn(n,...e){if(n==null)return[null,null];for(const[o,a]of e){const r=o.exec(n);if(r)return a(r)}return[null,null]}function El(...n){return(e,o)=>{const a={};let r;for(r=0;r<n.length;r++)a[n[r]]=He(e[o+r]);return[a,null,o+r]}}const Cl=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,mh=`(?:${Cl.source}?(?:\\[(${kl.source})\\])?)?`,Ha=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,xl=RegExp(`${Ha.source}${mh}`),Wa=RegExp(`(?:T${xl.source})?`),ph=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,gh=/(\d{4})-?W(\d\d)(?:-?(\d))?/,_h=/(\d{4})-?(\d{3})/,yh=El("weekYear","weekNumber","weekDay"),vh=El("year","ordinal"),wh=/(\d{4})-(\d\d)-(\d\d)/,Al=RegExp(`${Ha.source} ?(?:${Cl.source}|(${kl.source}))?`),Lh=RegExp(`(?: ${Al.source})?`);function In(n,e,o){const a=n[e];return et(a)?o:He(a)}function Mh(n,e){return[{year:In(n,e),month:In(n,e+1,1),day:In(n,e+2,1)},null,e+3]}function $n(n,e){return[{hours:In(n,e,0),minutes:In(n,e+1,0),seconds:In(n,e+2,0),milliseconds:Ua(n[e+3])},null,e+4]}function _i(n,e){const o=!n[e]&&!n[e+1],a=Mo(n[e+1],n[e+2]),r=o?null:Gt.instance(a);return[{},r,e+3]}function yi(n,e){const o=n[e]?Fe.create(n[e]):null;return[{},o,e+1]}const bh=RegExp(`^T?${Ha.source}$`),Th=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Sh(n){const[e,o,a,r,c,l,d,f,p]=n,g=e[0]==="-",y=f&&f[0]==="-",v=(M,b=!1)=>M!==void 0&&(b||M&&g)?-M:M;return[{years:v(nn(o)),months:v(nn(a)),weeks:v(nn(r)),days:v(nn(c)),hours:v(nn(l)),minutes:v(nn(d)),seconds:v(nn(f),f==="-0"),milliseconds:v(Ua(p),y)}]}const Ph={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Ga(n,e,o,a,r,c,l){const d={year:e.length===2?xa(He(e)):He(e),month:wl.indexOf(o)+1,day:He(a),hour:He(r),minute:He(c)};return l&&(d.second=He(l)),n&&(d.weekday=n.length>3?Ml.indexOf(n)+1:bl.indexOf(n)+1),d}const kh=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Eh(n){const[,e,o,a,r,c,l,d,f,p,g,y]=n,v=Ga(e,r,a,o,c,l,d);let M;return f?M=Ph[f]:p?M=0:M=Mo(g,y),[v,new Gt(M)]}function Ch(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const xh=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Ah=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Ih=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function mr(n){const[,e,o,a,r,c,l,d]=n;return[Ga(e,r,a,o,c,l,d),Gt.utcInstance]}function Dh(n){const[,e,o,a,r,c,l,d]=n;return[Ga(e,d,o,a,r,c,l),Gt.utcInstance]}const Nh=Fn(ph,Wa),Oh=Fn(gh,Wa),Fh=Fn(_h,Wa),Rh=Fn(xl),Il=Rn(Mh,$n,_i,yi),zh=Rn(yh,$n,_i,yi),$h=Rn(vh,$n,_i,yi),Bh=Rn($n,_i,yi);function Uh(n){return zn(n,[Nh,Il],[Oh,zh],[Fh,$h],[Rh,Bh])}function Zh(n){return zn(Ch(n),[kh,Eh])}function Hh(n){return zn(n,[xh,mr],[Ah,mr],[Ih,Dh])}function Wh(n){return zn(n,[Th,Sh])}const Gh=Rn($n);function Vh(n){return zn(n,[bh,Gh])}const Jh=Fn(wh,Lh),jh=Fn(Al),qh=Rn($n,_i,yi);function Kh(n){return zn(n,[Jh,Il],[jh,qh])}const pr="Invalid Duration",Dl={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Yh={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Dl},oe=146097/400,Tn=146097/4800,Xh={years:{quarters:4,months:12,weeks:oe/7,days:oe,hours:oe*24,minutes:oe*24*60,seconds:oe*24*60*60,milliseconds:oe*24*60*60*1e3},quarters:{months:3,weeks:oe/28,days:oe/4,hours:oe*24/4,minutes:oe*24*60/4,seconds:oe*24*60*60/4,milliseconds:oe*24*60*60*1e3/4},months:{weeks:Tn/7,days:Tn,hours:Tn*24,minutes:Tn*24*60,seconds:Tn*24*60*60,milliseconds:Tn*24*60*60*1e3},...Dl},sn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Qh=sn.slice(0).reverse();function Ue(n,e,o=!1){const a={values:o?e.values:{...n.values,...e.values||{}},loc:n.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||n.conversionAccuracy,matrix:e.matrix||n.matrix};return new ct(a)}function Nl(n,e){let o=e.milliseconds??0;for(const a of Qh.slice(1))e[a]&&(o+=e[a]*n[a].milliseconds);return o}function gr(n,e){const o=Nl(n,e)<0?-1:1;sn.reduceRight((a,r)=>{if(et(e[r]))return a;if(a){const c=e[a]*o,l=n[r][a],d=Math.floor(c/l);e[r]+=d*o,e[a]-=d*l*o}return r},null),sn.reduce((a,r)=>{if(et(e[r]))return a;if(a){const c=e[a]%1;e[a]-=c,e[r]+=c*n[a][r]}return r},null)}function td(n){const e={};for(const[o,a]of Object.entries(n))a!==0&&(e[o]=a);return e}class ct{constructor(e){const o=e.conversionAccuracy==="longterm"||!1;let a=o?Xh:Yh;e.matrix&&(a=e.matrix),this.values=e.values,this.loc=e.loc||ft.create(),this.conversionAccuracy=o?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=a,this.isLuxonDuration=!0}static fromMillis(e,o){return ct.fromObject({milliseconds:e},o)}static fromObject(e,o={}){if(e==null||typeof e!="object")throw new $t(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new ct({values:po(e,ct.normalizeUnit),loc:ft.fromObject(o),conversionAccuracy:o.conversionAccuracy,matrix:o.matrix})}static fromDurationLike(e){if(Ve(e))return ct.fromMillis(e);if(ct.isDuration(e))return e;if(typeof e=="object")return ct.fromObject(e);throw new $t(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,o){const[a]=Wh(e);return a?ct.fromObject(a,o):ct.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,o){const[a]=Vh(e);return a?ct.fromObject(a,o):ct.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,o=null){if(!e)throw new $t("need to specify a reason the Duration is invalid");const a=e instanceof ge?e:new ge(e,o);if(Tt.throwOnInvalid)throw new Su(a);return new ct({invalid:a})}static normalizeUnit(e){const o={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!o)throw new Zr(e);return o}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,o={}){const a={...o,floor:o.round!==!1&&o.floor!==!1};return this.isValid?Bt.create(this.loc,a).formatDurationFromString(this,e):pr}toHuman(e={}){if(!this.isValid)return pr;const o=sn.map(a=>{const r=this.values[a];return et(r)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:a.slice(0,-1)}).format(r)}).filter(a=>a);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(o)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Za(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const o=this.toMillis();return o<0||o>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},J.fromMillis(o,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?Nl(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const o=ct.fromDurationLike(e),a={};for(const r of sn)(Dn(o.values,r)||Dn(this.values,r))&&(a[r]=o.get(r)+this.get(r));return Ue(this,{values:a},!0)}minus(e){if(!this.isValid)return this;const o=ct.fromDurationLike(e);return this.plus(o.negate())}mapUnits(e){if(!this.isValid)return this;const o={};for(const a of Object.keys(this.values))o[a]=vl(e(this.values[a],a));return Ue(this,{values:o},!0)}get(e){return this[ct.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const o={...this.values,...po(e,ct.normalizeUnit)};return Ue(this,{values:o})}reconfigure({locale:e,numberingSystem:o,conversionAccuracy:a,matrix:r}={}){const l={loc:this.loc.clone({locale:e,numberingSystem:o}),matrix:r,conversionAccuracy:a};return Ue(this,l)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return gr(this.matrix,e),Ue(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=td(this.normalize().shiftToAll().toObject());return Ue(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(l=>ct.normalizeUnit(l));const o={},a={},r=this.toObject();let c;for(const l of sn)if(e.indexOf(l)>=0){c=l;let d=0;for(const p in a)d+=this.matrix[p][l]*a[p],a[p]=0;Ve(r[l])&&(d+=r[l]);const f=Math.trunc(d);o[l]=f,a[l]=(d*1e3-f*1e3)/1e3}else Ve(r[l])&&(a[l]=r[l]);for(const l in a)a[l]!==0&&(o[c]+=l===c?a[l]:a[l]/this.matrix[c][l]);return gr(this.matrix,o),Ue(this,{values:o},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const o of Object.keys(this.values))e[o]=this.values[o]===0?0:-this.values[o];return Ue(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function o(a,r){return a===void 0||a===0?r===void 0||r===0:a===r}for(const a of sn)if(!o(this.values[a],e.values[a]))return!1;return!0}}const Sn="Invalid Interval";function ed(n,e){return!n||!n.isValid?bt.invalid("missing or invalid start"):!e||!e.isValid?bt.invalid("missing or invalid end"):e<n?bt.invalid("end before start",`The end of an interval must be after its start, but you had start=${n.toISO()} and end=${e.toISO()}`):null}class bt{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,o=null){if(!e)throw new $t("need to specify a reason the Interval is invalid");const a=e instanceof ge?e:new ge(e,o);if(Tt.throwOnInvalid)throw new Tu(a);return new bt({invalid:a})}static fromDateTimes(e,o){const a=ei(e),r=ei(o),c=ed(a,r);return c??new bt({start:a,end:r})}static after(e,o){const a=ct.fromDurationLike(o),r=ei(e);return bt.fromDateTimes(r,r.plus(a))}static before(e,o){const a=ct.fromDurationLike(o),r=ei(e);return bt.fromDateTimes(r.minus(a),r)}static fromISO(e,o){const[a,r]=(e||"").split("/",2);if(a&&r){let c,l;try{c=J.fromISO(a,o),l=c.isValid}catch{l=!1}let d,f;try{d=J.fromISO(r,o),f=d.isValid}catch{f=!1}if(l&&f)return bt.fromDateTimes(c,d);if(l){const p=ct.fromISO(r,o);if(p.isValid)return bt.after(c,p)}else if(f){const p=ct.fromISO(a,o);if(p.isValid)return bt.before(d,p)}}return bt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",o){if(!this.isValid)return NaN;const a=this.start.startOf(e,o);let r;return o!=null&&o.useLocaleWeeks?r=this.end.reconfigure({locale:a.locale}):r=this.end,r=r.startOf(e,o),Math.floor(r.diff(a,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:o}={}){return this.isValid?bt.fromDateTimes(e||this.s,o||this.e):this}splitAt(...e){if(!this.isValid)return[];const o=e.map(ei).filter(l=>this.contains(l)).sort((l,d)=>l.toMillis()-d.toMillis()),a=[];let{s:r}=this,c=0;for(;r<this.e;){const l=o[c]||this.e,d=+l>+this.e?this.e:l;a.push(bt.fromDateTimes(r,d)),r=d,c+=1}return a}splitBy(e){const o=ct.fromDurationLike(e);if(!this.isValid||!o.isValid||o.as("milliseconds")===0)return[];let{s:a}=this,r=1,c;const l=[];for(;a<this.e;){const d=this.start.plus(o.mapUnits(f=>f*r));c=+d>+this.e?this.e:d,l.push(bt.fromDateTimes(a,c)),a=c,r+=1}return l}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const o=this.s>e.s?this.s:e.s,a=this.e<e.e?this.e:e.e;return o>=a?null:bt.fromDateTimes(o,a)}union(e){if(!this.isValid)return this;const o=this.s<e.s?this.s:e.s,a=this.e>e.e?this.e:e.e;return bt.fromDateTimes(o,a)}static merge(e){const[o,a]=e.sort((r,c)=>r.s-c.s).reduce(([r,c],l)=>c?c.overlaps(l)||c.abutsStart(l)?[r,c.union(l)]:[r.concat([c]),l]:[r,l],[[],null]);return a&&o.push(a),o}static xor(e){let o=null,a=0;const r=[],c=e.map(f=>[{time:f.s,type:"s"},{time:f.e,type:"e"}]),l=Array.prototype.concat(...c),d=l.sort((f,p)=>f.time-p.time);for(const f of d)a+=f.type==="s"?1:-1,a===1?o=f.time:(o&&+o!=+f.time&&r.push(bt.fromDateTimes(o,f.time)),o=null);return bt.merge(r)}difference(...e){return bt.xor([this].concat(e)).map(o=>this.intersection(o)).filter(o=>o&&!o.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Sn}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=ho,o={}){return this.isValid?Bt.create(this.s.loc.clone(o),e).formatInterval(this):Sn}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Sn}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Sn}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Sn}toFormat(e,{separator:o=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${o}${this.e.toFormat(e)}`:Sn}toDuration(e,o){return this.isValid?this.e.diff(this.s,e,o):ct.invalid(this.invalidReason)}mapEndpoints(e){return bt.fromDateTimes(e(this.s),e(this.e))}}class no{static hasDST(e=Tt.defaultZone){const o=J.now().setZone(e).set({month:12});return!e.isUniversal&&o.offset!==o.set({month:6}).offset}static isValidIANAZone(e){return Fe.isValidZone(e)}static normalizeZone(e){return Ge(e,Tt.defaultZone)}static getStartOfWeek({locale:e=null,locObj:o=null}={}){return(o||ft.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:o=null}={}){return(o||ft.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:o=null}={}){return(o||ft.create(e)).getWeekendDays().slice()}static months(e="long",{locale:o=null,numberingSystem:a=null,locObj:r=null,outputCalendar:c="gregory"}={}){return(r||ft.create(o,a,c)).months(e)}static monthsFormat(e="long",{locale:o=null,numberingSystem:a=null,locObj:r=null,outputCalendar:c="gregory"}={}){return(r||ft.create(o,a,c)).months(e,!0)}static weekdays(e="long",{locale:o=null,numberingSystem:a=null,locObj:r=null}={}){return(r||ft.create(o,a,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:o=null,numberingSystem:a=null,locObj:r=null}={}){return(r||ft.create(o,a,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return ft.create(e).meridiems()}static eras(e="short",{locale:o=null}={}){return ft.create(o,null,"gregory").eras(e)}static features(){return{relative:gl(),localeWeek:_l()}}}function _r(n,e){const o=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),a=o(e)-o(n);return Math.floor(ct.fromMillis(a).as("days"))}function nd(n,e,o){const a=[["years",(f,p)=>p.year-f.year],["quarters",(f,p)=>p.quarter-f.quarter+(p.year-f.year)*4],["months",(f,p)=>p.month-f.month+(p.year-f.year)*12],["weeks",(f,p)=>{const g=_r(f,p);return(g-g%7)/7}],["days",_r]],r={},c=n;let l,d;for(const[f,p]of a)o.indexOf(f)>=0&&(l=f,r[f]=p(n,e),d=c.plus(r),d>e?(r[f]--,n=c.plus(r),n>e&&(d=n,r[f]--,n=c.plus(r))):n=d);return[n,r,d,l]}function id(n,e,o,a){let[r,c,l,d]=nd(n,e,o);const f=e-r,p=o.filter(y=>["hours","minutes","seconds","milliseconds"].indexOf(y)>=0);p.length===0&&(l<e&&(l=r.plus({[d]:1})),l!==r&&(c[d]=(c[d]||0)+f/(l-r)));const g=ct.fromObject(c,a);return p.length>0?ct.fromMillis(f,a).shiftTo(...p).plus(g):g}const od="missing Intl.DateTimeFormat.formatToParts support";function dt(n,e=o=>o){return{regex:n,deser:([o])=>e(Ju(o))}}const ad=" ",Ol=`[ ${ad}]`,Fl=new RegExp(Ol,"g");function sd(n){return n.replace(/\./g,"\\.?").replace(Fl,Ol)}function yr(n){return n.replace(/\./g,"").replace(Fl," ").toLowerCase()}function pe(n,e){return n===null?null:{regex:RegExp(n.map(sd).join("|")),deser:([o])=>n.findIndex(a=>yr(o)===yr(a))+e}}function vr(n,e){return{regex:n,deser:([,o,a])=>Mo(o,a),groups:e}}function io(n){return{regex:n,deser:([e])=>e}}function rd(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function ld(n,e){const o=me(e),a=me(e,"{2}"),r=me(e,"{3}"),c=me(e,"{4}"),l=me(e,"{6}"),d=me(e,"{1,2}"),f=me(e,"{1,3}"),p=me(e,"{1,6}"),g=me(e,"{1,9}"),y=me(e,"{2,4}"),v=me(e,"{4,6}"),M=k=>({regex:RegExp(rd(k.val)),deser:([E])=>E,literal:!0}),S=(k=>{if(n.literal)return M(k);switch(k.val){case"G":return pe(e.eras("short"),0);case"GG":return pe(e.eras("long"),0);case"y":return dt(p);case"yy":return dt(y,xa);case"yyyy":return dt(c);case"yyyyy":return dt(v);case"yyyyyy":return dt(l);case"M":return dt(d);case"MM":return dt(a);case"MMM":return pe(e.months("short",!0),1);case"MMMM":return pe(e.months("long",!0),1);case"L":return dt(d);case"LL":return dt(a);case"LLL":return pe(e.months("short",!1),1);case"LLLL":return pe(e.months("long",!1),1);case"d":return dt(d);case"dd":return dt(a);case"o":return dt(f);case"ooo":return dt(r);case"HH":return dt(a);case"H":return dt(d);case"hh":return dt(a);case"h":return dt(d);case"mm":return dt(a);case"m":return dt(d);case"q":return dt(d);case"qq":return dt(a);case"s":return dt(d);case"ss":return dt(a);case"S":return dt(f);case"SSS":return dt(r);case"u":return io(g);case"uu":return io(d);case"uuu":return dt(o);case"a":return pe(e.meridiems(),0);case"kkkk":return dt(c);case"kk":return dt(y,xa);case"W":return dt(d);case"WW":return dt(a);case"E":case"c":return dt(o);case"EEE":return pe(e.weekdays("short",!1),1);case"EEEE":return pe(e.weekdays("long",!1),1);case"ccc":return pe(e.weekdays("short",!0),1);case"cccc":return pe(e.weekdays("long",!0),1);case"Z":case"ZZ":return vr(new RegExp(`([+-]${d.source})(?::(${a.source}))?`),2);case"ZZZ":return vr(new RegExp(`([+-]${d.source})(${a.source})?`),2);case"z":return io(/[a-z_+-/]{1,256}?/i);case" ":return io(/[^\S\n\r]/);default:return M(k)}})(n)||{invalidReason:od};return S.token=n,S}const cd={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function ud(n,e,o){const{type:a,value:r}=n;if(a==="literal"){const f=/^\s+$/.test(r);return{literal:!f,val:f?" ":r}}const c=e[a];let l=a;a==="hour"&&(e.hour12!=null?l=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?l="hour12":l="hour24":l=o.hour12?"hour12":"hour24");let d=cd[l];if(typeof d=="object"&&(d=d[c]),d)return{literal:!1,val:d}}function hd(n){return[`^${n.map(o=>o.regex).reduce((o,a)=>`${o}(${a.source})`,"")}$`,n]}function dd(n,e,o){const a=n.match(e);if(a){const r={};let c=1;for(const l in o)if(Dn(o,l)){const d=o[l],f=d.groups?d.groups+1:1;!d.literal&&d.token&&(r[d.token.val[0]]=d.deser(a.slice(c,c+f))),c+=f}return[a,r]}else return[a,{}]}function fd(n){const e=c=>{switch(c){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let o=null,a;return et(n.z)||(o=Fe.create(n.z)),et(n.Z)||(o||(o=new Gt(n.Z)),a=n.Z),et(n.q)||(n.M=(n.q-1)*3+1),et(n.h)||(n.h<12&&n.a===1?n.h+=12:n.h===12&&n.a===0&&(n.h=0)),n.G===0&&n.y&&(n.y=-n.y),et(n.u)||(n.S=Ua(n.u)),[Object.keys(n).reduce((c,l)=>{const d=e(l);return d&&(c[d]=n[l]),c},{}),o,a]}let la=null;function md(){return la||(la=J.fromMillis(1555555555555)),la}function pd(n,e){if(n.literal)return n;const o=Bt.macroTokenToFormatOpts(n.val),a=Bl(o,e);return a==null||a.includes(void 0)?n:a}function Rl(n,e){return Array.prototype.concat(...n.map(o=>pd(o,e)))}class zl{constructor(e,o){if(this.locale=e,this.format=o,this.tokens=Rl(Bt.parseFormat(o),e),this.units=this.tokens.map(a=>ld(a,e)),this.disqualifyingUnit=this.units.find(a=>a.invalidReason),!this.disqualifyingUnit){const[a,r]=hd(this.units);this.regex=RegExp(a,"i"),this.handlers=r}}explainFromTokens(e){if(this.isValid){const[o,a]=dd(e,this.regex,this.handlers),[r,c,l]=a?fd(a):[null,null,void 0];if(Dn(a,"a")&&Dn(a,"H"))throw new Cn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:o,matches:a,result:r,zone:c,specificOffset:l}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function $l(n,e,o){return new zl(n,o).explainFromTokens(e)}function gd(n,e,o){const{result:a,zone:r,specificOffset:c,invalidReason:l}=$l(n,e,o);return[a,r,c,l]}function Bl(n,e){if(!n)return null;const a=Bt.create(e,n).dtFormatter(md()),r=a.formatToParts(),c=a.resolvedOptions();return r.map(l=>ud(l,n,c))}const ca="Invalid DateTime",wr=864e13;function ii(n){return new ge("unsupported zone",`the zone "${n.name}" is not supported`)}function ua(n){return n.weekData===null&&(n.weekData=fo(n.c)),n.weekData}function ha(n){return n.localWeekData===null&&(n.localWeekData=fo(n.c,n.loc.getMinDaysInFirstWeek(),n.loc.getStartOfWeek())),n.localWeekData}function on(n,e){const o={ts:n.ts,zone:n.zone,c:n.c,o:n.o,loc:n.loc,invalid:n.invalid};return new J({...o,...e,old:o})}function Ul(n,e,o){let a=n-e*60*1e3;const r=o.offset(a);if(e===r)return[a,e];a-=(r-e)*60*1e3;const c=o.offset(a);return r===c?[a,r]:[n-Math.min(r,c)*60*1e3,Math.max(r,c)]}function oo(n,e){n+=e*60*1e3;const o=new Date(n);return{year:o.getUTCFullYear(),month:o.getUTCMonth()+1,day:o.getUTCDate(),hour:o.getUTCHours(),minute:o.getUTCMinutes(),second:o.getUTCSeconds(),millisecond:o.getUTCMilliseconds()}}function ro(n,e,o){return Ul(Lo(n),e,o)}function Lr(n,e){const o=n.o,a=n.c.year+Math.trunc(e.years),r=n.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,c={...n.c,year:a,month:r,day:Math.min(n.c.day,mo(a,r))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},l=ct.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),d=Lo(c);let[f,p]=Ul(d,o,n.zone);return l!==0&&(f+=l,p=n.zone.offset(f)),{ts:f,o:p}}function Pn(n,e,o,a,r,c){const{setZone:l,zone:d}=o;if(n&&Object.keys(n).length!==0||e){const f=e||d,p=J.fromObject(n,{...o,zone:f,specificOffset:c});return l?p:p.setZone(d)}else return J.invalid(new ge("unparsable",`the input "${r}" can't be parsed as ${a}`))}function ao(n,e,o=!0){return n.isValid?Bt.create(ft.create("en-US"),{allowZ:o,forceSimple:!0}).formatDateTimeFromString(n,e):null}function da(n,e){const o=n.c.year>9999||n.c.year<0;let a="";return o&&n.c.year>=0&&(a+="+"),a+=Et(n.c.year,o?6:4),e?(a+="-",a+=Et(n.c.month),a+="-",a+=Et(n.c.day)):(a+=Et(n.c.month),a+=Et(n.c.day)),a}function Mr(n,e,o,a,r,c){let l=Et(n.c.hour);return e?(l+=":",l+=Et(n.c.minute),(n.c.millisecond!==0||n.c.second!==0||!o)&&(l+=":")):l+=Et(n.c.minute),(n.c.millisecond!==0||n.c.second!==0||!o)&&(l+=Et(n.c.second),(n.c.millisecond!==0||!a)&&(l+=".",l+=Et(n.c.millisecond,3))),r&&(n.isOffsetFixed&&n.offset===0&&!c?l+="Z":n.o<0?(l+="-",l+=Et(Math.trunc(-n.o/60)),l+=":",l+=Et(Math.trunc(-n.o%60))):(l+="+",l+=Et(Math.trunc(n.o/60)),l+=":",l+=Et(Math.trunc(n.o%60)))),c&&(l+="["+n.zone.ianaName+"]"),l}const Zl={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},_d={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},yd={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Hl=["year","month","day","hour","minute","second","millisecond"],vd=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],wd=["year","ordinal","hour","minute","second","millisecond"];function Ld(n){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[n.toLowerCase()];if(!e)throw new Zr(n);return e}function br(n){switch(n.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return Ld(n)}}function Md(n){if(oi===void 0&&(oi=Tt.now()),n.type!=="iana")return n.offset(oi);const e=n.name;let o=Aa.get(e);return o===void 0&&(o=n.offset(oi),Aa.set(e,o)),o}function Tr(n,e){const o=Ge(e.zone,Tt.defaultZone);if(!o.isValid)return J.invalid(ii(o));const a=ft.fromObject(e);let r,c;if(et(n.year))r=Tt.now();else{for(const f of Hl)et(n[f])&&(n[f]=Zl[f]);const l=ml(n)||pl(n);if(l)return J.invalid(l);const d=Md(o);[r,c]=ro(n,d,o)}return new J({ts:r,zone:o,loc:a,o:c})}function Sr(n,e,o){const a=et(o.round)?!0:o.round,r=(l,d)=>(l=Za(l,a||o.calendary?0:2,!0),e.loc.clone(o).relFormatter(o).format(l,d)),c=l=>o.calendary?e.hasSame(n,l)?0:e.startOf(l).diff(n.startOf(l),l).get(l):e.diff(n,l).get(l);if(o.unit)return r(c(o.unit),o.unit);for(const l of o.units){const d=c(l);if(Math.abs(d)>=1)return r(d,l)}return r(n>e?-0:0,o.units[o.units.length-1])}function Pr(n){let e={},o;return n.length>0&&typeof n[n.length-1]=="object"?(e=n[n.length-1],o=Array.from(n).slice(0,n.length-1)):o=Array.from(n),[e,o]}let oi;const Aa=new Map;class J{constructor(e){const o=e.zone||Tt.defaultZone;let a=e.invalid||(Number.isNaN(e.ts)?new ge("invalid input"):null)||(o.isValid?null:ii(o));this.ts=et(e.ts)?Tt.now():e.ts;let r=null,c=null;if(!a)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(o))[r,c]=[e.old.c,e.old.o];else{const d=Ve(e.o)&&!e.old?e.o:o.offset(this.ts);r=oo(this.ts,d),a=Number.isNaN(r.year)?new ge("invalid input"):null,r=a?null:r,c=a?null:d}this._zone=o,this.loc=e.loc||ft.create(),this.invalid=a,this.weekData=null,this.localWeekData=null,this.c=r,this.o=c,this.isLuxonDateTime=!0}static now(){return new J({})}static local(){const[e,o]=Pr(arguments),[a,r,c,l,d,f,p]=o;return Tr({year:a,month:r,day:c,hour:l,minute:d,second:f,millisecond:p},e)}static utc(){const[e,o]=Pr(arguments),[a,r,c,l,d,f,p]=o;return e.zone=Gt.utcInstance,Tr({year:a,month:r,day:c,hour:l,minute:d,second:f,millisecond:p},e)}static fromJSDate(e,o={}){const a=Xu(e)?e.valueOf():NaN;if(Number.isNaN(a))return J.invalid("invalid input");const r=Ge(o.zone,Tt.defaultZone);return r.isValid?new J({ts:a,zone:r,loc:ft.fromObject(o)}):J.invalid(ii(r))}static fromMillis(e,o={}){if(Ve(e))return e<-wr||e>wr?J.invalid("Timestamp out of range"):new J({ts:e,zone:Ge(o.zone,Tt.defaultZone),loc:ft.fromObject(o)});throw new $t(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,o={}){if(Ve(e))return new J({ts:e*1e3,zone:Ge(o.zone,Tt.defaultZone),loc:ft.fromObject(o)});throw new $t("fromSeconds requires a numerical input")}static fromObject(e,o={}){e=e||{};const a=Ge(o.zone,Tt.defaultZone);if(!a.isValid)return J.invalid(ii(a));const r=ft.fromObject(o),c=po(e,br),{minDaysInFirstWeek:l,startOfWeek:d}=ur(c,r),f=Tt.now(),p=et(o.specificOffset)?a.offset(f):o.specificOffset,g=!et(c.ordinal),y=!et(c.year),v=!et(c.month)||!et(c.day),M=y||v,b=c.weekYear||c.weekNumber;if((M||g)&&b)throw new Cn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(v&&g)throw new Cn("Can't mix ordinal dates with month/day");const S=b||c.weekday&&!M;let k,E,C=oo(f,p);S?(k=vd,E=_d,C=fo(C,l,d)):g?(k=wd,E=yd,C=ra(C)):(k=Hl,E=Zl);let I=!1;for(const K of k){const z=c[K];et(z)?I?c[K]=E[K]:c[K]=C[K]:I=!0}const x=S?qu(c,l,d):g?Ku(c):ml(c),N=x||pl(c);if(N)return J.invalid(N);const R=S?lr(c,l,d):g?cr(c):c,[F,$]=ro(R,p,a),G=new J({ts:F,zone:a,o:$,loc:r});return c.weekday&&M&&e.weekday!==G.weekday?J.invalid("mismatched weekday",`you can't specify both a weekday of ${c.weekday} and a date of ${G.toISO()}`):G.isValid?G:J.invalid(G.invalid)}static fromISO(e,o={}){const[a,r]=Uh(e);return Pn(a,r,o,"ISO 8601",e)}static fromRFC2822(e,o={}){const[a,r]=Zh(e);return Pn(a,r,o,"RFC 2822",e)}static fromHTTP(e,o={}){const[a,r]=Hh(e);return Pn(a,r,o,"HTTP",o)}static fromFormat(e,o,a={}){if(et(e)||et(o))throw new $t("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:c=null}=a,l=ft.fromOpts({locale:r,numberingSystem:c,defaultToEN:!0}),[d,f,p,g]=gd(l,e,o);return g?J.invalid(g):Pn(d,f,a,`format ${o}`,e,p)}static fromString(e,o,a={}){return J.fromFormat(e,o,a)}static fromSQL(e,o={}){const[a,r]=Kh(e);return Pn(a,r,o,"SQL",e)}static invalid(e,o=null){if(!e)throw new $t("need to specify a reason the DateTime is invalid");const a=e instanceof ge?e:new ge(e,o);if(Tt.throwOnInvalid)throw new bu(a);return new J({invalid:a})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,o={}){const a=Bl(e,ft.fromObject(o));return a?a.map(r=>r?r.val:null).join(""):null}static expandFormat(e,o={}){return Rl(Bt.parseFormat(e),ft.fromObject(o)).map(r=>r.val).join("")}static resetCache(){oi=void 0,Aa.clear()}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?ua(this).weekYear:NaN}get weekNumber(){return this.isValid?ua(this).weekNumber:NaN}get weekday(){return this.isValid?ua(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?ha(this).weekday:NaN}get localWeekNumber(){return this.isValid?ha(this).weekNumber:NaN}get localWeekYear(){return this.isValid?ha(this).weekYear:NaN}get ordinal(){return this.isValid?ra(this.c).ordinal:NaN}get monthShort(){return this.isValid?no.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?no.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?no.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?no.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,o=6e4,a=Lo(this.c),r=this.zone.offset(a-e),c=this.zone.offset(a+e),l=this.zone.offset(a-r*o),d=this.zone.offset(a-c*o);if(l===d)return[this];const f=a-l*o,p=a-d*o,g=oo(f,l),y=oo(p,d);return g.hour===y.hour&&g.minute===y.minute&&g.second===y.second&&g.millisecond===y.millisecond?[on(this,{ts:f}),on(this,{ts:p})]:[this]}get isInLeapYear(){return gi(this.year)}get daysInMonth(){return mo(this.year,this.month)}get daysInYear(){return this.isValid?An(this.year):NaN}get weeksInWeekYear(){return this.isValid?ui(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?ui(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:o,numberingSystem:a,calendar:r}=Bt.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:o,numberingSystem:a,outputCalendar:r}}toUTC(e=0,o={}){return this.setZone(Gt.instance(e),o)}toLocal(){return this.setZone(Tt.defaultZone)}setZone(e,{keepLocalTime:o=!1,keepCalendarTime:a=!1}={}){if(e=Ge(e,Tt.defaultZone),e.equals(this.zone))return this;if(e.isValid){let r=this.ts;if(o||a){const c=e.offset(this.ts),l=this.toObject();[r]=ro(l,c,e)}return on(this,{ts:r,zone:e})}else return J.invalid(ii(e))}reconfigure({locale:e,numberingSystem:o,outputCalendar:a}={}){const r=this.loc.clone({locale:e,numberingSystem:o,outputCalendar:a});return on(this,{loc:r})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const o=po(e,br),{minDaysInFirstWeek:a,startOfWeek:r}=ur(o,this.loc),c=!et(o.weekYear)||!et(o.weekNumber)||!et(o.weekday),l=!et(o.ordinal),d=!et(o.year),f=!et(o.month)||!et(o.day),p=d||f,g=o.weekYear||o.weekNumber;if((p||l)&&g)throw new Cn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&l)throw new Cn("Can't mix ordinal dates with month/day");let y;c?y=lr({...fo(this.c,a,r),...o},a,r):et(o.ordinal)?(y={...this.toObject(),...o},et(o.day)&&(y.day=Math.min(mo(y.year,y.month),y.day))):y=cr({...ra(this.c),...o});const[v,M]=ro(y,this.o,this.zone);return on(this,{ts:v,o:M})}plus(e){if(!this.isValid)return this;const o=ct.fromDurationLike(e);return on(this,Lr(this,o))}minus(e){if(!this.isValid)return this;const o=ct.fromDurationLike(e).negate();return on(this,Lr(this,o))}startOf(e,{useLocaleWeeks:o=!1}={}){if(!this.isValid)return this;const a={},r=ct.normalizeUnit(e);switch(r){case"years":a.month=1;case"quarters":case"months":a.day=1;case"weeks":case"days":a.hour=0;case"hours":a.minute=0;case"minutes":a.second=0;case"seconds":a.millisecond=0;break}if(r==="weeks")if(o){const c=this.loc.getStartOfWeek(),{weekday:l}=this;l<c&&(a.weekNumber=this.weekNumber-1),a.weekday=c}else a.weekday=1;if(r==="quarters"){const c=Math.ceil(this.month/3);a.month=(c-1)*3+1}return this.set(a)}endOf(e,o){return this.isValid?this.plus({[e]:1}).startOf(e,o).minus(1):this}toFormat(e,o={}){return this.isValid?Bt.create(this.loc.redefaultToEN(o)).formatDateTimeFromString(this,e):ca}toLocaleString(e=ho,o={}){return this.isValid?Bt.create(this.loc.clone(o),e).formatDateTime(this):ca}toLocaleParts(e={}){return this.isValid?Bt.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:o=!1,suppressMilliseconds:a=!1,includeOffset:r=!0,extendedZone:c=!1}={}){if(!this.isValid)return null;const l=e==="extended";let d=da(this,l);return d+="T",d+=Mr(this,l,o,a,r,c),d}toISODate({format:e="extended"}={}){return this.isValid?da(this,e==="extended"):null}toISOWeekDate(){return ao(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:o=!1,includeOffset:a=!0,includePrefix:r=!1,extendedZone:c=!1,format:l="extended"}={}){return this.isValid?(r?"T":"")+Mr(this,l==="extended",o,e,a,c):null}toRFC2822(){return ao(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ao(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?da(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:o=!1,includeOffsetSpace:a=!0}={}){let r="HH:mm:ss.SSS";return(o||e)&&(a&&(r+=" "),o?r+="z":e&&(r+="ZZ")),ao(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():ca}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const o={...this.c};return e.includeConfig&&(o.outputCalendar=this.outputCalendar,o.numberingSystem=this.loc.numberingSystem,o.locale=this.loc.locale),o}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,o="milliseconds",a={}){if(!this.isValid||!e.isValid)return ct.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...a},c=Qu(o).map(ct.normalizeUnit),l=e.valueOf()>this.valueOf(),d=l?this:e,f=l?e:this,p=id(d,f,c,r);return l?p.negate():p}diffNow(e="milliseconds",o={}){return this.diff(J.now(),e,o)}until(e){return this.isValid?bt.fromDateTimes(this,e):this}hasSame(e,o,a){if(!this.isValid)return!1;const r=e.valueOf(),c=this.setZone(e.zone,{keepLocalTime:!0});return c.startOf(o,a)<=r&&r<=c.endOf(o,a)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const o=e.base||J.fromObject({},{zone:this.zone}),a=e.padding?this<o?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],c=e.unit;return Array.isArray(e.unit)&&(r=e.unit,c=void 0),Sr(o,this.plus(a),{...e,numeric:"always",units:r,unit:c})}toRelativeCalendar(e={}){return this.isValid?Sr(e.base||J.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(J.isDateTime))throw new $t("min requires all arguments be DateTimes");return hr(e,o=>o.valueOf(),Math.min)}static max(...e){if(!e.every(J.isDateTime))throw new $t("max requires all arguments be DateTimes");return hr(e,o=>o.valueOf(),Math.max)}static fromFormatExplain(e,o,a={}){const{locale:r=null,numberingSystem:c=null}=a,l=ft.fromOpts({locale:r,numberingSystem:c,defaultToEN:!0});return $l(l,e,o)}static fromStringExplain(e,o,a={}){return J.fromFormatExplain(e,o,a)}static buildFormatParser(e,o={}){const{locale:a=null,numberingSystem:r=null}=o,c=ft.fromOpts({locale:a,numberingSystem:r,defaultToEN:!0});return new zl(c,e)}static fromFormatParser(e,o,a={}){if(et(e)||et(o))throw new $t("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:c=null}=a,l=ft.fromOpts({locale:r,numberingSystem:c,defaultToEN:!0});if(!l.equals(o.locale))throw new $t(`fromFormatParser called with a locale of ${l}, but the format parser was created for ${o.locale}`);const{result:d,zone:f,specificOffset:p,invalidReason:g}=o.explainFromTokens(e);return g?J.invalid(g):Pn(d,f,a,`format ${o.format}`,e,p)}static get DATE_SHORT(){return ho}static get DATE_MED(){return Hr}static get DATE_MED_WITH_WEEKDAY(){return Pu}static get DATE_FULL(){return Wr}static get DATE_HUGE(){return Gr}static get TIME_SIMPLE(){return Vr}static get TIME_WITH_SECONDS(){return Jr}static get TIME_WITH_SHORT_OFFSET(){return jr}static get TIME_WITH_LONG_OFFSET(){return qr}static get TIME_24_SIMPLE(){return Kr}static get TIME_24_WITH_SECONDS(){return Yr}static get TIME_24_WITH_SHORT_OFFSET(){return Xr}static get TIME_24_WITH_LONG_OFFSET(){return Qr}static get DATETIME_SHORT(){return tl}static get DATETIME_SHORT_WITH_SECONDS(){return el}static get DATETIME_MED(){return nl}static get DATETIME_MED_WITH_SECONDS(){return il}static get DATETIME_MED_WITH_WEEKDAY(){return ku}static get DATETIME_FULL(){return ol}static get DATETIME_FULL_WITH_SECONDS(){return al}static get DATETIME_HUGE(){return sl}static get DATETIME_HUGE_WITH_SECONDS(){return rl}}function ei(n){if(J.isDateTime(n))return n;if(n&&n.valueOf&&Ve(n.valueOf()))return J.fromJSDate(n);if(n&&typeof n=="object")return J.fromObject(n);throw new $t(`Unknown datetime argument: ${n}, of type ${typeof n}`)}async function cn(n,e,o=null){return console.log("[weatherManager] Starting full weather fetch for location:",{lat:n,lng:e}),await Td(n,e),await bd(n,e,o)}async function bd(n,e,o=null){var r,c;const a=document.getElementById("loading");a&&(a.style.display="block");try{const l=((r=document.getElementById("modelSelect"))==null?void 0:r.value)||_.defaultSettings.model;if(!l)throw new Error("No weather model selected.");const f=Fr.API_MAP[l]||l;let p=!1,g,y;const v=J.utc().startOf("day");let M=null;if(o){let I=J.fromISO(o,{zone:"utc"});I.isValid&&(M=I.startOf("day"),M<v&&(p=!0))}else{const I=(c=document.getElementById("historicalDatePicker"))==null?void 0:c.value;if(I){let x=J.fromISO(I,{zone:"utc"}).startOf("day");x<v&&(p=!0,M=x)}}let b=ci.FORECAST;if(p&&M)b=ci.HISTORICAL,g=y=M.toFormat("yyyy-MM-dd"),u.lastModelRun="N/A (Historical Data)";else{let I;try{const R=`https://api.open-meteo.com/data/${f}/static/meta.json`,$=await(await fetch(R)).json();I=new Date($.last_run_initialisation_time*1e3),u.lastModelRun=I.toISOString().replace("T"," ").substring(0,17)+"Z"}catch{I=new Date,u.lastModelRun="N/A"}let x=J.fromJSDate(I).setZone("utc").plus({hours:6});x>J.utc()&&(x=J.utc()),g=x.toFormat("yyyy-MM-dd");const N=l.includes("_d2")?2:7;y=x.plus({days:N}).toFormat("yyyy-MM-dd")}const k=`${b}?latitude=${n}&longitude=${e}&hourly=surface_pressure,temperature_2m,relative_humidity_2m,wind_speed_10m,wind_direction_10m,wind_gusts_10m,temperature_1000hPa,relative_humidity_1000hPa,wind_speed_1000hPa,wind_direction_1000hPa,geopotential_height_1000hPa,temperature_950hPa,relative_humidity_950hPa,wind_speed_950hPa,wind_direction_950hPa,geopotential_height_950hPa,temperature_925hPa,relative_humidity_925hPa,wind_speed_925hPa,wind_direction_925hPa,geopotential_height_925hPa,temperature_900hPa,relative_humidity_900hPa,wind_speed_900hPa,wind_direction_900hPa,geopotential_height_900hPa,temperature_850hPa,relative_humidity_850hPa,wind_speed_850hPa,wind_direction_850hPa,geopotential_height_850hPa,temperature_800hPa,relative_humidity_800hPa,wind_speed_800hPa,wind_direction_800hPa,geopotential_height_800hPa,temperature_700hPa,relative_humidity_700hPa,wind_speed_700hPa,wind_direction_700hPa,geopotential_height_700hPa,temperature_600hPa,relative_humidity_600hPa,wind_speed_600hPa,wind_direction_600hPa,geopotential_height_600hPa,temperature_500hPa,relative_humidity_500hPa,wind_speed_500hPa,wind_direction_500hPa,geopotential_height_500hPa,temperature_400hPa,relative_humidity_400hPa,wind_speed_400hPa,wind_direction_400hPa,geopotential_height_400hPa,temperature_300hPa,relative_humidity_300hPa,wind_speed_300hPa,wind_direction_300hPa,geopotential_height_300hPa,temperature_250hPa,relative_humidity_250hPa,wind_speed_250hPa,wind_direction_250hPa,geopotential_height_250hPa,temperature_200hPa,relative_humidity_200hPa,wind_speed_200hPa,wind_direction_200hPa,geopotential_height_200hPa&models=${l}&start_date=${g}&end_date=${y}`,E=await fetch(k);if(!E.ok)throw new Error(`HTTP error! Status: ${E.status}`);const C=await E.json();if(!C.hourly||!C.hourly.time||!C.hourly.time.length)throw new Error("No hourly data in API response.");return C.hourly}catch(l){return console.error("[fetchWeather] Error:",l),Nn(`Failed to fetch weather: ${l.message}`),null}finally{a&&(a.style.display="none")}}async function Td(n,e){const o=Fr.LIST;let a=[];for(const r of o)try{const c=await fetch(`${ci.FORECAST}?latitude=${n}&longitude=${e}&hourly=temperature_2m&models=${r}`);if(c.ok){const l=await c.json();l.hourly&&l.hourly.temperature_2m&&l.hourly.temperature_2m.some(d=>d!==null)&&a.push(r)}else console.warn(`Modell '${r}' ist nicht verfügbar (Server-Antwort: ${c.status})`)}catch(c){console.error(`Netzwerkfehler beim Abruf von Modell '${r}':`,c)}return xd(a),Ad(a),Id(a),a}function un(n){if(!u.weatherData||!u.weatherData.time||n>=u.weatherData.time.length)return console.warn("No weather data available for interpolation"),[];const e=Math.round(u.lastAltitude),o=parseInt(Rr())||100,a=_.getValue("heightUnit","radio","m"),c=wu.filter(F=>{var G;const $=(G=u.weatherData[`geopotential_height_${F}hPa`])==null?void 0:G[n];return $!=null});if(c.length<2)return console.warn("Insufficient valid pressure level data for interpolation:",c),[];let l=c.map(F=>u.weatherData[`geopotential_height_${F}hPa`][n]),d=c.map(F=>u.weatherData[`temperature_${F}hPa`][n]),f=c.map(F=>u.weatherData[`relative_humidity_${F}hPa`][n]),p=c.map(F=>u.weatherData[`wind_speed_${F}hPa`][n]),g=c.map(F=>u.weatherData[`wind_direction_${F}hPa`][n]);const y=u.weatherData.surface_pressure[n];if(y==null)return console.warn("Surface pressure missing"),[];let v=p.map((F,$)=>-F*Math.sin(g[$]*Math.PI/180)),M=p.map((F,$)=>-F*Math.cos(g[$]*Math.PI/180));const b=Math.max(...c),S=u.weatherData[`geopotential_height_${b}hPa`][n];if(y>b&&Number.isFinite(S)&&S>e){const F=Math.floor((S-e)/o),$=-u.weatherData.wind_speed_10m[n]*Math.sin(u.weatherData.wind_direction_10m[n]*Math.PI/180),G=-u.weatherData.wind_speed_10m[n]*Math.cos(u.weatherData.wind_direction_10m[n]*Math.PI/180),K=v[c.indexOf(b)],z=M[c.indexOf(b)];for(let B=F-1;B>=1;B--){const Y=e+B*o;if(Y>=S)continue;const nt=(Y-e)/(S-e),wt=Math.log(y),q=Math.log(b),Lt=wt+nt*(q-wt),H=Math.exp(Lt),vt=Math.log(Y-e+1),V=Math.log(1),tt=Math.log(S-e),pt=T.linearInterpolate([V,tt],[$,K],vt),gt=T.linearInterpolate([V,tt],[G,z],vt),mt=T.windSpeed(pt,gt),X=T.windDirection(pt,gt);l.unshift(Y),c.unshift(H),d.unshift(T.linearInterpolate([e,S],[u.weatherData.temperature_2m[n],u.weatherData[`temperature_${b}hPa`][n]],Y)),f.unshift(T.linearInterpolate([e,S],[u.weatherData.relative_humidity_2m[n],u.weatherData[`relative_humidity_${b}hPa`][n]],Y)),p.unshift(mt),g.unshift(X),v.unshift(pt),M.unshift(gt)}l.unshift(e),c.unshift(y),d.unshift(u.weatherData.temperature_2m[n]),f.unshift(u.weatherData.relative_humidity_2m[n]),p.unshift(u.weatherData.wind_speed_10m[n]),g.unshift(u.weatherData.wind_direction_10m[n]),v.unshift($),M.unshift(G)}const k=c.indexOf(Math.min(...c)),E=l[k],C=E-e;if(C<=0||isNaN(C))return console.warn("Invalid max height at lowest pressure level:",{maxHeightASL:E,baseHeight:e,minPressure:c[k]}),[];const I=a==="ft"?C*3.28084:C,x=Math.floor(I/o),N=Array.from({length:x+1},(F,$)=>$*o);console.log("Interpolating up to lowest pressure level:",{maxHeightAGL:C,minPressure:c[k],interpStep:o});const R=[];return N.forEach(F=>{const $=a==="ft"?F/3.28084:F,G=e+$;let K;if($===0)K={height:G,pressure:y,temp:u.weatherData.temperature_2m[n],rh:u.weatherData.relative_humidity_2m[n],spd:u.weatherData.wind_speed_10m[n],dir:u.weatherData.wind_direction_10m[n],dew:T.calculateDewpoint(u.weatherData.temperature_2m[n],u.weatherData.relative_humidity_2m[n])};else{const z=T.interpolatePressure(G,c,l),B=T.interpolateWindAtAltitude(G,c,l,v,M),Y=T.windSpeed(B.u,B.v),nt=T.windDirection(B.u,B.v),wt=T.linearInterpolate(l,d,G),q=T.linearInterpolate(l,f,G),Lt=T.calculateDewpoint(wt,q);K={height:G,pressure:z==="N/A"?"N/A":Number(z.toFixed(1)),temp:Number(wt.toFixed(1)),rh:Number(q.toFixed(0)),spd:Number(Y.toFixed(1)),dir:Number(nt.toFixed(0)),dew:Number(Lt.toFixed(1))}}K.displayHeight=F,R.push(K)}),console.log("Interpolated data length:",R.length,"Max height:",R[R.length-1].displayHeight),R}var ai={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var Sd=ai.exports,kr;function Wl(){return kr||(kr=1,function(n,e){(function(o,a){a(e)})(Sd,function(o){var a="1.9.4";function r(t){var i,s,h,m;for(s=1,h=arguments.length;s<h;s++){m=arguments[s];for(i in m)t[i]=m[i]}return t}var c=Object.create||function(){function t(){}return function(i){return t.prototype=i,new t}}();function l(t,i){var s=Array.prototype.slice;if(t.bind)return t.bind.apply(t,s.call(arguments,1));var h=s.call(arguments,2);return function(){return t.apply(i,h.length?h.concat(s.call(arguments)):arguments)}}var d=0;function f(t){return"_leaflet_id"in t||(t._leaflet_id=++d),t._leaflet_id}function p(t,i,s){var h,m,w,P;return P=function(){h=!1,m&&(w.apply(s,m),m=!1)},w=function(){h?m=arguments:(t.apply(s,arguments),setTimeout(P,i),h=!0)},w}function g(t,i,s){var h=i[1],m=i[0],w=h-m;return t===h&&s?t:((t-m)%w+w)%w+m}function y(){return!1}function v(t,i){if(i===!1)return t;var s=Math.pow(10,i===void 0?6:i);return Math.round(t*s)/s}function M(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function b(t){return M(t).split(/\s+/)}function S(t,i){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?c(t.options):{});for(var s in i)t.options[s]=i[s];return t.options}function k(t,i,s){var h=[];for(var m in t)h.push(encodeURIComponent(s?m.toUpperCase():m)+"="+encodeURIComponent(t[m]));return(!i||i.indexOf("?")===-1?"?":"&")+h.join("&")}var E=/\{ *([\w_ -]+) *\}/g;function C(t,i){return t.replace(E,function(s,h){var m=i[h];if(m===void 0)throw new Error("No value provided for variable "+s);return typeof m=="function"&&(m=m(i)),m})}var I=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function x(t,i){for(var s=0;s<t.length;s++)if(t[s]===i)return s;return-1}var N="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function R(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var F=0;function $(t){var i=+new Date,s=Math.max(0,16-(i-F));return F=i+s,window.setTimeout(t,s)}var G=window.requestAnimationFrame||R("RequestAnimationFrame")||$,K=window.cancelAnimationFrame||R("CancelAnimationFrame")||R("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function z(t,i,s){if(s&&G===$)t.call(i);else return G.call(window,l(t,i))}function B(t){t&&K.call(window,t)}var Y={__proto__:null,extend:r,create:c,bind:l,get lastId(){return d},stamp:f,throttle:p,wrapNum:g,falseFn:y,formatNum:v,trim:M,splitWords:b,setOptions:S,getParamString:k,template:C,isArray:I,indexOf:x,emptyImageUrl:N,requestFn:G,cancelFn:K,requestAnimFrame:z,cancelAnimFrame:B};function nt(){}nt.extend=function(t){var i=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},s=i.__super__=this.prototype,h=c(s);h.constructor=i,i.prototype=h;for(var m in this)Object.prototype.hasOwnProperty.call(this,m)&&m!=="prototype"&&m!=="__super__"&&(i[m]=this[m]);return t.statics&&r(i,t.statics),t.includes&&(wt(t.includes),r.apply(null,[h].concat(t.includes))),r(h,t),delete h.statics,delete h.includes,h.options&&(h.options=s.options?c(s.options):{},r(h.options,t.options)),h._initHooks=[],h.callInitHooks=function(){if(!this._initHooksCalled){s.callInitHooks&&s.callInitHooks.call(this),this._initHooksCalled=!0;for(var w=0,P=h._initHooks.length;w<P;w++)h._initHooks[w].call(this)}},i},nt.include=function(t){var i=this.prototype.options;return r(this.prototype,t),t.options&&(this.prototype.options=i,this.mergeOptions(t.options)),this},nt.mergeOptions=function(t){return r(this.prototype.options,t),this},nt.addInitHook=function(t){var i=Array.prototype.slice.call(arguments,1),s=typeof t=="function"?t:function(){this[t].apply(this,i)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(s),this};function wt(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=I(t)?t:[t];for(var i=0;i<t.length;i++)t[i]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var q={on:function(t,i,s){if(typeof t=="object")for(var h in t)this._on(h,t[h],i);else{t=b(t);for(var m=0,w=t.length;m<w;m++)this._on(t[m],i,s)}return this},off:function(t,i,s){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var h in t)this._off(h,t[h],i);else{t=b(t);for(var m=arguments.length===1,w=0,P=t.length;w<P;w++)m?this._off(t[w]):this._off(t[w],i,s)}return this},_on:function(t,i,s,h){if(typeof i!="function"){console.warn("wrong listener type: "+typeof i);return}if(this._listens(t,i,s)===!1){s===this&&(s=void 0);var m={fn:i,ctx:s};h&&(m.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(m)}},_off:function(t,i,s){var h,m,w;if(this._events&&(h=this._events[t],!!h)){if(arguments.length===1){if(this._firingCount)for(m=0,w=h.length;m<w;m++)h[m].fn=y;delete this._events[t];return}if(typeof i!="function"){console.warn("wrong listener type: "+typeof i);return}var P=this._listens(t,i,s);if(P!==!1){var A=h[P];this._firingCount&&(A.fn=y,this._events[t]=h=h.slice()),h.splice(P,1)}}},fire:function(t,i,s){if(!this.listens(t,s))return this;var h=r({},i,{type:t,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var m=this._events[t];if(m){this._firingCount=this._firingCount+1||1;for(var w=0,P=m.length;w<P;w++){var A=m[w],D=A.fn;A.once&&this.off(t,D,A.ctx),D.call(A.ctx||this,h)}this._firingCount--}}return s&&this._propagateEvent(h),this},listens:function(t,i,s,h){typeof t!="string"&&console.warn('"string" type argument expected');var m=i;typeof i!="function"&&(h=!!i,m=void 0,s=void 0);var w=this._events&&this._events[t];if(w&&w.length&&this._listens(t,m,s)!==!1)return!0;if(h){for(var P in this._eventParents)if(this._eventParents[P].listens(t,i,s,h))return!0}return!1},_listens:function(t,i,s){if(!this._events)return!1;var h=this._events[t]||[];if(!i)return!!h.length;s===this&&(s=void 0);for(var m=0,w=h.length;m<w;m++)if(h[m].fn===i&&h[m].ctx===s)return m;return!1},once:function(t,i,s){if(typeof t=="object")for(var h in t)this._on(h,t[h],i,!0);else{t=b(t);for(var m=0,w=t.length;m<w;m++)this._on(t[m],i,s,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[f(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[f(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,r({layer:t.target,propagatedFrom:t.target},t),!0)}};q.addEventListener=q.on,q.removeEventListener=q.clearAllEventListeners=q.off,q.addOneTimeEventListener=q.once,q.fireEvent=q.fire,q.hasEventListeners=q.listens;var Lt=nt.extend(q);function H(t,i,s){this.x=s?Math.round(t):t,this.y=s?Math.round(i):i}var vt=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};H.prototype={clone:function(){return new H(this.x,this.y)},add:function(t){return this.clone()._add(V(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(V(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new H(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new H(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=vt(this.x),this.y=vt(this.y),this},distanceTo:function(t){t=V(t);var i=t.x-this.x,s=t.y-this.y;return Math.sqrt(i*i+s*s)},equals:function(t){return t=V(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=V(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+v(this.x)+", "+v(this.y)+")"}};function V(t,i,s){return t instanceof H?t:I(t)?new H(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new H(t.x,t.y):new H(t,i,s)}function tt(t,i){if(t)for(var s=i?[t,i]:t,h=0,m=s.length;h<m;h++)this.extend(s[h])}tt.prototype={extend:function(t){var i,s;if(!t)return this;if(t instanceof H||typeof t[0]=="number"||"x"in t)i=s=V(t);else if(t=pt(t),i=t.min,s=t.max,!i||!s)return this;return!this.min&&!this.max?(this.min=i.clone(),this.max=s.clone()):(this.min.x=Math.min(i.x,this.min.x),this.max.x=Math.max(s.x,this.max.x),this.min.y=Math.min(i.y,this.min.y),this.max.y=Math.max(s.y,this.max.y)),this},getCenter:function(t){return V((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return V(this.min.x,this.max.y)},getTopRight:function(){return V(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var i,s;return typeof t[0]=="number"||t instanceof H?t=V(t):t=pt(t),t instanceof tt?(i=t.min,s=t.max):i=s=t,i.x>=this.min.x&&s.x<=this.max.x&&i.y>=this.min.y&&s.y<=this.max.y},intersects:function(t){t=pt(t);var i=this.min,s=this.max,h=t.min,m=t.max,w=m.x>=i.x&&h.x<=s.x,P=m.y>=i.y&&h.y<=s.y;return w&&P},overlaps:function(t){t=pt(t);var i=this.min,s=this.max,h=t.min,m=t.max,w=m.x>i.x&&h.x<s.x,P=m.y>i.y&&h.y<s.y;return w&&P},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var i=this.min,s=this.max,h=Math.abs(i.x-s.x)*t,m=Math.abs(i.y-s.y)*t;return pt(V(i.x-h,i.y-m),V(s.x+h,s.y+m))},equals:function(t){return t?(t=pt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function pt(t,i){return!t||t instanceof tt?t:new tt(t,i)}function gt(t,i){if(t)for(var s=i?[t,i]:t,h=0,m=s.length;h<m;h++)this.extend(s[h])}gt.prototype={extend:function(t){var i=this._southWest,s=this._northEast,h,m;if(t instanceof X)h=t,m=t;else if(t instanceof gt){if(h=t._southWest,m=t._northEast,!h||!m)return this}else return t?this.extend(W(t)||mt(t)):this;return!i&&!s?(this._southWest=new X(h.lat,h.lng),this._northEast=new X(m.lat,m.lng)):(i.lat=Math.min(h.lat,i.lat),i.lng=Math.min(h.lng,i.lng),s.lat=Math.max(m.lat,s.lat),s.lng=Math.max(m.lng,s.lng)),this},pad:function(t){var i=this._southWest,s=this._northEast,h=Math.abs(i.lat-s.lat)*t,m=Math.abs(i.lng-s.lng)*t;return new gt(new X(i.lat-h,i.lng-m),new X(s.lat+h,s.lng+m))},getCenter:function(){return new X((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new X(this.getNorth(),this.getWest())},getSouthEast:function(){return new X(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof X||"lat"in t?t=W(t):t=mt(t);var i=this._southWest,s=this._northEast,h,m;return t instanceof gt?(h=t.getSouthWest(),m=t.getNorthEast()):h=m=t,h.lat>=i.lat&&m.lat<=s.lat&&h.lng>=i.lng&&m.lng<=s.lng},intersects:function(t){t=mt(t);var i=this._southWest,s=this._northEast,h=t.getSouthWest(),m=t.getNorthEast(),w=m.lat>=i.lat&&h.lat<=s.lat,P=m.lng>=i.lng&&h.lng<=s.lng;return w&&P},overlaps:function(t){t=mt(t);var i=this._southWest,s=this._northEast,h=t.getSouthWest(),m=t.getNorthEast(),w=m.lat>i.lat&&h.lat<s.lat,P=m.lng>i.lng&&h.lng<s.lng;return w&&P},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,i){return t?(t=mt(t),this._southWest.equals(t.getSouthWest(),i)&&this._northEast.equals(t.getNorthEast(),i)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function mt(t,i){return t instanceof gt?t:new gt(t,i)}function X(t,i,s){if(isNaN(t)||isNaN(i))throw new Error("Invalid LatLng object: ("+t+", "+i+")");this.lat=+t,this.lng=+i,s!==void 0&&(this.alt=+s)}X.prototype={equals:function(t,i){if(!t)return!1;t=W(t);var s=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return s<=(i===void 0?1e-9:i)},toString:function(t){return"LatLng("+v(this.lat,t)+", "+v(this.lng,t)+")"},distanceTo:function(t){return rt.distance(this,W(t))},wrap:function(){return rt.wrapLatLng(this)},toBounds:function(t){var i=180*t/40075017,s=i/Math.cos(Math.PI/180*this.lat);return mt([this.lat-i,this.lng-s],[this.lat+i,this.lng+s])},clone:function(){return new X(this.lat,this.lng,this.alt)}};function W(t,i,s){return t instanceof X?t:I(t)&&typeof t[0]!="object"?t.length===3?new X(t[0],t[1],t[2]):t.length===2?new X(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new X(t.lat,"lng"in t?t.lng:t.lon,t.alt):i===void 0?null:new X(t,i,s)}var ht={latLngToPoint:function(t,i){var s=this.projection.project(t),h=this.scale(i);return this.transformation._transform(s,h)},pointToLatLng:function(t,i){var s=this.scale(i),h=this.transformation.untransform(t,s);return this.projection.unproject(h)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var i=this.projection.bounds,s=this.scale(t),h=this.transformation.transform(i.min,s),m=this.transformation.transform(i.max,s);return new tt(h,m)},infinite:!1,wrapLatLng:function(t){var i=this.wrapLng?g(t.lng,this.wrapLng,!0):t.lng,s=this.wrapLat?g(t.lat,this.wrapLat,!0):t.lat,h=t.alt;return new X(s,i,h)},wrapLatLngBounds:function(t){var i=t.getCenter(),s=this.wrapLatLng(i),h=i.lat-s.lat,m=i.lng-s.lng;if(h===0&&m===0)return t;var w=t.getSouthWest(),P=t.getNorthEast(),A=new X(w.lat-h,w.lng-m),D=new X(P.lat-h,P.lng-m);return new gt(A,D)}},rt=r({},ht,{wrapLng:[-180,180],R:6371e3,distance:function(t,i){var s=Math.PI/180,h=t.lat*s,m=i.lat*s,w=Math.sin((i.lat-t.lat)*s/2),P=Math.sin((i.lng-t.lng)*s/2),A=w*w+Math.cos(h)*Math.cos(m)*P*P,D=2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A));return this.R*D}}),Ft=6378137,Zt={R:Ft,MAX_LATITUDE:85.0511287798,project:function(t){var i=Math.PI/180,s=this.MAX_LATITUDE,h=Math.max(Math.min(s,t.lat),-s),m=Math.sin(h*i);return new H(this.R*t.lng*i,this.R*Math.log((1+m)/(1-m))/2)},unproject:function(t){var i=180/Math.PI;return new X((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*i,t.x*i/this.R)},bounds:function(){var t=Ft*Math.PI;return new tt([-t,-t],[t,t])}()};function Rt(t,i,s,h){if(I(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=i,this._c=s,this._d=h}Rt.prototype={transform:function(t,i){return this._transform(t.clone(),i)},_transform:function(t,i){return i=i||1,t.x=i*(this._a*t.x+this._b),t.y=i*(this._c*t.y+this._d),t},untransform:function(t,i){return i=i||1,new H((t.x/i-this._b)/this._a,(t.y/i-this._d)/this._c)}};function qt(t,i,s,h){return new Rt(t,i,s,h)}var Kt=r({},rt,{code:"EPSG:3857",projection:Zt,transformation:function(){var t=.5/(Math.PI*Zt.R);return qt(t,.5,-t,.5)}()}),At=r({},Kt,{code:"EPSG:900913"});function Ht(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function he(t,i){var s="",h,m,w,P,A,D;for(h=0,w=t.length;h<w;h++){for(A=t[h],m=0,P=A.length;m<P;m++)D=A[m],s+=(m?"L":"M")+D.x+" "+D.y;s+=i?j.svg?"z":"x":""}return s||"M0 0"}var Se=document.documentElement.style,Pe="ActiveXObject"in window,wi=Pe&&!document.addEventListener,Li="msLaunchUri"in navigator&&!("documentMode"in document),Bn=Yt("webkit"),It=Yt("android"),Mi=Yt("android 2")||Yt("android 3"),hn=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),je=It&&Yt("Google")&&hn<537&&!("AudioNode"in window),te=!!window.opera,Re=!Li&&Yt("chrome"),qe=Yt("gecko")&&!Bn&&!te&&!Pe,ko=!Re&&Yt("safari"),Un=Yt("phantom"),bi="OTransition"in Se,Ti=navigator.platform.indexOf("Win")===0,Si=Pe&&"transition"in Se,Pi="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Mi,dn="MozPerspective"in Se,ki=!window.L_DISABLE_3D&&(Si||Pi||dn)&&!bi&&!Un,Ke=typeof orientation<"u"||Yt("mobile"),ke=Ke&&Bn,Eo=Ke&&Pi,Ei=!window.PointerEvent&&window.MSPointerEvent,Ci=!!(window.PointerEvent||Ei),xi="ontouchstart"in window||!!window.TouchEvent,Co=!window.L_NO_TOUCH&&(xi||Ci),Ai=Ke&&te,Dt=Ke&&qe,ye=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,fn=function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",y,i),window.removeEventListener("testPassiveEventSupport",y,i)}catch{}return t}(),xo=function(){return!!document.createElement("canvas").getContext}(),Zn=!!(document.createElementNS&&Ht("svg").createSVGRect),Ya=!!Zn&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Xa=!Zn&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&typeof i.adj=="object"}catch{return!1}}(),Qa=navigator.platform.indexOf("Mac")===0,Ii=navigator.platform.indexOf("Linux")===0;function Yt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var j={ie:Pe,ielt9:wi,edge:Li,webkit:Bn,android:It,android23:Mi,androidStock:je,opera:te,chrome:Re,gecko:qe,safari:ko,phantom:Un,opera12:bi,win:Ti,ie3d:Si,webkit3d:Pi,gecko3d:dn,any3d:ki,mobile:Ke,mobileWebkit:ke,mobileWebkit3d:Eo,msPointer:Ei,pointer:Ci,touch:Co,touchNative:xi,mobileOpera:Ai,mobileGecko:Dt,retina:ye,passiveEvents:fn,canvas:xo,svg:Zn,vml:Xa,inlineSvg:Ya,mac:Qa,linux:Ii},Di=j.msPointer?"MSPointerDown":"pointerdown",ts=j.msPointer?"MSPointerMove":"pointermove",es=j.msPointer?"MSPointerUp":"pointerup",ns=j.msPointer?"MSPointerCancel":"pointercancel",Ao={touchstart:Di,touchmove:ts,touchend:es,touchcancel:ns},is={touchstart:gc,touchmove:Ni,touchend:Ni,touchcancel:Ni},mn={},os=!1;function hc(t,i,s){return i==="touchstart"&&pc(),is[i]?(s=is[i].bind(this,s),t.addEventListener(Ao[i],s,!1),s):(console.warn("wrong event specified:",i),y)}function dc(t,i,s){if(!Ao[i]){console.warn("wrong event specified:",i);return}t.removeEventListener(Ao[i],s,!1)}function fc(t){mn[t.pointerId]=t}function mc(t){mn[t.pointerId]&&(mn[t.pointerId]=t)}function as(t){delete mn[t.pointerId]}function pc(){os||(document.addEventListener(Di,fc,!0),document.addEventListener(ts,mc,!0),document.addEventListener(es,as,!0),document.addEventListener(ns,as,!0),os=!0)}function Ni(t,i){if(i.pointerType!==(i.MSPOINTER_TYPE_MOUSE||"mouse")){i.touches=[];for(var s in mn)i.touches.push(mn[s]);i.changedTouches=[i],t(i)}}function gc(t,i){i.MSPOINTER_TYPE_TOUCH&&i.pointerType===i.MSPOINTER_TYPE_TOUCH&&Nt(i),Ni(t,i)}function _c(t){var i={},s,h;for(h in t)s=t[h],i[h]=s&&s.bind?s.bind(t):s;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var yc=200;function vc(t,i){t.addEventListener("dblclick",i);var s=0,h;function m(w){if(w.detail!==1){h=w.detail;return}if(!(w.pointerType==="mouse"||w.sourceCapabilities&&!w.sourceCapabilities.firesTouchEvents)){var P=us(w);if(!(P.some(function(D){return D instanceof HTMLLabelElement&&D.attributes.for})&&!P.some(function(D){return D instanceof HTMLInputElement||D instanceof HTMLSelectElement}))){var A=Date.now();A-s<=yc?(h++,h===2&&i(_c(w))):h=1,s=A}}}return t.addEventListener("click",m),{dblclick:i,simDblclick:m}}function wc(t,i){t.removeEventListener("dblclick",i.dblclick),t.removeEventListener("click",i.simDblclick)}var Io=Ri(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Hn=Ri(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ss=Hn==="webkitTransition"||Hn==="OTransition"?Hn+"End":"transitionend";function rs(t){return typeof t=="string"?document.getElementById(t):t}function Wn(t,i){var s=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!s||s==="auto")&&document.defaultView){var h=document.defaultView.getComputedStyle(t,null);s=h?h[i]:null}return s==="auto"?null:s}function ut(t,i,s){var h=document.createElement(t);return h.className=i||"",s&&s.appendChild(h),h}function Mt(t){var i=t.parentNode;i&&i.removeChild(t)}function Oi(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function pn(t){var i=t.parentNode;i&&i.lastChild!==t&&i.appendChild(t)}function gn(t){var i=t.parentNode;i&&i.firstChild!==t&&i.insertBefore(t,i.firstChild)}function Do(t,i){if(t.classList!==void 0)return t.classList.contains(i);var s=Fi(t);return s.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(s)}function at(t,i){if(t.classList!==void 0)for(var s=b(i),h=0,m=s.length;h<m;h++)t.classList.add(s[h]);else if(!Do(t,i)){var w=Fi(t);No(t,(w?w+" ":"")+i)}}function St(t,i){t.classList!==void 0?t.classList.remove(i):No(t,M((" "+Fi(t)+" ").replace(" "+i+" "," ")))}function No(t,i){t.className.baseVal===void 0?t.className=i:t.className.baseVal=i}function Fi(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function ee(t,i){"opacity"in t.style?t.style.opacity=i:"filter"in t.style&&Lc(t,i)}function Lc(t,i){var s=!1,h="DXImageTransform.Microsoft.Alpha";try{s=t.filters.item(h)}catch{if(i===1)return}i=Math.round(i*100),s?(s.Enabled=i!==100,s.Opacity=i):t.style.filter+=" progid:"+h+"(opacity="+i+")"}function Ri(t){for(var i=document.documentElement.style,s=0;s<t.length;s++)if(t[s]in i)return t[s];return!1}function Ye(t,i,s){var h=i||new H(0,0);t.style[Io]=(j.ie3d?"translate("+h.x+"px,"+h.y+"px)":"translate3d("+h.x+"px,"+h.y+"px,0)")+(s?" scale("+s+")":"")}function Pt(t,i){t._leaflet_pos=i,j.any3d?Ye(t,i):(t.style.left=i.x+"px",t.style.top=i.y+"px")}function Xe(t){return t._leaflet_pos||new H(0,0)}var Gn,Vn,Oo;if("onselectstart"in document)Gn=function(){it(window,"selectstart",Nt)},Vn=function(){_t(window,"selectstart",Nt)};else{var Jn=Ri(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Gn=function(){if(Jn){var t=document.documentElement.style;Oo=t[Jn],t[Jn]="none"}},Vn=function(){Jn&&(document.documentElement.style[Jn]=Oo,Oo=void 0)}}function Fo(){it(window,"dragstart",Nt)}function Ro(){_t(window,"dragstart",Nt)}var zi,zo;function $o(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&($i(),zi=t,zo=t.style.outlineStyle,t.style.outlineStyle="none",it(window,"keydown",$i))}function $i(){zi&&(zi.style.outlineStyle=zo,zi=void 0,zo=void 0,_t(window,"keydown",$i))}function ls(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function Bo(t){var i=t.getBoundingClientRect();return{x:i.width/t.offsetWidth||1,y:i.height/t.offsetHeight||1,boundingClientRect:i}}var Mc={__proto__:null,TRANSFORM:Io,TRANSITION:Hn,TRANSITION_END:ss,get:rs,getStyle:Wn,create:ut,remove:Mt,empty:Oi,toFront:pn,toBack:gn,hasClass:Do,addClass:at,removeClass:St,setClass:No,getClass:Fi,setOpacity:ee,testProp:Ri,setTransform:Ye,setPosition:Pt,getPosition:Xe,get disableTextSelection(){return Gn},get enableTextSelection(){return Vn},disableImageDrag:Fo,enableImageDrag:Ro,preventOutline:$o,restoreOutline:$i,getSizedParentNode:ls,getScale:Bo};function it(t,i,s,h){if(i&&typeof i=="object")for(var m in i)Zo(t,m,i[m],s);else{i=b(i);for(var w=0,P=i.length;w<P;w++)Zo(t,i[w],s,h)}return this}var ve="_leaflet_events";function _t(t,i,s,h){if(arguments.length===1)cs(t),delete t[ve];else if(i&&typeof i=="object")for(var m in i)Ho(t,m,i[m],s);else if(i=b(i),arguments.length===2)cs(t,function(A){return x(i,A)!==-1});else for(var w=0,P=i.length;w<P;w++)Ho(t,i[w],s,h);return this}function cs(t,i){for(var s in t[ve]){var h=s.split(/\d/)[0];(!i||i(h))&&Ho(t,h,null,null,s)}}var Uo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Zo(t,i,s,h){var m=i+f(s)+(h?"_"+f(h):"");if(t[ve]&&t[ve][m])return this;var w=function(A){return s.call(h||t,A||window.event)},P=w;!j.touchNative&&j.pointer&&i.indexOf("touch")===0?w=hc(t,i,w):j.touch&&i==="dblclick"?w=vc(t,w):"addEventListener"in t?i==="touchstart"||i==="touchmove"||i==="wheel"||i==="mousewheel"?t.addEventListener(Uo[i]||i,w,j.passiveEvents?{passive:!1}:!1):i==="mouseenter"||i==="mouseleave"?(w=function(A){A=A||window.event,Go(t,A)&&P(A)},t.addEventListener(Uo[i],w,!1)):t.addEventListener(i,P,!1):t.attachEvent("on"+i,w),t[ve]=t[ve]||{},t[ve][m]=w}function Ho(t,i,s,h,m){m=m||i+f(s)+(h?"_"+f(h):"");var w=t[ve]&&t[ve][m];if(!w)return this;!j.touchNative&&j.pointer&&i.indexOf("touch")===0?dc(t,i,w):j.touch&&i==="dblclick"?wc(t,w):"removeEventListener"in t?t.removeEventListener(Uo[i]||i,w,!1):t.detachEvent("on"+i,w),t[ve][m]=null}function Qe(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Wo(t){return Zo(t,"wheel",Qe),this}function jn(t){return it(t,"mousedown touchstart dblclick contextmenu",Qe),t._leaflet_disable_click=!0,this}function Nt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function tn(t){return Nt(t),Qe(t),this}function us(t){if(t.composedPath)return t.composedPath();for(var i=[],s=t.target;s;)i.push(s),s=s.parentNode;return i}function hs(t,i){if(!i)return new H(t.clientX,t.clientY);var s=Bo(i),h=s.boundingClientRect;return new H((t.clientX-h.left)/s.x-i.clientLeft,(t.clientY-h.top)/s.y-i.clientTop)}var bc=j.linux&&j.chrome?window.devicePixelRatio:j.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ds(t){return j.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/bc:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function Go(t,i){var s=i.relatedTarget;if(!s)return!0;try{for(;s&&s!==t;)s=s.parentNode}catch{return!1}return s!==t}var Tc={__proto__:null,on:it,off:_t,stopPropagation:Qe,disableScrollPropagation:Wo,disableClickPropagation:jn,preventDefault:Nt,stop:tn,getPropagationPath:us,getMousePosition:hs,getWheelDelta:ds,isExternalTarget:Go,addListener:it,removeListener:_t},fs=Lt.extend({run:function(t,i,s,h){this.stop(),this._el=t,this._inProgress=!0,this._duration=s||.25,this._easeOutPower=1/Math.max(h||.5,.2),this._startPos=Xe(t),this._offset=i.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=z(this._animate,this),this._step()},_step:function(t){var i=+new Date-this._startTime,s=this._duration*1e3;i<s?this._runFrame(this._easeOut(i/s),t):(this._runFrame(1),this._complete())},_runFrame:function(t,i){var s=this._startPos.add(this._offset.multiplyBy(t));i&&s._round(),Pt(this._el,s),this.fire("step")},_complete:function(){B(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),lt=Lt.extend({options:{crs:Kt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,i){i=S(this,i),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=l(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),i.zoom!==void 0&&(this._zoom=this._limitZoom(i.zoom)),i.center&&i.zoom!==void 0&&this.setView(W(i.center),i.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Hn&&j.any3d&&!j.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),it(this._proxy,ss,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,i,s){if(i=i===void 0?this._zoom:this._limitZoom(i),t=this._limitCenter(W(t),i,this.options.maxBounds),s=s||{},this._stop(),this._loaded&&!s.reset&&s!==!0){s.animate!==void 0&&(s.zoom=r({animate:s.animate},s.zoom),s.pan=r({animate:s.animate,duration:s.duration},s.pan));var h=this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,s.zoom):this._tryAnimatedPan(t,s.pan);if(h)return clearTimeout(this._sizeTimer),this}return this._resetView(t,i,s.pan&&s.pan.noMoveStart),this},setZoom:function(t,i){return this._loaded?this.setView(this.getCenter(),t,{zoom:i}):(this._zoom=t,this)},zoomIn:function(t,i){return t=t||(j.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,i)},zoomOut:function(t,i){return t=t||(j.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,i)},setZoomAround:function(t,i,s){var h=this.getZoomScale(i),m=this.getSize().divideBy(2),w=t instanceof H?t:this.latLngToContainerPoint(t),P=w.subtract(m).multiplyBy(1-1/h),A=this.containerPointToLatLng(m.add(P));return this.setView(A,i,{zoom:s})},_getBoundsCenterZoom:function(t,i){i=i||{},t=t.getBounds?t.getBounds():mt(t);var s=V(i.paddingTopLeft||i.padding||[0,0]),h=V(i.paddingBottomRight||i.padding||[0,0]),m=this.getBoundsZoom(t,!1,s.add(h));if(m=typeof i.maxZoom=="number"?Math.min(i.maxZoom,m):m,m===1/0)return{center:t.getCenter(),zoom:m};var w=h.subtract(s).divideBy(2),P=this.project(t.getSouthWest(),m),A=this.project(t.getNorthEast(),m),D=this.unproject(P.add(A).divideBy(2).add(w),m);return{center:D,zoom:m}},fitBounds:function(t,i){if(t=mt(t),!t.isValid())throw new Error("Bounds are not valid.");var s=this._getBoundsCenterZoom(t,i);return this.setView(s.center,s.zoom,i)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,i){return this.setView(t,this._zoom,{pan:i})},panBy:function(t,i){if(t=V(t).round(),i=i||{},!t.x&&!t.y)return this.fire("moveend");if(i.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new fs,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),i.noMoveStart||this.fire("movestart"),i.animate!==!1){at(this._mapPane,"leaflet-pan-anim");var s=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,s,i.duration||.25,i.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,i,s){if(s=s||{},s.animate===!1||!j.any3d)return this.setView(t,i,s);this._stop();var h=this.project(this.getCenter()),m=this.project(t),w=this.getSize(),P=this._zoom;t=W(t),i=i===void 0?P:i;var A=Math.max(w.x,w.y),D=A*this.getZoomScale(P,i),O=m.distanceTo(h)||1,Z=1.42,Q=Z*Z;function st(kt){var Yi=kt?-1:1,du=kt?D:A,fu=D*D-A*A+Yi*Q*Q*O*O,mu=2*du*Q*O,na=fu/mu,Js=Math.sqrt(na*na+1)-na,pu=Js<1e-9?-18:Math.log(Js);return pu}function Wt(kt){return(Math.exp(kt)-Math.exp(-kt))/2}function Ct(kt){return(Math.exp(kt)+Math.exp(-kt))/2}function ie(kt){return Wt(kt)/Ct(kt)}var Vt=st(0);function Mn(kt){return A*(Ct(Vt)/Ct(Vt+Z*kt))}function lu(kt){return A*(Ct(Vt)*ie(Vt+Z*kt)-Wt(Vt))/Q}function cu(kt){return 1-Math.pow(1-kt,1.5)}var uu=Date.now(),Gs=(st(1)-Vt)/Z,hu=s.duration?1e3*s.duration:1e3*Gs*.8;function Vs(){var kt=(Date.now()-uu)/hu,Yi=cu(kt)*Gs;kt<=1?(this._flyToFrame=z(Vs,this),this._move(this.unproject(h.add(m.subtract(h).multiplyBy(lu(Yi)/O)),P),this.getScaleZoom(A/Mn(Yi),P),{flyTo:!0})):this._move(t,i)._moveEnd(!0)}return this._moveStart(!0,s.noMoveStart),Vs.call(this),this},flyToBounds:function(t,i){var s=this._getBoundsCenterZoom(t,i);return this.flyTo(s.center,s.zoom,i)},setMaxBounds:function(t){return t=mt(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var i=this.options.minZoom;return this.options.minZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var i=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,i){this._enforcingBounds=!0;var s=this.getCenter(),h=this._limitCenter(s,this._zoom,mt(t));return s.equals(h)||this.panTo(h,i),this._enforcingBounds=!1,this},panInside:function(t,i){i=i||{};var s=V(i.paddingTopLeft||i.padding||[0,0]),h=V(i.paddingBottomRight||i.padding||[0,0]),m=this.project(this.getCenter()),w=this.project(t),P=this.getPixelBounds(),A=pt([P.min.add(s),P.max.subtract(h)]),D=A.getSize();if(!A.contains(w)){this._enforcingBounds=!0;var O=w.subtract(A.getCenter()),Z=A.extend(w).getSize().subtract(D);m.x+=O.x<0?-Z.x:Z.x,m.y+=O.y<0?-Z.y:Z.y,this.panTo(this.unproject(m),i),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=r({animate:!1,pan:!0},t===!0?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var s=this.getSize(),h=i.divideBy(2).round(),m=s.divideBy(2).round(),w=h.subtract(m);return!w.x&&!w.y?this:(t.animate&&t.pan?this.panBy(w):(t.pan&&this._rawPanBy(w),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(l(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:s}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=r({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var i=l(this._handleGeolocationResponse,this),s=l(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(i,s,t):navigator.geolocation.getCurrentPosition(i,s,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var i=t.code,s=t.message||(i===1?"permission denied":i===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:i,message:"Geolocation error: "+s+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var i=t.coords.latitude,s=t.coords.longitude,h=new X(i,s),m=h.toBounds(t.coords.accuracy*2),w=this._locateOptions;if(w.setView){var P=this.getBoundsZoom(m);this.setView(h,w.maxZoom?Math.min(P,w.maxZoom):P)}var A={latlng:h,bounds:m,timestamp:t.timestamp};for(var D in t.coords)typeof t.coords[D]=="number"&&(A[D]=t.coords[D]);this.fire("locationfound",A)}},addHandler:function(t,i){if(!i)return this;var s=this[t]=new i(this);return this._handlers.push(s),this.options[t]&&s.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Mt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(B(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)Mt(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,i){var s="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),h=ut("div",s,i||this._mapPane);return t&&(this._panes[t]=h),h},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),i=this.unproject(t.getBottomLeft()),s=this.unproject(t.getTopRight());return new gt(i,s)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,i,s){t=mt(t),s=V(s||[0,0]);var h=this.getZoom()||0,m=this.getMinZoom(),w=this.getMaxZoom(),P=t.getNorthWest(),A=t.getSouthEast(),D=this.getSize().subtract(s),O=pt(this.project(A,h),this.project(P,h)).getSize(),Z=j.any3d?this.options.zoomSnap:1,Q=D.x/O.x,st=D.y/O.y,Wt=i?Math.max(Q,st):Math.min(Q,st);return h=this.getScaleZoom(Wt,h),Z&&(h=Math.round(h/(Z/100))*(Z/100),h=i?Math.ceil(h/Z)*Z:Math.floor(h/Z)*Z),Math.max(m,Math.min(w,h))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new H(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,i){var s=this._getTopLeftPoint(t,i);return new tt(s,s.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,i){var s=this.options.crs;return i=i===void 0?this._zoom:i,s.scale(t)/s.scale(i)},getScaleZoom:function(t,i){var s=this.options.crs;i=i===void 0?this._zoom:i;var h=s.zoom(t*s.scale(i));return isNaN(h)?1/0:h},project:function(t,i){return i=i===void 0?this._zoom:i,this.options.crs.latLngToPoint(W(t),i)},unproject:function(t,i){return i=i===void 0?this._zoom:i,this.options.crs.pointToLatLng(V(t),i)},layerPointToLatLng:function(t){var i=V(t).add(this.getPixelOrigin());return this.unproject(i)},latLngToLayerPoint:function(t){var i=this.project(W(t))._round();return i._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(W(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(mt(t))},distance:function(t,i){return this.options.crs.distance(W(t),W(i))},containerPointToLayerPoint:function(t){return V(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return V(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var i=this.containerPointToLayerPoint(V(t));return this.layerPointToLatLng(i)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(W(t)))},mouseEventToContainerPoint:function(t){return hs(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var i=this._container=rs(t);if(i){if(i._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");it(i,"scroll",this._onScroll,this),this._containerId=f(i)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&j.any3d,at(t,"leaflet-container"+(j.touch?" leaflet-touch":"")+(j.retina?" leaflet-retina":"")+(j.ielt9?" leaflet-oldie":"")+(j.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var i=Wn(t,"position");i!=="absolute"&&i!=="relative"&&i!=="fixed"&&i!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Pt(this._mapPane,new H(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(at(t.markerPane,"leaflet-zoom-hide"),at(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,i,s){Pt(this._mapPane,new H(0,0));var h=!this._loaded;this._loaded=!0,i=this._limitZoom(i),this.fire("viewprereset");var m=this._zoom!==i;this._moveStart(m,s)._move(t,i)._moveEnd(m),this.fire("viewreset"),h&&this.fire("load")},_moveStart:function(t,i){return t&&this.fire("zoomstart"),i||this.fire("movestart"),this},_move:function(t,i,s,h){i===void 0&&(i=this._zoom);var m=this._zoom!==i;return this._zoom=i,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),h?s&&s.pinch&&this.fire("zoom",s):((m||s&&s.pinch)&&this.fire("zoom",s),this.fire("move",s)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return B(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){Pt(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[f(this._container)]=this;var i=t?_t:it;i(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&i(window,"resize",this._onResize,this),j.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){B(this._resizeRequest),this._resizeRequest=z(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,i){for(var s=[],h,m=i==="mouseout"||i==="mouseover",w=t.target||t.srcElement,P=!1;w;){if(h=this._targets[f(w)],h&&(i==="click"||i==="preclick")&&this._draggableMoved(h)){P=!0;break}if(h&&h.listens(i,!0)&&(m&&!Go(w,t)||(s.push(h),m))||w===this._container)break;w=w.parentNode}return!s.length&&!P&&!m&&this.listens(i,!0)&&(s=[this]),s},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var i=t.target||t.srcElement;if(!(!this._loaded||i._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(i))){var s=t.type;s==="mousedown"&&$o(i),this._fireDOMEvent(t,s)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,i,s){if(t.type==="click"){var h=r({},t);h.type="preclick",this._fireDOMEvent(h,h.type,s)}var m=this._findEventTargets(t,i);if(s){for(var w=[],P=0;P<s.length;P++)s[P].listens(i,!0)&&w.push(s[P]);m=w.concat(m)}if(m.length){i==="contextmenu"&&Nt(t);var A=m[0],D={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var O=A.getLatLng&&(!A._radius||A._radius<=10);D.containerPoint=O?this.latLngToContainerPoint(A.getLatLng()):this.mouseEventToContainerPoint(t),D.layerPoint=this.containerPointToLayerPoint(D.containerPoint),D.latlng=O?A.getLatLng():this.layerPointToLatLng(D.layerPoint)}for(P=0;P<m.length;P++)if(m[P].fire(i,D,!0),D.originalEvent._stopped||m[P].options.bubblingMouseEvents===!1&&x(this._mouseEvents,i)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,i=this._handlers.length;t<i;t++)this._handlers[t].disable()},whenReady:function(t,i){return this._loaded?t.call(i||this,{target:this}):this.on("load",t,i),this},_getMapPanePos:function(){return Xe(this._mapPane)||new H(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,i){var s=t&&i!==void 0?this._getNewPixelOrigin(t,i):this.getPixelOrigin();return s.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,i){var s=this.getSize()._divideBy(2);return this.project(t,i)._subtract(s)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,i,s){var h=this._getNewPixelOrigin(s,i);return this.project(t,i)._subtract(h)},_latLngBoundsToNewLayerBounds:function(t,i,s){var h=this._getNewPixelOrigin(s,i);return pt([this.project(t.getSouthWest(),i)._subtract(h),this.project(t.getNorthWest(),i)._subtract(h),this.project(t.getSouthEast(),i)._subtract(h),this.project(t.getNorthEast(),i)._subtract(h)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,i,s){if(!s)return t;var h=this.project(t,i),m=this.getSize().divideBy(2),w=new tt(h.subtract(m),h.add(m)),P=this._getBoundsOffset(w,s,i);return Math.abs(P.x)<=1&&Math.abs(P.y)<=1?t:this.unproject(h.add(P),i)},_limitOffset:function(t,i){if(!i)return t;var s=this.getPixelBounds(),h=new tt(s.min.add(t),s.max.add(t));return t.add(this._getBoundsOffset(h,i))},_getBoundsOffset:function(t,i,s){var h=pt(this.project(i.getNorthEast(),s),this.project(i.getSouthWest(),s)),m=h.min.subtract(t.min),w=h.max.subtract(t.max),P=this._rebound(m.x,-w.x),A=this._rebound(m.y,-w.y);return new H(P,A)},_rebound:function(t,i){return t+i>0?Math.round(t-i)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(i))},_limitZoom:function(t){var i=this.getMinZoom(),s=this.getMaxZoom(),h=j.any3d?this.options.zoomSnap:1;return h&&(t=Math.round(t/h)*h),Math.max(i,Math.min(s,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){St(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,i){var s=this._getCenterOffset(t)._trunc();return(i&&i.animate)!==!0&&!this.getSize().contains(s)?!1:(this.panBy(s,i),!0)},_createAnimProxy:function(){var t=this._proxy=ut("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(i){var s=Io,h=this._proxy.style[s];Ye(this._proxy,this.project(i.center,i.zoom),this.getZoomScale(i.zoom,1)),h===this._proxy.style[s]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Mt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),i=this.getZoom();Ye(this._proxy,this.project(t,i),this.getZoomScale(i,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,i,s){if(this._animatingZoom)return!0;if(s=s||{},!this._zoomAnimated||s.animate===!1||this._nothingToAnimate()||Math.abs(i-this._zoom)>this.options.zoomAnimationThreshold)return!1;var h=this.getZoomScale(i),m=this._getCenterOffset(t)._divideBy(1-1/h);return s.animate!==!0&&!this.getSize().contains(m)?!1:(z(function(){this._moveStart(!0,s.noMoveStart||!1)._animateZoom(t,i,!0)},this),!0)},_animateZoom:function(t,i,s,h){this._mapPane&&(s&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=i,at(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:i,noUpdate:h}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(l(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&St(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Sc(t,i){return new lt(t,i)}var de=nt.extend({options:{position:"topright"},initialize:function(t){S(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var i=this._map;return i&&i.removeControl(this),this.options.position=t,i&&i.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var i=this._container=this.onAdd(t),s=this.getPosition(),h=t._controlCorners[s];return at(i,"leaflet-control"),s.indexOf("bottom")!==-1?h.insertBefore(i,h.firstChild):h.appendChild(i),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Mt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),qn=function(t){return new de(t)};lt.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},i="leaflet-",s=this._controlContainer=ut("div",i+"control-container",this._container);function h(m,w){var P=i+m+" "+i+w;t[m+w]=ut("div",P,s)}h("top","left"),h("top","right"),h("bottom","left"),h("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)Mt(this._controlCorners[t]);Mt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ms=de.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,i,s,h){return s<h?-1:h<s?1:0}},initialize:function(t,i,s){S(this,s),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var h in t)this._addLayer(t[h],h);for(h in i)this._addLayer(i[h],h,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return de.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,i){return this._addLayer(t,i),this._map?this._update():this},addOverlay:function(t,i){return this._addLayer(t,i,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var i=this._getLayer(f(t));return i&&this._layers.splice(this._layers.indexOf(i),1),this._map?this._update():this},expand:function(){at(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(at(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):St(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return St(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",i=this._container=ut("div",t),s=this.options.collapsed;i.setAttribute("aria-haspopup",!0),jn(i),Wo(i);var h=this._section=ut("section",t+"-list");s&&(this._map.on("click",this.collapse,this),it(i,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var m=this._layersLink=ut("a",t+"-toggle",i);m.href="#",m.title="Layers",m.setAttribute("role","button"),it(m,{keydown:function(w){w.keyCode===13&&this._expandSafely()},click:function(w){Nt(w),this._expandSafely()}},this),s||this.expand(),this._baseLayersList=ut("div",t+"-base",h),this._separator=ut("div",t+"-separator",h),this._overlaysList=ut("div",t+"-overlays",h),i.appendChild(h)},_getLayer:function(t){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&f(this._layers[i].layer)===t)return this._layers[i]},_addLayer:function(t,i,s){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:i,overlay:s}),this.options.sortLayers&&this._layers.sort(l(function(h,m){return this.options.sortFunction(h.layer,m.layer,h.name,m.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Oi(this._baseLayersList),Oi(this._overlaysList),this._layerControlInputs=[];var t,i,s,h,m=0;for(s=0;s<this._layers.length;s++)h=this._layers[s],this._addItem(h),i=i||h.overlay,t=t||!h.overlay,m+=h.overlay?0:1;return this.options.hideSingleBase&&(t=t&&m>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=i&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var i=this._getLayer(f(t.target)),s=i.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;s&&this._map.fire(s,i)},_createRadioElement:function(t,i){var s='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",h=document.createElement("div");return h.innerHTML=s,h.firstChild},_addItem:function(t){var i=document.createElement("label"),s=this._map.hasLayer(t.layer),h;t.overlay?(h=document.createElement("input"),h.type="checkbox",h.className="leaflet-control-layers-selector",h.defaultChecked=s):h=this._createRadioElement("leaflet-base-layers_"+f(this),s),this._layerControlInputs.push(h),h.layerId=f(t.layer),it(h,"click",this._onInputClick,this);var m=document.createElement("span");m.innerHTML=" "+t.name;var w=document.createElement("span");i.appendChild(w),w.appendChild(h),w.appendChild(m);var P=t.overlay?this._overlaysList:this._baseLayersList;return P.appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,i,s,h=[],m=[];this._handlingClick=!0;for(var w=t.length-1;w>=0;w--)i=t[w],s=this._getLayer(i.layerId).layer,i.checked?h.push(s):i.checked||m.push(s);for(w=0;w<m.length;w++)this._map.hasLayer(m[w])&&this._map.removeLayer(m[w]);for(w=0;w<h.length;w++)this._map.hasLayer(h[w])||this._map.addLayer(h[w]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,i,s,h=this._map.getZoom(),m=t.length-1;m>=0;m--)i=t[m],s=this._getLayer(i.layerId).layer,i.disabled=s.options.minZoom!==void 0&&h<s.options.minZoom||s.options.maxZoom!==void 0&&h>s.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,it(t,"click",Nt),this.expand();var i=this;setTimeout(function(){_t(t,"click",Nt),i._preventClick=!1})}}),Pc=function(t,i,s){return new ms(t,i,s)},Vo=de.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var i="leaflet-control-zoom",s=ut("div",i+" leaflet-bar"),h=this.options;return this._zoomInButton=this._createButton(h.zoomInText,h.zoomInTitle,i+"-in",s,this._zoomIn),this._zoomOutButton=this._createButton(h.zoomOutText,h.zoomOutTitle,i+"-out",s,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),s},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,i,s,h,m){var w=ut("a",s,h);return w.innerHTML=t,w.href="#",w.title=i,w.setAttribute("role","button"),w.setAttribute("aria-label",i),jn(w),it(w,"click",tn),it(w,"click",m,this),it(w,"click",this._refocusOnMap,this),w},_updateDisabled:function(){var t=this._map,i="leaflet-disabled";St(this._zoomInButton,i),St(this._zoomOutButton,i),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(at(this._zoomOutButton,i),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(at(this._zoomInButton,i),this._zoomInButton.setAttribute("aria-disabled","true"))}});lt.mergeOptions({zoomControl:!0}),lt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Vo,this.addControl(this.zoomControl))});var kc=function(t){return new Vo(t)},ps=de.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var i="leaflet-control-scale",s=ut("div",i),h=this.options;return this._addScales(h,i+"-line",s),t.on(h.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),s},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,i,s){t.metric&&(this._mScale=ut("div",i,s)),t.imperial&&(this._iScale=ut("div",i,s))},_update:function(){var t=this._map,i=t.getSize().y/2,s=t.distance(t.containerPointToLatLng([0,i]),t.containerPointToLatLng([this.options.maxWidth,i]));this._updateScales(s)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var i=this._getRoundNum(t),s=i<1e3?i+" m":i/1e3+" km";this._updateScale(this._mScale,s,i/t)},_updateImperial:function(t){var i=t*3.2808399,s,h,m;i>5280?(s=i/5280,h=this._getRoundNum(s),this._updateScale(this._iScale,h+" mi",h/s)):(m=this._getRoundNum(i),this._updateScale(this._iScale,m+" ft",m/i))},_updateScale:function(t,i,s){t.style.width=Math.round(this.options.maxWidth*s)+"px",t.innerHTML=i},_getRoundNum:function(t){var i=Math.pow(10,(Math.floor(t)+"").length-1),s=t/i;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,i*s}}),Ec=function(t){return new ps(t)},Cc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Jo=de.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(j.inlineSvg?Cc+" ":"")+"Leaflet</a>"},initialize:function(t){S(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=ut("div","leaflet-control-attribution"),jn(this._container);for(var i in t._layers)t._layers[i].getAttribution&&this.addAttribution(t._layers[i].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var i in this._attributions)this._attributions[i]&&t.push(i);var s=[];this.options.prefix&&s.push(this.options.prefix),t.length&&s.push(t.join(", ")),this._container.innerHTML=s.join(' <span aria-hidden="true">|</span> ')}}});lt.mergeOptions({attributionControl:!0}),lt.addInitHook(function(){this.options.attributionControl&&new Jo().addTo(this)});var xc=function(t){return new Jo(t)};de.Layers=ms,de.Zoom=Vo,de.Scale=ps,de.Attribution=Jo,qn.layers=Pc,qn.zoom=kc,qn.scale=Ec,qn.attribution=xc;var we=nt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});we.addTo=function(t,i){return t.addHandler(i,this),this};var Ac={Events:q},gs=j.touch?"touchstart mousedown":"mousedown",ze=Lt.extend({options:{clickTolerance:3},initialize:function(t,i,s,h){S(this,h),this._element=t,this._dragStartTarget=i||t,this._preventOutline=s},enable:function(){this._enabled||(it(this._dragStartTarget,gs,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ze._dragging===this&&this.finishDrag(!0),_t(this._dragStartTarget,gs,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!Do(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){ze._dragging===this&&this.finishDrag();return}if(!(ze._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(ze._dragging=this,this._preventOutline&&$o(this._element),Fo(),Gn(),!this._moving)){this.fire("down");var i=t.touches?t.touches[0]:t,s=ls(this._element);this._startPoint=new H(i.clientX,i.clientY),this._startPos=Xe(this._element),this._parentScale=Bo(s);var h=t.type==="mousedown";it(document,h?"mousemove":"touchmove",this._onMove,this),it(document,h?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var i=t.touches&&t.touches.length===1?t.touches[0]:t,s=new H(i.clientX,i.clientY)._subtract(this._startPoint);!s.x&&!s.y||Math.abs(s.x)+Math.abs(s.y)<this.options.clickTolerance||(s.x/=this._parentScale.x,s.y/=this._parentScale.y,Nt(t),this._moved||(this.fire("dragstart"),this._moved=!0,at(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),at(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),Pt(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){St(document.body,"leaflet-dragging"),this._lastTarget&&(St(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),_t(document,"mousemove touchmove",this._onMove,this),_t(document,"mouseup touchend touchcancel",this._onUp,this),Ro(),Vn();var i=this._moved&&this._moving;this._moving=!1,ze._dragging=!1,i&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function _s(t,i,s){var h,m=[1,4,2,8],w,P,A,D,O,Z,Q,st;for(w=0,Z=t.length;w<Z;w++)t[w]._code=en(t[w],i);for(A=0;A<4;A++){for(Q=m[A],h=[],w=0,Z=t.length,P=Z-1;w<Z;P=w++)D=t[w],O=t[P],D._code&Q?O._code&Q||(st=Bi(O,D,Q,i,s),st._code=en(st,i),h.push(st)):(O._code&Q&&(st=Bi(O,D,Q,i,s),st._code=en(st,i),h.push(st)),h.push(D));t=h}return t}function ys(t,i){var s,h,m,w,P,A,D,O,Z;if(!t||t.length===0)throw new Error("latlngs not passed");ne(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var Q=W([0,0]),st=mt(t),Wt=st.getNorthWest().distanceTo(st.getSouthWest())*st.getNorthEast().distanceTo(st.getNorthWest());Wt<1700&&(Q=jo(t));var Ct=t.length,ie=[];for(s=0;s<Ct;s++){var Vt=W(t[s]);ie.push(i.project(W([Vt.lat-Q.lat,Vt.lng-Q.lng])))}for(A=D=O=0,s=0,h=Ct-1;s<Ct;h=s++)m=ie[s],w=ie[h],P=m.y*w.x-w.y*m.x,D+=(m.x+w.x)*P,O+=(m.y+w.y)*P,A+=P*3;A===0?Z=ie[0]:Z=[D/A,O/A];var Mn=i.unproject(V(Z));return W([Mn.lat+Q.lat,Mn.lng+Q.lng])}function jo(t){for(var i=0,s=0,h=0,m=0;m<t.length;m++){var w=W(t[m]);i+=w.lat,s+=w.lng,h++}return W([i/h,s/h])}var Ic={__proto__:null,clipPolygon:_s,polygonCenter:ys,centroid:jo};function vs(t,i){if(!i||!t.length)return t.slice();var s=i*i;return t=Oc(t,s),t=Nc(t,s),t}function ws(t,i,s){return Math.sqrt(Kn(t,i,s,!0))}function Dc(t,i,s){return Kn(t,i,s)}function Nc(t,i){var s=t.length,h=typeof Uint8Array<"u"?Uint8Array:Array,m=new h(s);m[0]=m[s-1]=1,qo(t,m,i,0,s-1);var w,P=[];for(w=0;w<s;w++)m[w]&&P.push(t[w]);return P}function qo(t,i,s,h,m){var w=0,P,A,D;for(A=h+1;A<=m-1;A++)D=Kn(t[A],t[h],t[m],!0),D>w&&(P=A,w=D);w>s&&(i[P]=1,qo(t,i,s,h,P),qo(t,i,s,P,m))}function Oc(t,i){for(var s=[t[0]],h=1,m=0,w=t.length;h<w;h++)Fc(t[h],t[m])>i&&(s.push(t[h]),m=h);return m<w-1&&s.push(t[w-1]),s}var Ls;function Ms(t,i,s,h,m){var w=h?Ls:en(t,s),P=en(i,s),A,D,O;for(Ls=P;;){if(!(w|P))return[t,i];if(w&P)return!1;A=w||P,D=Bi(t,i,A,s,m),O=en(D,s),A===w?(t=D,w=O):(i=D,P=O)}}function Bi(t,i,s,h,m){var w=i.x-t.x,P=i.y-t.y,A=h.min,D=h.max,O,Z;return s&8?(O=t.x+w*(D.y-t.y)/P,Z=D.y):s&4?(O=t.x+w*(A.y-t.y)/P,Z=A.y):s&2?(O=D.x,Z=t.y+P*(D.x-t.x)/w):s&1&&(O=A.x,Z=t.y+P*(A.x-t.x)/w),new H(O,Z,m)}function en(t,i){var s=0;return t.x<i.min.x?s|=1:t.x>i.max.x&&(s|=2),t.y<i.min.y?s|=4:t.y>i.max.y&&(s|=8),s}function Fc(t,i){var s=i.x-t.x,h=i.y-t.y;return s*s+h*h}function Kn(t,i,s,h){var m=i.x,w=i.y,P=s.x-m,A=s.y-w,D=P*P+A*A,O;return D>0&&(O=((t.x-m)*P+(t.y-w)*A)/D,O>1?(m=s.x,w=s.y):O>0&&(m+=P*O,w+=A*O)),P=t.x-m,A=t.y-w,h?P*P+A*A:new H(m,w)}function ne(t){return!I(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function bs(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ne(t)}function Ts(t,i){var s,h,m,w,P,A,D,O;if(!t||t.length===0)throw new Error("latlngs not passed");ne(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var Z=W([0,0]),Q=mt(t),st=Q.getNorthWest().distanceTo(Q.getSouthWest())*Q.getNorthEast().distanceTo(Q.getNorthWest());st<1700&&(Z=jo(t));var Wt=t.length,Ct=[];for(s=0;s<Wt;s++){var ie=W(t[s]);Ct.push(i.project(W([ie.lat-Z.lat,ie.lng-Z.lng])))}for(s=0,h=0;s<Wt-1;s++)h+=Ct[s].distanceTo(Ct[s+1])/2;if(h===0)O=Ct[0];else for(s=0,w=0;s<Wt-1;s++)if(P=Ct[s],A=Ct[s+1],m=P.distanceTo(A),w+=m,w>h){D=(w-h)/m,O=[A.x-D*(A.x-P.x),A.y-D*(A.y-P.y)];break}var Vt=i.unproject(V(O));return W([Vt.lat+Z.lat,Vt.lng+Z.lng])}var Rc={__proto__:null,simplify:vs,pointToSegmentDistance:ws,closestPointOnSegment:Dc,clipSegment:Ms,_getEdgeIntersection:Bi,_getBitCode:en,_sqClosestPointOnSegment:Kn,isFlat:ne,_flat:bs,polylineCenter:Ts},Ko={project:function(t){return new H(t.lng,t.lat)},unproject:function(t){return new X(t.y,t.x)},bounds:new tt([-180,-90],[180,90])},Yo={R:6378137,R_MINOR:6356752314245179e-9,bounds:new tt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var i=Math.PI/180,s=this.R,h=t.lat*i,m=this.R_MINOR/s,w=Math.sqrt(1-m*m),P=w*Math.sin(h),A=Math.tan(Math.PI/4-h/2)/Math.pow((1-P)/(1+P),w/2);return h=-s*Math.log(Math.max(A,1e-10)),new H(t.lng*i*s,h)},unproject:function(t){for(var i=180/Math.PI,s=this.R,h=this.R_MINOR/s,m=Math.sqrt(1-h*h),w=Math.exp(-t.y/s),P=Math.PI/2-2*Math.atan(w),A=0,D=.1,O;A<15&&Math.abs(D)>1e-7;A++)O=m*Math.sin(P),O=Math.pow((1-O)/(1+O),m/2),D=Math.PI/2-2*Math.atan(w*O)-P,P+=D;return new X(P*i,t.x*i/s)}},zc={__proto__:null,LonLat:Ko,Mercator:Yo,SphericalMercator:Zt},$c=r({},rt,{code:"EPSG:3395",projection:Yo,transformation:function(){var t=.5/(Math.PI*Yo.R);return qt(t,.5,-t,.5)}()}),Ss=r({},rt,{code:"EPSG:4326",projection:Ko,transformation:qt(1/180,1,-1/180,.5)}),Bc=r({},ht,{projection:Ko,transformation:qt(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,i){var s=i.lng-t.lng,h=i.lat-t.lat;return Math.sqrt(s*s+h*h)},infinite:!0});ht.Earth=rt,ht.EPSG3395=$c,ht.EPSG3857=Kt,ht.EPSG900913=At,ht.EPSG4326=Ss,ht.Simple=Bc;var fe=Lt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[f(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[f(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var i=t.target;if(i.hasLayer(this)){if(this._map=i,this._zoomAnimated=i._zoomAnimated,this.getEvents){var s=this.getEvents();i.on(s,this),this.once("remove",function(){i.off(s,this)},this)}this.onAdd(i),this.fire("add"),i.fire("layeradd",{layer:this})}}});lt.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var i=f(t);return this._layers[i]?this:(this._layers[i]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var i=f(t);return this._layers[i]?(this._loaded&&t.onRemove(this),delete this._layers[i],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return f(t)in this._layers},eachLayer:function(t,i){for(var s in this._layers)t.call(i,this._layers[s]);return this},_addLayers:function(t){t=t?I(t)?t:[t]:[];for(var i=0,s=t.length;i<s;i++)this.addLayer(t[i])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[f(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var i=f(t);this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,i=-1/0,s=this._getZoomSpan();for(var h in this._zoomBoundLayers){var m=this._zoomBoundLayers[h].options;t=m.minZoom===void 0?t:Math.min(t,m.minZoom),i=m.maxZoom===void 0?i:Math.max(i,m.maxZoom)}this._layersMaxZoom=i===-1/0?void 0:i,this._layersMinZoom=t===1/0?void 0:t,s!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var _n=fe.extend({initialize:function(t,i){S(this,i),this._layers={};var s,h;if(t)for(s=0,h=t.length;s<h;s++)this.addLayer(t[s])},addLayer:function(t){var i=this.getLayerId(t);return this._layers[i]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var i=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this},hasLayer:function(t){var i=typeof t=="number"?t:this.getLayerId(t);return i in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var i=Array.prototype.slice.call(arguments,1),s,h;for(s in this._layers)h=this._layers[s],h[t]&&h[t].apply(h,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,i){for(var s in this._layers)t.call(i,this._layers[s]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return f(t)}}),Uc=function(t,i){return new _n(t,i)},Ee=_n.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),_n.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),_n.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new gt;for(var i in this._layers){var s=this._layers[i];t.extend(s.getBounds?s.getBounds():s.getLatLng())}return t}}),Zc=function(t,i){return new Ee(t,i)},yn=nt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){S(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,i){var s=this._getIconUrl(t);if(!s){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var h=this._createImg(s,i&&i.tagName==="IMG"?i:null);return this._setIconStyles(h,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(h.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),h},_setIconStyles:function(t,i){var s=this.options,h=s[i+"Size"];typeof h=="number"&&(h=[h,h]);var m=V(h),w=V(i==="shadow"&&s.shadowAnchor||s.iconAnchor||m&&m.divideBy(2,!0));t.className="leaflet-marker-"+i+" "+(s.className||""),w&&(t.style.marginLeft=-w.x+"px",t.style.marginTop=-w.y+"px"),m&&(t.style.width=m.x+"px",t.style.height=m.y+"px")},_createImg:function(t,i){return i=i||document.createElement("img"),i.src=t,i},_getIconUrl:function(t){return j.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Hc(t){return new yn(t)}var Yn=yn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof Yn.imagePath!="string"&&(Yn.imagePath=this._detectIconPath()),(this.options.imagePath||Yn.imagePath)+yn.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var i=function(s,h,m){var w=h.exec(s);return w&&w[m]};return t=i(t,/^url\((['"])?(.+)\1\)$/,2),t&&i(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=ut("div","leaflet-default-icon-path",document.body),i=Wn(t,"background-image")||Wn(t,"backgroundImage");if(document.body.removeChild(t),i=this._stripUrl(i),i)return i;var s=document.querySelector('link[href$="leaflet.css"]');return s?s.href.substring(0,s.href.length-11-1):""}}),Ps=we.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ze(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),at(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&St(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var i=this._marker,s=i._map,h=this._marker.options.autoPanSpeed,m=this._marker.options.autoPanPadding,w=Xe(i._icon),P=s.getPixelBounds(),A=s.getPixelOrigin(),D=pt(P.min._subtract(A).add(m),P.max._subtract(A).subtract(m));if(!D.contains(w)){var O=V((Math.max(D.max.x,w.x)-D.max.x)/(P.max.x-D.max.x)-(Math.min(D.min.x,w.x)-D.min.x)/(P.min.x-D.min.x),(Math.max(D.max.y,w.y)-D.max.y)/(P.max.y-D.max.y)-(Math.min(D.min.y,w.y)-D.min.y)/(P.min.y-D.min.y)).multiplyBy(h);s.panBy(O,{animate:!1}),this._draggable._newPos._add(O),this._draggable._startPos._add(O),Pt(i._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=z(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(B(this._panRequest),this._panRequest=z(this._adjustPan.bind(this,t)))},_onDrag:function(t){var i=this._marker,s=i._shadow,h=Xe(i._icon),m=i._map.layerPointToLatLng(h);s&&Pt(s,h),i._latlng=m,t.latlng=m,t.oldLatLng=this._oldLatLng,i.fire("move",t).fire("drag",t)},_onDragEnd:function(t){B(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Ui=fe.extend({options:{icon:new Yn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,i){S(this,i),this._latlng=W(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var i=this._latlng;return this._latlng=W(t),this.update(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,i="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),s=t.icon.createIcon(this._icon),h=!1;s!==this._icon&&(this._icon&&this._removeIcon(),h=!0,t.title&&(s.title=t.title),s.tagName==="IMG"&&(s.alt=t.alt||"")),at(s,i),t.keyboard&&(s.tabIndex="0",s.setAttribute("role","button")),this._icon=s,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&it(s,"focus",this._panOnFocus,this);var m=t.icon.createShadow(this._shadow),w=!1;m!==this._shadow&&(this._removeShadow(),w=!0),m&&(at(m,i),m.alt=""),this._shadow=m,t.opacity<1&&this._updateOpacity(),h&&this.getPane().appendChild(this._icon),this._initInteraction(),m&&w&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&_t(this._icon,"focus",this._panOnFocus,this),Mt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Mt(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&Pt(this._icon,t),this._shadow&&Pt(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(i)},_initInteraction:function(){if(this.options.interactive&&(at(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ps)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ps(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&ee(this._icon,t),this._shadow&&ee(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var i=this.options.icon.options,s=i.iconSize?V(i.iconSize):V(0,0),h=i.iconAnchor?V(i.iconAnchor):V(0,0);t.panInside(this._latlng,{paddingTopLeft:h,paddingBottomRight:s.subtract(h)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Wc(t,i){return new Ui(t,i)}var $e=fe.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return S(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Zi=$e.extend({options:{fill:!0,radius:10},initialize:function(t,i){S(this,i),this._latlng=W(t),this._radius=this.options.radius},setLatLng:function(t){var i=this._latlng;return this._latlng=W(t),this.redraw(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var i=t&&t.radius||this._radius;return $e.prototype.setStyle.call(this,t),this.setRadius(i),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,i=this._radiusY||t,s=this._clickTolerance(),h=[t+s,i+s];this._pxBounds=new tt(this._point.subtract(h),this._point.add(h))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Gc(t,i){return new Zi(t,i)}var Xo=Zi.extend({initialize:function(t,i,s){if(typeof i=="number"&&(i=r({},s,{radius:i})),S(this,i),this._latlng=W(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new gt(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:$e.prototype.setStyle,_project:function(){var t=this._latlng.lng,i=this._latlng.lat,s=this._map,h=s.options.crs;if(h.distance===rt.distance){var m=Math.PI/180,w=this._mRadius/rt.R/m,P=s.project([i+w,t]),A=s.project([i-w,t]),D=P.add(A).divideBy(2),O=s.unproject(D).lat,Z=Math.acos((Math.cos(w*m)-Math.sin(i*m)*Math.sin(O*m))/(Math.cos(i*m)*Math.cos(O*m)))/m;(isNaN(Z)||Z===0)&&(Z=w/Math.cos(Math.PI/180*i)),this._point=D.subtract(s.getPixelOrigin()),this._radius=isNaN(Z)?0:D.x-s.project([O,t-Z]).x,this._radiusY=D.y-P.y}else{var Q=h.unproject(h.project(this._latlng).subtract([this._mRadius,0]));this._point=s.latLngToLayerPoint(this._latlng),this._radius=this._point.x-s.latLngToLayerPoint(Q).x}this._updateBounds()}});function Vc(t,i,s){return new Xo(t,i,s)}var Ce=$e.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,i){S(this,i),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var i=1/0,s=null,h=Kn,m,w,P=0,A=this._parts.length;P<A;P++)for(var D=this._parts[P],O=1,Z=D.length;O<Z;O++){m=D[O-1],w=D[O];var Q=h(t,m,w,!0);Q<i&&(i=Q,s=h(t,m,w))}return s&&(s.distance=Math.sqrt(i)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ts(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,i){return i=i||this._defaultShape(),t=W(t),i.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new gt,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return ne(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var i=[],s=ne(t),h=0,m=t.length;h<m;h++)s?(i[h]=W(t[h]),this._bounds.extend(i[h])):i[h]=this._convertLatLngs(t[h]);return i},_project:function(){var t=new tt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),i=new H(t,t);this._rawPxBounds&&(this._pxBounds=new tt([this._rawPxBounds.min.subtract(i),this._rawPxBounds.max.add(i)]))},_projectLatlngs:function(t,i,s){var h=t[0]instanceof X,m=t.length,w,P;if(h){for(P=[],w=0;w<m;w++)P[w]=this._map.latLngToLayerPoint(t[w]),s.extend(P[w]);i.push(P)}else for(w=0;w<m;w++)this._projectLatlngs(t[w],i,s)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var i=this._parts,s,h,m,w,P,A,D;for(s=0,m=0,w=this._rings.length;s<w;s++)for(D=this._rings[s],h=0,P=D.length;h<P-1;h++)A=Ms(D[h],D[h+1],t,h,!0),A&&(i[m]=i[m]||[],i[m].push(A[0]),(A[1]!==D[h+1]||h===P-2)&&(i[m].push(A[1]),m++))}},_simplifyPoints:function(){for(var t=this._parts,i=this.options.smoothFactor,s=0,h=t.length;s<h;s++)t[s]=vs(t[s],i)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,i){var s,h,m,w,P,A,D=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(s=0,w=this._parts.length;s<w;s++)for(A=this._parts[s],h=0,P=A.length,m=P-1;h<P;m=h++)if(!(!i&&h===0)&&ws(t,A[m],A[h])<=D)return!0;return!1}});function Jc(t,i){return new Ce(t,i)}Ce._flat=bs;var vn=Ce.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ys(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var i=Ce.prototype._convertLatLngs.call(this,t),s=i.length;return s>=2&&i[0]instanceof X&&i[0].equals(i[s-1])&&i.pop(),i},_setLatLngs:function(t){Ce.prototype._setLatLngs.call(this,t),ne(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ne(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,i=this.options.weight,s=new H(i,i);if(t=new tt(t.min.subtract(s),t.max.add(s)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var h=0,m=this._rings.length,w;h<m;h++)w=_s(this._rings[h],t,!0),w.length&&this._parts.push(w)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var i=!1,s,h,m,w,P,A,D,O;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(w=0,D=this._parts.length;w<D;w++)for(s=this._parts[w],P=0,O=s.length,A=O-1;P<O;A=P++)h=s[P],m=s[A],h.y>t.y!=m.y>t.y&&t.x<(m.x-h.x)*(t.y-h.y)/(m.y-h.y)+h.x&&(i=!i);return i||Ce.prototype._containsPoint.call(this,t,!0)}});function jc(t,i){return new vn(t,i)}var xe=Ee.extend({initialize:function(t,i){S(this,i),this._layers={},t&&this.addData(t)},addData:function(t){var i=I(t)?t:t.features,s,h,m;if(i){for(s=0,h=i.length;s<h;s++)m=i[s],(m.geometries||m.geometry||m.features||m.coordinates)&&this.addData(m);return this}var w=this.options;if(w.filter&&!w.filter(t))return this;var P=Hi(t,w);return P?(P.feature=Vi(t),P.defaultOptions=P.options,this.resetStyle(P),w.onEachFeature&&w.onEachFeature(t,P),this.addLayer(P)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=r({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(i){this._setLayerStyle(i,t)},this)},_setLayerStyle:function(t,i){t.setStyle&&(typeof i=="function"&&(i=i(t.feature)),t.setStyle(i))}});function Hi(t,i){var s=t.type==="Feature"?t.geometry:t,h=s?s.coordinates:null,m=[],w=i&&i.pointToLayer,P=i&&i.coordsToLatLng||Qo,A,D,O,Z;if(!h&&!s)return null;switch(s.type){case"Point":return A=P(h),ks(w,t,A,i);case"MultiPoint":for(O=0,Z=h.length;O<Z;O++)A=P(h[O]),m.push(ks(w,t,A,i));return new Ee(m);case"LineString":case"MultiLineString":return D=Wi(h,s.type==="LineString"?0:1,P),new Ce(D,i);case"Polygon":case"MultiPolygon":return D=Wi(h,s.type==="Polygon"?1:2,P),new vn(D,i);case"GeometryCollection":for(O=0,Z=s.geometries.length;O<Z;O++){var Q=Hi({geometry:s.geometries[O],type:"Feature",properties:t.properties},i);Q&&m.push(Q)}return new Ee(m);case"FeatureCollection":for(O=0,Z=s.features.length;O<Z;O++){var st=Hi(s.features[O],i);st&&m.push(st)}return new Ee(m);default:throw new Error("Invalid GeoJSON object.")}}function ks(t,i,s,h){return t?t(i,s):new Ui(s,h&&h.markersInheritOptions&&h)}function Qo(t){return new X(t[1],t[0],t[2])}function Wi(t,i,s){for(var h=[],m=0,w=t.length,P;m<w;m++)P=i?Wi(t[m],i-1,s):(s||Qo)(t[m]),h.push(P);return h}function ta(t,i){return t=W(t),t.alt!==void 0?[v(t.lng,i),v(t.lat,i),v(t.alt,i)]:[v(t.lng,i),v(t.lat,i)]}function Gi(t,i,s,h){for(var m=[],w=0,P=t.length;w<P;w++)m.push(i?Gi(t[w],ne(t[w])?0:i-1,s,h):ta(t[w],h));return!i&&s&&m.length>0&&m.push(m[0].slice()),m}function wn(t,i){return t.feature?r({},t.feature,{geometry:i}):Vi(i)}function Vi(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var ea={toGeoJSON:function(t){return wn(this,{type:"Point",coordinates:ta(this.getLatLng(),t)})}};Ui.include(ea),Xo.include(ea),Zi.include(ea),Ce.include({toGeoJSON:function(t){var i=!ne(this._latlngs),s=Gi(this._latlngs,i?1:0,!1,t);return wn(this,{type:(i?"Multi":"")+"LineString",coordinates:s})}}),vn.include({toGeoJSON:function(t){var i=!ne(this._latlngs),s=i&&!ne(this._latlngs[0]),h=Gi(this._latlngs,s?2:i?1:0,!0,t);return i||(h=[h]),wn(this,{type:(s?"Multi":"")+"Polygon",coordinates:h})}}),_n.include({toMultiPoint:function(t){var i=[];return this.eachLayer(function(s){i.push(s.toGeoJSON(t).geometry.coordinates)}),wn(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(t){var i=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(i==="MultiPoint")return this.toMultiPoint(t);var s=i==="GeometryCollection",h=[];return this.eachLayer(function(m){if(m.toGeoJSON){var w=m.toGeoJSON(t);if(s)h.push(w.geometry);else{var P=Vi(w);P.type==="FeatureCollection"?h.push.apply(h,P.features):h.push(P)}}}),s?wn(this,{geometries:h,type:"GeometryCollection"}):{type:"FeatureCollection",features:h}}});function Es(t,i){return new xe(t,i)}var qc=Es,Ji=fe.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,i,s){this._url=t,this._bounds=mt(i),S(this,s)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(at(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Mt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&pn(this._image),this},bringToBack:function(){return this._map&&gn(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=mt(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",i=this._image=t?this._url:ut("img");if(at(i,"leaflet-image-layer"),this._zoomAnimated&&at(i,"leaflet-zoom-animated"),this.options.className&&at(i,this.options.className),i.onselectstart=y,i.onmousemove=y,i.onload=l(this.fire,this,"load"),i.onerror=l(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=i.src;return}i.src=this._url,i.alt=this.options.alt},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),s=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Ye(this._image,s,i)},_reset:function(){var t=this._image,i=new tt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),s=i.getSize();Pt(t,i.min),t.style.width=s.x+"px",t.style.height=s.y+"px"},_updateOpacity:function(){ee(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Kc=function(t,i,s){return new Ji(t,i,s)},Cs=Ji.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",i=this._image=t?this._url:ut("video");if(at(i,"leaflet-image-layer"),this._zoomAnimated&&at(i,"leaflet-zoom-animated"),this.options.className&&at(i,this.options.className),i.onselectstart=y,i.onmousemove=y,i.onloadeddata=l(this.fire,this,"load"),t){for(var s=i.getElementsByTagName("source"),h=[],m=0;m<s.length;m++)h.push(s[m].src);this._url=s.length>0?h:[i.src];return}I(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(i.style,"objectFit")&&(i.style.objectFit="fill"),i.autoplay=!!this.options.autoplay,i.loop=!!this.options.loop,i.muted=!!this.options.muted,i.playsInline=!!this.options.playsInline;for(var w=0;w<this._url.length;w++){var P=ut("source");P.src=this._url[w],i.appendChild(P)}}});function Yc(t,i,s){return new Cs(t,i,s)}var xs=Ji.extend({_initImage:function(){var t=this._image=this._url;at(t,"leaflet-image-layer"),this._zoomAnimated&&at(t,"leaflet-zoom-animated"),this.options.className&&at(t,this.options.className),t.onselectstart=y,t.onmousemove=y}});function Xc(t,i,s){return new xs(t,i,s)}var Le=fe.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,i){t&&(t instanceof X||I(t))?(this._latlng=W(t),S(this,i)):(S(this,t),this._source=i),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&ee(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&ee(this._container,1),this.bringToFront(),this.options.interactive&&(at(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(ee(this._container,0),this._removeTimeout=setTimeout(l(Mt,void 0,this._container),200)):Mt(this._container),this.options.interactive&&(St(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=W(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&pn(this._container),this},bringToBack:function(){return this._map&&gn(this._container),this},_prepareOpen:function(t){var i=this._source;if(!i._map)return!1;if(i instanceof Ee){i=null;var s=this._source._layers;for(var h in s)if(s[h]._map){i=s[h];break}if(!i)return!1;this._source=i}if(!t)if(i.getCenter)t=i.getCenter();else if(i.getLatLng)t=i.getLatLng();else if(i.getBounds)t=i.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,i=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof i=="string")t.innerHTML=i;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(i)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),i=V(this.options.offset),s=this._getAnchor();this._zoomAnimated?Pt(this._container,t.add(s)):i=i.add(t).add(s);var h=this._containerBottom=-i.y,m=this._containerLeft=-Math.round(this._containerWidth/2)+i.x;this._container.style.bottom=h+"px",this._container.style.left=m+"px"}},_getAnchor:function(){return[0,0]}});lt.include({_initOverlay:function(t,i,s,h){var m=i;return m instanceof t||(m=new t(h).setContent(i)),s&&m.setLatLng(s),m}}),fe.include({_initOverlay:function(t,i,s,h){var m=s;return m instanceof t?(S(m,h),m._source=this):(m=i&&!h?i:new t(h,this),m.setContent(s)),m}});var ji=Le.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Le.prototype.openOn.call(this,t)},onAdd:function(t){Le.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof $e||this._source.on("preclick",Qe))},onRemove:function(t){Le.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof $e||this._source.off("preclick",Qe))},getEvents:function(){var t=Le.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",i=this._container=ut("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),s=this._wrapper=ut("div",t+"-content-wrapper",i);if(this._contentNode=ut("div",t+"-content",s),jn(i),Wo(this._contentNode),it(i,"contextmenu",Qe),this._tipContainer=ut("div",t+"-tip-container",i),this._tip=ut("div",t+"-tip",this._tipContainer),this.options.closeButton){var h=this._closeButton=ut("a",t+"-close-button",i);h.setAttribute("role","button"),h.setAttribute("aria-label","Close popup"),h.href="#close",h.innerHTML='<span aria-hidden="true">&#215;</span>',it(h,"click",function(m){Nt(m),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,i=t.style;i.width="",i.whiteSpace="nowrap";var s=t.offsetWidth;s=Math.min(s,this.options.maxWidth),s=Math.max(s,this.options.minWidth),i.width=s+1+"px",i.whiteSpace="",i.height="";var h=t.offsetHeight,m=this.options.maxHeight,w="leaflet-popup-scrolled";m&&h>m?(i.height=m+"px",at(t,w)):St(t,w),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),s=this._getAnchor();Pt(this._container,i.add(s))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,i=parseInt(Wn(this._container,"marginBottom"),10)||0,s=this._container.offsetHeight+i,h=this._containerWidth,m=new H(this._containerLeft,-s-this._containerBottom);m._add(Xe(this._container));var w=t.layerPointToContainerPoint(m),P=V(this.options.autoPanPadding),A=V(this.options.autoPanPaddingTopLeft||P),D=V(this.options.autoPanPaddingBottomRight||P),O=t.getSize(),Z=0,Q=0;w.x+h+D.x>O.x&&(Z=w.x+h-O.x+D.x),w.x-Z-A.x<0&&(Z=w.x-A.x),w.y+s+D.y>O.y&&(Q=w.y+s-O.y+D.y),w.y-Q-A.y<0&&(Q=w.y-A.y),(Z||Q)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([Z,Q]))}},_getAnchor:function(){return V(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Qc=function(t,i){return new ji(t,i)};lt.mergeOptions({closePopupOnClick:!0}),lt.include({openPopup:function(t,i,s){return this._initOverlay(ji,t,i,s).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),fe.include({bindPopup:function(t,i){return this._popup=this._initOverlay(ji,this._popup,t,i),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Ee||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){tn(t);var i=t.layer||t.target;if(this._popup._source===i&&!(i instanceof $e)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=i,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var qi=Le.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Le.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Le.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Le.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",i=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ut("div",i),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+f(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var i,s,h=this._map,m=this._container,w=h.latLngToContainerPoint(h.getCenter()),P=h.layerPointToContainerPoint(t),A=this.options.direction,D=m.offsetWidth,O=m.offsetHeight,Z=V(this.options.offset),Q=this._getAnchor();A==="top"?(i=D/2,s=O):A==="bottom"?(i=D/2,s=0):A==="center"?(i=D/2,s=O/2):A==="right"?(i=0,s=O/2):A==="left"?(i=D,s=O/2):P.x<w.x?(A="right",i=0,s=O/2):(A="left",i=D+(Z.x+Q.x)*2,s=O/2),t=t.subtract(V(i,s,!0)).add(Z).add(Q),St(m,"leaflet-tooltip-right"),St(m,"leaflet-tooltip-left"),St(m,"leaflet-tooltip-top"),St(m,"leaflet-tooltip-bottom"),at(m,"leaflet-tooltip-"+A),Pt(m,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&ee(this._container,t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(i)},_getAnchor:function(){return V(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),tu=function(t,i){return new qi(t,i)};lt.include({openTooltip:function(t,i,s){return this._initOverlay(qi,t,i,s).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),fe.include({bindTooltip:function(t,i){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(qi,this._tooltip,t,i),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var i=t?"off":"on",s={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?s.add=this._openTooltip:(s.mouseover=this._openTooltip,s.mouseout=this.closeTooltip,s.click=this._openTooltip,this._map?this._addFocusListeners():s.add=this._addFocusListeners),this._tooltip.options.sticky&&(s.mousemove=this._moveTooltip),this[i](s),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Ee||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var i=typeof t.getElement=="function"&&t.getElement();i&&(it(i,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),it(i,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var i=typeof t.getElement=="function"&&t.getElement();i&&i.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var i=this;this._map.once("moveend",function(){i._openOnceFlag=!1,i._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var i=t.latlng,s,h;this._tooltip.options.sticky&&t.originalEvent&&(s=this._map.mouseEventToContainerPoint(t.originalEvent),h=this._map.containerPointToLayerPoint(s),i=this._map.layerPointToLatLng(h)),this._tooltip.setLatLng(i)}});var As=yn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&t.tagName==="DIV"?t:document.createElement("div"),s=this.options;if(s.html instanceof Element?(Oi(i),i.appendChild(s.html)):i.innerHTML=s.html!==!1?s.html:"",s.bgPos){var h=V(s.bgPos);i.style.backgroundPosition=-h.x+"px "+-h.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}});function eu(t){return new As(t)}yn.Default=Yn;var Xn=fe.extend({options:{tileSize:256,opacity:1,updateWhenIdle:j.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){S(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),Mt(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(pn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(gn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=p(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof H?t:new H(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var i=this.getPane().children,s=-t(-1/0,1/0),h=0,m=i.length,w;h<m;h++)w=i[h].style.zIndex,i[h]!==this._container&&w&&(s=t(s,+w));isFinite(s)&&(this.options.zIndex=s+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!j.ielt9){ee(this._container,this.options.opacity);var t=+new Date,i=!1,s=!1;for(var h in this._tiles){var m=this._tiles[h];if(!(!m.current||!m.loaded)){var w=Math.min(1,(t-m.loaded)/200);ee(m.el,w),w<1?i=!0:(m.active?s=!0:this._onOpaqueTile(m),m.active=!0)}}s&&!this._noPrune&&this._pruneTiles(),i&&(B(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this))}},_onOpaqueTile:y,_initContainer:function(){this._container||(this._container=ut("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,i=this.options.maxZoom;if(t!==void 0){for(var s in this._levels)s=Number(s),this._levels[s].el.children.length||s===t?(this._levels[s].el.style.zIndex=i-Math.abs(t-s),this._onUpdateLevel(s)):(Mt(this._levels[s].el),this._removeTilesAtZoom(s),this._onRemoveLevel(s),delete this._levels[s]);var h=this._levels[t],m=this._map;return h||(h=this._levels[t]={},h.el=ut("div","leaflet-tile-container leaflet-zoom-animated",this._container),h.el.style.zIndex=i,h.origin=m.project(m.unproject(m.getPixelOrigin()),t).round(),h.zoom=t,this._setZoomTransform(h,m.getCenter(),m.getZoom()),y(h.el.offsetWidth),this._onCreateLevel(h)),this._level=h,h}},_onUpdateLevel:y,_onRemoveLevel:y,_onCreateLevel:y,_pruneTiles:function(){if(this._map){var t,i,s=this._map.getZoom();if(s>this.options.maxZoom||s<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)i=this._tiles[t],i.retain=i.current;for(t in this._tiles)if(i=this._tiles[t],i.current&&!i.active){var h=i.coords;this._retainParent(h.x,h.y,h.z,h.z-5)||this._retainChildren(h.x,h.y,h.z,h.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var i in this._tiles)this._tiles[i].coords.z===t&&this._removeTile(i)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)Mt(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,i,s,h){var m=Math.floor(t/2),w=Math.floor(i/2),P=s-1,A=new H(+m,+w);A.z=+P;var D=this._tileCoordsToKey(A),O=this._tiles[D];return O&&O.active?(O.retain=!0,!0):(O&&O.loaded&&(O.retain=!0),P>h?this._retainParent(m,w,P,h):!1)},_retainChildren:function(t,i,s,h){for(var m=2*t;m<2*t+2;m++)for(var w=2*i;w<2*i+2;w++){var P=new H(m,w);P.z=s+1;var A=this._tileCoordsToKey(P),D=this._tiles[A];if(D&&D.active){D.retain=!0;continue}else D&&D.loaded&&(D.retain=!0);s+1<h&&this._retainChildren(m,w,s+1,h)}},_resetView:function(t){var i=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),i,i)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var i=this.options;return i.minNativeZoom!==void 0&&t<i.minNativeZoom?i.minNativeZoom:i.maxNativeZoom!==void 0&&i.maxNativeZoom<t?i.maxNativeZoom:t},_setView:function(t,i,s,h){var m=Math.round(i);this.options.maxZoom!==void 0&&m>this.options.maxZoom||this.options.minZoom!==void 0&&m<this.options.minZoom?m=void 0:m=this._clampZoom(m);var w=this.options.updateWhenZooming&&m!==this._tileZoom;(!h||w)&&(this._tileZoom=m,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),m!==void 0&&this._update(t),s||this._pruneTiles(),this._noPrune=!!s),this._setZoomTransforms(t,i)},_setZoomTransforms:function(t,i){for(var s in this._levels)this._setZoomTransform(this._levels[s],t,i)},_setZoomTransform:function(t,i,s){var h=this._map.getZoomScale(s,t.zoom),m=t.origin.multiplyBy(h).subtract(this._map._getNewPixelOrigin(i,s)).round();j.any3d?Ye(t.el,m,h):Pt(t.el,m)},_resetGrid:function(){var t=this._map,i=t.options.crs,s=this._tileSize=this.getTileSize(),h=this._tileZoom,m=this._map.getPixelWorldBounds(this._tileZoom);m&&(this._globalTileRange=this._pxBoundsToTileRange(m)),this._wrapX=i.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,i.wrapLng[0]],h).x/s.x),Math.ceil(t.project([0,i.wrapLng[1]],h).x/s.y)],this._wrapY=i.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([i.wrapLat[0],0],h).y/s.x),Math.ceil(t.project([i.wrapLat[1],0],h).y/s.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var i=this._map,s=i._animatingZoom?Math.max(i._animateToZoom,i.getZoom()):i.getZoom(),h=i.getZoomScale(s,this._tileZoom),m=i.project(t,this._tileZoom).floor(),w=i.getSize().divideBy(h*2);return new tt(m.subtract(w),m.add(w))},_update:function(t){var i=this._map;if(i){var s=this._clampZoom(i.getZoom());if(t===void 0&&(t=i.getCenter()),this._tileZoom!==void 0){var h=this._getTiledPixelBounds(t),m=this._pxBoundsToTileRange(h),w=m.getCenter(),P=[],A=this.options.keepBuffer,D=new tt(m.getBottomLeft().subtract([A,-A]),m.getTopRight().add([A,-A]));if(!(isFinite(m.min.x)&&isFinite(m.min.y)&&isFinite(m.max.x)&&isFinite(m.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var O in this._tiles){var Z=this._tiles[O].coords;(Z.z!==this._tileZoom||!D.contains(new H(Z.x,Z.y)))&&(this._tiles[O].current=!1)}if(Math.abs(s-this._tileZoom)>1){this._setView(t,s);return}for(var Q=m.min.y;Q<=m.max.y;Q++)for(var st=m.min.x;st<=m.max.x;st++){var Wt=new H(st,Q);if(Wt.z=this._tileZoom,!!this._isValidTile(Wt)){var Ct=this._tiles[this._tileCoordsToKey(Wt)];Ct?Ct.current=!0:P.push(Wt)}}if(P.sort(function(Vt,Mn){return Vt.distanceTo(w)-Mn.distanceTo(w)}),P.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ie=document.createDocumentFragment();for(st=0;st<P.length;st++)this._addTile(P[st],ie);this._level.el.appendChild(ie)}}}},_isValidTile:function(t){var i=this._map.options.crs;if(!i.infinite){var s=this._globalTileRange;if(!i.wrapLng&&(t.x<s.min.x||t.x>s.max.x)||!i.wrapLat&&(t.y<s.min.y||t.y>s.max.y))return!1}if(!this.options.bounds)return!0;var h=this._tileCoordsToBounds(t);return mt(this.options.bounds).overlaps(h)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var i=this._map,s=this.getTileSize(),h=t.scaleBy(s),m=h.add(s),w=i.unproject(h,t.z),P=i.unproject(m,t.z);return[w,P]},_tileCoordsToBounds:function(t){var i=this._tileCoordsToNwSe(t),s=new gt(i[0],i[1]);return this.options.noWrap||(s=this._map.wrapLatLngBounds(s)),s},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var i=t.split(":"),s=new H(+i[0],+i[1]);return s.z=+i[2],s},_removeTile:function(t){var i=this._tiles[t];i&&(Mt(i.el),delete this._tiles[t],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){at(t,"leaflet-tile");var i=this.getTileSize();t.style.width=i.x+"px",t.style.height=i.y+"px",t.onselectstart=y,t.onmousemove=y,j.ielt9&&this.options.opacity<1&&ee(t,this.options.opacity)},_addTile:function(t,i){var s=this._getTilePos(t),h=this._tileCoordsToKey(t),m=this.createTile(this._wrapCoords(t),l(this._tileReady,this,t));this._initTile(m),this.createTile.length<2&&z(l(this._tileReady,this,t,null,m)),Pt(m,s),this._tiles[h]={el:m,coords:t,current:!0},i.appendChild(m),this.fire("tileloadstart",{tile:m,coords:t})},_tileReady:function(t,i,s){i&&this.fire("tileerror",{error:i,tile:s,coords:t});var h=this._tileCoordsToKey(t);s=this._tiles[h],s&&(s.loaded=+new Date,this._map._fadeAnimated?(ee(s.el,0),B(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this)):(s.active=!0,this._pruneTiles()),i||(at(s.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:s.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),j.ielt9||!this._map._fadeAnimated?z(this._pruneTiles,this):setTimeout(l(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var i=new H(this._wrapX?g(t.x,this._wrapX):t.x,this._wrapY?g(t.y,this._wrapY):t.y);return i.z=t.z,i},_pxBoundsToTileRange:function(t){var i=this.getTileSize();return new tt(t.min.unscaleBy(i).floor(),t.max.unscaleBy(i).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function nu(t){return new Xn(t)}var Ln=Xn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,i){this._url=t,i=S(this,i),i.detectRetina&&j.retina&&i.maxZoom>0?(i.tileSize=Math.floor(i.tileSize/2),i.zoomReverse?(i.zoomOffset--,i.minZoom=Math.min(i.maxZoom,i.minZoom+1)):(i.zoomOffset++,i.maxZoom=Math.max(i.minZoom,i.maxZoom-1)),i.minZoom=Math.max(0,i.minZoom)):i.zoomReverse?i.minZoom=Math.min(i.maxZoom,i.minZoom):i.maxZoom=Math.max(i.minZoom,i.maxZoom),typeof i.subdomains=="string"&&(i.subdomains=i.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,i){return this._url===t&&i===void 0&&(i=!0),this._url=t,i||this.redraw(),this},createTile:function(t,i){var s=document.createElement("img");return it(s,"load",l(this._tileOnLoad,this,i,s)),it(s,"error",l(this._tileOnError,this,i,s)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(s.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(s.referrerPolicy=this.options.referrerPolicy),s.alt="",s.src=this.getTileUrl(t),s},getTileUrl:function(t){var i={r:j.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var s=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=s),i["-y"]=s}return C(this._url,r(i,this.options))},_tileOnLoad:function(t,i){j.ielt9?setTimeout(l(t,this,null,i),0):t(null,i)},_tileOnError:function(t,i,s){var h=this.options.errorTileUrl;h&&i.getAttribute("src")!==h&&(i.src=h),t(s,i)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,i=this.options.maxZoom,s=this.options.zoomReverse,h=this.options.zoomOffset;return s&&(t=i-t),t+h},_getSubdomain:function(t){var i=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var t,i;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(i=this._tiles[t].el,i.onload=y,i.onerror=y,!i.complete)){i.src=N;var s=this._tiles[t].coords;Mt(i),delete this._tiles[t],this.fire("tileabort",{tile:i,coords:s})}},_removeTile:function(t){var i=this._tiles[t];if(i)return i.el.setAttribute("src",N),Xn.prototype._removeTile.call(this,t)},_tileReady:function(t,i,s){if(!(!this._map||s&&s.getAttribute("src")===N))return Xn.prototype._tileReady.call(this,t,i,s)}});function Is(t,i){return new Ln(t,i)}var Ds=Ln.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,i){this._url=t;var s=r({},this.defaultWmsParams);for(var h in i)h in this.options||(s[h]=i[h]);i=S(this,i);var m=i.detectRetina&&j.retina?2:1,w=this.getTileSize();s.width=w.x*m,s.height=w.y*m,this.wmsParams=s},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code,Ln.prototype.onAdd.call(this,t)},getTileUrl:function(t){var i=this._tileCoordsToNwSe(t),s=this._crs,h=pt(s.project(i[0]),s.project(i[1])),m=h.min,w=h.max,P=(this._wmsVersion>=1.3&&this._crs===Ss?[m.y,m.x,w.y,w.x]:[m.x,m.y,w.x,w.y]).join(","),A=Ln.prototype.getTileUrl.call(this,t);return A+k(this.wmsParams,A,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+P},setParams:function(t,i){return r(this.wmsParams,t),i||this.redraw(),this}});function iu(t,i){return new Ds(t,i)}Ln.WMS=Ds,Is.wms=iu;var Ae=fe.extend({options:{padding:.1},initialize:function(t){S(this,t),f(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),at(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,i){var s=this._map.getZoomScale(i,this._zoom),h=this._map.getSize().multiplyBy(.5+this.options.padding),m=this._map.project(this._center,i),w=h.multiplyBy(-s).add(m).subtract(this._map._getNewPixelOrigin(t,i));j.any3d?Ye(this._container,w,s):Pt(this._container,w)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,i=this._map.getSize(),s=this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();this._bounds=new tt(s,s.add(i.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ns=Ae.extend({options:{tolerance:0},getEvents:function(){var t=Ae.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ae.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");it(t,"mousemove",this._onMouseMove,this),it(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),it(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){B(this._redrawRequest),delete this._ctx,Mt(this._container),_t(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var i in this._layers)t=this._layers[i],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ae.prototype._update.call(this);var t=this._bounds,i=this._container,s=t.getSize(),h=j.retina?2:1;Pt(i,t.min),i.width=h*s.x,i.height=h*s.y,i.style.width=s.x+"px",i.style.height=s.y+"px",j.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Ae.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[f(t)]=t;var i=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=i),this._drawLast=i,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var i=t._order,s=i.next,h=i.prev;s?s.prev=h:this._drawLast=h,h?h.next=s:this._drawFirst=s,delete t._order,delete this._layers[f(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var i=t.options.dashArray.split(/[, ]+/),s=[],h,m;for(m=0;m<i.length;m++){if(h=Number(i[m]),isNaN(h))return;s.push(h)}t.options._dashArray=s}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||z(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var i=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new tt,this._redrawBounds.extend(t._pxBounds.min.subtract([i,i])),this._redrawBounds.extend(t._pxBounds.max.add([i,i]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var i=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,i.x,i.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,i=this._redrawBounds;if(this._ctx.save(),i){var s=i.getSize();this._ctx.beginPath(),this._ctx.rect(i.min.x,i.min.y,s.x,s.y),this._ctx.clip()}this._drawing=!0;for(var h=this._drawFirst;h;h=h.next)t=h.layer,(!i||t._pxBounds&&t._pxBounds.intersects(i))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,i){if(this._drawing){var s,h,m,w,P=t._parts,A=P.length,D=this._ctx;if(A){for(D.beginPath(),s=0;s<A;s++){for(h=0,m=P[s].length;h<m;h++)w=P[s][h],D[h?"lineTo":"moveTo"](w.x,w.y);i&&D.closePath()}this._fillStroke(D,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var i=t._point,s=this._ctx,h=Math.max(Math.round(t._radius),1),m=(Math.max(Math.round(t._radiusY),1)||h)/h;m!==1&&(s.save(),s.scale(1,m)),s.beginPath(),s.arc(i.x,i.y/m,h,0,Math.PI*2,!1),m!==1&&s.restore(),this._fillStroke(s,t)}},_fillStroke:function(t,i){var s=i.options;s.fill&&(t.globalAlpha=s.fillOpacity,t.fillStyle=s.fillColor||s.color,t.fill(s.fillRule||"evenodd")),s.stroke&&s.weight!==0&&(t.setLineDash&&t.setLineDash(i.options&&i.options._dashArray||[]),t.globalAlpha=s.opacity,t.lineWidth=s.weight,t.strokeStyle=s.color,t.lineCap=s.lineCap,t.lineJoin=s.lineJoin,t.stroke())},_onClick:function(t){for(var i=this._map.mouseEventToLayerPoint(t),s,h,m=this._drawFirst;m;m=m.next)s=m.layer,s.options.interactive&&s._containsPoint(i)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(s))&&(h=s);this._fireEvent(h?[h]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var i=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,i)}},_handleMouseOut:function(t){var i=this._hoveredLayer;i&&(St(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,i){if(!this._mouseHoverThrottled){for(var s,h,m=this._drawFirst;m;m=m.next)s=m.layer,s.options.interactive&&s._containsPoint(i)&&(h=s);h!==this._hoveredLayer&&(this._handleMouseOut(t),h&&(at(this._container,"leaflet-interactive"),this._fireEvent([h],t,"mouseover"),this._hoveredLayer=h)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(l(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,i,s){this._map._fireDOMEvent(i,s||i.type,t)},_bringToFront:function(t){var i=t._order;if(i){var s=i.next,h=i.prev;if(s)s.prev=h;else return;h?h.next=s:s&&(this._drawFirst=s),i.prev=this._drawLast,this._drawLast.next=i,i.next=null,this._drawLast=i,this._requestRedraw(t)}},_bringToBack:function(t){var i=t._order;if(i){var s=i.next,h=i.prev;if(h)h.next=s;else return;s?s.prev=h:h&&(this._drawLast=h),i.prev=null,i.next=this._drawFirst,this._drawFirst.prev=i,this._drawFirst=i,this._requestRedraw(t)}}});function Os(t){return j.canvas?new Ns(t):null}var Qn=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),ou={_initContainer:function(){this._container=ut("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ae.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var i=t._container=Qn("shape");at(i,"leaflet-vml-shape "+(this.options.className||"")),i.coordsize="1 1",t._path=Qn("path"),i.appendChild(t._path),this._updateStyle(t),this._layers[f(t)]=t},_addPath:function(t){var i=t._container;this._container.appendChild(i),t.options.interactive&&t.addInteractiveTarget(i)},_removePath:function(t){var i=t._container;Mt(i),t.removeInteractiveTarget(i),delete this._layers[f(t)]},_updateStyle:function(t){var i=t._stroke,s=t._fill,h=t.options,m=t._container;m.stroked=!!h.stroke,m.filled=!!h.fill,h.stroke?(i||(i=t._stroke=Qn("stroke")),m.appendChild(i),i.weight=h.weight+"px",i.color=h.color,i.opacity=h.opacity,h.dashArray?i.dashStyle=I(h.dashArray)?h.dashArray.join(" "):h.dashArray.replace(/( *, *)/g," "):i.dashStyle="",i.endcap=h.lineCap.replace("butt","flat"),i.joinstyle=h.lineJoin):i&&(m.removeChild(i),t._stroke=null),h.fill?(s||(s=t._fill=Qn("fill")),m.appendChild(s),s.color=h.fillColor||h.color,s.opacity=h.fillOpacity):s&&(m.removeChild(s),t._fill=null)},_updateCircle:function(t){var i=t._point.round(),s=Math.round(t._radius),h=Math.round(t._radiusY||s);this._setPath(t,t._empty()?"M0 0":"AL "+i.x+","+i.y+" "+s+","+h+" 0,"+65535*360)},_setPath:function(t,i){t._path.v=i},_bringToFront:function(t){pn(t._container)},_bringToBack:function(t){gn(t._container)}},Ki=j.vml?Qn:Ht,ti=Ae.extend({_initContainer:function(){this._container=Ki("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ki("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Mt(this._container),_t(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ae.prototype._update.call(this);var t=this._bounds,i=t.getSize(),s=this._container;(!this._svgSize||!this._svgSize.equals(i))&&(this._svgSize=i,s.setAttribute("width",i.x),s.setAttribute("height",i.y)),Pt(s,t.min),s.setAttribute("viewBox",[t.min.x,t.min.y,i.x,i.y].join(" ")),this.fire("update")}},_initPath:function(t){var i=t._path=Ki("path");t.options.className&&at(i,t.options.className),t.options.interactive&&at(i,"leaflet-interactive"),this._updateStyle(t),this._layers[f(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){Mt(t._path),t.removeInteractiveTarget(t._path),delete this._layers[f(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var i=t._path,s=t.options;i&&(s.stroke?(i.setAttribute("stroke",s.color),i.setAttribute("stroke-opacity",s.opacity),i.setAttribute("stroke-width",s.weight),i.setAttribute("stroke-linecap",s.lineCap),i.setAttribute("stroke-linejoin",s.lineJoin),s.dashArray?i.setAttribute("stroke-dasharray",s.dashArray):i.removeAttribute("stroke-dasharray"),s.dashOffset?i.setAttribute("stroke-dashoffset",s.dashOffset):i.removeAttribute("stroke-dashoffset")):i.setAttribute("stroke","none"),s.fill?(i.setAttribute("fill",s.fillColor||s.color),i.setAttribute("fill-opacity",s.fillOpacity),i.setAttribute("fill-rule",s.fillRule||"evenodd")):i.setAttribute("fill","none"))},_updatePoly:function(t,i){this._setPath(t,he(t._parts,i))},_updateCircle:function(t){var i=t._point,s=Math.max(Math.round(t._radius),1),h=Math.max(Math.round(t._radiusY),1)||s,m="a"+s+","+h+" 0 1,0 ",w=t._empty()?"M0 0":"M"+(i.x-s)+","+i.y+m+s*2+",0 "+m+-s*2+",0 ";this._setPath(t,w)},_setPath:function(t,i){t._path.setAttribute("d",i)},_bringToFront:function(t){pn(t._path)},_bringToBack:function(t){gn(t._path)}});j.vml&&ti.include(ou);function Fs(t){return j.svg||j.vml?new ti(t):null}lt.include({getRenderer:function(t){var i=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return i||(i=this._renderer=this._createRenderer()),this.hasLayer(i)||this.addLayer(i),i},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var i=this._paneRenderers[t];return i===void 0&&(i=this._createRenderer({pane:t}),this._paneRenderers[t]=i),i},_createRenderer:function(t){return this.options.preferCanvas&&Os(t)||Fs(t)}});var Rs=vn.extend({initialize:function(t,i){vn.prototype.initialize.call(this,this._boundsToLatLngs(t),i)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=mt(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function au(t,i){return new Rs(t,i)}ti.create=Ki,ti.pointsToPath=he,xe.geometryToLayer=Hi,xe.coordsToLatLng=Qo,xe.coordsToLatLngs=Wi,xe.latLngToCoords=ta,xe.latLngsToCoords=Gi,xe.getFeature=wn,xe.asFeature=Vi,lt.mergeOptions({boxZoom:!0});var zs=we.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){it(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){_t(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Mt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Gn(),Fo(),this._startPoint=this._map.mouseEventToContainerPoint(t),it(document,{contextmenu:tn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=ut("div","leaflet-zoom-box",this._container),at(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var i=new tt(this._point,this._startPoint),s=i.getSize();Pt(this._box,i.min),this._box.style.width=s.x+"px",this._box.style.height=s.y+"px"},_finish:function(){this._moved&&(Mt(this._box),St(this._container,"leaflet-crosshair")),Vn(),Ro(),_t(document,{contextmenu:tn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(l(this._resetState,this),0);var i=new gt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(i).fire("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});lt.addInitHook("addHandler","boxZoom",zs),lt.mergeOptions({doubleClickZoom:!0});var $s=we.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var i=this._map,s=i.getZoom(),h=i.options.zoomDelta,m=t.originalEvent.shiftKey?s-h:s+h;i.options.doubleClickZoom==="center"?i.setZoom(m):i.setZoomAround(t.containerPoint,m)}});lt.addInitHook("addHandler","doubleClickZoom",$s),lt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Bs=we.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ze(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}at(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){St(this._map._container,"leaflet-grab"),St(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var i=mt(this._map.options.maxBounds);this._offsetLimit=pt(this._map.latLngToContainerPoint(i.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(i.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var i=this._lastTime=+new Date,s=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(s),this._times.push(i),this._prunePositions(i)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,i){return t-(t-i)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),i=this._offsetLimit;t.x<i.min.x&&(t.x=this._viscousLimit(t.x,i.min.x)),t.y<i.min.y&&(t.y=this._viscousLimit(t.y,i.min.y)),t.x>i.max.x&&(t.x=this._viscousLimit(t.x,i.max.x)),t.y>i.max.y&&(t.y=this._viscousLimit(t.y,i.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,i=Math.round(t/2),s=this._initialWorldOffset,h=this._draggable._newPos.x,m=(h-i+s)%t+i-s,w=(h+i+s)%t-i-s,P=Math.abs(m+s)<Math.abs(w+s)?m:w;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=P},_onDragEnd:function(t){var i=this._map,s=i.options,h=!s.inertia||t.noInertia||this._times.length<2;if(i.fire("dragend",t),h)i.fire("moveend");else{this._prunePositions(+new Date);var m=this._lastPos.subtract(this._positions[0]),w=(this._lastTime-this._times[0])/1e3,P=s.easeLinearity,A=m.multiplyBy(P/w),D=A.distanceTo([0,0]),O=Math.min(s.inertiaMaxSpeed,D),Z=A.multiplyBy(O/D),Q=O/(s.inertiaDeceleration*P),st=Z.multiplyBy(-Q/2).round();!st.x&&!st.y?i.fire("moveend"):(st=i._limitOffset(st,i.options.maxBounds),z(function(){i.panBy(st,{duration:Q,easeLinearity:P,noMoveStart:!0,animate:!0})}))}}});lt.addInitHook("addHandler","dragging",Bs),lt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Us=we.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),it(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),_t(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,i=document.documentElement,s=t.scrollTop||i.scrollTop,h=t.scrollLeft||i.scrollLeft;this._map._container.focus(),window.scrollTo(h,s)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var i=this._panKeys={},s=this.keyCodes,h,m;for(h=0,m=s.left.length;h<m;h++)i[s.left[h]]=[-1*t,0];for(h=0,m=s.right.length;h<m;h++)i[s.right[h]]=[t,0];for(h=0,m=s.down.length;h<m;h++)i[s.down[h]]=[0,t];for(h=0,m=s.up.length;h<m;h++)i[s.up[h]]=[0,-1*t]},_setZoomDelta:function(t){var i=this._zoomKeys={},s=this.keyCodes,h,m;for(h=0,m=s.zoomIn.length;h<m;h++)i[s.zoomIn[h]]=t;for(h=0,m=s.zoomOut.length;h<m;h++)i[s.zoomOut[h]]=-t},_addHooks:function(){it(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){_t(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=t.keyCode,s=this._map,h;if(i in this._panKeys){if(!s._panAnim||!s._panAnim._inProgress)if(h=this._panKeys[i],t.shiftKey&&(h=V(h).multiplyBy(3)),s.options.maxBounds&&(h=s._limitOffset(V(h),s.options.maxBounds)),s.options.worldCopyJump){var m=s.wrapLatLng(s.unproject(s.project(s.getCenter()).add(h)));s.panTo(m)}else s.panBy(h)}else if(i in this._zoomKeys)s.setZoom(s.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else if(i===27&&s._popup&&s._popup.options.closeOnEscapeKey)s.closePopup();else return;tn(t)}}});lt.addInitHook("addHandler","keyboard",Us),lt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Zs=we.extend({addHooks:function(){it(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){_t(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var i=ds(t),s=this._map.options.wheelDebounceTime;this._delta+=i,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var h=Math.max(s-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(l(this._performZoom,this),h),tn(t)},_performZoom:function(){var t=this._map,i=t.getZoom(),s=this._map.options.zoomSnap||0;t._stop();var h=this._delta/(this._map.options.wheelPxPerZoomLevel*4),m=4*Math.log(2/(1+Math.exp(-Math.abs(h))))/Math.LN2,w=s?Math.ceil(m/s)*s:m,P=t._limitZoom(i+(this._delta>0?w:-w))-i;this._delta=0,this._startTime=null,P&&(t.options.scrollWheelZoom==="center"?t.setZoom(i+P):t.setZoomAround(this._lastMousePos,i+P))}});lt.addInitHook("addHandler","scrollWheelZoom",Zs);var su=600;lt.mergeOptions({tapHold:j.touchNative&&j.safari&&j.mobile,tapTolerance:15});var Hs=we.extend({addHooks:function(){it(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){_t(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var i=t.touches[0];this._startPos=this._newPos=new H(i.clientX,i.clientY),this._holdTimeout=setTimeout(l(function(){this._cancel(),this._isTapValid()&&(it(document,"touchend",Nt),it(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",i))},this),su),it(document,"touchend touchcancel contextmenu",this._cancel,this),it(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){_t(document,"touchend",Nt),_t(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),_t(document,"touchend touchcancel contextmenu",this._cancel,this),_t(document,"touchmove",this._onMove,this)},_onMove:function(t){var i=t.touches[0];this._newPos=new H(i.clientX,i.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,i){var s=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY});s._simulated=!0,i.target.dispatchEvent(s)}});lt.addInitHook("addHandler","tapHold",Hs),lt.mergeOptions({touchZoom:j.touch,bounceAtZoomLimits:!0});var Ws=we.extend({addHooks:function(){at(this._map._container,"leaflet-touch-zoom"),it(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){St(this._map._container,"leaflet-touch-zoom"),_t(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(!(!t.touches||t.touches.length!==2||i._animatingZoom||this._zooming)){var s=i.mouseEventToContainerPoint(t.touches[0]),h=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),i.options.touchZoom!=="center"&&(this._pinchStartLatLng=i.containerPointToLatLng(s.add(h)._divideBy(2))),this._startDist=s.distanceTo(h),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),it(document,"touchmove",this._onTouchMove,this),it(document,"touchend touchcancel",this._onTouchEnd,this),Nt(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var i=this._map,s=i.mouseEventToContainerPoint(t.touches[0]),h=i.mouseEventToContainerPoint(t.touches[1]),m=s.distanceTo(h)/this._startDist;if(this._zoom=i.getScaleZoom(m,this._startZoom),!i.options.bounceAtZoomLimits&&(this._zoom<i.getMinZoom()&&m<1||this._zoom>i.getMaxZoom()&&m>1)&&(this._zoom=i._limitZoom(this._zoom)),i.options.touchZoom==="center"){if(this._center=this._startLatLng,m===1)return}else{var w=s._add(h)._divideBy(2)._subtract(this._centerPoint);if(m===1&&w.x===0&&w.y===0)return;this._center=i.unproject(i.project(this._pinchStartLatLng,this._zoom).subtract(w),this._zoom)}this._moved||(i._moveStart(!0,!1),this._moved=!0),B(this._animRequest);var P=l(i._move,i,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=z(P,this,!0),Nt(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,B(this._animRequest),_t(document,"touchmove",this._onTouchMove,this),_t(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});lt.addInitHook("addHandler","touchZoom",Ws),lt.BoxZoom=zs,lt.DoubleClickZoom=$s,lt.Drag=Bs,lt.Keyboard=Us,lt.ScrollWheelZoom=Zs,lt.TapHold=Hs,lt.TouchZoom=Ws,o.Bounds=tt,o.Browser=j,o.CRS=ht,o.Canvas=Ns,o.Circle=Xo,o.CircleMarker=Zi,o.Class=nt,o.Control=de,o.DivIcon=As,o.DivOverlay=Le,o.DomEvent=Tc,o.DomUtil=Mc,o.Draggable=ze,o.Evented=Lt,o.FeatureGroup=Ee,o.GeoJSON=xe,o.GridLayer=Xn,o.Handler=we,o.Icon=yn,o.ImageOverlay=Ji,o.LatLng=X,o.LatLngBounds=gt,o.Layer=fe,o.LayerGroup=_n,o.LineUtil=Rc,o.Map=lt,o.Marker=Ui,o.Mixin=Ac,o.Path=$e,o.Point=H,o.PolyUtil=Ic,o.Polygon=vn,o.Polyline=Ce,o.Popup=ji,o.PosAnimation=fs,o.Projection=zc,o.Rectangle=Rs,o.Renderer=Ae,o.SVG=ti,o.SVGOverlay=xs,o.TileLayer=Ln,o.Tooltip=qi,o.Transformation=Rt,o.Util=Y,o.VideoOverlay=Cs,o.bind=l,o.bounds=pt,o.canvas=Os,o.circle=Vc,o.circleMarker=Gc,o.control=qn,o.divIcon=eu,o.extend=r,o.featureGroup=Zc,o.geoJSON=Es,o.geoJson=qc,o.gridLayer=nu,o.icon=Hc,o.imageOverlay=Kc,o.latLng=W,o.latLngBounds=mt,o.layerGroup=Uc,o.map=Sc,o.marker=Wc,o.point=V,o.polygon=jc,o.polyline=Jc,o.popup=Qc,o.rectangle=au,o.setOptions=S,o.stamp=f,o.svg=Fs,o.svgOverlay=Xc,o.tileLayer=Is,o.tooltip=tu,o.transformation=qt,o.version=a,o.videoOverlay=Yc;var ru=window.L;o.noConflict=function(){return window.L=ru,this},window.L=o})}(ai,ai.exports)),ai.exports}const Gl=Object.freeze(Object.defineProperty({__proto__:null,__require:Wl},Symbol.toStringTag,{value:"Module"}));(function(){function n(e){return this instanceof n?(this._canvas=e=typeof e=="string"?document.getElementById(e):e,this._ctx=e.getContext("2d"),this._width=e.width,this._height=e.height,this._max=1,void this.clear()):new n(e)}n.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(e,o){return this._data=e,this},max:function(e){return this._max=e,this},add:function(e){return this._data.push(e),this},clear:function(){return this._data=[],this},radius:function(e,o){o=o||15;var a=this._circle=document.createElement("canvas"),r=a.getContext("2d"),c=this._r=e+o;return a.width=a.height=2*c,r.shadowOffsetX=r.shadowOffsetY=200,r.shadowBlur=o,r.shadowColor="black",r.beginPath(),r.arc(c-200,c-200,e,0,2*Math.PI,!0),r.closePath(),r.fill(),this},gradient:function(e){var o=document.createElement("canvas"),a=o.getContext("2d"),r=a.createLinearGradient(0,0,0,256);o.width=1,o.height=256;for(var c in e)r.addColorStop(c,e[c]);return a.fillStyle=r,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(e){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var o=this._ctx;o.clearRect(0,0,this._width,this._height);for(var a,r=0,c=this._data.length;c>r;r++)a=this._data[r],o.globalAlpha=Math.max(a[2]/this._max,e||.05),o.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var l=o.getImageData(0,0,this._width,this._height);return this._colorize(l.data,this._grad),o.putImageData(l,0,0),this},_colorize:function(e,o){for(var a,r=3,c=e.length;c>r;r+=4)a=4*e[r],a&&(e[r-3]=o[a],e[r-2]=o[a+1],e[r-1]=o[a+2])}},window.simpleheat=n})(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(n,e){this._latlngs=n,L.setOptions(this,e)},setLatLngs:function(n){return this._latlngs=n,this.redraw()},addLatLng:function(n){return this._latlngs.push(n),this.redraw()},setOptions:function(n){return L.setOptions(this,n),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(n){this._map=n,this._canvas||this._initCanvas(),n._panes.overlayPane.appendChild(this._canvas),n.on("moveend",this._reset,this),n.options.zoomAnimation&&L.Browser.any3d&&n.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(n){n.getPanes().overlayPane.removeChild(this._canvas),n.off("moveend",this._reset,this),n.options.zoomAnimation&&n.off("zoomanim",this._animateZoom,this)},addTo:function(n){return n.addLayer(this),this},_initCanvas:function(){var n=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),e=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);n.style[e]="50% 50%";var o=this._map.getSize();n.width=o.x,n.height=o.y;var a=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(n,"leaflet-zoom-"+(a?"animated":"hide")),this._heat=simpleheat(n),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var n=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,n);var e=this._map.getSize();this._heat._width!==e.x&&(this._canvas.width=this._heat._width=e.x),this._heat._height!==e.y&&(this._canvas.height=this._heat._height=e.y),this._redraw()},_redraw:function(){var n,e,o,a,r,c,l,d,f,p=[],g=this._heat._r,y=this._map.getSize(),v=new L.Bounds(L.point([-g,-g]),y.add([g,g])),M=this.options.max===void 0?1:this.options.max,b=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,S=1/Math.pow(2,Math.max(0,Math.min(b-this._map.getZoom(),12))),k=g/2,E=[],C=this._map._getMapPanePos(),I=C.x%k,x=C.y%k;for(n=0,e=this._latlngs.length;e>n;n++)if(o=this._map.latLngToContainerPoint(this._latlngs[n]),v.contains(o)){r=Math.floor((o.x-I)/k)+2,c=Math.floor((o.y-x)/k)+2;var N=this._latlngs[n].alt!==void 0?this._latlngs[n].alt:this._latlngs[n][2]!==void 0?+this._latlngs[n][2]:1;f=N*S,E[c]=E[c]||[],a=E[c][r],a?(a[0]=(a[0]*a[2]+o.x*f)/(a[2]+f),a[1]=(a[1]*a[2]+o.y*f)/(a[2]+f),a[2]+=f):E[c][r]=[o.x,o.y,f]}for(n=0,e=E.length;e>n;n++)if(E[n])for(l=0,d=E[n].length;d>l;l++)a=E[n][l],a&&p.push([Math.round(a[0]),Math.round(a[1]),Math.min(a[2],M)]);this._heat.data(p).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(n){var e=this._map.getZoomScale(n.zoom),o=this._map._getCenterOffset(n.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,o,e):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(o)+" scale("+e+")"}}),L.heatLayer=function(n,e){return new L.HeatLayer(n,e)};async function Va(){if(!u.lastLat||!u.lastLng){T.handleMessage("Please select a location first.");return}if(!_.state.userSettings.selectedEnsembleModels||_.state.userSettings.selectedEnsembleModels.length===0){u.ensembleModelsData=null,rn(),console.log("No ensemble models selected. Cleared ensemble data and visualizations.");return}const n=u.lastLat,e=u.lastLng,o=_.state.userSettings.selectedEnsembleModels;console.log(`Fetching ensemble weather data for models: ${o.join(", ")} at ${n}, ${e}`);const a=document.getElementById("loading");a&&(a.style.display="block");const r=o.join(","),c=["surface_pressure","temperature_2m","relative_humidity_2m","wind_speed_10m","wind_direction_10m","geopotential_height_1000hPa","temperature_1000hPa","relative_humidity_1000hPa","wind_speed_1000hPa","wind_direction_1000hPa","geopotential_height_950hPa","temperature_950hPa","relative_humidity_950hPa","wind_speed_950hPa","wind_direction_950hPa","geopotential_height_925hPa","temperature_925hPa","relative_humidity_925hPa","wind_speed_925hPa","wind_direction_925hPa","geopotential_height_900hPa","temperature_900hPa","relative_humidity_900hPa","wind_speed_900hPa","wind_direction_900hPa","geopotential_height_850hPa","temperature_850hPa","relative_humidity_850hPa","wind_speed_850hPa","wind_direction_850hPa","geopotential_height_800hPa","temperature_800hPa","relative_humidity_800hPa","wind_speed_800hPa","wind_direction_800hPa","geopotential_height_700hPa","temperature_700hPa","relative_humidity_700hPa","wind_speed_700hPa","wind_direction_700hPa","geopotential_height_600hPa","temperature_600hPa","relative_humidity_600hPa","wind_speed_600hPa","wind_direction_600hPa","geopotential_height_500hPa","temperature_500hPa","relative_humidity_500hPa","wind_speed_500hPa","wind_direction_500hPa","geopotential_height_400hPa","temperature_400hPa","relative_humidity_400hPa","wind_speed_400hPa","wind_direction_400hPa","geopotential_height_300hPa","temperature_300hPa","relative_humidity_300hPa","wind_speed_300hPa","wind_direction_300hPa","geopotential_height_250hPa","temperature_250hPa","relative_humidity_250hPa","wind_speed_250hPa","wind_direction_250hPa","geopotential_height_200hPa","temperature_200hPa","relative_humidity_200hPa","wind_speed_200hPa","wind_direction_200hPa"],l=c.join(","),d=document.getElementById("historicalDatePicker"),f=d?d.value:null,p=f?J.fromISO(f,{zone:"utc"}):null,g=J.utc().startOf("day"),y=p&&p<g;let v,M,b=ci.FORECAST;if(y)b=ci.HISTORICAL,v=p.toFormat("yyyy-MM-dd"),M=v;else{const k=J.utc();v=k.toFormat("yyyy-MM-dd"),M=k.plus({days:7}).toFormat("yyyy-MM-dd")}const S=`${b}?latitude=${n}&longitude=${e}&hourly=${l}&models=${r}&start_date=${v}&end_date=${M}`;console.log("Constructed ensemble URL:",S);try{const k=await fetch(S);if(!k.ok){const I=await k.text();throw new Error(`API request failed: ${k.status} - ${I}`)}const E=await k.json();if(console.log("Raw data from OpenMeteo for ensemble request:",JSON.stringify(E,null,2)),console.log("Models requested:",o),u.ensembleModelsData={},E.error&&E.reason)throw new Error(`API Error: ${E.reason}`);if(!E.hourly){let I='Unexpected data format: "hourly" field missing in API response.';throw E&&typeof E.latitude<"u"&&(I="Received metadata but no 'hourly' data for any requested ensemble model."),console.error(I,E),new Error(I)}const C=E.hourly.time;if(!C)throw new Error("Shared 'time' array missing in hourly data.");if(o.forEach(I=>{const x={time:[...C]};let N=!1;c.forEach(R=>{const F=`${R}_${I}`;E.hourly[F]?(x[R]=E.hourly[F],N=!0):o.length===1&&E.hourly[R]?(x[R]=E.hourly[R],N=!0):x[R]=null}),N?(u.ensembleModelsData[I]=x,console.log(`Successfully processed and stored data for model: ${I}`)):console.warn(`No data found for model ${I} with suffixed keys in the 'hourly' object. Available keys for this model might be missing or the model is unavailable for this specific request. Hourly keys in response:`,Object.keys(E.hourly))}),Object.keys(u.ensembleModelsData).length===0&&o.length>0){const I="Could not retrieve and process data for any of the selected ensemble models. They might be unavailable or the API response structure was not as expected for these models.";console.warn(I,"Original API response:",E),T.handleMessage(I)}else console.log("Ensemble weather data processed and stored in AppState.ensembleModelsData:",u.ensembleModelsData);go()}catch(k){console.error("Error in fetchEnsembleWeatherData:",k),T.handleError(`Failed to fetch ensemble weather data: ${k.message}`),u.ensembleModelsData=null,rn()}finally{a&&(a.style.display="none")}}function rn(){u.ensembleLayerGroup&&u.map.removeLayer(u.ensembleLayerGroup),u.heatmapLayer&&u.map.removeLayer(u.heatmapLayer),u.heatmapLayer=null,u.ensembleScenarioCircles={},u.ensembleLayerGroup=(void 0)().addTo(u.map),console.log("Ensemble visualizations cleared and a new, clean layer group was created.")}function go(){if(rn(),!u.ensembleModelsData||Object.keys(u.ensembleModelsData).length===0){console.log("No ensemble data to process."),_.state.userSettings.selectedEnsembleModels.length>0&&_.state.userSettings.currentEnsembleScenario!=="all_models"&&(T.handleMessage("Data for selected ensemble models not yet available. Fetching..."),Va());return}const n=_.state.userSettings.currentEnsembleScenario,e=Te();if(console.log(`Processing ensemble scenario: ${n} for slider index: ${e}`),n==="heatmap")Cd();else if(n==="all_models"){for(const o in u.ensembleModelsData)if(Object.hasOwnProperty.call(u.ensembleModelsData,o)){const r={hourly:u.ensembleModelsData[o]},c=Ia(o,r);if(c){const l=Pd(o);Er(c,l,o)}}}else{const o=Ed(n);if(o){const a=Ia(n,o);if(a){const r=kd(n);Er(a,r,n.replace("_"," "))}}else console.warn(`Could not calculate profile for scenario: ${n}`),T.handleMessage(`Could not generate '${n.replace("_"," ")}' profile. Not enough data?`)}}function Pd(n){let e=0;for(let a=0;a<n.length;a++)e=n.charCodeAt(a)+((e<<5)-e),e=e&e;return`hsl(${e%360}, 70%, 60%)`}function kd(n){return n==="min_wind"?re.SCENARIO_COLORS.MIN_WIND:n==="mean_wind"?re.SCENARIO_COLORS.MEAN_WIND:n==="max_wind"?re.SCENARIO_COLORS.MAX_WIND:"rgba(128, 128, 128, 0.7)"}function Er(n,e,o){var S,k;if(!u.map||!n||!u.ensembleLayerGroup)return;const a=[n.centerLat,n.centerLng],r=(void 0)(a,{radius:n.radius,color:e,fillColor:e,fillOpacity:.15,weight:2,dashArray:"5, 10"}).addTo(u.ensembleLayerGroup),c=_.getValue("windUnit","radio","kt");let l="N/A";if(n.meanWindSpeedMps!=="N/A"&&Number.isFinite(n.meanWindSpeedMps)){const E=T.convertWind(n.meanWindSpeedMps,c,"m/s");E!=="N/A"&&Number.isFinite(E)&&(l=c==="bft"?Math.round(E):E.toFixed(1))}const d=parseInt((S=document.getElementById("openingAltitude"))==null?void 0:S.value)||_.state.userSettings.openingAltitude||1200,f=parseInt((k=document.getElementById("legHeightDownwind"))==null?void 0:k.value)||_.state.userSettings.legHeightDownwind||0,p=d-200,g=_.getValue("heightUnit","radio","m"),y=Math.round(T.convertHeight(f,g)),v=Math.round(T.convertHeight(p,g)),M=n.meanWindDir!=="N/A"&&Number.isFinite(n.meanWindDir)?T.roundToTens(n.meanWindDir):"N/A",b=`<strong>${o}</strong><br>Mean Wind ${y}-${v} ${g} AGL:<br>${M}° ${l} ${c}`;r.bindTooltip(b,{permanent:!1,direction:"top",className:"wind-tooltip",opacity:.9}),u.ensembleScenarioCircles[o]=r,console.log(`Drew ensemble circle for ${o} at [${a.join(", ")}], radius ${n.radius}`)}function Ed(n){var p;if(!u.ensembleModelsData||Object.keys(u.ensembleModelsData).length===0)return console.warn("No ensemble data available for profile calculation."),null;if(Object.keys(u.ensembleModelsData).length===0)return null;console.log(`Calculating full time-series ensemble profile for: ${n}`);const o={},a=Object.keys(u.ensembleModelsData)[0],r=(p=u.ensembleModelsData[a])==null?void 0:p.time;if(!r||r.length===0)return console.error("Time data missing or empty in the first ensemble model for profile calculation."),null;o.time=[...r];const c=o.time.length,l=["surface_pressure","temperature_2m","relative_humidity_2m","geopotential_height_1000hPa","temperature_1000hPa","relative_humidity_1000hPa","geopotential_height_950hPa","temperature_950hPa","relative_humidity_950hPa","geopotential_height_925hPa","temperature_925hPa","relative_humidity_925hPa","geopotential_height_900hPa","temperature_900hPa","relative_humidity_900hPa","geopotential_height_850hPa","temperature_850hPa","relative_humidity_850hPa","geopotential_height_800hPa","temperature_800hPa","relative_humidity_800hPa","geopotential_height_700hPa","temperature_700hPa","relative_humidity_700hPa","geopotential_height_600hPa","temperature_600hPa","relative_humidity_600hPa","geopotential_height_500hPa","temperature_500hPa","relative_humidity_500hPa","geopotential_height_400hPa","temperature_400hPa","relative_humidity_400hPa","geopotential_height_300hPa","temperature_300hPa","relative_humidity_300hPa","geopotential_height_250hPa","temperature_250hPa","relative_humidity_250hPa","geopotential_height_200hPa","temperature_200hPa","relative_humidity_200hPa"],d=[["wind_speed_10m","wind_direction_10m"]];[1e3,950,925,900,850,800,700,600,500,400,300,250,200].forEach(g=>{d.push([`wind_speed_${g}hPa`,`wind_direction_${g}hPa`])}),l.forEach(g=>{o[g]=new Array(c).fill(null)}),d.forEach(g=>{o[g[0]]=new Array(c).fill(null),o[g[1]]=new Array(c).fill(null)});for(let g=0;g<c;g++)l.forEach(y=>{const v=[];for(const M in u.ensembleModelsData){const b=u.ensembleModelsData[M];if(b&&b[y]){const S=b[y][g];S!=null&&!isNaN(S)&&v.push(S)}}v.length>0&&(n==="min_wind"?o[y][g]=Math.min(...v):n==="max_wind"?o[y][g]=Math.max(...v):o[y][g]=v.reduce((M,b)=>M+b,0)/v.length)}),d.forEach(y=>{const v=y[0],M=y[1];let b=[],S=[],k=[],E=[];for(const C in u.ensembleModelsData){const I=u.ensembleModelsData[C];if(I&&I[v]&&I[M]){const x=I[v][g],N=I[M][g];x!=null&&!isNaN(x)&&N!==null&&N!==void 0&&!isNaN(N)&&(k.push(x),E.push(N),b.push(-x*Math.sin(N*Math.PI/180)),S.push(-x*Math.cos(N*Math.PI/180)))}}if(k.length>0)if(n==="min_wind"){const C=Math.min(...k),I=k.indexOf(C);o[v][g]=C,o[M][g]=E[I]}else if(n==="max_wind"){const C=Math.max(...k),I=k.indexOf(C);o[v][g]=C,o[M][g]=E[I]}else{const C=b.reduce((x,N)=>x+N,0)/b.length,I=S.reduce((x,N)=>x+N,0)/S.length;o[v][g]=T.windSpeed(C,I),o[M][g]=T.windDirection(C,I)}});return{hourly:o}}function Ia(n,e=null){var l,d;console.log(`Calculating exit circle for ensemble profile/model: ${n}`);let o;if(e)o=e;else if(u.ensembleModelsData&&u.ensembleModelsData[n])o={hourly:u.ensembleModelsData[n]};else return console.warn(`No data for profile/model ${n} in calculateExitCircleForEnsemble found.`),null;if(!o.hourly||!u.lastLat||!u.lastLng||u.lastAltitude==="N/A")return console.warn(`Incomplete data for calculateExitCircleForEnsemble: ${n}`),null;const a=u.weatherData;u.weatherData=o.hourly;let r=null,c={meanWindDir:"N/A",meanWindSpeedMps:"N/A"};try{const f=_.state.userSettings.calculateJump,p=_.state.userSettings.showExitArea;_.state.userSettings.calculateJump=!0,_.state.userSettings.showExitArea=!0;const g=Te(),y=un(g);if(r=Br(y),y&&y.length>0){const v=y.map(N=>N.height),M=y.map(N=>-T.convertWind(N.spd,"m/s","km/h")*Math.sin(N.dir*Math.PI/180)),b=y.map(N=>-T.convertWind(N.spd,"m/s","km/h")*Math.cos(N.dir*Math.PI/180)),S=parseInt((l=document.getElementById("openingAltitude"))==null?void 0:l.value)||1200,k=parseInt((d=document.getElementById("legHeightDownwind"))==null?void 0:d.value)||0,E=Math.round(u.lastAltitude),C=E+S-200,I=E+k,x=T.calculateMeanWind(v,M,b,I,C);x&&Number.isFinite(x[0])&&Number.isFinite(x[1])&&(c={meanWindDir:x[0],meanWindSpeedMps:x[1]})}_.state.userSettings.calculateJump=f,_.state.userSettings.showExitArea=p}catch(f){console.error(`Error in calculateExitCircle for profile ${n}:`,f),r=null}finally{u.weatherData=a}return r?{centerLat:r.darkGreenLat,centerLng:r.darkGreenLng,radius:r.darkGreenRadius,freeFallDirection:r.freeFallDirection,freeFallDistance:r.freeFallDistance,freeFallTime:r.freeFallTime,meanWindDir:c.meanWindDir,meanWindSpeedMps:c.meanWindSpeedMps,profileIdentifier:n}:(console.warn(`calculateExitCircle returned null for profile ${n}`),null)}function Cd(){if(rn(),u.heatmapLayer&&(u.map.removeLayer(u.heatmapLayer),u.heatmapLayer=null),!u.ensembleModelsData||Object.keys(u.ensembleModelsData).length<2){T.handleMessage("Please select at least two ensemble models to generate a heatmap.");return}const n=[];for(const p in u.ensembleModelsData)if(Object.hasOwnProperty.call(u.ensembleModelsData,p)){const g=u.ensembleModelsData[p],y=Ia(p,{hourly:g});y&&n.push({centerLat:y.centerLat,centerLng:y.centerLng,radius:y.radius})}if(n.length===0){console.warn("Could not calculate any circles for the heatmap.");return}console.log(`[Heatmap] Calculated ${n.length} model circles.`);let e=90,o=-90,a=180,r=-180;const c=111320;n.forEach(p=>{const g=p.radius/c,y=p.radius/(c*Math.cos(p.centerLat*Math.PI/180));e=Math.min(e,p.centerLat-g),o=Math.max(o,p.centerLat+g),a=Math.min(a,p.centerLng-y),r=Math.max(r,p.centerLng+y)});const l=40,d=l/c,f=[];console.log("[Heatmap] Starting grid calculation...");for(let p=e;p<=o;p+=d){const g=l/(c*Math.cos(p*Math.PI/180));for(let y=a;y<=r;y+=g){let v=0;const M=(void 0)(p,y);n.forEach(b=>{const S=(void 0)(b.centerLat,b.centerLng);u.map.distance(M,S)<=b.radius&&v++}),v>0&&f.push([p,y,v])}}if(console.log(`[Heatmap] Finished grid calculation. Generated ${f.length} heatmap points.`),f.length>0){const p=n.length,g={};if(p===1)g[1]="lime";else for(let v=1;v<=p;v++){const M=v/p;v===1?g[M]="red":v<p?g[M]="yellow":g[M]="lime"}console.log("[Heatmap] Using gradient:",g),u.heatmapLayer&&u.map.removeLayer(u.heatmapLayer);const y=T.calculateDynamicRadius(re.HEATMAP_BASE_RADIUS,re.HEATMAP_REFERENCE_ZOOM);u.heatmapLayer=(void 0)(f,{radius:y,blur:10,max:p,minOpacity:.01,gradient:g}).addTo(u.map)}else T.handleMessage("No overlapping landing areas found for the selected models.")}function hi(){const n=window.innerWidth<le.MOBILE_BREAKPOINT_PX;return console.log(`isMobileDevice check: window.innerWidth=${window.innerWidth}, isMobile=${n}`),n}function se(n){console.log("displayMessage called with:",n);let e=document.getElementById("message");e||(e=document.createElement("div"),e.id="message",e.style.position="fixed",e.style.top="5px",e.style.right="5px",e.style.width=hi()?"70%":"30%",e.style.backgroundColor="#ccffcc",e.style.borderRadius="5px 5px 5px 5px",e.style.color="#000000",e.style.padding="6px",e.style.zIndex="9998",e.style.textAlign="center",document.body.appendChild(e),window.addEventListener("resize",()=>{e.style.width=hi()?"70%":"30%"})),e.textContent=n,e.style.display="block",clearTimeout(window.messageTimeout),window.messageTimeout=setTimeout(()=>{e.style.display="none"},le.MESSAGE_TIMEOUT_MS)}function _o(n,e,o){const a=Math.round(n/e*100);let r=document.getElementById("progress");r||(r=document.createElement("div"),r.id="progress",r.style.position="fixed",r.style.top="5px",r.style.right="5px",r.style.width=hi()?"70%":"30%",r.style.backgroundColor="#ccffcc",r.style.borderRadius="5px 5px 5px 5px",r.style.color="#000000",r.style.padding="6px",r.style.zIndex="9998",r.style.display="flex",r.style.alignItems="center",r.style.gap="10px",document.body.appendChild(r),window.addEventListener("resize",()=>{r.style.width=hi()?"70%":"30%"}));const c=document.createElement("div");c.style.flex="1",c.style.display="flex",c.style.flexDirection="column",c.style.gap="3px";const l=document.createElement("div");l.textContent=`Caching (${n}/${e}, ${a}%)`,l.style.fontSize="12px",l.style.textAlign="center";const d=document.createElement("div");d.style.width="100%",d.style.height="8px",d.style.backgroundColor="#e0e0e0",d.style.borderRadius="3px",d.style.overflow="hidden";const f=document.createElement("div");f.style.width=`${a}%`,f.style.height="100%",f.style.backgroundColor="#4caf50",f.style.transition="width 0.3s ease-in-out",d.appendChild(f),c.appendChild(l),c.appendChild(d);let p=document.getElementById("cancel-caching");p||(p=document.createElement("button"),p.id="cancel-caching",p.textContent="Cancel",p.style.backgroundColor="#ff4444",p.style.color="#ffffff",p.style.border="none",p.style.borderRadius="3px",p.style.padding="5px 3px",p.style.cursor="pointer",p.style.fontSize="12px",p.addEventListener("click",()=>{o(),r.style.display="none",T.handleMessage("Caching cancelled.")})),r.innerHTML="",r.appendChild(c),r.appendChild(p),r.style.display="flex"}function Vl(){const n=document.getElementById("progress");n&&(n.style.display="none")}function Da(){console.log("updateOfflineIndicator called, navigator.onLine:",navigator.onLine);let n=document.getElementById("offline-indicator");n||(n=document.createElement("div"),n.id="offline-indicator",document.body.appendChild(n),console.log("Offline indicator created and appended")),n.style.display=navigator.onLine?"none":"block",n.textContent="Offline Mode"}function Nn(n){console.log("displayError called with:",n);let e=document.getElementById("error-message");e||(e=document.createElement("div"),e.id="error-message",document.body.appendChild(e),window.addEventListener("resize",()=>{e.style.width=hi()?"70%":"30%"})),e.textContent=n,e.style.display="block",console.log("Error element state:",{display:e.style.display,text:e.textContent,position:e.style.position,zIndex:e.style.zIndex}),clearTimeout(window.errorTimeout),window.errorTimeout=setTimeout(()=>{e.style.display="none",console.log("Error hidden after 3s")},le.MESSAGE_TIMEOUT_MS)}function Te(){var n;return parseInt((n=document.getElementById("timeSlider"))==null?void 0:n.value)||0}function xd(n){const e=document.getElementById("modelSelect");if(!e)return;const o=e.value;e.innerHTML="",n.forEach(a=>{const r=document.createElement("option");r.value=a,r.textContent=a.replace(/_/g," ").toUpperCase(),e.appendChild(r)}),n.includes(_.state.userSettings.model)?e.value=_.state.userSettings.model:n.includes(o)?e.value=o:n.length>0&&(e.value=n[0])}function Ad(n){const e=document.getElementById("ensembleModelsSubmenu");e&&(e.innerHTML="",n.forEach(o=>{const a=document.createElement("li"),r=document.createElement("label");r.className="radio-label";const c=document.createElement("input");c.type="checkbox",c.name="ensembleModel",c.value=o,c.checked=_.state.userSettings.selectedEnsembleModels.includes(o),c.addEventListener("change",()=>{const l=Array.from(e.querySelectorAll("input:checked")).map(d=>d.value);_.state.userSettings.selectedEnsembleModels=l,_.save(),Va()}),r.append(c,` ${o.replace(/_/g," ").toUpperCase()}`),a.appendChild(r),e.appendChild(a)}))}function Id(n){let e=_.state.userSettings.selectedEnsembleModels||[],o=e.filter(a=>n.includes(a));e.length!==o.length&&(_.state.userSettings.selectedEnsembleModels=o,_.save())}const xn=65,Jt=73,ae=79;function Jl(n,e){if(e=typeof e=="number"?e:5,!Array.isArray(n))throw new TypeError("forward did not receive an array");if(typeof n[0]=="string"||typeof n[1]=="string")throw new TypeError("forward received an array of strings, but it only accepts an array of numbers.");const[o,a]=n;if(o<-180||o>180)throw new TypeError("forward received an invalid longitude of "+o);if(a<-90||a>90)throw new TypeError("forward received an invalid latitude of "+a);if(a<-80||a>84)throw new TypeError(`forward received a latitude of ${a}, but this library does not support conversions of points in polar regions below 80°S and above 84°N`);return function(r,c){const l="00000"+r.easting,d="00000"+r.northing;return r.zoneNumber+r.zoneLetter+function(f,p,g){const y=ql(g),v=Math.floor(f/1e5),M=Math.floor(p/1e5)%20;return function(b,S,k){const E=k-1,C="AJSAJS".charCodeAt(E),I="AFAFAF".charCodeAt(E);let x=C+b-1,N=I+S,R=!1;return x>90&&(x=x-90+xn-1,R=!0),(x===Jt||C<Jt&&x>Jt||(x>Jt||C<Jt)&&R)&&x++,(x===ae||C<ae&&x>ae||(x>ae||C<ae)&&R)&&(x++,x===Jt&&x++),x>90&&(x=x-90+xn-1),N>86?(N=N-86+xn-1,R=!0):R=!1,(N===Jt||I<Jt&&N>Jt||(N>Jt||I<Jt)&&R)&&N++,(N===ae||I<ae&&N>ae||(N>ae||I<ae)&&R)&&(N++,N===Jt&&N++),N>86&&(N=N-86+xn-1),String.fromCharCode(x)+String.fromCharCode(N)}(v,M,y)}(r.easting,r.northing,r.zoneNumber)+l.substr(l.length-5,c)+d.substr(d.length-5,c)}(function(r){const c=r.lat,l=r.lon,d=6378137,f=fa(c),p=fa(l);let g;g=Math.floor((l+180)/6)+1,l===180&&(g=60),c>=56&&c<64&&l>=3&&l<12&&(g=32),c>=72&&c<84&&(l>=0&&l<9?g=31:l>=9&&l<21?g=33:l>=21&&l<33?g=35:l>=33&&l<42&&(g=37));const y=fa(6*(g-1)-180+3),v=d/Math.sqrt(1-.00669438*Math.sin(f)*Math.sin(f)),M=Math.tan(f)*Math.tan(f),b=.006739496752268451*Math.cos(f)*Math.cos(f),S=Math.cos(f)*(p-y),k=d*(.9983242984503243*f-.002514607064228144*Math.sin(2*f)+2639046602129982e-21*Math.sin(4*f)-3418046101696858e-24*Math.sin(6*f)),E=.9996*v*(S+(1-M+b)*S*S*S/6+(5-18*M+M*M+72*b-.39089081163157013)*S*S*S*S*S/120)+5e5;let C=.9996*(k+v*Math.tan(f)*(S*S/2+(5-M+9*b+4*b*b)*S*S*S*S/24+(61-58*M+M*M+600*b-2.2240339282485886)*S*S*S*S*S*S/720));return c<0&&(C+=1e7),{northing:Math.trunc(C),easting:Math.trunc(E),zoneNumber:g,zoneLetter:jl(c)}}({lat:a,lon:o}),e)}function Dd(n){const e=ja(Kl(n.toUpperCase()));return typeof e.lat=="number"&&typeof e.lon=="number"?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function Ja(n){if(n==="")throw new TypeError("toPoint received a blank string");const e=ja(Kl(n.toUpperCase()));return typeof e.lat=="number"&&typeof e.lon=="number"?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function fa(n){return n*(Math.PI/180)}function Cr(n){return n/Math.PI*180}function ja(n){const e=n.northing,o=n.easting,{zoneLetter:a,zoneNumber:r}=n;if(r<0||r>60)return null;const c=6378137,l=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),d=o-5e5;let f=e;a<"N"&&(f-=1e7);const p=6*(r-1)-180+3,g=f/.9996/6367449145945056e-9,y=g+(3*l/2-27*l*l*l/32)*Math.sin(2*g)+(21*l*l/16-55*l*l*l*l/32)*Math.sin(4*g)+151*l*l*l/96*Math.sin(6*g),v=c/Math.sqrt(1-.00669438*Math.sin(y)*Math.sin(y)),M=Math.tan(y)*Math.tan(y),b=.006739496752268451*Math.cos(y)*Math.cos(y),S=.99330562*c/Math.pow(1-.00669438*Math.sin(y)*Math.sin(y),1.5),k=d/(.9996*v);let E=y-v*Math.tan(y)/S*(k*k/2-(5+3*M+10*b-4*b*b-.06065547077041606)*k*k*k*k/24+(61+90*M+298*b+45*M*M-1.6983531815716497-3*b*b)*k*k*k*k*k*k/720);E=Cr(E);let C,I=(k-(1+2*M+b)*k*k*k/6+(5-2*b+28*M-3*b*b+.05391597401814761+24*M*M)*k*k*k*k*k/120)/Math.cos(y);if(I=p+Cr(I),typeof n.accuracy=="number"){const x=ja({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});C={top:x.lat,right:x.lon,bottom:E,left:I}}else C={lat:E,lon:I};return C}function jl(n){return n<=84&&n>=72?"X":n<72&&n>=-80?"CDEFGHJKLMNPQRSTUVWX"[Math.floor((n- -80)/8)]:n>84||n<-80?"Z":void 0}function ql(n){let e=n%6;return e===0&&(e=6),e}function Kl(n){if(n&&n.length===0)throw new TypeError("MGRSPoint coverting from nothing");n=n.replace(/ /g,"");const{length:e}=n;let o,a=null,r="",c=0;for(;!/[A-Z]/.test(o=n.charAt(c));){if(c>=2)throw new Error("MGRSPoint bad conversion from: "+n);r+=o,c++}const l=parseInt(r,10);if(c===0||c+3>e)throw new Error("MGRSPoint bad conversion from "+n);const d=n.charAt(c++);if(d<="A"||d==="B"||d==="Y"||d>="Z"||d==="I"||d==="O")throw new Error(`MGRSPoint zone letter ${d} not handled: ${n}`);a=n.substring(c,c+=2);const f=ql(l),p=function(C,I){let x="AJSAJS".charCodeAt(I-1),N=1e5,R=!1;for(;x!==C.charCodeAt(0);){if(x++,x===Jt&&x++,x===ae&&x++,x>90){if(R)throw new Error("Bad character: "+C);x=xn,R=!0}N+=1e5}return N}(a.charAt(0),f);let g=function(C,I){if(C>"V")throw new TypeError("MGRSPoint given invalid Northing "+C);let x="AFAFAF".charCodeAt(I-1),N=0,R=!1;for(;x!==C.charCodeAt(0);){if(x++,x===Jt&&x++,x===ae&&x++,x>86){if(R)throw new Error("Bad character: "+C);x=xn,R=!0}N+=1e5}return N}(a.charAt(1),f);for(;g<Nd(d);)g+=2e6;const y=e-c;if(y%2!=0)throw new Error(`MGRSPoint has to have an even number
of digits after the zone letter and two 100km letters - front
half for easting meters, second half for
northing meters `+n);const v=y/2;let M,b,S,k=0,E=0;return v>0&&(M=1e5/Math.pow(10,v),b=n.substring(c,c+v),k=parseFloat(b)*M,S=n.substring(c+v),E=parseFloat(S)*M),{easting:k+p,northing:E+g,zoneLetter:d,zoneNumber:l,accuracy:M}}function Nd(n){let e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw new TypeError("Invalid zone letter: "+n)}const Od=Object.freeze(Object.defineProperty({__proto__:null,forward:Jl,getLetterDesignator:jl,inverse:Dd,toPoint:Ja},Symbol.toStringTag,{value:"Module"}));var ot;let T=(ot=class{static formatTime(e){return J.fromISO(e,{zone:"UTC"}).toFormat("yyyy-MM-dd HHmm")+"Z"}static roundToTens(e){return Math.round(e/10)*10}static convertTemperature(e,o){const a=parseFloat(e);return isNaN(a)?"N/A":o==="°F"?a*9/5+32:a}static convertHeight(e,o){const a=parseFloat(e);return isNaN(a)?"N/A":o==="ft"?parseFloat((e*zt.METERS_TO_FEET).toFixed(0)):e}static convertWind(e,o,a="km/h"){if(e==null||isNaN(e))return"N/A";let r;switch(a){case"km/h":r=e;break;case"m/s":r=e*3.6;break;case"kt":r=e*zt.KNOTS_TO_KMH;break;case"mph":r=e*1.60934;break;case"bft":r=ot.beaufortToKnots(e)*zt.KNOTS_TO_KMH;break;default:r=e;break}switch(o){case"km/h":return r;case"m/s":return r/3.6;case"kt":return r/zt.KNOTS_TO_KMH;case"mph":return r/1.60934;case"bft":return ot.knotsToBeaufort(r/zt.KNOTS_TO_KMH);default:return r/zt.KNOTS_TO_KMH}}static knotsToBeaufort(e){const o=Ys.KNOT_THRESHOLDS.findIndex(a=>e<a);return o===-1?12:o}static beaufortToKnots(e){return Ys.BEAUFORT_THRESHOLDS[e]||63}static calculateDewpoint(e,o){const a=Xi.A_LIQUID,r=Xi.B_LIQUID,c=Xi.A_ICE,l=Xi.B_ICE;let d,f;return e>=0?(d=a*e/(r+e)+Math.log(o/100),f=r*d/(a-d)):(d=c*e/(l+e)+Math.log(o/100),f=l*d/(c-d)),isNaN(f)?null:f}static gaussianInterpolation(e,o,a,r,c){if(a===c)return e;if(r===c)return o;let l=1/Math.abs(a-c),d=1/Math.abs(r-c);return(l*e+d*o)/(l+d)}static interpolateWindAtAltitude(e,o,a,r,c){if(o.length!=a.length||o.length!=r.length||o.length!=c.length)return{u:"Invalid input",v:"Invalid input"};const l=o.map(y=>Math.log(y)),d=ot.linearInterpolate(a,l,e);if(typeof d=="string"&&d.includes("error"))return{u:"Interpolation error",v:"Interpolation error"};const f=Math.exp(d),p=ot.linearInterpolate(l,r,Math.log(f)),g=ot.linearInterpolate(l,c,Math.log(f));return typeof p=="string"&&p.includes("error")||typeof g=="string"&&g.includes("error")?{u:"Interpolation error",v:"Interpolation error"}:{u:p,v:g}}static interpolatePressure(e,o,a){if(!o||!a||o.length!==a.length||o.length<2||e<a[0]||e>a[a.length-1])return"N/A";for(let r=0;r<a.length-1;r++)if(e>=a[r]&&e<=a[r+1]){const c=a[r],l=a[r+1],d=o[r],f=o[r+1];return d+(f-d)*(e-c)/(l-c)}return"N/A"}static linearInterpolate(e,o,a){if(!(e!=null&&e.length)||!(o!=null&&o.length)||e.length!==o.length)return"invalid input for linearInterpolate";let r=!1;e[1]>e[0]&&(o=[...o].reverse(),e=[...e].reverse(),r=!0);const c=e.length-1;try{if(a>e[0]||a<e[c]){let l,d;return a>e[0]?(l=(o[1]-o[0])/(e[1]-e[0]),d=o[1]-l*e[1]):(l=(o[c]-o[c-1])/(e[c]-e[c-1]),d=o[c]-l*e[c]),l*a+d}else{let l;for(l=1;l<=c&&!(a>=e[l]);l++);const d=(o[l]-o[l-1])/(e[l]-e[l-1]),f=o[l]-d*e[l];return d*a+f}}catch{return"interpolation error"}finally{r&&(o.reverse(),e.reverse())}}static windSpeed(e,o){return Math.sqrt(e*e+o*o)}static windDirection(e,o){return(Math.atan2(-e,-o)*180/Math.PI+360)%360}static calculateMeanWind(e,o,a,r,c){try{if(!e||!o||!a||e.length<2)throw new Error("Invalid input data for calculateMeanWind");const l=new Array(4);let d=[c],f=[Number(ot.linearInterpolate(e,o,c))],p=[Number(ot.linearInterpolate(e,a,c))];const g=Number(ot.linearInterpolate(e,o,r)),y=Number(ot.linearInterpolate(e,a,r));for(let E=0;E<e.length;E++)e[E]<c&&e[E]>r&&(d.push(e[E]),f.push(o[E]),p.push(a[E]));d.push(r),f.push(g),p.push(y);const v=d.map((E,C)=>C);v.sort((E,C)=>d[C]-d[E]),d=v.map(E=>d[E]),f=v.map(E=>f[E]),p=v.map(E=>p[E]);let M=0,b=0;for(let E=0;E<d.length-1;E++)M+=.5*(f[E]+f[E+1])*(d[E]-d[E+1]),b+=.5*(p[E]+p[E+1])*(d[E]-d[E+1]);const S=M/(d[0]-d[d.length-1]),k=b/(d[0]-d[d.length-1]);return l[2]=S,l[3]=k,l[1]=ot.windSpeed(S,k),l[0]=ot.windDirection(S,k),l}catch(l){return console.error("Error in calculateMeanWind:",l,{heights:e,xComponents:o,yComponents:a,lowerLimit:r,upperLimit:c}),ot.handleError("Failed to calculate mean wind: "+l.message),null}}static async getLocationData(e,o){const a=`${e.toFixed(4)},${o.toFixed(4)}`;if(ot.locationCache.has(a))return ot.locationCache.get(a);try{const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${o}&timezone=auto`);if(!r.ok)throw new Error(`Open-Meteo fetch failed: ${r.status}`);const c=await r.json(),l={timezone:c.timezone||"GMT",timezone_abbreviation:c.timezone_abbreviation||"GMT",elevation:c.elevation!==void 0?c.elevation:"N/A"};return ot.locationCache.set(a,l),console.log(`Fetched location data for ${a}:`,l),l}catch(r){return console.error("Error fetching location data:",r.message),{timezone:"UTC",elevation:"N/A"}}}static async formatLocalTime(e,o,a){const{timezone:r,timezone_abbreviation:c}=await ot.getLocationData(o,a);return J.fromISO(e,{zone:"UTC"}).setZone(r).toFormat("yyyy-MM-dd HHmm")+` ${c}`}static normalizeAngle(e){return(e%360+360)%360}static calculateWindAngle(e,o){let a=ot.normalizeAngle(o-e);return a>180&&(a-=360),a}static calculateWindComponents(e,o){const a=o*(Math.PI/180),r=e*Math.sin(a),c=e*Math.cos(a);return{crosswind:r,headwind:c}}static calculateWCA(e,o){const r=Math.abs(Math.asin(e/o))*(180/Math.PI);return isNaN(r)?0:r}static calculateGroundSpeed(e,o){return e-o}static calculateCourseFromHeading(e,o,a,r){const c=ot.calculateWindAngle(e,o),{crosswind:l,headwind:d}=ot.calculateWindComponents(a,c),f=r*Math.sin(e*Math.PI/180),p=r*Math.cos(e*Math.PI/180),g=(o+180)%360,y=a*Math.sin(g*Math.PI/180),v=a*Math.cos(g*Math.PI/180),M=f+y,b=p+v,S=Math.atan2(M,b)*(180/Math.PI),k=ot.normalizeAngle(S),E=Math.sqrt(M*M+b*b),C=ot.calculateWCA(l,r)*(l<0?-1:1);return{trueCourse:Number(k.toFixed(2)),groundSpeed:Number(E.toFixed(2)),wca:Number(C.toFixed(2)),crosswind:Number(l.toFixed(2)),headwind:Number(d.toFixed(2))}}static calculateFlightParameters(e,o,a,r){const c=ot.calculateWindAngle(e,o),{crosswind:l,headwind:d}=ot.calculateWindComponents(a,c),f=ot.calculateWCA(l,r),p=ot.calculateGroundSpeed(r,d);return{crosswind:Number(l.toFixed(2)),headwind:Number(d.toFixed(2)),wca:Number(f.toFixed(2)),groundSpeed:Number(p.toFixed(2))}}static handleError(e,o=!0){o&&console.error(e),typeof Nn=="function"?Nn(e):(console.warn("Utils.js: displayError function is not available, logging to console only."),console.error("Error message:",e))}static dmsToDecimal(e,o,a,r){if(isNaN(e)||isNaN(o)||isNaN(a)||!r)throw console.warn("Invalid DMS inputs:",{deg:e,min:o,sec:a,dir:r}),new Error("Invalid DMS values");let c=e+o/60+a/3600;if((r==="S"||r==="W")&&(c=-c),isNaN(c))throw console.warn("DMS to decimal conversion failed:",{deg:e,min:o,sec:a,dir:r}),new Error("Failed to convert DMS to decimal");return c}static decimalToDms(e,o){if(isNaN(e)||e===null||e===void 0)throw console.warn("Invalid decimal value for DMS conversion:",e),new Error("Invalid coordinate for DMS conversion");const a=Math.abs(e),r=Math.floor(a),c=Math.floor((a-r)*60),l=(a-r)*3600-c*60,d=o?e>=0?"N":"S":e>=0?"E":"W";if(isNaN(r)||isNaN(c)||isNaN(l))throw console.warn("DMS calculation resulted in invalid values:",{deg:r,min:c,sec:l}),new Error("Failed to convert to DMS");return{deg:r,min:c,sec:l,dir:d}}static decimalToMgrs(e,o){try{return Jl([o,e])}catch(a){return console.error("Error converting to MGRS:",a),"Invalid MGRS"}}static mgrsToDecimal(e){try{const[o,a]=Ja(e);return{lat:a,lng:o}}catch(o){return console.error("Error converting MGRS to decimal:",o),null}}static convertCoords(e,o,a="Decimal"){if(e===null||o===null||e===void 0||o===void 0)return{lat:"N/A",lng:"N/A"};const r={Decimal:{lat:e.toFixed(6),lng:o.toFixed(6)},DMS:{lat:ot.decimalToDms(e,!0),lng:ot.decimalToDms(o,!1)},MGRS:ot.decimalToMgrs(e,o)};switch(a){case"DMS":return r.DMS;case"MGRS":return{lat:r.MGRS,lng:r.MGRS};case"Decimal":default:return r.Decimal}}static calculateTAS(e,o){if(isNaN(e)||isNaN(o)||e<0||o<0)return console.warn("Invalid inputs for calculateTAS:",{ias:e,heightFt:o}),"N/A";const a=an.LAPSE_RATE,r=an.SEA_LEVEL_TEMP_KELVIN,c=an.GRAVITY,l=an.GAS_CONSTANT_AIR,d=zt.FEET_TO_METERS,f=o*d,p=r-a*f,g=p/r,y=1-a*f/r,v=c/(a*l)-1,M=Math.pow(y,v),b=e/Math.sqrt(M);return console.log("calculateTAS debug:",{ias:e,heightFt:o,heightM:f,tempAtAltitude:p,tempRatio:g,base:y,exponent:v,densityRatio:M,tas:b,tasRounded:Number(b.toFixed(2))}),Number(b.toFixed(2))}static calculateTASFromGroundSpeed(e,o,a,r,c){if(isNaN(e)||isNaN(o)||isNaN(a)||isNaN(r))return"N/A";const l=ot.convertWind(e,"kt","m/s"),d=ot.convertWind(o,"kt","m/s"),f=ot.calculateWindAngle(r,a),{crosswind:p,headwind:g}=ot.calculateWindComponents(d,f),y=l+g,v=ot.calculateTAS(y,c);return Number(v.toFixed(1))}static handleMessage(e){const o=document.getElementById("info");o?(o.textContent=e,o.style.display="block",setTimeout(()=>{o.style.display="none"},3e3),console.log("Displayed message:",e)):(console.warn("Info div not found for handleMessage, using alert"),alert(e))}static calculateQFE(e,o,a,r=15){if(!e||o==="N/A"||a==="N/A"||isNaN(e)||isNaN(o)||isNaN(a))return"N/A";console.log("QFE reference elevation: ",a);const c=an.GRAVITY,l=Ks.MOLAR_MASS_AIR,d=Ks.UNIVERSAL_GAS_CONSTANT,f=r+zt.CELSIUS_TO_KELVIN,p=an.LAPSE_RATE,g=e*100,y=o-a,v=c*l/(d*p),M=g*Math.pow(1-p*y/f,v);console.log(e,o,a);const b=Math.round(M/100);return isNaN(b)?"N/A":b}static calculateNewCenter(e,o,a,r){const c=vu,l=e*Math.PI/180,d=o*Math.PI/180,f=r*Math.PI/180,p=a/c,g=Math.asin(Math.sin(l)*Math.cos(p)+Math.cos(l)*Math.sin(p)*Math.cos(f)),y=d+Math.atan2(Math.sin(f)*Math.sin(p)*Math.cos(l),Math.cos(p)-Math.sin(l)*Math.sin(g)),v=g*180/Math.PI,b=(y*180/Math.PI+540)%360-180;return[v,b]}static debounce(e,o){let a;return function(...r){clearTimeout(a),a=setTimeout(()=>e.apply(this,r),o)}}static calculateBearing(e,o,a,r){const c=y=>y*Math.PI/180,l=y=>y*180/Math.PI,d=c(r-o),f=Math.sin(d)*Math.cos(c(a)),p=Math.cos(c(e))*Math.sin(c(a))-Math.sin(c(e))*Math.cos(c(a))*Math.cos(d);let g=l(Math.atan2(f,p));return g=(g+360)%360,g}static async getAltitude(e,o){const{elevation:a}=await ot.getLocationData(e,o);return console.log("Fetched elevation from Open-Meteo:",a),a!=="N/A"?a:"N/A"}static getLastFullHourUTC(){const e=new Date,o=e.getUTCFullYear(),a=e.getUTCMonth(),r=e.getUTCDate(),c=e.getUTCHours(),l=new Date(Date.UTC(o,a,r,c,0,0));return console.log("Last full hour UTC:",l.toISOString()),l}static async getDisplayTime(e,o,a){var c;return(((c=document.querySelector('input[name="timeZone"]:checked'))==null?void 0:c.value)||"Z")==="Z"||!o||!a?ot.formatTime(e):await ot.formatLocalTime(e,o,a)}static calculateDynamicRadius(e=re.HEATMAP_SCALING_BASE,o=re.HEATMAP_REFERENCE_ZOOM){const a=u.map.getZoom(),r=re.HEATMAP_SCALING_BASE,c=Math.pow(r,a-o),l=e*c,d=re.HEATMAP_MIN_RADIUS_PX,f=re.HEATMAP_MAX_RADIUS_PX,p=Math.max(d,Math.min(f,l));return console.log("[calculateDynamicRadius] Calculated dynamic radius:",{currentZoom:a,baseRadius:e,scaleFactor:c,dynamicRadius:l,adjustedRadius:p}),p}static interpolateColor(e,o=0,a=3e3){const r=Math.min(Math.max((e-o)/(a-o),0),1);return e<0||isNaN(e)?"#808080":r<=.5?`rgb(255, ${Math.round(255*(r*2))}, 0)`:`rgb(${Math.round(255*(1-(r-.5)*2))}, 255, 0)`}static generateWindBarb(e,o,a=null){const r=Math.round(o),c=40,l=40,d=c/2,f=l/2,p=20,y=(typeof a=="number"&&!isNaN(a)?a>=0:!0)?-1:1;let v=Math.floor(r/50),M=r%50,b=Math.floor(M/10),S=Math.floor(M%10/5);r<5?(b=0,S=0):r<10&&S>0&&(S=1);let k=`<svg width="${c}" height="${l}" viewBox="0 0 ${c} ${l}">`;const E=e+180;k+=`<g transform="translate(${d}, ${f}) rotate(${E})">`,k+=`<line x1="0" y1="${p/2}" x2="0" y2="${-p/2}" stroke="black" stroke-width="1"/>`;let C=p/2;const I=4;for(let x=0;x<v;x++)k+=`<polygon points="0,${C-5} 0,${C+5} ${10*y},${C}" fill="black"/>`,C-=I+5;for(let x=0;x<b;x++)k+=`<line x1="0" y1="${C}" x2="${10*y}" y2="${C}" stroke="black" stroke-width="1"/>`,C-=I;return S>0&&(k+=`<line x1="0" y1="${C}" x2="${5*y}" y2="${C}" stroke="black" stroke-width="1"/>`),r<5&&(k+='<circle cx="0" cy="0" r="3" fill="none" stroke="black" stroke-width="1"/>'),k+="</g></svg>",k}},js(ot,"locationCache",new Map),ot);window.Utils=T;const Ut={dbName:"SkydivingTileCache",storeName:"tiles",db:null,async init(){return new Promise((n,e)=>{const o=indexedDB.open(this.dbName,1);o.onupgradeneeded=a=>{a.target.result.createObjectStore(this.storeName,{keyPath:"url"})},o.onsuccess=a=>{this.db=a.target.result,n()},o.onerror=a=>{console.error("IndexedDB initialization failed:",a),e(a)}})},async storeTile(n,e){return this.db||await this.init(),new Promise((o,a)=>{const l=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({url:n,blob:e,timestamp:Date.now()});l.onsuccess=()=>{console.log(`Stored tile: ${n}`),o(!0)},l.onerror=d=>{console.warn(`Failed to store tile: ${n}`,d),T.handleError("Failed to store some tiles. Try clearing cache."),a(d)}})},async getTile(n){return this.db||await this.init(),new Promise((e,o)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),c=r.get(n);c.onsuccess=l=>{const d=l.target.result;if(d)e(d.blob);else{const f=[n.replace("https://tile.opentopomap.org","https://a.tile.opentopomap.org"),n.replace("https://tile.opentopomap.org","https://b.tile.opentopomap.org"),n.replace("https://tile.opentopomap.org","https://c.tile.opentopomap.org"),n.replace("https://tile.openstreetmap.org","https://a.tile.openstreetmap.org"),n.replace("https://tile.openstreetmap.org","https://b.tile.openstreetmap.org"),n.replace("https://tile.openstreetmap.org","https://c.tile.openstreetmap.org"),n.replace("https://basemaps.cartocdn.com","https://a.basemaps.cartocdn.com"),n.replace("https://basemaps.cartocdn.com","https://b.basemaps.cartocdn.com"),n.replace("https://basemaps.cartocdn.com","https://c.basemaps.cartocdn.com"),n.replace("https://basemaps.cartocdn.com","https://d.basemaps.cartocdn.com")];let p=null;for(const g of f){if(g===n)continue;const y=r.get(g);y.onsuccess=v=>{const M=v.target.result;M&&(p=M.blob,e(p))},y.onerror=()=>{}}setTimeout(()=>{p||e(null)},100)}},c.onerror=l=>{console.warn(`Failed to retrieve tile: ${n}`,l),o(l)}})},async clearCache(){return this.db||await this.init(),new Promise((n,e)=>{const r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();r.onsuccess=()=>{console.log("Tile cache cleared"),n()},r.onerror=c=>{console.error("Failed to clear cache:",c),e(c)}})},async clearOldTiles(n=mi.MAX_AGE_DAYS){this.db||await this.init();const e=n*24*60*60*1e3;return new Promise((o,a)=>{const l=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).openCursor();let d=0,f=0;l.onsuccess=p=>{const g=p.target.result;if(g)Date.now()-g.value.timestamp>e&&(f+=g.value.blob.size||0,g.delete(),d++),g.continue();else{const y=f/1048576;console.log(`Cleared ${d} old tiles, freed ${y.toFixed(2)} MB`),o({deletedCount:d,deletedSizeMB:y})}},l.onerror=p=>{console.error("Failed to clear old tiles:",p),a(p)}})},async getCacheSize(){return this.db||await this.init(),new Promise((n,e)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).openCursor();let c=0,l=0;r.onsuccess=d=>{var p;const f=d.target.result;if(f)try{const g=((p=f.value.blob)==null?void 0:p.size)||0;typeof g!="number"||isNaN(g)?console.warn(`Invalid blob size for tile: ${f.value.url}, size: ${g}`):(c+=g,l++),f.continue()}catch(g){console.warn(`Error processing tile during size calculation: ${f.value.url}`,g),f.continue()}else{const g=c/1048576;console.log(`Cache size calculation completed: ${g.toFixed(2)} MB, ${l} tiles`),n(g)}},r.onerror=d=>{console.error("Failed to calculate cache size:",d),e(d)}})},async migrateTiles(){return this.db||await this.init(),new Promise((n,e)=>{const a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),r=a.openCursor();let c=0;r.onsuccess=l=>{const d=l.target.result;if(d){const{url:f,blob:p,timestamp:g}=d.value,y=f.replace(/^(https?:\/\/[a-c]\.tile\.openstreetmap\.org)/,"https://tile.openstreetmap.org").replace(/^(https?:\/\/[a-d]\.basemaps\.cartocdn\.com)/,"https://basemaps.cartocdn.com").replace(/^(https?:\/\/[a-c]\.tile\.opentopomap\.org)/,"https://tile.opentopomap.org");f!==y&&(d.delete(),a.put({url:y,blob:p,timestamp:g}),c++),d.continue()}else console.log(`Migrated ${c} tiles to normalized URLs`),n()},r.onerror=l=>{console.error("Failed to migrate tiles:",l),e(l)}})}};(void 0).Cached=(void 0).extend({createTile(n,e){const o=document.createElement("img");(void 0).on(o,"load",()=>{console.log("Tile loaded:",this.getTileUrl(n)),e(null,o)}),(void 0).on(o,"error",()=>{console.warn("Tile error:",this.getTileUrl(n)),e(new Error("Failed to load tile"),o)});const a=this.getTileUrl(n);o.setAttribute("role","presentation");const r=a.replace(/^(https?:\/\/[a-c]\.tile\.openstreetmap\.org)/,"https://tile.openstreetmap.org").replace(/^(https?:\/\/[a-d]\.basemaps\.cartocdn\.com)/,"https://basemaps.cartocdn.com").replace(/^(https?:\/\/[a-c]\.tile\.opentopomap\.org)/,"https://tile.opentopomap.org");return!navigator.onLine&&(n.z<11||n.z>14)?(console.log(`Skipping tile request outside cached zoom levels (11–14): ${a}`),T.handleError("Offline: Zoom restricted to levels 11–14 for cached tiles."),e(new Error("Zoom level not cached"),o),o):(navigator.onLine?(o.src=a,fetch(a,{signal:AbortSignal.timeout(mi.FETCH_TIMEOUT_MS)}).then(c=>{if(!c.ok)throw new Error(`HTTP ${c.status}`);return c.blob()}).then(c=>{Ut.storeTile(r,c).catch(l=>console.warn("Failed to cache tile during rendering:",r,l))}).catch(c=>{console.warn("Fetch error for tile during rendering:",a,c),Ut.getTile(r).then(l=>{l?(o.src=URL.createObjectURL(l),console.log(`Tile loaded from cache (fallback): ${r}`)):e(c,o)}).catch(l=>{console.warn("Cache fallback error:",r,l),e(l,o)})})):Ut.getTile(r).then(c=>{c?(o.src=URL.createObjectURL(c),console.log(`Tile loaded from cache: ${r}`)):(console.warn(`Tile not in cache: ${r}`),T.handleError("This area is not cached. Please cache more tiles while online."),e(new Error("Tile not in cache"),o))}).catch(c=>{console.warn("Cache error for offline tile:",r,c),T.handleError("This area is not cached. Please cache more tiles while online."),e(c,o)}),o)}});(void 0).cached=function(n,e){return new(void 0).Cached(n,e)};function Fd(n,e,o,a,r){if(!r)return console.warn("Map not initialized, cannot calculate tiles"),[];const c=new Set,l=40075016686e-3,d=o*1e3;return a.forEach(f=>{const p=r.project([n,e],f),g=256,y=p.x/g,v=p.y/g,M=n*Math.PI/180,b=l*Math.cos(M)/(g*Math.pow(2,f)),S=Math.ceil(d/(b*g))+1,k=Math.pow(2,f);for(let E=Math.floor(y-S);E<=Math.ceil(y+S);E++)for(let C=Math.floor(v-S);C<=Math.ceil(v+S);C++)E>=0&&E<k&&C>=0&&C<k&&c.add(`${f}/${E}/${C}`)}),Array.from(c).map(f=>{const[p,g,y]=f.split("/").map(Number);return{zoom:p,x:g,y}})}async function Yl(n,e=3){let o=null;for(let a=1;a<=e;a++){try{const r=new AbortController,c=setTimeout(()=>r.abort(),mi.FETCH_TIMEOUT_MS),l=await fetch(n,{signal:r.signal});if(clearTimeout(c),l.ok)return{success:!0,blob:await l.blob()};console.warn(`Attempt ${a} failed for ${n}: HTTP ${l.status}`),o=new Error(`HTTP ${l.status}`)}catch(r){console.warn(`Attempt ${a} error for ${n}: ${r.message}`),o=r,r.name==="AbortError"&&console.warn(`Fetch timeout after 15s for ${n}`)}a<e&&await new Promise(r=>setTimeout(r,1e3))}return{success:!1,error:o}}async function Rd({map:n,lastLat:e,lastLng:o,baseMaps:a}){if(!n){console.warn("Map not initialized, cannot cache tiles"),se("Map not initialized, cannot cache tiles.");return}if(console.log("cacheTilesForDIP called with:",{lastLat:e,lastLng:o,cacheRadiusKm:_.state.userSettings.cacheRadiusKm,cacheZoomLevels:_.state.userSettings.cacheZoomLevels}),!e||!o){console.warn("No DIP coordinates for caching, skipping"),se("Please select a location to cache map tiles.");return}if(!_.state.userSettings.baseMaps||!a[_.state.userSettings.baseMaps]){console.warn(`Base map ${_.state.userSettings.baseMaps} not found, skipping caching`),se("Selected base map not available for caching.");return}const r=_.state.userSettings.cacheRadiusKm||_.defaultSettings.cacheRadiusKm,c=_.state.userSettings.cacheZoomLevels||_.defaultSettings.cacheZoomLevels,l=Fd(e,o,r,c,n);console.log(`Caching ${l.length} tiles for DIP:`,{lat:e,lng:o,radiusKm:r,zoomLevels:c,baseMap:_.state.userSettings.baseMaps});const d=[];if(_.state.userSettings.baseMaps==="Esri Satellite + OSM")d.push({name:"Esri Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",normalizedUrl:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{name:"OSM Overlay",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],normalizedUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"});else{const v=a[_.state.userSettings.baseMaps];d.push({name:_.state.userSettings.baseMaps,url:v.options.url||v._url,subdomains:v.options.subdomains,normalizedUrl:(v.options.url||v._url).replace(/{s}\./,"")})}let f=0,p=0;const g=l.length*d.length,y=[];u.isCachingCancelled=!1,console.log("Calling displayProgress with initial values:",{cachedCount:f,failedCount:p,totalTiles:g}),_o(f+p,g,()=>{u.isCachingCancelled=!0});try{for(const v of d){if(console.log("Processing layer:",v.name),u.isCachingCancelled){console.log("Caching cancelled by user");break}const M=l.map(async(b,S)=>{if(u.isCachingCancelled){console.log("Caching cancelled during tile processing");return}const k=v.url.replace("{z}",b.zoom).replace("{x}",b.x).replace("{y}",b.y).replace("{s}",v.subdomains?v.subdomains[Math.floor(Math.random()*v.subdomains.length)]:""),E=v.normalizedUrl.replace("{z}",b.zoom).replace("{x}",b.x).replace("{y}",b.y);if(console.log(`Processing tile ${S+1}/${l.length} for layer ${v.name}:`,{url:k,normalizedUrl:E}),await Ut.getTile(E).catch(x=>(console.error(`Error retrieving tile from cache: ${E}`,x),null)))f++,console.log(`Tile ${S+1} already in cache`);else{const x=await Yl(k);x.success?await Ut.storeTile(E,x.blob).catch(R=>(console.error(`Error storing tile: ${E}`,R),!1))?(f++,console.log(`Tile ${S+1} cached successfully`)):(p++,y.push(k),console.log(`Tile ${S+1} failed to store`)):(p++,y.push(k),console.log(`Tile ${S+1} failed to fetch:`,x.error.message))}const I=f+p;((S+1)%10===0||S===l.length-1)&&(console.log("Updating progress:",{currentCount:I,totalTiles:g}),_o(I,g,()=>{u.isCachingCancelled=!0}))});console.log(`Processing batch of ${l.length} tiles for layer ${v.name}`);for(let b=0;b<M.length;b+=20){if(u.isCachingCancelled){console.log("Caching cancelled during batch processing");break}const S=M.slice(b,b+20);await Promise.all(S).catch(k=>{console.error("Error processing batch of tiles:",k)}),console.log(`Completed batch ${b/20+1} for layer ${v.name}`)}}}catch(v){console.error("Unexpected error in cacheTilesForDIP:",v),T.handleError("Failed to cache map tiles: "+v.message)}finally{console.log("Hiding progress bar"),Vl()}y.length>0&&console.warn(`Failed to cache ${y.length} tiles:`,y),console.log(`DIP caching complete: ${f} tiles cached, ${p} failed`),u.isCachingCancelled?se(`Caching cancelled: ${f} tiles cached, ${p} failed.`):p>0?se(`Cached ${f} tiles around DIP (${p} failed). Pan or zoom to cache more tiles.`):se(`Cached ${f} tiles around DIP successfully.`);try{const v=await Ut.getCacheSize();console.log(`Cache size after DIP caching: ${v.toFixed(2)} MB`),v>mi.SIZE_LIMIT_MB_WARNING&&T.handleError(`Cache size large (${v.toFixed(2)} MB). Consider clearing cache to free up space.`)}catch(v){console.error("Failed to check cache size after DIP caching:",v),T.handleError("Unable to check cache size. Consider clearing cache to free up space.")}}T.debounce(async({map:n,baseMaps:e})=>{if(!n||!navigator.onLine){console.log("Skipping visible tile caching: offline or map not initialized");return}const o=n.getBounds(),a=n.getZoom(),r=_.state.userSettings.cacheZoomLevels||_.defaultSettings.cacheZoomLevels;if(!r.includes(a)){console.log(`Skipping caching: zoom ${a} not in cacheZoomLevels`,r);return}const c=256,l=n.project(o.getSouthWest(),a),d=n.project(o.getNorthEast(),a),f=Math.floor(l.x/c),p=Math.floor(d.x/c),g=Math.floor(d.y/c),y=Math.floor(l.y/c),v=[];for(let C=f;C<=p;C++)for(let I=g;I<=y;I++){const x=2**a;C>=0&&C<x&&I>=0&&I<x&&v.push({zoom:a,x:C,y:I})}console.log(`Caching ${v.length} visible tiles at zoom ${a} for ${_.state.userSettings.baseMaps}`);const M=[];if(!e[_.state.userSettings.baseMaps]){console.warn(`Base map ${_.state.userSettings.baseMaps} not found, skipping caching`),se("Selected base map not available for caching.");return}if(_.state.userSettings.baseMaps==="Esri Satellite + OSM")M.push({name:"Esri Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",normalizedUrl:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{name:"OSM Overlay",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],normalizedUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"});else{const C=e[_.state.userSettings.baseMaps];M.push({name:_.state.userSettings.baseMaps,url:C.options.url||C._url,subdomains:C.options.subdomains,normalizedUrl:(C.options.url||C._url).replace(/{s}\./,"")})}let b=0,S=0;const k=v.length*M.length,E=[];u.isCachingCancelled=!1,_o(b+S,k,()=>{u.isCachingCancelled=!0});for(const C of M){if(u.isCachingCancelled){console.log("Visible tile caching cancelled by user");break}const I=v.map(async(x,N)=>{if(u.isCachingCancelled)return;const R=C.url.replace("{z}",x.zoom).replace("{x}",x.x).replace("{y}",x.y).replace("{s}",C.subdomains?C.subdomains[Math.floor(Math.random()*C.subdomains.length)]:""),F=C.normalizedUrl.replace("{z}",x.zoom).replace("{x}",x.x).replace("{y}",x.y);if(await Ut.getTile(F).catch(()=>null))b++;else{const K=await Yl(R);K.success&&await Ut.storeTile(F,K.blob).catch(()=>!1)?b++:(S++,E.push(R))}const G=b+S;((N+1)%10===0||N===v.length-1)&&_o(G,k,()=>{u.isCachingCancelled=!0})});for(let x=0;x<I.length&&!u.isCachingCancelled;x+=20){const N=I.slice(x,x+20);await Promise.all(N)}}Vl(),E.length>0&&console.warn(`Failed to cache ${E.length} visible tiles:`,E),u.isCachingCancelled?se(`Visible tile caching cancelled: ${b} tiles cached.`):se("Visible map tiles cached.");try{const C=await Ut.getCacheSize();console.log(`Cache size after visible tiles caching: ${C.toFixed(2)} MB`),C>mi.SIZE_LIMIT_MB_WARNING&&T.handleError(`Cache size large (${C.toFixed(2)} MB). Consider clearing cache to free up space.`)}catch(C){console.error("Failed to check cache size after visible tiles caching:",C),T.handleError("Unable to check cache size. Consider clearing cache to free up space.")}},1e3);var ma={exports:{}},xr;function zd(){return xr||(xr=1,function(n){(function(e){n.exports=e(Wl())})(function(e){var o="polyline-measure-control",a="polyline-measure-unicode-icon",r=navigator.platform==="MacIntel";return e.Control.PolylineMeasure=e.Control.extend({options:{position:"topleft",unit:"kilometres",useSubunits:!0,clearMeasurementsOnStop:!0,showBearings:!1,bearingTextIn:"In",bearingTextOut:"Out",tooltipTextFinish:"Click to <b>finish line</b><br>",tooltipTextDelete:"Press SHIFT-key and click to <b>delete point</b>",tooltipTextMove:"Click and drag to <b>move point</b><br>",tooltipTextResume:"<br>Press "+(r?"⌘":"CTRL-key")+" and click to <b>resume line</b>",tooltipTextAdd:"Press "+(r?"⌘":"CTRL-key")+" and click to <b>add point</b>",measureControlTitleOn:"Turn on PolylineMeasure",measureControlTitleOff:"Turn off PolylineMeasure",measureControlLabel:"&#8614;",measureControlClasses:[],showClearControl:!1,clearControlTitle:"Clear Measurements",clearControlLabel:"&times;",clearControlClasses:[],showUnitControl:!1,unitControlUnits:["kilometres","landmiles","nauticalmiles"],unitControlTitle:{text:"Change Units",kilometres:"kilometres",landmiles:"land miles",nauticalmiles:"nautical miles"},unitControlLabel:{metres:"m",kilometres:"km",feet:"ft",landmiles:"mi",nauticalmiles:"nm"},unitControlClasses:[],tempLine:{color:"#00f",weight:2},fixedLine:{color:"#006",weight:2},arrow:{color:"#000"},startCircle:{color:"#000",weight:1,fillColor:"#0f0",fillOpacity:1,radius:3},intermedCircle:{color:"#000",weight:1,fillColor:"#ff0",fillOpacity:1,radius:3},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:6},endCircle:{color:"#000",weight:1,fillColor:"#f00",fillOpacity:1,radius:3}},_arcpoints:99,_circleNr:-1,_lineNr:-1,_createControl:function(c,l,d,f,p,g){var y=document.createElement("a");return y.innerHTML=c,y.setAttribute("title",l),d.forEach(function(v){y.classList.add(v)}),e.DomEvent.on(y,"click",p,g),f.appendChild(y),y},onAdd:function(c){var l=this;c.on("movestart ",function(){l._mapdragging=!0}),this._container=document.createElement("div"),this._container.classList.add("leaflet-bar"),e.DomEvent.disableClickPropagation(this._container);var d=this.options.measureControlTitleOn,f=this.options.measureControlLabel,p=this.options.measureControlClasses;if(f.indexOf("&")!=-1&&p.push(a),this._arrPolylines=[],this._measureControl=this._createControl(f,d,p,this._container,this._toggleMeasure,this),this._defaultControlBgColor=this._measureControl.style.backgroundColor,this._measureControl.setAttribute("id",o),this.options.showClearControl){var d=this.options.clearControlTitle,f=this.options.clearControlLabel,p=this.options.clearControlClasses;f.indexOf("&")!=-1&&p.push(a),this._clearMeasureControl=this._createControl(f,d,p,this._container,this._clearAllMeasurements,this),this._clearMeasureControl.classList.add("polyline-measure-clearControl")}if(this.options.showUnitControl&&this.options.unitControlUnits.length>1){var f=this.options.unitControlLabel[this.options.unit],d=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle[this.options.unit]+"]",p=this.options.unitControlClasses;this._unitControl=this._createControl(f,d,p,this._container,this._changeUnit,this),this._unitControl.setAttribute("id","unitControlId")}return this._container},onRemove:function(){this._measuring&&this._toggleMeasure()},_saveNonpolylineEvents:function(){this._nonpolylineTargets=this._map._targets,typeof this._polylineTargets<"u"?this._map._targets=this._polylineTargets:this._map._targets={}},_savePolylineEvents:function(){this._polylineTargets=this._map._targets,this._map._targets=this._nonpolylineTargets},_toggleMeasure:function(){this._measuring=!this._measuring,this._measuring?(this._mapdragging=!1,this._saveNonpolylineEvents(),this._measureControl.classList.add("polyline-measure-controlOnBgColor"),this._measureControl.style.backgroundColor=this.options.backgroundColor,this._measureControl.title=this.options.measureControlTitleOff,this._oldCursor=this._map._container.style.cursor,this._map._container.style.cursor="crosshair",this._doubleClickZoom=this._map.doubleClickZoom.enabled(),this._map.doubleClickZoom.disable(),this._layerPaint||(this._layerPaint=e.layerGroup().addTo(this._map)),this._map.on("mousemove",this._mouseMove,this),this._map.on("click",this._mouseClick,this),e.DomEvent.on(document,"keydown",this._onKeyDown,this),this._resetPathVariables()):(this._savePolylineEvents(),this._measureControl.classList.remove("polyline-measure-controlOnBgColor"),this._measureControl.style.backgroundColor=this._defaultControlBgColor,this._measureControl.title=this.options.measureControlTitleOn,this._map._container.style.cursor=this._oldCursor,this._map.off("mousemove",this._mouseMove,this),this._map.off("click",this._mouseClick,this),this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._map.off("mousemove",this._dragCircleMousemove,this),this._map.off("mouseup",this._dragCircleMouseup,this),e.DomEvent.off(document,"keydown",this._onKeyDown,this),this._doubleClickZoom&&this._map.doubleClickZoom.enable(),this.options.clearMeasurementsOnStop&&this._layerPaint&&this._clearAllMeasurements(),this._cntCircle!==0&&this._finishPolylinePath()),this._map.fire("polylinemeasure:toggle",{status:this._measuring})},_clearAllMeasurements:function(){this._cntCircle!==void 0&&this._cntCircle!==0&&this._finishPolylinePath(),this._layerPaint&&this._layerPaint.clearLayers(),this._arrPolylines=[],this._map.fire("polylinemeasure:clear")},_changeUnit:function(){let l=(this.options.unitControlUnits.indexOf(this.options.unit)+1)%this.options.unitControlUnits.length;this.options.unit=this.options.unitControlUnits[l],this._unitControl.innerHTML=this.options.unitControlLabel[this.options.unit],this._unitControl.title=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle[this.options.unit]+"]",this._currentLine&&this._computeDistance(this._currentLine),this._arrPolylines.map(this._computeDistance.bind(this))},_computeDistance:function(c){var l=0;c.circleCoords.map((function(d,f){if(f>=1){var p=c.circleCoords[f-1].distanceTo(c.circleCoords[f]);l+=p,this._updateTooltip(c.tooltips[f],c.tooltips[f-1],l,p,c.circleCoords[f-1],c.circleCoords[f])}}).bind(this))},_onKeyDown:function(c){if(c.keyCode===27){if(this._resumeFirstpointFlag===!0){this._resumeFirstpointFlag=!1;var l=this._lineNr;this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._layerPaint.removeLayer(this._rubberlinePath2),this._layerPaint.removeLayer(this._tooltipNew),this._arrPolylines[l].circleMarkers[0].setStyle(this.options.startCircle);var d="",f=0;this.options.showBearings===!0&&(d=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),d=d+'<div class="polyline-measure-tooltip-difference">+0</div>',d=d+'<div class="polyline-measure-tooltip-total">0</div>',this._arrPolylines[l].tooltips[0]._icon.innerHTML=d,this._arrPolylines[l].tooltips.map((function(p,g){if(g>=1){var y=this._arrPolylines[l].circleCoords[g-1].distanceTo(this._arrPolylines[l].circleCoords[g]),v=this._arrPolylines[l].circleCoords[g-1],M=this._arrPolylines[l].circleCoords[g];f+=y;var b=this._arrPolylines[l].tooltips[g-1];this._updateTooltip(p,b,f,y,v,M)}}).bind(this)),this._map.on("mousemove",this._mouseMove,this);return}this._currentLine?this._finishPolylinePath(c):this._toggleMeasure()}},_getDistance:function(c){var l=c,d;return this.options.unit==="nauticalmiles"?(d=this.options.unitControlLabel.nauticalmiles,l>=185200?l=(l/1852).toFixed(0):l>=18520?l=(l/1852).toFixed(1):l>=1852?l=(l/1852).toFixed(2):l=(l/1852).toFixed(3)):this.options.unit==="landmiles"?(d=this.options.unitControlLabel.landmiles,l>=160934.4?l=(l/1609.344).toFixed(0):l>=16093.44?l=(l/1609.344).toFixed(1):l>=1609.344?l=(l/1609.344).toFixed(2):this.options.useSubunits?(l=(l/.3048).toFixed(0),d=this.options.unitControlLabel.feet):l=(l/1609.344).toFixed(4)):(d=this.options.unitControlLabel.kilometres,l>=1e5?l=(l/1e3).toFixed(0):l>=1e4?l=(l/1e3).toFixed(1):l>=1e3?l=(l/1e3).toFixed(2):this.options.useSubunits?(l=l.toFixed(1),d=this.options.unitControlLabel.metres):l=(l/1e3).toFixed(4)),{value:l,unit:d}},_polylineArc:function(c,l){function d(S){var k=Math.sin((1-S)*M)/Math.sin(M),E=Math.sin(S*M)/Math.sin(M),C=k*Math.cos(p)*Math.cos(g)+E*Math.cos(y)*Math.cos(v),I=k*Math.cos(p)*Math.sin(g)+E*Math.cos(y)*Math.sin(v),x=k*Math.sin(p)+E*Math.sin(y),N=180/Math.PI*Math.atan2(x,Math.sqrt(Math.pow(C,2)+Math.pow(I,2))),R=180/Math.PI*Math.atan2(I,C),F=R-g*180/Math.PI;function $(G){return Math[G>0?"floor":"ceil"](G)}return F<0?R=R-$((F-180)/360)*360:R=R-$((F+180)/360)*360,[N,R]}function f(S){for(var k=[],E=1/(S-1),C=0;C<S;C++){var I=E*C,x=d(I);k.push(x)}return k}var p=c.lat,g=c.lng,y=l.lat,v=l.lng;p=p*Math.PI/180,g=g*Math.PI/180,y=y*Math.PI/180,v=v*Math.PI/180;var M=2*Math.asin(Math.sqrt(Math.pow(Math.sin((p-y)/2),2)+Math.cos(p)*Math.cos(y)*Math.pow(Math.sin((g-v)/2),2))),b;return M===0?b=[[p,g]]:b=f(this._arcpoints),b},_updateTooltip:function(c,l,d,f,p,g){var y=function(x,N,R){var F=x.lat/180*Math.PI,$=N.lat/180*Math.PI,G=x.lng/180*Math.PI,K=N.lng/180*Math.PI,z=Math.sin(K-G)*Math.cos($),B=Math.cos(F)*Math.sin($)-Math.sin(F)*Math.cos($)*Math.cos(K-G);if(R==="inbound")var Y=(Math.atan2(z,B)*180/Math.PI+180).toFixed(0);else var Y=(Math.atan2(z,B)*180/Math.PI+360).toFixed(0);return Y%360},v=y(g,p,"inbound"),M=y(p,g,"outbound"),b=this._getDistance(d),S=this._getDistance(f),k="";if(S.value>0&&(this.options.showBearings===!0&&(k=this.options.bearingTextIn+": "+v+"°<br>"+this.options.bearingTextOut+":---°"),k+='<div class="polyline-measure-tooltip-difference">+'+S.value+"&nbsp;"+S.unit+"</div>"),k+='<div class="polyline-measure-tooltip-total">'+b.value+"&nbsp;"+b.unit+"</div>",c._icon.innerHTML=k,this.options.showBearings===!0&&l){var E=l._icon.innerHTML,C=new RegExp(this.options.bearingTextOut+".*°"),I=E.replace(C,this.options.bearingTextOut+": "+M+"°");l._icon.innerHTML=I}},_drawArrow:function(c){var l=Math.trunc(c.length/2);if(c.length%2==0)var d=c[l-1],f=c[l],p=f[1]-d[1],g=f[0]-d[0],y=[d[0]+g/2,d[1]+p/2];else var d=c[l-1],f=c[l+1],p=f[1]-d[1],g=f[0]-d[0],y=c[l];var v=-Math.atan2(g,p)*57.29578,M=e.divIcon({className:"",iconSize:[16,16],iconAnchor:[8,8],html:"<div style = 'color:"+this.options.arrow.color+"; font-size: 16px; line-height: 16px; vertical-align:top; transform: rotate("+v+"deg)'>&#x27a4;</div>"}),b=e.marker(y,{icon:M,zIndexOffset:-50}).addTo(this._layerPaint);return this._currentLine||b.bindTooltip(this.options.tooltipTextAdd,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),b.on("click",this._clickedArrow,this),b},_mouseMove:function(c){var l=c.latlng;if(this._map.on("click",this._mouseClick,this),!(!l||!this._currentLine)){var d=this._currentLine.circleCoords.last();this._rubberlinePath.setLatLngs(this._polylineArc(d,l));var f=this._currentLine.tooltips.last(),p=this._currentLine.tooltips.slice(-2,-1)[0];f.setLatLng(l);var g=l.distanceTo(d);this._updateTooltip(f,p,this._currentLine.distance+g,g,d,l)}},_startLine:function(c){var l=e.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),d=function(){return this.slice(-1)[0]};this._rubberlinePath=e.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack();var f=this;this._currentLine={id:0,circleCoords:[],circleMarkers:[],arrowMarkers:[],tooltips:[],distance:0,polylinePath:e.polyline([],{color:this.options.fixedLine.color,weight:this.options.fixedLine.weight,interactive:!1}).addTo(this._layerPaint).bringToBack(),handleMarkers:function(y){var v=this.circleMarkers.last();v&&(v.bindTooltip(f.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),v.off("click",f._finishPolylinePath,f),this.circleMarkers.length===1?v.setStyle(f.options.startCircle):v.setStyle(f.options.intermedCircle));var M=new e.CircleMarker(y,f.options.currentCircle).addTo(f._layerPaint);M.bindTooltip(f.options.tooltipTextFinish+f.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),M.cntLine=f._currentLine.id,M.cntCircle=f._cntCircle,f._cntCircle++,M.on("mousedown",f._dragCircle,f),M.on("click",f._finishPolylinePath,f),this.circleMarkers.push(M)},getNewToolTip:function(y){return e.marker(y,{icon:l,interactive:!1})},addPoint:function(y){var v=this.circleCoords.last();if(!(v&&v.equals(y))){if(this.circleCoords.push(y),this.circleCoords.length>1){var M=f._polylineArc(v,y),b=f._drawArrow(M);this.circleCoords.length>2&&M.shift(),this.polylinePath.setLatLngs(this.polylinePath.getLatLngs().concat(M)),b.cntLine=f._currentLine.id,b.cntArrow=f._cntCircle-1,f._currentLine.arrowMarkers.push(b);var S=v.distanceTo(y);this.distance+=S;var k=f._currentLine.tooltips.last(),E=f._currentLine.tooltips.slice(-1,-2)[0];f._updateTooltip(k,E,this.distance,S,v,y)}k&&k.setLatLng(y);var C=this.getNewToolTip(y);C.addTo(f._layerPaint),this.tooltips.push(C),this.handleMarkers(y)}},finalize:function(){if(f._layerPaint.removeLayer(this.tooltips.last()),this.tooltips.pop(),f._layerPaint.removeLayer(f._rubberlinePath),this.circleCoords.length>1){this.tooltips.last()._icon.classList.add("polyline-measure-tooltip-end");var y=this.circleMarkers.last();y.setStyle(f.options.endCircle),y.unbindTooltip(),f._currentLine.circleMarkers.map(function(v){v.bindTooltip(f.options.tooltipTextMove+f.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"})}),f._currentLine.circleMarkers[0].bindTooltip(f.options.tooltipTextMove+f.options.tooltipTextDelete+f.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),y.bindTooltip(f.options.tooltipTextMove+f.options.tooltipTextDelete+f.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),f._currentLine.arrowMarkers.map(function(v){v.bindTooltip(f.options.tooltipTextAdd,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"})}),y.off("click",f._finishPolylinePath,f),y.on("click",f._resumePolylinePath,f),f._arrPolylines[this.id]=this}else f._layerPaint.removeLayer(this.circleMarkers.last()),f._layerPaint.removeLayer(this.tooltips.last());f._resetPathVariables()}};var p=e.marker(c,{icon:l,interactive:!1});p.addTo(this._layerPaint);var g="";this.options.showBearings===!0&&(g=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),g=g+'<div class="polyline-measure-tooltip-difference">+0</div>',g=g+'<div class="polyline-measure-tooltip-total">0</div>',p._icon.innerHTML=g,this._currentLine.tooltips.push(p),this._currentLine.circleCoords.last=d,this._currentLine.tooltips.last=d,this._currentLine.circleMarkers.last=d,this._currentLine.id=this._arrPolylines.length},_mouseClick:function(c){!c.latlng||this._finishCircleScreencoords&&this._finishCircleScreencoords.equals(c.containerPoint)||(!this._currentLine&&!this._mapdragging&&(this._startLine(c.latlng),this._map.fire("polylinemeasure:start",this._currentLine)),this._mapdragging?this._mapdragging=!1:(this._currentLine.addPoint(c.latlng),this._map.fire("polylinemeasure:add",c),this._map.fire("polylinemeasure:change",this._currentLine)))},_finishPolylinePath:function(c){this._map.fire("polylinemeasure:finish",this._currentLine),this._currentLine.finalize(),c&&(this._finishCircleScreencoords=c.containerPoint)},_resumePolylinePath:function(c){if(c.originalEvent.ctrlKey===!0||c.originalEvent.metaKey===!0){this._currentLine=this._arrPolylines[c.target.cntLine],this._rubberlinePath=e.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack(),this._currentLine.tooltips.last()._icon.classList.remove("polyline-measure-tooltip-end");var l=this._currentLine.getNewToolTip(c.latlng);l.addTo(this._layerPaint),this._currentLine.tooltips.push(l),this._currentLine.circleMarkers.last().unbindTooltip(),this._currentLine.circleMarkers.last().bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.circleMarkers.last().setStyle(this.options.currentCircle),this._cntCircle=this._currentLine.circleCoords.length,this._map.fire("polylinemeasure:resume",this._currentLine)}},_resetPathVariables:function(){this._cntCircle=0,this._currentLine=null},_clickedArrow:function(c){if(c.originalEvent.ctrlKey||c.originalEvent.metaKey){var l=c.target.cntLine,d=c.target.cntArrow;this._arrPolylines[l].arrowMarkers[d].removeFrom(this._layerPaint);var f=new e.CircleMarker(c.latlng,this.options.intermedCircle).addTo(this._layerPaint);f.cntLine=l,f.on("mousedown",this._dragCircle,this),f.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[l].circleMarkers.splice(d+1,0,f),this._arrPolylines[l].circleMarkers.map(function(b,S){b.cntCircle=S}),this._arrPolylines[l].circleCoords.splice(d+1,0,c.latlng);var p=this._arrPolylines[l].polylinePath.getLatLngs(),g=this._polylineArc(this._arrPolylines[l].circleCoords[d],c.latlng);g.pop();var y=this._polylineArc(c.latlng,this._arrPolylines[l].circleCoords[d+2]);Array.prototype.splice.apply(p,[d*(this._arcpoints-1),this._arcpoints].concat(g,y)),this._arrPolylines[l].polylinePath.setLatLngs(p);var v=this._drawArrow(g);this._arrPolylines[l].arrowMarkers[d]=v,v=this._drawArrow(y),this._arrPolylines[l].arrowMarkers.splice(d+1,0,v),this._arrPolylines[l].arrowMarkers.map(function(b,S){b.cntLine=l,b.cntArrow=S}),this._tooltipNew=e.marker(c.latlng,{icon:e.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),interactive:!1}),this._tooltipNew.addTo(this._layerPaint),this._arrPolylines[l].tooltips.splice(d+1,0,this._tooltipNew);var M=0;this._arrPolylines[l].tooltips.map((function(b,S){if(S>=1){var k=this._arrPolylines[l].circleCoords[S-1].distanceTo(this._arrPolylines[l].circleCoords[S]),E=this._arrPolylines[l].circleCoords[S-1],C=this._arrPolylines[l].circleCoords[S];M+=k;var I=this._arrPolylines[l].tooltips[S-1];this._updateTooltip(b,I,M,k,E,C)}}).bind(this)),this._map.fire("polylinemeasure:insert",c),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])}},_dragCircleMouseup:function(){this._circleNr===0||this._circleNr===this._arrPolylines[this._lineNr].circleCoords.length-1?this._e1.target.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}):this._e1.target.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._resetPathVariables(),this._map.off("mousemove",this._dragCircleMousemove,this),this._map.dragging.enable(),this._map.on("mousemove",this._mouseMove,this),this._map.off("mouseup",this._dragCircleMouseup,this),this._map.fire("polylinemeasure:move",this._e1),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])},_dragCircleMousemove:function(c){var l=c.latlng.lat,d=c.latlng.lng,f=l-this._mouseStartingLat,p=d-this._mouseStartingLng,g=e.latLng(this._circleStartingLat+f,this._circleStartingLng+p),y=this._arcpoints,v=this._e1.target.cntLine;this._lineNr=v;var M=this._e1.target.cntCircle;this._circleNr=M,this._e1.target.setLatLng(g),this._e1.target.unbindTooltip(),this._arrPolylines[v].circleCoords[M]=g;var b=this._arrPolylines[v].polylinePath.getLatLngs();if(M>=1){var S=this._polylineArc(this._arrPolylines[v].circleCoords[M-1],g);Array.prototype.splice.apply(b,[(M-1)*(y-1),y].concat(S));var k=this._drawArrow(S);k.cntLine=v,k.cntArrow=M-1,this._arrPolylines[v].arrowMarkers[M-1].removeFrom(this._layerPaint),this._arrPolylines[v].arrowMarkers[M-1]=k}if(M<this._arrPolylines[v].circleCoords.length-1){var E=this._polylineArc(g,this._arrPolylines[v].circleCoords[M+1]);Array.prototype.splice.apply(b,[M*(y-1),y].concat(E)),k=this._drawArrow(E),k.cntLine=v,k.cntArrow=M,this._arrPolylines[v].arrowMarkers[M].removeFrom(this._layerPaint),this._arrPolylines[v].arrowMarkers[M]=k}this._arrPolylines[v].polylinePath.setLatLngs(b),M>=0&&this._arrPolylines[v].tooltips[M].setLatLng(g);var C=0;this._arrPolylines[v].tooltips.map((function(I,x){if(x>=1){var N=this._arrPolylines[v].circleCoords[x-1].distanceTo(this._arrPolylines[v].circleCoords[x]),R=this._arrPolylines[v].circleCoords[x-1],F=this._arrPolylines[v].circleCoords[x];C+=N,this._arrPolylines[v].distance=C;var $=this._arrPolylines[v].tooltips[x-1];this._updateTooltip(I,$,C,N,R,F)}}).bind(this)),this._map.on("mouseup",this._dragCircleMouseup,this)},_resumeFirstpointMousemove:function(c){var l=this._lineNr;this._map.on("click",this._resumeFirstpointClick,this);var d=c.latlng;this._rubberlinePath2.setLatLngs(this._polylineArc(d,currentCircleCoords)),this._tooltipNew.setLatLng(d);var f=0,p=d.distanceTo(this._arrPolylines[l].circleCoords[0]),g=d,y=this._arrPolylines[l].circleCoords[0];f+=p;var v=this._tooltipNew,M=this._arrPolylines[l].tooltips[0];this._updateTooltip(M,v,f,p,g,y),this._arrPolylines[l].tooltips.map((function(b,S){if(S>=1){var k=this._arrPolylines[l].circleCoords[S-1].distanceTo(this._arrPolylines[l].circleCoords[S]),E=this._arrPolylines[l].circleCoords[S-1],C=this._arrPolylines[l].circleCoords[S];f+=k;var I=this._arrPolylines[l].tooltips[S-1];this._updateTooltip(b,I,f,k,E,C)}}).bind(this))},_resumeFirstpointClick:function(c){var l=this._lineNr;this._resumeFirstpointFlag=!1,this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._layerPaint.removeLayer(this._rubberlinePath2),this._arrPolylines[l].circleMarkers[0].setStyle(this.options.intermedCircle),this._arrPolylines[l].circleMarkers[0].unbindTooltip(),this._arrPolylines[l].circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"});var d=new e.CircleMarker(c.latlng,this.options.startCircle).addTo(this._layerPaint);d.cntLine=l,d.cntCircle=0,d.on("mousedown",this._dragCircle,this),d.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[l].circleMarkers.unshift(d),this._arrPolylines[l].circleMarkers.map(function(g,y){g.cntCircle=y}),this._arrPolylines[l].circleCoords.unshift(c.latlng);var f=this._polylineArc(c.latlng,currentCircleCoords),p=this._drawArrow(f);this._arrPolylines[l].arrowMarkers.unshift(p),this._arrPolylines[l].arrowMarkers.map(function(g,y){g.cntLine=l,g.cntArrow=y}),f.pop(),this._arrPolylines[l].polylinePath.setLatLngs(f.concat(this._arrPolylines[l].polylinePath.getLatLngs())),this._arrPolylines[l].tooltips.unshift(this._tooltipNew),this._map.on("mousemove",this._mouseMove,this)},_dragCircle:function(c){var l=this._arcpoints;if(c.originalEvent.ctrlKey||c.originalEvent.metaKey){if(this._map.off("click",this._mouseClick,this),c.target.cntCircle===0){this._resumeFirstpointFlag=!0,this._lineNr=c.target.cntLine;var d=this._lineNr;this._circleNr=c.target.cntCircle,currentCircleCoords=c.latlng,this._arrPolylines[d].circleMarkers[0].setStyle(this.options.currentCircle),this._rubberlinePath2=e.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack(),this._tooltipNew=e.marker(currentCircleCoords,{icon:e.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),interactive:!1}),this._tooltipNew.addTo(this._layerPaint);var f="";this.options.showBearings===!0&&(f=f+this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),f=f+'<div class="polyline-measure-tooltip-difference">+0</div>',f=f+'<div class="polyline-measure-tooltip-total">0</div>',this._tooltipNew._icon.innerHTML=f,this._map.off("mousemove",this._mouseMove,this),this._map.on("mousemove",this._resumeFirstpointMousemove,this)}return}if(c.originalEvent.shiftKey){this._lineNr=c.target.cntLine;var d=this._lineNr;this._circleNr=c.target.cntCircle;var p=this._circleNr;if(this._layerPaint.hasLayer(this._rubberlinePath)&&d===this._currentLine.id){if(this._cntCircle--,this._currentLine.circleMarkers.length===1){this._currentLine.finalize();return}if(this._currentLine.circleCoords.splice(p,1),this._currentLine.circleMarkers[p].removeFrom(this._layerPaint),this._currentLine.circleMarkers.splice(p,1),this._currentLine.circleMarkers.map(function(k,E){k.cntCircle=E}),y=this._currentLine.polylinePath.getLatLngs(),this._currentLine.tooltips[p].removeFrom(this._layerPaint),this._currentLine.tooltips.splice(p,1),p===0){this._currentLine.circleMarkers.length===1?this._currentLine.circleMarkers[0].setStyle(this.options.currentCircle):this._currentLine.circleMarkers[0].setStyle(this.options.startCircle),y.splice(0,l-1),this._currentLine.circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.arrowMarkers[p].removeFrom(this._layerPaint),this._currentLine.arrowMarkers.splice(0,1);var f="";this.options.showBearings===!0&&(f=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),f=f+'<div class="polyline-measure-tooltip-difference">+0</div>',f=f+'<div class="polyline-measure-tooltip-total">0</div>',this._currentLine.tooltips[0]._icon.innerHTML=f}else p===this._currentLine.circleCoords.length?(this._currentLine.circleMarkers[p-1].on("click",this._resumePolylinePath,this),this._currentLine.circleMarkers[p-1].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.circleMarkers.slice(-1)[0].setStyle(this.options.currentCircle),y.splice(-(l-1),l-1),this._currentLine.arrowMarkers[p-1].removeFrom(this._layerPaint),this._currentLine.arrowMarkers.splice(-1,1)):(v=this._polylineArc(this._currentLine.circleCoords[p-1],this._currentLine.circleCoords[p]),Array.prototype.splice.apply(y,[(p-1)*(l-1),2*l-1].concat(v)),this._currentLine.arrowMarkers[p-1].removeFrom(this._layerPaint),this._currentLine.arrowMarkers[p].removeFrom(this._layerPaint),M=this._drawArrow(v),this._currentLine.arrowMarkers.splice(p-1,2,M));this._currentLine.polylinePath.setLatLngs(y),this._currentLine.arrowMarkers.map(function(k,E){k.cntLine=d,k.cntArrow=E});var g=0;this._currentLine.tooltips.map((function(k,E,C){if(E>=1){var I,x,N=this._currentLine.tooltips[E-1],R=this._currentLine.circleCoords[E-1];E===C.length-1?(I=this._currentLine.circleCoords[E-1].distanceTo(c.latlng),x=c.latlng,this._updateTooltip(k,N,g+I,I,R,x)):(I=this._currentLine.circleCoords[E-1].distanceTo(this._currentLine.circleCoords[E]),x=this._currentLine.circleCoords[E],g+=I,this._updateTooltip(k,N,g,I,R,x))}}).bind(this)),this._currentLine.distance=g}else{if(this._arrPolylines[d].circleMarkers.length===2){this._layerPaint.removeLayer(this._arrPolylines[d].circleMarkers[1]),this._layerPaint.removeLayer(this._arrPolylines[d].tooltips[1]),this._layerPaint.removeLayer(this._arrPolylines[d].circleMarkers[0]),this._layerPaint.removeLayer(this._arrPolylines[d].tooltips[0]),this._layerPaint.removeLayer(this._arrPolylines[d].arrowMarkers[0]),this._layerPaint.removeLayer(this._arrPolylines[d].polylinePath),this._map.fire("polylinemeasure:remove",c),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr]);return}this._arrPolylines[d].circleCoords.splice(p,1),this._arrPolylines[d].circleMarkers[p].removeFrom(this._layerPaint),this._arrPolylines[d].circleMarkers.splice(p,1),this._arrPolylines[d].circleMarkers.map(function(k,E){k.cntCircle=E});var y=this._arrPolylines[d].polylinePath.getLatLngs();if(this._arrPolylines[d].tooltips[p].removeFrom(this._layerPaint),this._arrPolylines[d].tooltips.splice(p,1),!this._arrPolylines[d].circleMarkers.length){this._arrPolylines.splice(d,1),this._arrPolylines.forEach(function(k,E){k.circleMarkers.map(function(C){C.cntLine=E}),k.arrowMarkers.map(function(C){C.cntLine=E})});return}if(p===0){this._arrPolylines[d].circleMarkers[0].setStyle(this.options.startCircle),y.splice(0,l-1),this._arrPolylines[d].circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[d].arrowMarkers[p].removeFrom(this._layerPaint),this._arrPolylines[d].arrowMarkers.splice(0,1);var f="";this.options.showBearings===!0&&(f=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),f=f+'<div class="polyline-measure-tooltip-difference">+0</div>',f=f+'<div class="polyline-measure-tooltip-total">0</div>',this._arrPolylines[d].tooltips[0]._icon.innerHTML=f}else if(p===this._arrPolylines[d].circleCoords.length)this._arrPolylines[d].circleMarkers[p-1].on("click",this._resumePolylinePath,this),this._arrPolylines[d].circleMarkers[p-1].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[d].circleMarkers.slice(-1)[0].setStyle(this.options.endCircle),this._arrPolylines[d].tooltips.slice(-1)[0]._icon.classList.add("polyline-measure-tooltip-end"),y.splice(-(l-1),l-1),this._arrPolylines[d].arrowMarkers[p-1].removeFrom(this._layerPaint),this._arrPolylines[d].arrowMarkers.splice(-1,1);else{var v=this._polylineArc(this._arrPolylines[d].circleCoords[p-1],this._arrPolylines[d].circleCoords[p]);Array.prototype.splice.apply(y,[(p-1)*(l-1),2*l-1].concat(v)),this._arrPolylines[d].arrowMarkers[p-1].removeFrom(this._layerPaint),this._arrPolylines[d].arrowMarkers[p].removeFrom(this._layerPaint);var M=this._drawArrow(v);this._arrPolylines[d].arrowMarkers.splice(p-1,2,M)}this._arrPolylines[d].polylinePath.setLatLngs(y),this._arrPolylines[d].arrowMarkers.map(function(k,E){k.cntLine=d,k.cntArrow=E});var b=0;this._arrPolylines[d].tooltips.map((function(k,E){if(E>=1){var C=this._arrPolylines[d].circleCoords[E-1].distanceTo(this._arrPolylines[d].circleCoords[E]),I=this._arrPolylines[d].circleCoords[E-1],x=this._arrPolylines[d].circleCoords[E];b+=C,this._arrPolylines[d].distance=b;var N=this._arrPolylines[d].tooltips[E-1];this._updateTooltip(k,N,b,C,I,x)}}).bind(this))}this._map.fire("polylinemeasure:remove",c),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr]);return}this._e1=c,this._measuring&&this._cntCircle===0&&(this._map.dragging.disable(),this._map.off("mousemove",this._mouseMove,this),this._map.off("click",this._mouseClick,this),this._mouseStartingLat=c.latlng.lat,this._mouseStartingLng=c.latlng.lng,this._circleStartingLat=c.target._latlng.lat,this._circleStartingLng=c.target._latlng.lng,this._map.on("mousemove",this._dragCircleMousemove,this))},seed:function(c){c.forEach(l=>{this._toggleMeasure(),this._startLine(l[0]),l.forEach((d,f)=>{const p=e.latLng(d);this._mouseMove({latLng:p}),this._currentLine.addPoint(p),f===l.length-1&&(this._finishPolylinePath(),this._toggleMeasure())})})}}),e.Map.mergeOptions({PolylineMeasureControl:!1}),e.Map.addInitHook(function(){this.options.polylineMeasureControl&&(this.PMControl=new e.Control.PolylineMeasure,this.addControl(this.PMControl))}),e.control.polylineMeasure=function(c){return new e.Control.PolylineMeasure(c)},e.Control.PolylineMeasure})}(ma)),ma.exports}zd();var $d=15e3,Na=1e3,Oa=60*Na,lo=60*Oa,pa=24*lo,Bd="http://www.topografix.com/GPX/gpx_style/0/2",so=new L.Icon.Default,Ud={startIcon:so,endIcon:so,wptIcons:{"":so},wptTypeIcons:{"":so},pointMatchers:[]},Zd={iconSize:[33,45],iconAnchor:[16,45],clickable:!1},Hd={color:"blue"},Wd={parseElements:["track","route","waypoint"],joinTrackSegments:!0};L.GPX=L.FeatureGroup.extend({initialize:function(n,e){e.max_point_interval=e.max_point_interval||$d,e.markers=this._merge_objs(Ud,e.markers||{}),e.marker_options=this._merge_objs(Zd,e.marker_options||{}),e.polyline_options=e.polyline_options||[],e.gpx_options=this._merge_objs(Wd,e.gpx_options||{}),L.Util.setOptions(this,e),L.GPXTrackIcon=L.Icon.extend({options:e.marker_options}),this._gpx=n,this._layers={},this._prepare_markers(e.markers),this._init_info(),n&&this._parse(n,e,this.options.async)},get_duration_string:function(n,e){var o="";n>=pa&&(o+=Math.floor(n/pa)+"d ",n=n%pa),n>=lo&&(o+=Math.floor(n/lo)+":",n=n%lo);var a=Math.floor(n/Oa);n=n%Oa,a<10&&(o+="0"),o+=a+"'";var r=Math.floor(n/Na);return n=n%Na,r<10&&(o+="0"),o+=r,!e&&n>0?o+="."+Math.round(Math.floor(n)*1e3)/1e3:o+='"',o},get_duration_string_iso:function(n,e){var o=this.get_duration_string(n,e);return o.replace("'",":").replace('"',"")},_toFixed_helper:function(n,e=0){return typeof n=="number"?n.toFixed(e):"?"},to_miles:function(n){return n/1.60934},to_ft:function(n){return n*3.28084},m_to_km:function(n){return n/1e3},m_to_mi:function(n){return n/1609.34},ms_to_kmh:function(n){return n*3.6},ms_to_mih:function(n){return n/1609.34*3600},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/(3600*1e3))},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/(3600*1e3))},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/(3600*1e3))},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/(3600*1e3))},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var n=this;return this._info.elevation._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(o,a){return n._toFixed_helper(o,2)+" km, "+n._toFixed_helper(a,0)+" m"})})},get_elevation_data_imp:function(){var n=this;return this._info.elevation._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,n.to_ft,function(o,a){return n._toFixed_helper(o,2)+" mi, "+n._toFixed_helper(a,0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_speed_data:function(){var n=this;return this._info.speed._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,n.ms_to_kmh,function(o,a){return n._toFixed_helper(o,2)+" km, "+n._toFixed_helper(a,2)+" km/h"})})},get_speed_data_imp:function(){var n=this;return this._info.speed._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,n.ms_to_mih,function(o,a){return n._toFixed_helper(o,2)+" mi, "+n._toFixed_helper(a,2)+" mi/h"})})},get_speed_max:function(){return this.m_to_km(this._info.speed.max)*3600},get_speed_max_imp:function(){return this.to_miles(this.get_speed_max())},get_average_hr:function(){return this._info.hr.avg},get_average_temp:function(){return this._info.atemp.avg},get_average_cadence:function(){return this._info.cad.avg},get_heartrate_data:function(){var n=this;return this._info.hr._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(o,a){return n._toFixed_helper(o,2)+" km, "+n._toFixed_helper(a,0)+" bpm"})})},get_heartrate_data_imp:function(){var n=this;return this._info.hr._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,null,function(o,a){return n._toFixed_helper(o,2)+" mi, "+n._toFixed_helper(a,0)+" bpm"})})},get_cadence_data:function(){var n=this;return this._info.cad._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(o,a){return n._toFixed_helper(o,2)+" km, "+n._toFixed_helper(a,0)+" rpm"})})},get_temp_data:function(){var n=this;return this._info.atemp._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(o,a){return n._toFixed_helper(o,2)+" km, "+n._toFixed_helper(a,0)+" degrees"})})},get_cadence_data_imp:function(){var n=this;return this._info.cad._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,null,function(o,a){return n._toFixed_helper(o,2)+" mi, "+n._toFixed_helper(a,0)+" rpm"})})},get_temp_data_imp:function(){var n=this;return this._info.atemp._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,null,function(o,a){return n._toFixed_helper(o,2)+" mi, "+n._toFixed_helper(a,0)+" degrees"})})},reload:function(){this._init_info(),this.clearLayers(),this._parse(this._gpx,this.options,this.options.async)},_merge_objs:function(n,e){var o={};for(var a in n)o[a]=n[a];for(var a in e)o[a]=e[a];return o},_prepare_data_point:function(n,e,o,a){var r=[e&&e(n[0])||n[0],o&&o(n[1])||n[1]];return r.push(a&&a(r[0],r[1])||r[0]+": "+r[1]),r},_prepare_markers:function(n){function e(o){return new L.GPXTrackIcon({iconUrl:o})}return Object.entries(n).forEach(([o,a])=>{o==="wptIcons"||o==="wptTypeIcons"?n[o]=this._prepare_markers(a):o==="pointMatchers"?n[o]=a.map(r=>(typeof r.icon=="string"&&(r.icon=e(r.icon)),r)):typeof a=="string"?n[o]=e(a):typeof a=="object"&&a!==null&&(n[o]=a)}),n},_init_info:function(){this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},speed:{max:0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0},atemp:{avg:0,_total:0,_points:[]},cad:{avg:0,_total:0,_points:[]}}},_load_xml:function(n,e,o,a){a==null&&(a=this.options.async),o==null&&(o=this.options);var r=this,c=new window.XMLHttpRequest;c.open("GET",n,a);try{c.overrideMimeType("text/xml")}catch{}c.onloadend=function(){c.status==200?e(c.responseXML,o):r.fire("error",{err:"Error fetching resource: "+n})},c.send(null)},_parse:function(n,e,o){var a=this,r=function(l,d){var f=a._parse_gpx_data(l,d);if(!f){a.fire("error",{err:"No parseable layers of type(s) "+JSON.stringify(d.gpx_options.parseElements)});return}a.addLayer(f),a.fire("loaded",{layers:f,element:l})};if(n.substr(0,1)==="<"){var c=new DOMParser;o?setTimeout(function(){r(c.parseFromString(n,"text/xml"),e)}):r(c.parseFromString(n,"text/xml"),e)}else this._load_xml(n,r,e,o)},_parse_gpx_data:function(n,e){var o,a,r=[],c=n.getElementsByTagName("name");c.length>0&&(this._info.name=c[0].textContent);var l=n.getElementsByTagName("desc");l.length>0&&(this._info.desc=l[0].textContent);var d=n.getElementsByTagName("author");d.length>0&&(this._info.author=d[0].textContent);var f=n.getElementsByTagName("copyright");f.length>0&&(this._info.copyright=f[0].textContent);var p=e.gpx_options.parseElements;if(p.indexOf("route")>-1){var g=n.getElementsByTagName("rte");for(o=0;o<g.length;o++){var y=g[o],v=this._extract_styling(y),M=this._get_polyline_options(e.polyline_options,o);r=r.concat(this._parse_segment(g[o],e,v,M,"rtept"))}}if(p.indexOf("track")>-1){var b=n.getElementsByTagName("trk");for(o=0;o<b.length;o++){var S=b[o],v=this._extract_styling(S),M=this._get_polyline_options(e.polyline_options,o);if(e.gpx_options.joinTrackSegments)r=r.concat(this._parse_segment(S,e,v,M,"trkpt"));else{var k=S.getElementsByTagName("trkseg");for(B=0;B<k.length;B++)r=r.concat(this._parse_segment(k[B],e,v,M,"trkpt"))}}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),this._info.cad.avg=Math.round(this._info.cad._total/this._info.cad._points.length),this._info.atemp.avg=Math.round(this._info.atemp._total/this._info.atemp._points.length),p.indexOf("waypoint")>-1)for(a=n.getElementsByTagName("wpt"),o=0;o<a.length;o++){var E=new L.LatLng(a[o].getAttribute("lat"),a[o].getAttribute("lon")),C=a[o].getElementsByTagName("name"),c=C.length>0?C[0].textContent:"",I=a[o].getElementsByTagName("desc"),l=I.length>0?I[0].textContent:"",x=a[o].getElementsByTagName("sym"),N=x.length>0?x[0].textContent:null,R=a[o].getElementsByTagName("type"),F=R.length>0?R[0].textContent:null,$=e.markers.wptIcons,G=e.markers.wptTypeIcons,K=e.markers.pointMatchers||[],z;if($&&N&&$[N])z=$[N];else if(G&&F&&G[F])z=G[F];else if(K.length>0){for(var B=0;B<K.length;B++)if(K[B].regex.test(c)){z=K[B].icon;break}}else $&&$[""]&&(z=$[""]);if(!z){console.log("No waypoint icon could be matched for symKey=%s,typeKey=%s,name=%s on waypoint %o",N,F,c,a[o]);continue}var Y=new L.Marker(E,{clickable:e.marker_options.clickable,title:c,icon:z,type:"waypoint"});Y.bindPopup("<b>"+c+"</b>"+(l.length>0?"<br>"+l:"")).openPopup(),this.fire("addpoint",{point:Y,point_type:"waypoint",element:a[o]}),r.push(Y)}if(r.length>1)return new L.FeatureGroup(r);if(r.length==1)return r[0]},_parse_segment:function(n,e,o,a,r){var c=n.getElementsByTagName(r);if(!c.length)return[];for(var l=[],d=[],f=[],p=null,g=0;g<c.length;g++){var y,v=new L.LatLng(c[g].getAttribute("lat"),c[g].getAttribute("lon"));v.meta={time:null,ele:null,hr:null,cad:null,atemp:null,speed:null},y=c[g].getElementsByTagName("time"),y.length>0?v.meta.time=new Date(Date.parse(y[0].textContent)):v.meta.time=new Date("1970-01-01T00:00:00");var M=p!=null?Math.abs(v.meta.time-p.meta.time):0;y=c[g].getElementsByTagName("ele"),y.length>0?v.meta.ele=parseFloat(y[0].textContent):v.meta.ele=p!=null?p.meta.ele:null;var b=p!=null?v.meta.ele-p.meta.ele:0,S=p!=null?this._dist3d(p,v):0;if(y=c[g].getElementsByTagName("speed"),y.length>0?v.meta.speed=parseFloat(y[0].textContent):v.meta.speed=M>0?1e3*S/M:0,y=c[g].getElementsByTagName("name"),y.length>0){for(var k=y[0].textContent,E=e.markers.pointMatchers||[],C=0;C<E.length;C++)if(E[C].regex.test(k)){d.push({label:k,coords:v,icon:E[C].icon,element:c[g]});break}}this._info.length+=S,y=c[g].getElementsByTagNameNS("*","hr"),y.length>0&&(v.meta.hr=parseInt(y[0].textContent),this._info.hr._points.push([this._info.length,v.meta.hr]),this._info.hr._total+=v.meta.hr),y=c[g].getElementsByTagNameNS("*","cad"),y.length>0&&(v.meta.cad=parseInt(y[0].textContent),this._info.cad._points.push([this._info.length,v.meta.cad]),this._info.cad._total+=v.meta.cad),y=c[g].getElementsByTagNameNS("*","atemp"),y.length>0&&(v.meta.atemp=parseInt(y[0].textContent),this._info.atemp._points.push([this._info.length,v.meta.atemp]),this._info.atemp._total+=v.meta.atemp),v.meta.ele>this._info.elevation.max&&(this._info.elevation.max=v.meta.ele),v.meta.ele<this._info.elevation.min&&(this._info.elevation.min=v.meta.ele),this._info.elevation._points.push([this._info.length,v.meta.ele]),v.meta.speed>this._info.speed.max&&(this._info.speed.max=v.meta.speed),this._info.speed._points.push([this._info.length,v.meta.speed]),p==null&&this._info.duration.start==null&&(this._info.duration.start=v.meta.time),this._info.duration.end=v.meta.time,this._info.duration.total+=M,M<e.max_point_interval&&(this._info.duration.moving+=M),b>0?this._info.elevation.gain+=b:this._info.elevation.loss+=Math.abs(b),p=v,l.push(v)}var I=new L.Polyline(l,this._extract_styling(n,o,a));if(this.fire("addline",{line:I,element:n}),f.push(I),e.markers.startIcon){var x=new L.Marker(l[0],{clickable:e.marker_options.clickable,icon:e.markers.startIcon});this.fire("addpoint",{point:x,point_type:"start",element:c[0],line:n}),f.push(x)}if(e.markers.endIcon){var x=new L.Marker(l[l.length-1],{clickable:e.marker_options.clickable,icon:e.markers.endIcon});this.fire("addpoint",{point:x,point_type:"end",element:c[c.length-1],line:n}),f.push(x)}for(var g=0;g<d.length;g++){var x=new L.Marker(d[g].coords,{clickable:e.marker_options.clickable,title:d[g].label,icon:d[g].icon});this.fire("addpoint",{point:x,point_type:"label",element:d[g].element}),f.push(x)}return f},_get_polyline_options:function(n,e){return Array.isArray(n)?n[e]||{}:n},_extract_styling:function(n,e,o){var a=this._merge_objs(Hd,e),r=n.getElementsByTagNameNS(Bd,"line");if(r.length>0){var c=r[0].getElementsByTagName("color");c.length>0&&(a.color="#"+c[0].textContent);var c=r[0].getElementsByTagName("opacity");c.length>0&&(a.opacity=c[0].textContent);var c=r[0].getElementsByTagName("weight");c.length>0&&(a.weight=c[0].textContent);var c=r[0].getElementsByTagName("linecap");c.length>0&&(a.lineCap=c[0].textContent);var c=r[0].getElementsByTagName("linejoin");c.length>0&&(a.lineJoin=c[0].textContent);var c=r[0].getElementsByTagName("dasharray");c.length>0&&(a.dashArray=c[0].textContent);var c=r[0].getElementsByTagName("dashoffset");c.length>0&&(a.dashOffset=c[0].textContent)}return this._merge_objs(a,o)},_dist2d:function(n,e){var o=6371e3,a=this._deg2rad(e.lat-n.lat),r=this._deg2rad(e.lng-n.lng),c=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this._deg2rad(n.lat))*Math.cos(this._deg2rad(e.lat))*Math.sin(r/2)*Math.sin(r/2),l=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),d=o*l;return d},_dist3d:function(n,e){var o=this._dist2d(n,e),a=Math.abs(e.meta.ele-n.meta.ele);return Math.sqrt(Math.pow(o,2)+Math.pow(a,2))},_deg2rad:function(n){return n*Math.PI/180}});(function(){var n=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,o=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var a=this.options.icon&&this.options.icon.options,r=a&&this.options.icon.options.iconAnchor;r&&(r=r[0]+"px "+r[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||r||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(c){c.target._applyRotation()})}),L.Marker.include({_initIcon:function(){n.call(this)},_setPos:function(a){e.call(this,a),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,o?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(a){return this.options.rotationAngle=a,this.update(),this},setRotationOrigin:function(a){return this.options.rotationOrigin=a,this.update(),this}})})();window.L=Gl;async function Gd(){return console.log("MapManager: Starte Karteninitialisierung..."),await Vd(),console.log("MapManager: Karteninitialisierung abgeschlossen."),u.map}async function Vd(){if(u.ismapInitialized||u.map){console.warn("Map already initialized or init in progress.");return}u.ismapInitialized=!0,console.log("initMap started...");const n=le.DEFAULT_MAP_CENTER,e=le.DEFAULT_MAP_ZOOM;Jd(n,e),u.jumpVisualizationLayerGroup=(void 0)().addTo(u.map),u.landingPatternLayerGroup=(void 0)().addTo(u.map),u.jumpRunTrackLayerGroup=(void 0)().addTo(u.map),jd(),qd(),Kd(),Yd(),Xd(n),of(),Promise.all([Qd(),ef(n,e)]).then(()=>{console.log("Initial tile caching and geolocation promise resolved.")}).catch(o=>{console.error("Error during parallel initialization of cache/geolocation:",o)}),Da(),console.log("initMap finished.")}function Jd(n,e){u.lastLat=u.lastLat||n[0],u.lastLng=u.lastLng||n[1],u.map=(void 0)("map",{center:n,zoom:e,zoomControl:!1,doubleClickZoom:!1,maxZoom:19,minZoom:navigator.onLine?6:11}),console.log("Map instance created.")}function jd(){u.baseMaps={OpenStreetMap:(void 0).cached("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}),OpenTopoMap:(void 0).cached("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'© <a href="https://www.openstreetmap.org/copyright">OSM</a>, <a href="https://opentopomap.org">OpenTopoMap</a> (CC-BY-SA)',subdomains:["a","b","c"]}),"Esri Satellite":(void 0).cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USDA, USGS"}),"Esri Street":(void 0).cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USGS"}),"Esri Topo":(void 0).cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USGS"}),"Esri Satellite + OSM":(void 0)([(void 0).cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USDA, USGS",zIndex:1}),(void 0).cached("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',opacity:.5,zIndex:2,updateWhenIdle:!0,keepBuffer:2,subdomains:["a","b","c"]})],{attribution:'© Esri, USDA, USGS | © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'})},u.map&&u.map.attributionControl&&u.map.attributionControl.addAttribution('Weather data by <a href="https://open-meteo.com">Open-Meteo</a>');const e=_.state.userSettings.baseMaps in u.baseMaps?_.state.userSettings.baseMaps:"Esri Street",o=u.baseMaps[e];o&&typeof o.on=="function"?(o.on("tileerror",()=>{if(!navigator.onLine){u.hasTileErrorSwitched||(console.warn(`${e} tiles unavailable offline. Zoom restricted.`),T.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles."),u.hasTileErrorSwitched=!0);return}if(!u.hasTileErrorSwitched&&u.map.hasLayer(o)){const a="OpenStreetMap";console.warn(`${e} tiles unavailable, switching to ${a}`),u.map.removeLayer(o),u.baseMaps[a].addTo(u.map),_.state.userSettings.baseMaps=a,_.save(),T.handleMessage(`${e} tiles unavailable. Switched to ${a}.`),u.hasTileErrorSwitched=!0}else u.hasTileErrorSwitched||console.warn(`Tile error in ${e}, attempting to continue.`)}),o.addTo(u.map)):(console.error(`Default base map "${e}" could not be added.`),u.baseMaps.OpenStreetMap.addTo(u.map)),u.map&&u.map.invalidateSize(),window.addEventListener("online",()=>{u.hasTileErrorSwitched=!1,u.map&&(u.map.options.minZoom=6),Da()}),window.addEventListener("offline",()=>{u.map&&(u.map.options.minZoom=9),Da()}),console.log("Base layers and online/offline handlers set up.")}function qd(){if(!u.map){console.error("Karte nicht initialisiert, bevor Controls hinzugefügt werden können.");return}(void 0).layers(u.baseMaps,null,{position:"topright"}).addTo(u.map),u.map.on("baselayerchange",function(n){console.log(`Base map changed to: ${n.name}`),_&&_.state&&_.state.userSettings?(_.state.userSettings.baseMaps=n.name,_.save(),console.log(`Saved selected base map "${n.name}" to settings.`)):console.error("Settings object not properly available to save base map choice."),u.hasTileErrorSwitched=!1,u.lastLat&&u.lastLng&&typeof cacheTilesForDIP=="function"&&cacheTilesForDIP({map:u.map,lastLat:u.lastLat,lastLng:u.lastLng,baseMaps:u.baseMaps})}),(void 0).zoom({position:"topright"}).addTo(u.map),(void 0).polylineMeasure({position:"topright",unit:"kilometres",showBearings:!0,clearMeasurementsOnStop:!1,showClearControl:!0,showUnitControl:!0,tooltipTextFinish:"Click to finish the line<br>",tooltipTextDelete:"Shift-click to delete point",tooltipTextMove:"Drag to move point<br>",tooltipTextResume:"Click to resume line<br>",tooltipTextAdd:"Click to add point<br>",measureControlTitleOn:"Start measuring distance and bearing",measureControlTitleOff:"Stop measuring"}).addTo(u.map),(void 0).scale({position:"bottomleft",metric:!0,imperial:!1,maxWidth:100}).addTo(u.map),console.log("Standard map controls and baselayerchange handler added.")}function Kd(){u.map.createPane("gpxTrackPane"),u.map.getPane("gpxTrackPane").style.zIndex=650,u.map.getPane("tooltipPane").style.zIndex=700,u.map.getPane("popupPane").style.zIndex=700,console.log("Custom map panes created.")}function Yd(){u.livePositionControl=new mf({position:"bottomright"}).addTo(u.map),console.log("Initialized livePositionControl and hid by default")}async function Xd(n,e){console.log("MapManager: Initialisiere den Standard-Marker..."),await To(n[0],n[1]),u.isManualPanning=!1,console.log("Default marker initialized using the new standard method.")}async function Qd(){try{if(await Ut.init(),await Ut.migrateTiles(),await Ut.getCacheSize()>500){const e=await Ut.clearOldTiles(3);T.handleMessage(`Cleared ${e.deletedCount} old tiles: ${e.deletedSizeMB.toFixed(2)} MB freed.`)}else await Ut.clearOldTiles()}catch(n){console.error("Failed to initialize or manage tile cache:",n),T.handleError("Tile caching setup failed.")}console.log("Tile cache logic initialized.")}async function tf(n,e){const{latitude:o,longitude:a}=n.coords;console.log("MapManager: Geolocation erfolgreich. Sende Event."),u.lastLat=o,u.lastLng=a,u.lastAltitude=await T.getAltitude(o,a),u.map.setView([o,a],e);const r=new CustomEvent("location:selected",{detail:{lat:o,lng:a,source:"geolocation"},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(r)}async function Ar(n,e,o){console.warn(`Geolocation error: ${n.message}`),T.handleMessage("Unable to retrieve your location. Using default location."),await To(e[0],e[1]),u.map.setView(e,o),On(!0),u.isManualPanning=!1;const a=new CustomEvent("location:selected",{detail:{lat:e[0],lng:e[1],source:"geolocation_fallback"},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(a),console.log("Dispatched 'location:selected' event from geolocation fallback.")}async function ef(n,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>tf(o,e),o=>Ar(o,n,e),{enableHighAccuracy:!0,timeout:le.GEOLOCATION_TIMEOUT_MS,maximumAge:0}):(console.warn("Geolocation not supported."),await Ar({message:"Geolocation not supported by this browser."},n,e))}function nf(n){const{lat:e,lng:o}=n.latlng,a=new CustomEvent("map:mousemove",{detail:{lat:e,lng:o},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(a)}function of(){if(!u.map){console.error("Karte nicht initialisiert in _setupCoreMapEventHandlers");return}u.coordsControl||(u.coordsControl=new(void 0).Coordinates,u.coordsControl.addTo(u.map),console.log("CoordsControl initialized in _setupCoreMapEventHandlers.")),u.map.on("mousemove",nf),u.map.on("mouseout",function(){u.coordsControl&&u.coordsControl.getContainer()&&(u.coordsControl.getContainer().innerHTML="Move mouse over map")}),u.map.on("dblclick",Ir),u.map.on("zoomstart",e=>{if(!navigator.onLine){const o=e.target._zoom||u.map.getZoom();o<11?(e.target._zoom=11,u.map.setZoom(11),T.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles.")):o>14&&(e.target._zoom=14,u.map.setZoom(14),T.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles."))}}),u.map.on("zoomend",()=>{const e=u.map.getZoom(),o=new CustomEvent("map:zoomend",{detail:{zoom:e},bubbles:!0,cancelable:!0});if(u.map.getContainer().dispatchEvent(o),u.jumpRunTrackLayer&&_.state.userSettings.showJumpRunTrack){const a=u.jumpRunTrackLayer.getLayers().find(r=>{var c;return((c=r.options.icon)==null?void 0:c.options.className)==="jrt-anchor-marker"});if(a){const r=e<=11?10:e<=12?12:e<=13?14:16;a.setIcon((void 0)({className:"jrt-anchor-marker",html:`<div style="background-color: orange; width: ${r}px; height: ${r}px; border-radius: 50%; border: 2px solid white; opacity: 0.8;"></div>`,iconSize:[r,r],iconAnchor:[r/2,r/2],tooltipAnchor:[0,-(r/2+5)]}))}}if(u.heatmapLayer){const a=T.calculateDynamicRadius(re.HEATMAP_BASE_RADIUS,re.HEATMAP_REFERENCE_ZOOM);u.heatmapLayer.setOptions({radius:a}),console.log("Heatmap radius updated on zoom:",{currentZoom:u.map.getZoom(),newRadius:a})}}),u.map.on("movestart",e=>{e.target===u.map&&(!e.originalEvent||e.originalEvent.target===u.map.getContainer())&&(u.isManualPanning=!0,console.log("Manual map panning detected."))}),u.map.on("contextmenu",e=>{if(!_.state.userSettings.showCutAwayFinder||!_.state.userSettings.calculateJump)return;const{lat:o,lng:a}=e.latlng;u.cutAwayMarker?u.cutAwayMarker.setLatLng([o,a]):(u.cutAwayMarker=cf(o,a).addTo(u.map),uf(u.cutAwayMarker)),u.cutAwayLat=o,u.cutAwayLng=a,Xl(u.cutAwayMarker,o,a);const r=new CustomEvent("cutaway:marker_placed",{bubbles:!0});u.map.getContainer().dispatchEvent(r)});const n=u.map.getContainer();n.addEventListener("touchstart",async e=>{if(e.touches.length!==1||e.target.closest(".leaflet-marker-icon"))return;const o=new Date().getTime(),a=o-lastTapTime;if(a<300&&a>0){e.preventDefault();const c=n.getBoundingClientRect(),l=e.touches[0].clientX-c.left,d=e.touches[0].clientY-c.top,f=u.map.containerPointToLatLng([l,d]);await Ir({latlng:f,containerPoint:(void 0)(l,d),layerPoint:u.map.latLngToLayerPoint(f)})}lastTapTime=o},{passive:!1}),u.map.on("click",e=>{}),u.map.on("mousedown",e=>{}),console.log("All core map event handlers have been set up.")}function Ir(n){const{lat:e,lng:o}=n.latlng;console.log('MapManager: Doppelklick erkannt. Sende "location:selected"-Event.');const a=new CustomEvent("location:selected",{detail:{lat:e,lng:o,source:"dblclick"},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(a)}function co(n){if(af(),u.labelZoomListener&&u.map&&(u.map.off("zoomend",u.labelZoomListener),u.labelZoomListener=null),!n||!u.jumpVisualizationLayerGroup)return;const e=[];n.exitCircles&&n.exitCircles.forEach(a=>{const r=(void 0)(a.center,{radius:a.radius,color:a.color,fillColor:a.fillColor,fillOpacity:a.fillOpacity,weight:a.weight||2}).addTo(u.jumpVisualizationLayerGroup);a.tooltip&&r.bindTooltip(a.tooltip,{direction:"top",offset:[0,0],className:"wind-tooltip"})}),n.canopyCircles&&n.canopyCircles.forEach(a=>{(void 0)(a.center,a).addTo(u.jumpVisualizationLayerGroup)});function o(a,r){const c=(void 0)(a[0],a[1]),d=r/6378137*(180/Math.PI),f=(void 0)(a[0]+d,a[1]),p=u.map.latLngToLayerPoint(c),g=u.map.latLngToLayerPoint(f);return[25,p.y-g.y+10]}if(n.canopyLabels){const a=u.map.getZoom();n.canopyLabels.forEach(r=>{const c=a<=11,l=(void 0)(r.center,{icon:(void 0)({className:`isoline-label ${c?"isoline-label-small":"isoline-label-large"}`,html:`<span style="font-size: ${c?"8px":"10px"}">${r.text}</span>`,iconSize:c?[50,12]:[60,14],iconAnchor:o(r.center,r.radius)}),zIndexOffset:2100}).addTo(u.jumpVisualizationLayerGroup);e.push({marker:l,center:r.center,radius:r.radius,text:r.text})})}e.length>0&&(u.labelZoomListener=function(){const r=u.map.getZoom()<=11;e.forEach(c=>{c.marker.setIcon((void 0)({className:`isoline-label ${r?"isoline-label-small":"isoline-label-large"}`,html:`<span style="font-size: ${r?"8px":"10px"}">${c.text}</span>`,iconSize:r?[50,12]:[60,14],iconAnchor:o(c.center,c.radius)}))})},u.map.on("zoomend",u.labelZoomListener))}function af(){u.map&&u.jumpVisualizationLayerGroup&&u.map.removeLayer(u.jumpVisualizationLayerGroup),u.jumpVisualizationLayerGroup=(void 0)().addTo(u.map)}function sf(){u.landingPatternLayerGroup&&u.landingPatternLayerGroup.clearLayers()}function si(n){sf(),n&&(n.legs.forEach(e=>{(void 0)(e.path,{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}).addTo(u.landingPatternLayerGroup)}),n.arrows.forEach(e=>{const o=rf(e.position[0],e.position[1],e.bearing,e.color);(void 0)(e.position,{icon:o}).addTo(u.landingPatternLayerGroup).bindTooltip(e.tooltipText,{offset:[10,0],direction:"right",className:"wind-tooltip"})}))}function rf(n,e,o,a){const r=(o+360)%360,c=`
        <svg width="40" height="20" viewBox="0 0 40 20" xmlns="http://www.w3.org/2000/svg">
            <line x1="0" y1="10" x2="30" y2="10" stroke="${a}" stroke-width="4" />
            <polygon points="30,5 40,10 30,15" fill="${a}" />
        </svg>
    `;return(void 0)({html:`<div style="transform: rotate(${r}deg); ...">${c}</div>`,className:"wind-arrow-icon",iconSize:[40,20],iconAnchor:[20,10]})}function lf(){u.map&&u.jumpRunTrackLayerGroup&&u.map.removeLayer(u.jumpRunTrackLayerGroup),u.jumpRunTrackLayerGroup=(void 0)().addTo(u.map)}function cf(n,e){const o=(void 0)({iconUrl:Ra.CUTAWAY_MARKER,iconSize:[25,25],iconAnchor:[12,12],popupAnchor:[0,-12],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,41]});return(void 0)([n,e],{icon:o,draggable:!0})}function uf(n){n.on("dragend",e=>{const o=n.getLatLng();u.cutAwayLat=o.lat,u.cutAwayLng=o.lng,console.log("Cut-away marker dragged to:",{lat:u.cutAwayLat,lng:u.cutAwayLng}),Xl(n,u.cutAwayLat,u.cutAwayLng);const a=new CustomEvent("cutaway:marker_placed",{bubbles:!0});u.map.getContainer().dispatchEvent(a)})}function Xl(n,e,o,a=!1){const r=_.getValue("coordFormat","radio","Decimal"),c=T.convertCoords(e,o,r);let l="<b>Cut-Away Start</b><br>";if(r==="MGRS")l+=`MGRS: ${c.lat}`;else{const d=f=>`${f.deg}°${f.min}'${f.sec.toFixed(0)}" ${f.dir}`;r==="DMS"?l+=`Lat: ${d(T.decimalToDms(e,!0))}<br>Lng: ${d(T.decimalToDms(o,!1))}`:l+=`Lat: ${e.toFixed(5)}<br>Lng: ${o.toFixed(5)}`}qa(n,l,a)}function Fa(n){u.cutAwayCircle&&(u.map.removeLayer(u.cutAwayCircle),u.cutAwayCircle=null),n&&(u.cutAwayCircle=(void 0)(n.center,{radius:n.radius,color:"purple",fillColor:"purple",fillOpacity:.2,weight:2}).addTo(u.map),u.cutAwayCircle.bindTooltip(n.tooltipContent,{permanent:!1,direction:"center",className:"cutaway-tooltip"}))}function hf(){u.cutAwayMarker&&(u.map.removeLayer(u.cutAwayMarker),u.cutAwayMarker=null),Fa(null)}function uo(n){var c,l,d,f;if(lf(),!n||!u.jumpRunTrackLayerGroup){console.warn("No valid trackData or AppState.jumpRunTrackLayerGroup");return}if(!((l=(c=n.path)==null?void 0:c.latlngs)!=null&&l.length)||!((d=n.airplane)!=null&&d.position)){console.warn("Invalid trackData structure:",n);return}const e=(void 0)(n.path.latlngs,n.path.options).bindTooltip(n.path.tooltipText).addTo(u.jumpRunTrackLayerGroup);let o=null;(f=n.approachPath)!=null&&f.latlngs&&(o=(void 0)(n.approachPath.latlngs,n.approachPath.options).bindTooltip(n.approachPath.tooltipText).addTo(u.jumpRunTrackLayerGroup));const a=(void 0)({iconUrl:Ra.AIRPLANE_MARKER,iconSize:[32,32],iconAnchor:[16,16],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,32]}),r=(void 0)(n.airplane.position,{icon:a,rotationAngle:n.airplane.bearing,rotationOrigin:"center center",draggable:!0,zIndexOffset:2e3}).bindTooltip("Drag to move Jump Run Track").addTo(u.jumpRunTrackLayerGroup);r.on("mousedown",()=>u.map.dragging.disable()),r.on("mouseup",()=>u.map.dragging.enable()),r.on("drag",p=>{var S;const g=p.target.getLatLng(),y=n.airplane.originalPosition;if(!y||!Number.isFinite(y.lat)||!Number.isFinite(y.lng)){console.warn("Invalid originalPosition:",y);return}const v=g.lat-y.lat,M=g.lng-y.lng;if(!Number.isFinite(v)||!Number.isFinite(M)){console.warn("Invalid delta values:",{deltaLat:v,deltaLng:M});return}const b=n.path.originalLatLngs.map(k=>[Number.isFinite(k[0])?k[0]+v:k[0],Number.isFinite(k[1])?k[1]+M:k[1]]);if(e.setLatLngs(b),o&&((S=n.approachPath)!=null&&S.originalLatLngs)){const k=n.approachPath.originalLatLngs.map(E=>[Number.isFinite(E[0])?E[0]+v:E[0],Number.isFinite(E[1])?E[1]+M:E[1]]);o.setLatLngs(k)}}),r.on("dragend",p=>{const g=p.target.getLatLng();if(!Number.isFinite(g.lat)||!Number.isFinite(g.lng)){console.warn("Invalid new position in dragend:",g);return}const y=new CustomEvent("track:dragend",{detail:{newPosition:g,originalTrackData:n},bubbles:!0});u.map.getContainer().dispatchEvent(y)})}async function To(n,e){if(console.log("MapManager: Befehl erhalten, Marker zu erstellen/bewegen bei",n,e),typeof n!="number"||typeof e!="number"||n<-90||n>90||e<-180||e>180){console.error("MapManager: Ungültige Koordinaten:",{lat:n,lng:e});return}const o=await T.getAltitude(n,e);if(u.currentMarker)console.log("MapManager: Marker existiert, bewege ihn jetzt mit setLatLng."),u.currentMarker.setLatLng([n,e]);else{console.log("MapManager: Kein Marker vorhanden, erstelle einen neuen.");const r=df(n,e);ff(r),u.currentMarker=r,u.currentMarker.addTo(u.map)}const a=`Lat: ${n.toFixed(5)}<br>Lng: ${e.toFixed(5)}<br>Alt: ${o} m`;qa(u.currentMarker,a),u.lastLat=n,u.lastLng=e,u.lastAltitude=o,u.map.invalidateSize()}function df(n,e){const o=(void 0)({iconUrl:Ra.DEFAULT_MARKER,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,32]});return(void 0)([n,e],{icon:o,draggable:!0})}function ff(n){n.on("dragend",e=>{const o=n.getLatLng(),a=new CustomEvent("location:selected",{detail:{lat:o.lat,lng:o.lng,source:"marker_drag"},bubbles:!0});u.map.getContainer().dispatchEvent(a)})}function qa(n,e,o=!1){var r;if(!n)return;const a=((r=n.getPopup())==null?void 0:r.isOpen())||o;n.unbindPopup().bindPopup(e),a&&n.openPopup()}function On(n=!1){u.isManualPanning&&!n||u.map&&u.currentMarker&&u.map.panTo(u.currentMarker.getLatLng())}const mf=(void 0).extend({options:{position:"bottomright"},onAdd:function(n){const e=(void 0).create("div","leaflet-control-live-position");return e.style.display="none",e.style.background="rgba(255, 255, 255, 0.8)",e.style.padding="5px",e.style.borderRadius="4px",this._container=e,e},update:function(n){if(!n||n.latitude===null||n.latitude===void 0){this._container.style.display="none";return}const{latitude:e,longitude:o,deviceAltitude:a,altitudeAccuracy:r,accuracy:c,speedMs:l,direction:d,showJumpMasterLine:f,jumpMasterLineData:p,heightUnit:g,effectiveWindUnit:y,coordFormat:v,refLevel:M}=n,b=T.convertCoords(e,o,v),S=v==="MGRS"?`MGRS: ${b.lat}<br>`:`Lat: ${e.toFixed(5)}<br>Lng: ${o.toFixed(5)}<br>`;let k="Altitude: N/A<br>";if(a!==null){let N=M==="AGL"&&u.lastAltitude?a-parseFloat(u.lastAltitude):a,R=M==="AGL"&&u.lastAltitude?"abv DIP":M;const F=Math.round(T.convertHeight(N,g)),$=Math.round(T.convertHeight(r,g));k=`Altitude: ${F} ${g} ${R} (±${$||"N/A"} ${g})<br>`}const E=`Accuracy: ${Math.round(T.convertHeight(c,g))} ${g}<br>`,C=`Speed: ${T.convertWind(l,y,"m/s").toFixed(1)} ${y}<br>`,I=`Direction: ${d}°`;let x=`<span style="font-weight: bold;">Live Position</span><br>${S}${k}${E}${C}${I}`;if(f&&p){const N=Math.round(T.convertHeight(p.distance,g)),R=p.tot!=="N/A"&&p.tot<1200?`TOT: X - ${p.tot} s`:"TOT: N/A";x+=`<br><br><span style="font-weight: bold;">Jump Master Line to ${p.target}</span><br>`,x+=`Bearing: ${p.bearing}°<br>`,x+=`Distance: ${N} ${g}<br>`,x+=R}this._container.innerHTML=x,this._container.style.display="block"}});function pf(n,e){const o=[[n.lat,n.lng],[e.lat,e.lng]];u.jumpMasterLine?u.jumpMasterLine.setLatLngs(o):u.jumpMasterLine=(void 0)(o,{color:"blue",weight:3,dashArray:"5, 5"}).addTo(u.map)}function Dr(){u.jumpMasterLine&&(u.map.removeLayer(u.jumpMasterLine),u.jumpMasterLine=null)}function gf(){u.livePositionControl&&u.livePositionControl.update(null)}function _f(n){u.livePositionControl&&u.livePositionControl.update(n)}function Ql(n){if(!u.isPlacingHarp)return;const{lat:e,lng:o}=n.latlng;u.harpMarker?(u.harpMarker.setLatLng([e,o]),console.log("Updated HARP marker position:",{lat:e,lng:o})):(u.harpMarker=yf(e,o).addTo(u.map),console.log("Placed new HARP marker:",{lat:e,lng:o})),_.state.userSettings.harpLat=e,_.state.userSettings.harpLng=o,_.save(),u.isPlacingHarp=!1,u.map.off("click",Ql),console.log("HARP placement mode deactivated");const a=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');a&&(a.disabled=!1,console.log("Enabled HARP radio button"))}function yf(n,e){const o=(void 0)([n,e],{icon:(void 0)({className:"harp-marker",html:'<div style="background-color: green; width: 10px; height: 10px; border-radius: 50%;"></div>',iconSize:[10,10],iconAnchor:[5,5]}),pane:"markerPane"});return console.log("Created HARP marker at:",{latitude:n,longitude:e}),o}function vf(){if(!u.map){console.warn("Map not initialized, cannot clear HARP marker"),T.handleMessage("Map not initialized, cannot clear HARP marker.");return}u.harpMarker&&(u.map.removeLayer(u.harpMarker),u.harpMarker=null,console.log("Removed HARP marker")),_.state.userSettings.harpLat=null,_.state.userSettings.harpLng=null,_.save();const n=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');if(n&&(n.disabled=!0,console.log("Disabled HARP radio button")),_.state.userSettings.jumpMasterLineTarget==="HARP"&&_.state.userSettings.showJumpMasterLine){u.jumpMasterLine&&(u.map.removeLayer(u.jumpMasterLine),u.jumpMasterLine=null,console.log("Removed Jump Master Line: HARP marker cleared")),_.state.userSettings.jumpMasterLineTarget="DIP";const e=document.querySelector('input[name="jumpMasterLineTarget"][value="DIP"]');e&&(e.checked=!0,console.log("Switched Jump Master Line to DIP")),_.save(),u.liveMarker&&u.currentMarker&&u.lastLat!==null&&u.lastLng!==null&&debouncedPositionUpdate({coords:{latitude:u.lastLatitude,longitude:u.lastLongitude,accuracy:u.lastAccuracy,altitude:u.lastDeviceAltitude,altitudeAccuracy:u.lastAltitudeAccuracy}})}T.handleMessage("HARP marker cleared")}async function So(){if(!u.currentMarker||u.lastLat===null)return;const n=u.lastLat,e=u.lastLng,o=u.lastAltitude,a=_.getValue("coordFormat","radio","Decimal"),r=Te(),c=T.convertCoords(n,e,a);let l;if(a==="MGRS")l=`MGRS: ${c.lat}<br>Alt: ${o} m`;else{const d=f=>`${f.deg}°${f.min}'${f.sec.toFixed(0)}" ${f.dir}`;a==="DMS"?l=`Lat: ${d(T.decimalToDms(n,!0))}<br>Lng: ${d(T.decimalToDms(e,!1))}<br>Alt: ${o} m`:l=`Lat: ${n.toFixed(5)}<br>Lng: ${e.toFixed(5)}<br>Alt: ${o} m`}if(u.weatherData&&u.weatherData.surface_pressure){const d=u.weatherData.surface_pressure[r];d?l+=` QFE: ${d.toFixed(0)} hPa`:l+=" QFE: N/A"}else l+=" QFE: N/A";qa(u.currentMarker,l)}async function Po(n,e=null){var M;if(console.log(`updateWeatherDisplay called with index: ${n}, Time: ${u.weatherData.time[n]}`),!u.weatherData||!u.weatherData.time||n<0||n>=u.weatherData.time.length){console.error("No weather data available or index out of bounds:",n),document.getElementById("info").innerHTML="No weather data available",document.getElementById("selectedTime").innerHTML="Selected Time: ";const b=document.getElementById("timeSlider");b&&(b.value=0);return}u.landingWindDir=u.weatherData.wind_direction_10m[n]||null,console.log("landingWindDir updated to:",u.landingWindDir);const o=document.getElementById("customLandingDirectionLL"),a=document.getElementById("customLandingDirectionRR");o&&a&&u.landingWindDir!==null&&(o.value=Math.round(u.landingWindDir),a.value=Math.round(u.landingWindDir));const r=((M=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:M.value)||"AGL",c=_.getValue("heightUnit","radio","m"),l=_.getValue("windUnit","radio","kt"),d=_.getValue("temperatureUnit","radio","C"),f=await T.getDisplayTime(u.weatherData.time[n],u.lastLat,u.lastLng),p=un(n),g=r==="AMSL"&&u.lastAltitude!=="N/A"?Math.round(u.lastAltitude):0;if(!_.state.userSettings.showTable){document.getElementById("info").innerHTML="",document.getElementById("selectedTime").innerHTML=`Selected Time: ${f}`;return}const y=p.map(b=>{const S=parseFloat(b.spd);let k="";if(l==="bft"){const z=T.convertWind(S,"kt","km/h"),B=T.knotsToBeaufort(z);B<=1?k="wind-low":B<=3?k="wind-moderate":B<=4?k="wind-high":k="wind-very-high"}else{const z=T.convertWind(S,"kt","km/h");z<=3?k="wind-low":z<=10?k="wind-moderate":z<=16?k="wind-high":k="wind-very-high"}const E=b.rh;let C="";E!=="N/A"&&Number.isFinite(E)&&(E<65?C="humidity-low":E>=65&&E<=85?C="humidity-moderate":E>85&&E<100?C="humidity-high":E===100&&(C="humidity-saturated"));const I=r==="AMSL"?b.displayHeight+(c==="ft"?Math.round(g*3.28084):g):b.displayHeight,x=T.convertTemperature(b.temp,d==="C"?"°C":"°F"),N=x==="N/A"?"N/A":x.toFixed(0),R=T.convertWind(S,l,"km/h");let F;const $=r==="AMSL"?c==="ft"?Math.round(g*3.28084):g:0;if(Math.round(I)===$&&u.weatherData.wind_gusts_10m[n]!==void 0&&Number.isFinite(u.weatherData.wind_gusts_10m[n])){const z=u.weatherData.wind_gusts_10m[n],B=T.convertWind(z,l,"km/h"),Y=l==="bft"?Math.round(R):R.toFixed(0),nt=l==="bft"?Math.round(B):B.toFixed(0);F=`${Y} G ${nt}`}else F=R==="N/A"?"N/A":l==="bft"?Math.round(R):R.toFixed(0);const G=Math.round(T.convertWind(S,"kt","km/h")/5)*5,K=b.dir==="N/A"||isNaN(G)?"N/A":T.generateWindBarb(b.dir,G);return`<tr class="${k} ${C}">
                    <td>${Math.round(I)}</td>
                    <td>${T.roundToTens(b.dir)}</td>
                    <td>${F}</td>
                    <td>${K}</td>
                    <td>${N}</td>
                </tr>`}).join(""),v=`
        <table id="weatherTable">
            <thead>
                <tr>
                    <th>Height (${c} ${r})</th>
                    <th>Dir (deg)</th>
                    <th>Spd (${l})</th>
                    <th>Wind</th>
                    <th>T (${d==="C"?"°C":"°F"})</th>
                </tr>
            </thead>
            <tbody>
                ${y}
            </tbody>
        </table>`;document.getElementById("info").innerHTML=v,document.getElementById("selectedTime").innerHTML=`Selected Time: ${f}`}function Je(){var Ai;if(!u.currentMarker||typeof u.currentMarker.getLatLng!="function"){console.warn("Landing pattern update skipped: AppState.currentMarker is not a valid marker object yet.",u.currentMarker);return}const n=u.currentMarker.getLatLng();if(!n){console.error("Could not get LatLng from the current marker. Aborting landing pattern update.",u.currentMarker);return}if(!_.state.isLandingPatternUnlocked||!_.state.userSettings.showLandingPattern){si(null);return}if(!u.weatherData||!u.lastLat){si(null);return}const e=u.map.getZoom();if(e<le.LANDING_PATTERN_MIN_ZOOM){console.log("Landing pattern not displayed - zoom too low:",e),si(null);return}const o=parseInt(document.getElementById("timeSlider").value)||0,a=((Ai=document.querySelector('input[name="landingDirection"]:checked'))==null?void 0:Ai.value)||"LL",r=document.getElementById("customLandingDirectionLL"),c=document.getElementById("customLandingDirectionRR"),l=r?parseInt(r.value,10):null,d=c?parseInt(c.value,10):null,f=parseInt(document.getElementById("canopySpeed").value)||20,p=parseFloat(document.getElementById("descentRate").value)||3.5,g=parseInt(document.getElementById("legHeightFinal").value)||100,y=parseInt(document.getElementById("legHeightBase").value)||200,v=parseInt(document.getElementById("legHeightDownwind").value)||300,M=n.lat,b=n.lng,S=Math.round(u.lastAltitude),k=un(o);if(!k||k.length===0)return;const E=k.map(Dt=>Dt.height),C=k.map(Dt=>Number.isFinite(Dt.dir)?parseFloat(Dt.dir):0),I=k.map(Dt=>T.convertWind(parseFloat(Dt.spd)||0,"kt","km/h")),x=I.map((Dt,ye)=>-Dt*Math.sin(C[ye]*Math.PI/180)),N=I.map((Dt,ye)=>-Dt*Math.cos(C[ye]*Math.PI/180));let R;if(a==="LL"&&Number.isFinite(l)&&l>=0&&l<=359?R=l:a==="RR"&&Number.isFinite(d)&&d>=0&&d<=359?R=d:R=Number.isFinite(u.landingWindDir)?u.landingWindDir:C[0],!Number.isFinite(R)){console.warn("Invalid landing wind direction:",R);return}function F(Dt){const ye=_.getValue("windUnit","radio","kt"),fn=T.convertWind(Dt,ye,"kt");return ye==="bft"?Math.round(fn):fn.toFixed(1)}const $=(Dt,ye,fn,xo,Zn)=>{const Ii=xo*1.852/3.6*Zn/111e3,Yt=fn*Math.PI/180,j=Ii*Math.cos(Yt),Di=Ii*Math.sin(Yt)/Math.cos(Dt*Math.PI/180);return[Dt+j,ye+Di]},G=[S,S+g];console.log("Final limits:",G);const K=T.calculateMeanWind(E,x,N,...G),z=K[0],B=K[1];if(!Number.isFinite(B)||!Number.isFinite(z)){console.warn("Invalid mean wind for final leg:",K);return}let Y=null;B<=3?Y="lightblue":B<=10?Y="lightgreen":B<=16?Y="#f5f34f":Y="#ffcccc";const nt=R,wt=T.calculateWindAngle(nt,z),{crosswind:q,headwind:Lt}=T.calculateWindComponents(B,wt),H=T.calculateWCA(q,f)*(q>=0?1:-1),vt=T.normalizeAngle(nt-H),tt=T.calculateCourseFromHeading(vt,z,B,f).groundSpeed,pt=g/p,gt=tt*1.852/3.6*pt,mt=(R+180)%360,X=$(M,b,mt,tt,pt);(M+X[0])/2,(b+X[1])/2;const W=[S+g,S+y],ht=T.calculateMeanWind(E,x,N,...W),rt=ht[0],Ft=ht[1];if(!Number.isFinite(Ft)||!Number.isFinite(rt)){console.warn("Invalid mean wind for base leg:",ht);return}let Zt=null;Ft<=3?Zt="lightblue":Ft<=10?Zt="lightgreen":Ft<=16?Zt="#f5f34f":Zt="#ffcccc",console.log("********* Landing Direction: ",a,"Effective Landing Wind Dir:",R);let Rt=0;a==="LL"?(Rt=(R+90)%360,console.log("Base Heading:",Rt)):a==="RR"&&(Rt=(R-90+360)%360,console.log("Base Heading:",Rt));const qt=T.calculateCourseFromHeading(Rt,rt,Ft,f),Kt=qt.trueCourse,At=qt.groundSpeed;let Ht=(Kt+180)%360;At<0&&(Ht=(Ht+180)%360,console.log("Base ground speed is negative:",At,"New course:",Ht));const he=(y-g)/p,Se=At*1.852/3.6*he;console.log("Base Course:",Kt);const Pe=T.calculateWindAngle(Kt,rt),{crosswind:wi,headwind:Li}=T.calculateWindComponents(Ft,Pe),Bn=T.calculateWCA(wi,f)*(wi>=0?1:-1),It=$(X[0],X[1],Ht,At,he);(X[0]+It[0])/2,(X[1]+It[1])/2;const Mi=[S+y,S+v],hn=T.calculateMeanWind(E,x,N,...Mi),je=hn[0],te=hn[1];if(!Number.isFinite(te)||!Number.isFinite(je)){console.warn("Invalid mean wind for downwind leg:",hn);return}let Re=null;te<=3?Re="lightblue":te<=10?Re="lightgreen":te<=16?Re="#f5f34f":Re="#ffcccc";const qe=R,ko=T.calculateWindAngle(qe,je),{crosswind:Un,headwind:bi}=T.calculateWindComponents(te,ko),Ti=T.calculateWCA(Un,f)*(Un>=0?1:-1),Si=T.normalizeAngle((qe-Ti+180)%360),dn=T.calculateCourseFromHeading(Si,je,te,f).groundSpeed,ki=(v-y)/p,Ke=dn*1.852/3.6*ki,ke=$(It[0],It[1],qe,dn,ki),Eo=[(M+X[0])/2,(b+X[1])/2],Ei=[(X[0]+It[0])/2,(X[1]+It[1])/2],Ci=[(It[0]+ke[0])/2,(It[1]+ke[1])/2];(It[0]+ke[0])/2,(It[1]+ke[1])/2,console.log(`Landing Pattern Updated:
        Final Leg: Wind: ${z.toFixed(1)}° @ ${B.toFixed(1)}kt, Course: ${nt.toFixed(1)}°, WCA: ${H.toFixed(1)}°, GS: ${tt.toFixed(1)}kt, HW: ${Lt.toFixed(1)}kt, Length: ${gt.toFixed(1)}m
        Base Leg: Wind: ${rt.toFixed(1)}° @ ${Ft.toFixed(1)}kt, Course: ${Kt.toFixed(1)}°, WCA: ${Bn.toFixed(1)}°, GS: ${At.toFixed(1)}kt, HW: ${Li.toFixed(1)}kt, Length: ${Se.toFixed(1)}m
        Downwind Leg: Wind: ${je.toFixed(1)}° @ ${te.toFixed(1)}kt, Course: ${qe.toFixed(1)}°, WCA: ${Ti.toFixed(1)}°, GS: ${dn.toFixed(1)}kt, HW: ${bi.toFixed(1)}kt, Length: ${Ke.toFixed(1)}m`);const xi=u.weatherData.time[o];console.log("+++++++++ Koordinaten Pattern:",xi),console.log("Coordinates DIP: ",M,b,"Altitude DIP:",S),console.log("Coordinates final end: ",X[0],X[1],"Leg Height:",S+g),console.log("Coordinates base end: ",It[0],It[1],"Leg Height:",S+y),console.log("Coordinates downwind end: ",ke[0],ke[1],"Leg Height:",S+v);const Co={legs:[{path:[[M,b],X],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}},{path:[X,It],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}},{path:[It,ke],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}}],arrows:[{position:Eo,bearing:(z-90+180)%360,color:Y,tooltipText:`${Math.round(z)}° ${F(B)}${_.getValue("windUnit","radio","kt")}`},{position:Ei,bearing:(ht[0]-90+180)%360,color:Zt,tooltipText:`${Math.round(rt)}° ${F(Ft)}${_.getValue("windUnit","radio","kt")}`},{position:Ci,bearing:(hn[0]-90+180)%360,color:Re,tooltipText:`${Math.round(je)}° ${F(te)}${_.getValue("windUnit","radio","kt")}`}]};si(Co)}function xt(){var r,c,l,d,f,p,g,y;if(console.log("updateJumpRunTrackDisplay called"),!u.map){console.warn("Map not initialized, cannot update jump run track display");return}if(!(_.state.userSettings.showJumpRunTrack&&u.weatherData&&u.lastLat&&u.lastLng&&_.state.isCalculateJumpUnlocked&&_.state.userSettings.calculateJump)){console.log("Conditions not met to show JRT, clearing display."),uo(null),u.lastTrackData=null;return}const e=Te(),o=un(e),a=yo(o);if(a&&((r=a.latlngs)==null?void 0:r.length)===2&&a.latlngs.every(v=>Number.isFinite(v[0])&&Number.isFinite(v[1]))){console.log("Drawing jump run track with data:",a);const v={path:{latlngs:a.latlngs,options:{color:"orange",weight:5,opacity:.8},tooltipText:`Jump Run Track: ${a.direction}°, Length: ${a.trackLength} m`,originalLatLngs:((l=(c=u.lastTrackData)==null?void 0:c.latlngs)==null?void 0:l.length)===2?u.lastTrackData.latlngs:a.latlngs},approachPath:((d=a.approachLatLngs)==null?void 0:d.length)===2&&a.approachLatLngs.every(M=>Number.isFinite(M[0])&&Number.isFinite(M[1]))?{latlngs:a.approachLatLngs,options:{color:"orange",weight:5,opacity:.8,dashArray:"5, 10"},tooltipText:`Approach Path: ${a.direction}°, Length: ${a.approachLength} m`,originalLatLngs:((p=(f=u.lastTrackData)==null?void 0:f.approachLatLngs)==null?void 0:p.length)===2?u.lastTrackData.approachLatLngs:a.approachLatLngs}:null,trackLength:a.trackLength,airplane:{position:L.latLng(a.latlngs[1][0],a.latlngs[1][1]),bearing:a.direction,originalPosition:(y=(g=u.lastTrackData)==null?void 0:g.latlngs)!=null&&y[1]&&Number.isFinite(u.lastTrackData.latlngs[1][0])?L.latLng(u.lastTrackData.latlngs[1][0],u.lastTrackData.latlngs[1][1]):L.latLng(a.latlngs[1][0],a.latlngs[1][1])}};uo(v),u.lastTrackData={latlngs:a.latlngs,approachLatLngs:a.approachLatLngs,direction:a.direction,trackLength:a.trackLength,approachLength:a.approachLength},console.log("Updated AppState.lastTrackData:",u.lastTrackData)}else console.warn("No valid track data to display:",a),uo(null),u.lastTrackData=null}let Oe=!1;function tc(){const n=document.getElementById("locationSearchInput"),e=document.getElementById("locationResults"),o=document.getElementById("saveCurrentLocationBtn");if(!n||!e||!o){console.error("Einige UI-Elemente für die Ortssuche wurden nicht gefunden.");return}const a=T.debounce(wf,300);n.addEventListener("input",()=>{a(n.value)}),n.addEventListener("focus",()=>{n.value.trim()||be(),e.style.display="block"}),n.addEventListener("blur",()=>{setTimeout(()=>{e.style.display="none"},200)}),o._clickHandler&&(o.removeEventListener("click",o._clickHandler),console.log("Entfernte bestehenden click-Listener für saveCurrentLocationBtn")),o._clickHandler=r=>{if(r.stopPropagation(),u.lastLat===null||u.lastLng===null){T.handleError("Please select a location on the map first.");return}if(Oe){console.log("saveFavoriteBtn Klick blockiert: Ein Favorit wird bereits hinzugefügt.");return}const c=`DIP at ${u.lastLat.toFixed(4)}, ${u.lastLng.toFixed(4)}`,l=prompt("Enter a name for this favorite:",c);if(l){Oe=!0;try{ec(u.lastLat,u.lastLng,l),Ka(u.lastLat,u.lastLng,l,!0)}finally{Oe=!1,console.log("saveFavoriteBtn Aktion abgeschlossen, Sperre aufgehoben.")}}},o.addEventListener("click",o._clickHandler),console.log("Neuer click-Listener für saveCurrentLocationBtn hinzugefügt"),document.addEventListener("click",r=>{!n.contains(r.target)&&!e.contains(r.target)&&(e.style.display="none")})}async function wf(n){if(console.log("performSearch: Suche nach:",n),!n.trim()){console.log("performSearch: Leere Eingabe, zeige Favoriten/Verlauf."),be();return}let e=[];const o=Lf(n);if(o)console.log("performSearch: Koordinaten gefunden:",o),e.push({display_name:`Koordinate: ${o.lat.toFixed(5)}, ${o.lng.toFixed(5)}`,lat:o.lat,lon:o.lng,type:"coordinate"}),be(e);else{console.log("performSearch: Keine Koordinaten, starte Nominatim-Suche.");try{const a=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(n)}&format=json&limit=5&addressdetails=1`,r=await fetch(a,{method:"GET",headers:{"User-Agent":"Skydiving-Weather-App/1.0 (anonymous)"}});if(!r.ok)throw new Error(`Nominatim API Fehler: ${r.statusText}`);const c=await r.json();console.log("performSearch: Nominatim Ergebnisse:",c),e=c,be(e)}catch(a){console.error("Fehler bei der Geocoding-Suche:",a),T.handleError("Could not find location."),be([])}}}function Lf(n){console.log("parseQueryAsCoordinates: Eingabe:",n);const e=n.trim(),a=e.replace(/[,;\t]+/," ").trim().match(/^(-?\d{1,3}(?:\.\d+)?)\s+(-?\d{1,3}(?:\.\d+)?)$/);if(a){const l=parseFloat(a[1]),d=parseFloat(a[3]);if(console.log("parseQueryAsCoordinates: Dezimalgraden erkannt:",{lat:l,lng:d}),l>=-90&&l<=90&&d>=-180&&d<=180)return{lat:l,lng:d};console.warn("parseQueryAsCoordinates: Ungültige Koordinatenbereiche:",{lat:l,lng:d})}const r=e.replace(/\s/g,"").toUpperCase(),c=/^[0-9]{1,2}[C-HJ-NP-X][A-HJ-NP-Z]{2}(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})$/;if(typeof Od>"u")return console.warn("parseQueryAsCoordinates: MGRS-Bibliothek nicht geladen."),null;if(c.test(r))try{const[l,d]=Ja(r);if(console.log("parseQueryAsCoordinates: MGRS erkannt:",{lat:d,lng:l}),!isNaN(d)&&!isNaN(l))return{lat:d,lng:l};console.warn("parseQueryAsCoordinates: Ungültige MGRS-Koordinaten:",{lat:d,lng:l})}catch(l){return console.warn("parseQueryAsCoordinates: MGRS-Parsing fehlgeschlagen:",l.message),null}return console.log("parseQueryAsCoordinates: Keine Koordinaten erkannt."),null}function be(n=[]){const e=document.getElementById("locationResults");if(!e){console.error("resultsList nicht gefunden.");return}e.innerHTML="";const o=vi(),a=o.filter(l=>l.isFavorite),r=o.filter(l=>!l.isFavorite);console.log("renderResultsList: Favoriten:",a),console.log("renderResultsList: Verlauf (nicht Favoriten):",r),console.log("renderResultsList: Suchergebnisse:",n);const c=l=>{const d=document.createElement("li"),f=parseFloat(l.lat),p=parseFloat(l.lng||l.lon);if(isNaN(f)||isNaN(p))return console.error("Ungültige Koordinaten in createListItem:",l),null;console.log("createListItem: Verarbeite Eintrag:",{lat:f,lng:p,label:l.display_name||l.label}),d.dataset.lat=f,d.dataset.lon=p;const g=document.createElement("span");g.className="location-name",g.textContent=l.display_name||l.label,d.appendChild(g),g.addEventListener("mousedown",b=>{const S=new CustomEvent("location:selected",{detail:{lat:f,lng:p},bubbles:!0,cancelable:!0});d.dispatchEvent(S),Ka(f,p,l.display_name||l.label,l.isFavorite||!1),e.style.display="none"});const y=document.createElement("div");y.className="location-item-buttons";const v=document.createElement("button");v.className="favorite-toggle",v.innerHTML=l.isFavorite?"★":"☆",l.isFavorite&&v.classList.add("is-favorite"),v.title="Als Favorit markieren/entfernen",y.appendChild(v),v.addEventListener("click",b=>{b.stopPropagation(),console.log("favToggle Klick für:",{lat:f,lng:p,label:l.display_name||l.label}),Mf(f,p,l.display_name||l.label)});const M=document.createElement("button");return M.className="delete-location-btn",M.textContent="×",M.title="Diesen Eintrag löschen",y.appendChild(M),M.addEventListener("click",b=>{b.stopPropagation(),confirm(`Möchten Sie "${l.display_name||l.label}" wirklich löschen?`)&&bf(f,p)}),d.appendChild(y),d};if(n.length>0){const l=document.createElement("li");l.className="results-heading",l.textContent="Results",l.style.fontWeight="bold",l.style.background="#f0f0f0",e.appendChild(l),n.forEach(d=>{const f=parseFloat(d.lat),p=parseFloat(d.lon),g=a.find(M=>Math.abs(M.lat-f)<.001&&Math.abs(M.lng-p)<.001);d.isFavorite=!!g,g&&(d.display_name=g.label);const y={lat:f,lng:p,display_name:d.display_name,isFavorite:d.isFavorite},v=c(y);v&&e.appendChild(v)})}if(a.length>0){const l=document.createElement("li");l.className="results-heading",l.textContent="Favorites",l.style.fontWeight="bold",l.style.background="#f0f0f0",e.appendChild(l),a.forEach(d=>{const f=c(d);f&&e.appendChild(f)})}if(r.length>0){const l=document.createElement("li");l.className="results-heading",l.textContent="Previous Locations",l.style.fontWeight="bold",l.style.background="#f0f0f0",e.appendChild(l),r.forEach(d=>{const f=c(d);f&&e.appendChild(f)})}console.log("renderResultsList: Liste gerendert.")}function vi(){try{return JSON.parse(localStorage.getItem("coordHistory"))||[]}catch{return[]}}function di(n){try{localStorage.setItem("coordHistory",JSON.stringify(n))}catch(e){console.error("Error saving history:",e)}}function Ka(n,e,o,a=!1){if(isNaN(n)||isNaN(e))return;let r=vi();const c=parseFloat(n.toFixed(5)),l=parseFloat(e.toFixed(5));r=r.filter(p=>Math.abs(p.lat-c)>1e-4||Math.abs(p.lng-l)>1e-4),r.unshift({lat:c,lng:l,label:o,isFavorite:a,timestamp:Date.now()});const d=r.filter(p=>p.isFavorite),f=r.filter(p=>!p.isFavorite).slice(0,5);di([...d,...f]),be()}function ec(n,e,o,a=!1){if(isNaN(n)||isNaN(e)){console.error("Ungültige Koordinaten in addOrUpdateFavorite:",{lat:n,lng:e});return}if(Oe){console.log("addOrUpdateFavorite blockiert.");return}Oe=!0;try{let r=vi();const c=parseFloat(n.toFixed(5)),l=parseFloat(e.toFixed(5));console.log("addOrUpdateFavorite: Verarbeite:",{newLat:c,newLng:l,name:o});const d=r.find(f=>Math.abs(f.lat-c)<1e-4&&Math.abs(f.lng-l)<1e-4);if(d)console.log("addOrUpdateFavorite: Aktualisiere bestehenden Eintrag:",d),d.isFavorite=!0,d.label=o;else{const f={lat:c,lng:l,label:o,isFavorite:!0,timestamp:Date.now()};console.log("addOrUpdateFavorite: Füge neuen Eintrag hinzu:",f),r.unshift(f)}di(r),console.log("addOrUpdateFavorite: Verlauf nach Speicherung:",JSON.stringify(r)),a||T.handleMessage(`"${o}" als Favorit gespeichert.`),be()}catch(r){console.error("Fehler in addOrUpdateFavorite:",r)}finally{Oe=!1,console.log("addOrUpdateFavorite abgeschlossen.")}}function Mf(n,e,o){if(isNaN(n)||isNaN(e)){console.error("Ungültige Koordinaten in toggleFavorite:",{lat:n,lng:e});return}if(Oe){console.log("toggleFavorite blockiert: Ein Favorit wird bereits hinzugefügt.");return}let a=vi();const r=parseFloat(n.toFixed(5)),c=parseFloat(e.toFixed(5));console.log("toggleFavorite: Suche nach Eintrag mit:",{newLat:r,newLng:c,label:o});const l=a.find(d=>{const f=parseFloat(d.lat),p=parseFloat(d.lng);return Math.abs(f-r)<1e-4&&Math.abs(p-c)<1e-4});if(l)if(console.log("toggleFavorite: Bestehender Eintrag gefunden:",l),l.isFavorite)l.isFavorite=!1,T.handleMessage(`"${l.label}" ist kein Favorit mehr.`),di(a),be();else{Oe=!0;try{const d=prompt("Please enter a name for this favorite:",l.label||o);if(d)l.isFavorite=!0,l.label=d,T.handleMessage(`"${d}" als Favorit gespeichert.`),di(a),be();else{l.isFavorite=!1;return}}finally{Oe=!1,console.log("toggleFavorite abgeschlossen, Sperre aufgehoben.")}}else{console.log("toggleFavorite: Kein bestehender Eintrag, füge neuen Favoriten hinzu.");const d=prompt("Please enter a name for this favorite:",o);d&&ec(r,c,d)}}function bf(n,e){if(isNaN(n)||isNaN(e))return;const a=vi().filter(r=>{const c=parseFloat(r.lat),l=parseFloat(r.lng||r.lon);return Math.abs(c-n)>1e-4||Math.abs(l-e)>1e-4});di(a),T.handleMessage("Location deleted."),be()}function Tf(n,e,o,a){if(!u.map)return console.warn("Map not initialized for getTooltipContent"),"Map not initialized";const r=_.getValue("coordFormat","radio","Decimal"),c=_.getValue("windUnit","radio","kt"),l=_.getValue("heightUnit","radio","m"),d=T.convertCoords(n.lat,n.lng,r);let f=r==="MGRS"?`MGRS: ${d.lat}`:`Lat: ${d.lat}<br>Lng: ${d.lng}`;const p=n.ele;let g=p!==null&&a!==null?p-a:null;if(g!==null){const M=l||_.state.userSettings.heightUnit||"m";g=T.convertHeight(g,M),g=Math.round(g),f+=`<br>Altitude: ${g} ${M} AGL`}else f+="<br>Altitude: N/A";let y="N/A",v="N/A";if(e>0&&n.time&&o[e-1].time&&n.ele!==null&&o[e-1].ele!==null){const M=(n.time.toMillis()-o[e-1].time.toMillis())/1e3;if(M>0){const S=u.map.distance([o[e-1].lat,o[e-1].lng],[n.lat,n.lng])/M;y=T.convertWind(S,c,"m/s"),y=c==="bft"?Math.round(y):y.toFixed(1),v=((n.ele-o[e-1].ele)/M).toFixed(1)}}return f+=`<br>Speed: ${y} ${c}`,f+=`<br>Descent Rate: ${v} m/s`,f}async function Sf(n){if(!u.map)return T.handleError("Map not initialized."),null;u.isLoadingGpx=!0;const e=new FileReader;return new Promise((o,a)=>{e.onload=async function(r){var c,l;try{const d=r.target.result,g=new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("trkpt"),y=[];for(let M=0;M<g.length;M++){const b=parseFloat(g[M].getAttribute("lat")),S=parseFloat(g[M].getAttribute("lon"));if(isNaN(b)||isNaN(S))continue;const k=(c=g[M].getElementsByTagName("ele")[0])==null?void 0:c.textContent,E=(l=g[M].getElementsByTagName("time")[0])==null?void 0:l.textContent;y.push({lat:b,lng:S,ele:k?parseFloat(k):null,time:E?J.fromISO(E,{zone:"utc"}):null})}if(y.length<2)throw new Error("GPX track has insufficient points.");const v=await nc(y,n.name);o(v)}catch(d){console.error("[trackManager] Error in loadGpxTrack:",d),T.handleError("Error parsing GPX file: "+d.message),o(null)}finally{u.isLoadingGpx=!1}},e.onerror=()=>{T.handleError("Error reading GPX file."),u.isLoadingGpx=!1,a(new Error("Error reading GPX file."))},e.readAsText(n)})}async function Pf(n){if(!u.map)return T.handleError("Map not initialized."),null;u.isLoadingGpx=!0;const e=new FileReader;return new Promise((o,a)=>{e.onload=async function(r){try{const c=r.target.result,l=[];(void 0)(c,{skipEmptyLines:!0,step:function(d){const f=d.data;if(f[0]&&f[0].toUpperCase()==="$GNSS"&&f.length>=5){let p=f[1];const g=parseFloat(f[2]),y=parseFloat(f[3]),v=parseFloat(f[4]);if(isNaN(g)||isNaN(y)||isNaN(v))return;let M=null;try{M=J.fromISO(p,{setZone:!0}).toUTC(),M.isValid||(M=null)}catch{M=null}l.push({lat:g,lng:y,ele:v,time:M})}},complete:async function(){if(l.length<2)throw new Error("CSV track has insufficient points.");const d=await nc(l,n.name);o(d)},error:function(d){throw new Error("Error parsing CSV: "+d.message)}})}catch(c){console.error("[trackManager] Error in loadCsvTrackUTC:",c),T.handleError("Error parsing CSV file: "+c.message),o(null)}finally{u.isLoadingGpx=!1}},e.onerror=()=>{T.handleError("Error reading CSV file."),u.isLoadingGpx=!1,a(new Error("Error reading CSV file."))},e.readAsText(n)})}async function nc(n,e){try{if(console.log(`[trackManager] renderTrack called for ${e} with ${n.length} points.`),!u.map)return console.warn("[trackManager] Map object in AppState is not available in renderTrack."),T.handleError("Map not initialized. Cannot render track."),null;u.gpxLayer&&u.map.hasLayer(u.gpxLayer)&&u.map.removeLayer(u.gpxLayer),u.gpxLayer=null,u.gpxPoints=n,u.isTrackLoaded=!1;const o={finalPointData:null,timestampToUseForWeather:null,historicalDateString:null,summaryForInfoElement:"",success:!1};if(n.length>0){const r=n[n.length-1];if(u.lastLat=r.lat,u.lastLng=r.lng,u.lastAltitude=await T.getAltitude(u.lastLat,u.lastLng),o.finalPointData={lat:u.lastLat,lng:u.lastLng,altitude:u.lastAltitude},n[0].time&&n[0].time.isValid){const g=n[0].time,y=J.utc().startOf("day"),v=g.startOf("day");v<y&&(o.historicalDateString=v.toFormat("yyyy-MM-dd"));let M=g.startOf("hour");g.minute>=30&&(M=M.plus({hours:1})),o.timestampToUseForWeather=M.toISO()}const c=(n.reduce((g,y,v)=>{if(v===0||!u.map)return 0;const M=n[v-1];return g+u.map.distance([M.lat,M.lng],[y.lat,y.lng])},0)/1e3).toFixed(2),l=n.map(g=>g.ele).filter(g=>g!==null),d=l.length?Math.min(...l).toFixed(0):"N/A",f=l.length?Math.max(...l).toFixed(0):"N/A",p=new CustomEvent("track:loaded",{detail:{lat:u.lastLat,lng:u.lastLng,altitude:u.lastAltitude,timestamp:o.timestampToUseForWeather,historicalDate:o.historicalDateString,summary:`<br><strong>Track:</strong> Distance: ${c} km, Min Elevation: ${d} m, Max Elevation: ${f} m (Source: ${e})`},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(p)}u.gpxLayer=(void 0)([],{pane:"gpxTrackPane"});const a=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null;for(let r=0;r<n.length-1;r++){const c=n[r],l=n[r+1],d=c.ele,f=l.ele;let p="#808080";if(a!==null&&d!==null&&f!==null){const y=d-a,v=f-a,M=(y+v)/2;p=T.interpolateColor(M)}const g=(void 0)([[c.lat,c.lng],[l.lat,l.lng]],{color:p,weight:4,opacity:.75,pane:"gpxTrackPane"}).bindTooltip("",{sticky:!0});g.on("mousemove",function(y){const v=y.latlng;let M=n[0],b=1/0,S=0;n.forEach((k,E)=>{const C=Math.sqrt(Math.pow(k.lat-v.lat,2)+Math.pow(k.lng-v.lng,2));C<b&&(b=C,M=k,S=E)}),g.setTooltipContent(Tf(M,S,n,a)).openTooltip(v)}),u.gpxLayer.addLayer(g)}if(u.map&&u.gpxLayer.addTo(u.map),u.isTrackLoaded=!0,n.length>0&&u.map){const r=(void 0)(n.map(c=>[c.lat,c.lng]));r.isValid()?u.map.fitBounds(r,{padding:[50,50],maxZoom:u.map.getMaxZoom()||18}):T.handleError("Unable to display track: invalid coordinates.")}return o.success=!0,console.log("[trackManager] renderTrack finished successfully."),o}catch(o){return console.error("[trackManager] Error in renderTrack:",o),T.handleError("Error rendering track: "+o.message),u.gpxPoints=[],u.gpxLayer&&u.map&&u.map.hasLayer(u.gpxLayer)&&u.map.removeLayer(u.gpxLayer),u.gpxLayer=null,u.isTrackLoaded=!1,{success:!1,error:o.message}}}function kf(n,e){return(void 0)([n,e],{icon:(void 0)({className:"live-marker",html:'<div style="background-color: blue; width: 10px; height: 10px; border-radius: 50%;"></div>',iconSize:[10,10],iconAnchor:[5,5]}),zIndexOffset:1e3})}function Ef(n,e,o){u.accuracyCircle&&u.map.removeLayer(u.accuracyCircle),u.accuracyCircle=(void 0)([n,e],{radius:o,color:"blue",fillOpacity:.1,weight:1,dashArray:"5, 5"}).addTo(u.map)}const Cf=T.debounce(async n=>{if(console.log("[LiveTrackingManager] Received position data:",n),!u.map){console.warn("[LiveTrackingManager] Map not initialized, skipping position update.");return}const{latitude:e,longitude:o,accuracy:a,altitude:r,altitudeAccuracy:c}=n.coords;if(console.log("[LiveTrackingManager] Position details:",{latitude:e,longitude:o,accuracy:a,deviceAltitude:r,altitudeAccuracy:c}),a>le.GEOLOCATION_ACCURACY_THRESHOLD_M){console.log("[LiveTrackingManager] Skipping position update due to low accuracy:",a);return}const l=Date.now();let d=0,f="N/A";if(u.prevLat!==null&&u.prevLng!==null&&u.prevTime!==null){const y=u.map.distance([u.prevLat,u.prevLng],[e,o]),v=(l-u.prevTime)/1e3;v>to.MIN_TIME_DIFF_FOR_SPEED_CALC_S&&(d=y/v,f=T.calculateBearing(u.prevLat,u.prevLng,e,o).toFixed(0))}const p=d<to.SPEED_SMOOTHING_TRESHOLD?to.SPEED_SMOOTHING_LOW:to.SPEED_SMOOTHING_HIGH;u.lastSmoothedSpeedMs=p*d+(1-p)*u.lastSmoothedSpeedMs,u.liveMarker?u.liveMarker.setLatLng([e,o]):u.liveMarker=kf(e,o).addTo(u.map),a&&Ef(e,o,a),u.prevLat=e,u.prevLng=o,u.prevTime=l;const g=new CustomEvent("tracking:positionUpdated",{detail:{latitude:e,longitude:o,deviceAltitude:r,altitudeAccuracy:c,accuracy:a,speedMs:u.lastSmoothedSpeedMs,direction:f},bubbles:!0,cancelable:!0});console.log("[LiveTrackingManager] Dispatching tracking:positionUpdated event:",g.detail),document.dispatchEvent(g)},300);function xf(){if(u.watchId===null){if(!navigator.geolocation){T.handleError("Geolocation is not supported by your browser."),document.dispatchEvent(new CustomEvent("tracking:stopped"));return}console.log("[LiveTrackingManager] Starting position tracking..."),u.watchId=navigator.geolocation.watchPosition(Cf,n=>{T.handleError(`Geolocation error: ${n.message}`),ic()},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),document.dispatchEvent(new CustomEvent("tracking:started"))}}function ic(){u.watchId!==null&&(navigator.geolocation.clearWatch(u.watchId),u.watchId=null),u.liveMarker&&u.map.removeLayer(u.liveMarker),u.accuracyCircle&&u.map.removeLayer(u.accuracyCircle),u.liveMarker=null,u.accuracyCircle=null,u.prevLat=null,u.prevLng=null,u.prevTime=null,u.lastSmoothedSpeedMs=0,document.dispatchEvent(new CustomEvent("tracking:stopped")),console.log("[LiveTrackingManager] Stopped position tracking and cleaned up.")}function Nr(){if(u.autoupdateInterval){console.log("[AutoupdateManager] Autoupdate is already running.");return}if(!navigator.onLine){T.handleError("Cannot enable autoupdate while offline.");const n=document.getElementById("autoupdateCheckbox");n&&(n.checked=!1),_.state.userSettings.autoupdate=!1,_.save();return}console.log("[AutoupdateManager] Starting autoupdate interval."),document.dispatchEvent(new CustomEvent("autoupdate:tick",{detail:{isInitialTick:!0}})),u.autoupdateInterval=setInterval(()=>{console.log("[AutoupdateManager] Tick..."),document.dispatchEvent(new CustomEvent("autoupdate:tick",{detail:{isInitialTick:!1}}))},60*1e3),se("Autoupdate enabled")}function oc(){u.autoupdateInterval&&(clearInterval(u.autoupdateInterval),u.autoupdateInterval=null,console.log("[AutoupdateManager] Stopped autoupdate interval."),se("Autoupdate disabled"))}function Af(){var e;const n=document.getElementById("autoupdateCheckbox");if(!n){console.warn("[AutoupdateManager] Autoupdate checkbox not found.");return}n.checked=_.state.userSettings.autoupdate,n.addEventListener("change",()=>{_.state.userSettings.autoupdate=n.checked,_.save();const o=document.getElementById("historicalDatePicker");if(n.checked&&(o!=null&&o.value)){n.checked=!1,_.state.userSettings.autoupdate=!1,_.save(),Nn("Autoupdate cannot be enabled with a historical date set.");return}n.checked?Nr():oc()}),_.state.userSettings.autoupdate&&!((e=document.getElementById("historicalDatePicker"))!=null&&e.value)&&Nr()}window.L=Gl;function ac(n,e={}){console.log(`[EventManager] Dispatching event: ${n}`,e);const o=new CustomEvent(n,{detail:e,bubbles:!0,cancelable:!0});document.dispatchEvent(o)}const ri=()=>_.getValue("heightUnit","radio","m"),ga=()=>_.getValue("windUnit","radio","kt"),sc=()=>_.getValue("coordFormat","radio","Decimal");function kn(n,e,o){console.log(`setupCheckbox called for id: ${n}`);const a=document.getElementById(n);a?(a._changeHandler&&(a.removeEventListener("change",a._changeHandler),console.log(`Removed previous change listener for ${n}`)),a._changeHandler=r=>{console.log(`Change event fired for ${n}, checked: ${a.checked}, event:`,r),r.stopPropagation(),o(a)},a.addEventListener("change",a._changeHandler),a.addEventListener("click",r=>{console.log(`Click event on ${n}, checked: ${a.checked}, target:`,r.target)}),console.log(`Attached change and click listeners to ${n}`),n==="showLandingPattern"&&!(_.isFeatureUnlocked("landingPattern")&&_.state.isLandingPatternUnlocked)&&(a.style.opacity="0.5",a.title="Feature locked. Click to enter password.")):console.warn(`Checkbox ${n} not found`)}function _a(n,e,o){if(console.log(`toggleSubmenu called for ${n.textContent||n.id}: ${o?"show":"hide"}`),e){e.classList.contains("submenu")||e.classList.add("submenu"),e.classList.toggle("hidden",!o),n.setAttribute("aria-expanded",o),console.log(`Submenu toggled for ${n.textContent||n.id}: ${o?"shown":"hidden"}`);let a=0;const r=5,c=()=>{const l={isHidden:e.classList.contains("hidden"),displayStyle:window.getComputedStyle(e).display};o&&(l.isHidden||l.displayStyle==="none")&&(console.warn(`Submenu for ${n.textContent||n.id} was hidden unexpectedly. Forcing it to be visible.`),e.classList.remove("hidden"),e.style.display="block",a++,a<r&&setTimeout(c,100))};setTimeout(c,100)}else console.warn(`Submenu for ${n.textContent||n.id} not found`)}function Ie(n,e){document.querySelectorAll(`input[name="${n}"]`).forEach(a=>{a.addEventListener("change",()=>{const r=_.getValue(n,"radio",_.defaultSettings[n]);if(_.state.userSettings[n]=r,_.save(),console.log(`${n} changed to: ${r} and saved to localStorage`),n==="landingDirection"){const c=document.getElementById("customLandingDirectionLL"),l=document.getElementById("customLandingDirectionRR"),d=_.state.userSettings.landingDirection;c&&(c.disabled=d!=="LL"),l&&(l.disabled=d!=="RR"),d==="LL"&&c&&!c.value&&_.state.userSettings.customLandingDirectionLL===""&&(c.value=Math.round(u.landingWindDir||0),_.state.userSettings.customLandingDirectionLL=parseInt(c.value),_.save(),console.log(`Set customLandingDirectionLL to ${c.value}`)),d==="RR"&&l&&!l.value&&_.state.userSettings.customLandingDirectionRR===""&&(l.value=Math.round(u.landingWindDir||0),_.state.userSettings.customLandingDirectionRR=parseInt(l.value),_.save(),console.log(`Set customLandingDirectionRR to ${l.value}`))}e()})})}function Ot(n,e,o,a){const r=document.getElementById(n);if(!r){console.warn(`Input element ${n} not found`);return}r.addEventListener(e,T.debounce(()=>{const c=r.type==="number"?parseFloat(r.value):r.value;_.state.userSettings[n]=c,_.save(),console.log(`${n} changed to: ${c} and saved to localStorage`),a(c)},o))}function ya(n,e){const o=document.getElementById(n);if(!o){console.warn(`Input element ${n} not found`);return}o.addEventListener("blur",()=>{const a=parseInt(o.value)||e;console.log(`Attempting to update ${n} to ${a}`),_.state.userSettings[n]=a,_.save();const r=document.getElementById("legHeightFinal"),c=document.getElementById("legHeightBase"),l=document.getElementById("legHeightDownwind");if(!isNaN(a)&&a>=50&&a<=1e3&&Qf(r,c,l))console.log(`Valid ${n}: ${a}, updating displays`),jt(),u.weatherData&&u.lastLat&&u.lastLng&&n==="legHeightDownwind"&&_.state.userSettings.calculateJump&&We();else{let d=e;const f=parseInt(r==null?void 0:r.value)||100,p=parseInt(c==null?void 0:c.value)||200,g=parseInt(l==null?void 0:l.value)||300;n==="legHeightFinal"&&(d=Math.min(p-1,100)),n==="legHeightBase"&&(d=Math.max(f+1,Math.min(g-1,200))),n==="legHeightDownwind"&&(d=Math.max(p+1,300)),o.value=d,_.state.userSettings[n]=d,_.save(),console.log(`Adjusted ${n} to ${d} due to invalid input`),T.handleError(`Adjusted ${n} to ${d} to maintain valid leg order.`)}})}function If(){console.log("setupMenuEvents wird aufgerufen für allgemeine Menü-Logik.");const n=document.getElementById("hamburgerBtn"),e=document.getElementById("menu");!n||!e||(n.addEventListener("click",o=>{o.stopPropagation(),e.classList.toggle("hidden")}),document.addEventListener("click",o=>{!e.contains(o.target)&&!n.contains(o.target)&&e.classList.add("hidden")}),e.addEventListener("click",o=>{const a=o.target;if(a.matches("li > span")||a.matches("li > label")){o.preventDefault(),o.stopPropagation();const c=a.closest("li").querySelector("ul.submenu");c&&c.classList.toggle("hidden")}}))}function Df(){if(!u.map){console.warn("Map not initialized, skipping setupCheckboxEvents");return}kn("showTableCheckbox","showTable",l=>{_.state.userSettings.showTable=l.checked,_.save(),console.log("showTableCheckbox changed:",l.checked);const d=document.getElementById("info");d&&(d.style.display=l.checked?"block":"none",console.log("Info display set to:",d.style.display)),l.checked&&u.weatherData&&u.lastLat&&u.lastLng&&Po(Te()),On()}),kn("showExitAreaCheckbox","showExitArea",l=>{_.state.userSettings.showExitArea=l.checked,_.save(),console.log("Show Exit Area set to:",_.state.userSettings.showExitArea),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&Qt()}),kn("showCanopyAreaCheckbox","showCanopyArea",l=>{_.state.userSettings.showCanopyArea=l.checked,_.save(),console.log("Show Canopy Area set to:",_.state.userSettings.showCanopyArea),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&Qt()}),kn("showJumpRunTrack","showJumpRunTrack",l=>{if(_.state.userSettings.showJumpRunTrack=l.checked,_.save(),l.checked=_.state.userSettings.showJumpRunTrack,console.log("showJumpRunTrack changed:",l.checked),l.checked&&u.weatherData&&u.lastLat&&u.lastLng&&_.state.isCalculateJumpUnlocked&&_.state.userSettings.calculateJump)Xf();else{u.jumpRunTrackLayer&&(u.jumpRunTrackLayer.airplaneMarker&&u.map&&typeof u.map.removeLayer=="function"&&(u.map.removeLayer(u.jumpRunTrackLayer.airplaneMarker),u.jumpRunTrackLayer.airplaneMarker=null),u.jumpRunTrackLayer.approachLayer&&u.map&&typeof u.map.removeLayer=="function"&&(u.map.removeLayer(u.jumpRunTrackLayer.approachLayer),u.jumpRunTrackLayer.approachLayer=null),u.map&&typeof u.map.removeLayer=="function"&&u.map.removeLayer(u.jumpRunTrackLayer),u.jumpRunTrackLayer=null,console.log("Removed JRT polyline"));const d=document.getElementById("jumpRunTrackDirection");if(d){const f=yo();d.value=f?f.direction:"",console.log("Updated jumpRunTrackDirection value:",(f==null?void 0:f.direction)||"")}}}),kn("showCutAwayFinder","showCutAwayFinder",l=>{var f;_.state.userSettings.showCutAwayFinder=l.checked,_.save(),console.log("Show Cut Away Finder set to:",l.checked);const d=(f=l.closest("li"))==null?void 0:f.querySelector("ul.submenu");l.checked?d&&d.classList.remove("hidden"):(d&&d.classList.add("hidden"),hf(),u.cutAwayLat=null,u.cutAwayLng=null),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&Qt()}),kn("showLandingPattern","showLandingPattern",l=>{const d="landingPattern",f=()=>{var y;_.state.userSettings.showLandingPattern=!0,_.save();const g=(y=l.closest("li"))==null?void 0:y.querySelector("ul");_a(l,g,!0),Je()},p=()=>{var y;_.state.userSettings.showLandingPattern=!1,_.save(),l.checked=!1;const g=(y=l.closest("li"))==null?void 0:y.querySelector("ul");_a(l,g,!1),si(null)};l.checked?_.isFeatureUnlocked(d)?f():_.showPasswordModal(d,f,p):p()});const n=document.getElementById("showJumpMasterLine");n&&(n.disabled=!_.state.userSettings.trackPosition,n.style.opacity=n.disabled?"0.5":"1",n.addEventListener("change",()=>{var f;const l=n.checked;if(l&&n.disabled){n.checked=!1,T.handleError("Please start Live Tracking first.");return}_.state.userSettings.showJumpMasterLine=l,_.save(),ac("ui:showJumpMasterLineChanged",{isChecked:l});const d=(f=n.closest("li"))==null?void 0:f.querySelector("ul.submenu");d&&_a(n,d,l)}));const e=document.getElementById("trackPositionCheckbox");e&&e.addEventListener("change",()=>{const l=e.checked;_.state.userSettings.trackPosition=l,_.save(),l?xf():ic()});const o=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');o&&(o.disabled=!_.state.userSettings.harpLat||!_.state.userSettings.harpLng,console.log("HARP radio button initialized, disabled:",o.disabled));const a=document.getElementById("placeHarpButton");a&&a.addEventListener("click",()=>{u.isPlacingHarp=!0,console.log("HARP placement mode activated"),u.map.on("click",Ql),T.handleMessage("Click the map to place the HARP marker")});const r=document.getElementById("clearHarpButton");r&&r.addEventListener("click",vf);const c=document.querySelector(".hamburger-menu");c&&c.addEventListener("click",l=>{console.log("Menu click:",l.target,"class:",l.target.className,"id:",l.target.id)})}function Nf(){const n=document.getElementById("timeSlider");if(!n){console.warn("Time slider not found:",{id:"timeSlider"});return}n.addEventListener("input",async()=>{var o,a,r;const e=parseInt(n.value)||0;if(console.log("Time slider moved to index:",e),u.weatherData&&u.lastLat&&u.lastLng)await Po(e),await So(),u.lastAltitude!=="N/A"&&fi(),_.state.userSettings.showLandingPattern&&(console.log("Updating landing pattern for slider index:",e),Je()),_.state.userSettings.calculateJump&&(console.log("Recalculating jump for slider index:",e),Qt(),De()),_.state.userSettings.showJumpRunTrack&&(console.log("Updating jump run track for slider index:",e),xt()),Ne();else{let c="N/A";if((a=(o=u.weatherData)==null?void 0:o.time)!=null&&a[e])c=await T.getDisplayTime(u.weatherData.time[e],u.lastLat,u.lastLng);else if(u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0){const d=Object.keys(u.ensembleModelsData)[0],f=(r=u.ensembleModelsData[d])==null?void 0:r.time;f!=null&&f[e]&&(c=await T.getDisplayTime(f[e],u.lastLat,u.lastLng))}const l=document.getElementById("selectedTime");l&&(l.innerHTML=`Selected Time: ${c}`)}_.state.userSettings.selectedEnsembleModels&&_.state.userSettings.selectedEnsembleModels.length>0&&(console.log("Time slider change triggering ensemble update for index:",e),u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0?go():console.warn("Ensemble update skipped: AppState.ensembleModelsData is not populated yet."))}),n.addEventListener("change",async()=>{var r,c,l;const e=parseInt(n.value)||0;let o="N/A";if((c=(r=u.weatherData)==null?void 0:r.time)!=null&&c[e])o=await T.getDisplayTime(u.weatherData.time[e],u.lastLat,u.lastLng);else if(u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0){const d=Object.keys(u.ensembleModelsData)[0],f=(l=u.ensembleModelsData[d])==null?void 0:l.time;f!=null&&f[e]&&(o=await T.getDisplayTime(f[e],u.lastLat,u.lastLng))}const a=document.getElementById("selectedTime");a&&(a.innerHTML=`Selected Time: ${o}`,console.log("Time slider change event, updated selectedTime label to:",o))})}function Of(){const n=document.getElementById("modelSelect");if(!n){console.warn("modelSelect element not found");return}n.addEventListener("change",async()=>{var e,o;if(console.log("Model select changed to:",n.value),_.state.userSettings.model=n.value,_.save(),u.lastLat&&u.lastLng){const a=Te(),r=((o=(e=u.weatherData)==null?void 0:e.time)==null?void 0:o[a])||null,c=await cn(u.lastLat,u.lastLng,r);c&&await uc(c)}else T.handleError("Please select a position on the map first.")})}function Ff(){if(Ie("refLevel",()=>{_.updateUnitLabels(),jt()}),Ie("heightUnit",()=>{if(_.updateUnitLabels(),jt(),Ne(),u.lastMouseLatLng&&u.coordsControl){const a=sc(),r=u.lastMouseLatLng.lat,c=u.lastMouseLatLng.lng;let l;a==="MGRS"?l=`MGRS: ${T.decimalToMgrs(r,c)}`:l=`Lat: ${r.toFixed(5)}, Lng: ${c.toFixed(5)}`,lc(r,c,{lat:r,lng:c},(d,f)=>{if(u.lastMouseLatLng){const p=Math.abs(u.lastMouseLatLng.lat-f.lat),g=Math.abs(u.lastMouseLatLng.lng-f.lng),y=.05;if(p<y&&g<y){const v=ri();let M=d==="N/A"?"N/A":d;M!=="N/A"&&(M=T.convertHeight(M,v),M=Math.round(M)),console.log("Updating elevation display after heightUnit change:",{lat:r,lng:c,elevation:d,heightUnit:v,displayElevation:M}),u.coordsControl.update(`${l}<br>Elevation: ${M} ${M==="N/A"?"":v}`)}}})}if(u.gpxLayer&&u.gpxPoints.length>0){const a=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null,r=ga(),c=ri();u.gpxLayer.eachLayer(l=>{l instanceof void 0&&l.on("mousemove",function(d){const f=d.latlng;let p=u.gpxPoints[0],g=1/0,y=0;u.gpxPoints.forEach((v,M)=>{const b=Math.sqrt(Math.pow(v.lat-f.lat,2)+Math.pow(v.lng-f.lng,2));b<g&&(g=b,p=v,y=M)}),l.setTooltipContent(getTooltipContent(p,y,u.gpxPoints,a,r,c)).openTooltip(f)})})}}),Ie("temperatureUnit",()=>{jt()}),Ie("windUnit",()=>{if(_.updateUnitLabels(),jt(),Ne(),u.gpxLayer&&u.gpxPoints.length>0){const a=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null,r=ga(),c=ri();u.gpxLayer.eachLayer(l=>{l instanceof void 0&&l.on("mousemove",function(d){const f=d.latlng;let p=u.gpxPoints[0],g=1/0,y=0;u.gpxPoints.forEach((v,M)=>{const b=Math.sqrt(Math.pow(v.lat-f.lat,2)+Math.pow(v.lng-f.lng,2));b<g&&(g=b,p=v,y=M)}),l.setTooltipContent(getTooltipContent(p,y,u.gpxPoints,a,r,c)).openTooltip(f)})})}}),Ie("timeZone",async()=>{jt()}),Ie("coordFormat",()=>{u.lastLat&&u.lastLng&&So(),Ne()}),Ie("downloadFormat",()=>{console.log("Download format changed:",rc())}),Ie("landingDirection",()=>{const a=document.getElementById("customLandingDirectionLL"),r=document.getElementById("customLandingDirectionRR"),c=_.state.userSettings.landingDirection;console.log("landingDirection changed:",{landingDirection:c,customLL:a==null?void 0:a.value,customRR:r==null?void 0:r.value}),a&&(a.disabled=c!=="LL",c==="LL"&&!a.value&&u.landingWindDir!==null&&(a.value=Math.round(u.landingWindDir),_.state.userSettings.customLandingDirectionLL=parseInt(a.value),_.save())),r&&(r.disabled=c!=="RR",c==="RR"&&!r.value&&u.landingWindDir!==null&&(r.value=Math.round(u.landingWindDir),_.state.userSettings.customLandingDirectionRR=parseInt(r.value),_.save())),cc(),jt()}),Ie("jumpMasterLineTarget",()=>{_.state.userSettings.jumpMasterLineTarget=_.getValue("jumpMasterLineTarget","radio","DIP"),_.save(),console.log("jumpMasterLineTarget changed:",_.state.userSettings.jumpMasterLineTarget),ac("jml:targetChanged");const a=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');a&&(a.disabled=!u.harpMarker||_.state.userSettings.harpLat===null||_.state.userSettings.harpLng===null,console.log("HARP radio button disabled:",a.disabled))}),u.gpxLayer&&u.gpxPoints.length>0){const a=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null,r=ga(),c=ri();u.gpxLayer.eachLayer(l=>{l instanceof void 0&&l.on("mousemove",function(d){const f=d.latlng;let p=u.gpxPoints[0],g=1/0,y=0;u.gpxPoints.forEach((v,M)=>{const b=Math.sqrt(Math.pow(v.lat-f.lat,2)+Math.pow(v.lng-f.lng,2));b<g&&(g=b,p=v,y=M)}),l.setTooltipContent(getTooltipContent(p,y,u.gpxPoints,a,r,c)).openTooltip(f)})})}document.querySelectorAll('input[name="ensembleScenario"]').forEach(a=>{a.addEventListener("change",()=>{if(a.checked)if(_.state.userSettings.currentEnsembleScenario=a.value,u.currentEnsembleScenario=a.value,_.save(),console.log("Ensemble scenario changed to:",a.value),_.state.userSettings.selectedEnsembleModels.length>0){const r=_.state.userSettings.selectedEnsembleModels.every(c=>u.ensembleModelsData&&u.ensembleModelsData[c]);!r&&a.value!=="all_models"?Va():!r&&a.value==="all_models"&&u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0||r?go():(T.handleMessage("Please select models and ensure data is fetched."),rn())}else a.value!=="all_models"&&T.handleMessage("Please select models from the 'Ensemble > Models' menu first."),rn()})});const e=_.state.userSettings.currentEnsembleScenario||"all_models",o=document.querySelector(`input[name="ensembleScenario"][value="${e}"]`);o&&(o.checked=!0,u.currentEnsembleScenario=e),u.map&&!u.ensembleLayerGroup&&(u.ensembleLayerGroup=(void 0)().addTo(u.map))}function Rf(){Ot("lowerLimit","change",300,n=>{u.weatherData&&u.lastLat&&u.lastLng&&u.lastAltitude!=="N/A"&&fi()}),Ot("upperLimit","change",300,n=>{u.weatherData&&u.lastLat&&u.lastLng&&u.lastAltitude!=="N/A"&&fi()}),Ot("openingAltitude","change",300,n=>{!isNaN(n)&&n>=500&&n<=15e3?_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&(We(),De()):(T.handleError("Opening altitude must be between 500 and 15000 meters."),yt("openingAltitude",1200),_.state.userSettings.openingAltitude=1200,_.save())}),Ot("exitAltitude","change",300,n=>{!isNaN(n)&&n>=500&&n<=15e3?_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&We():(T.handleError("Exit altitude must be between 500 and 15000 meters."),yt("exitAltitude",3e3),_.state.userSettings.exitAltitude=3e3,_.save())}),Ot("canopySpeed","change",300,n=>{!isNaN(n)&&n>=5&&n<=50?jt():(T.handleError("Canopy speed must be between 5 and 50 kt."),yt("canopySpeed",20),_.state.userSettings.canopySpeed=20,_.save())}),Ot("descentRate","change",300,n=>{!isNaN(n)&&n>=1&&n<=10?jt():(T.handleError("Descent rate must be between 1 and 10 m/s."),yt("descentRate",3),_.state.userSettings.descentRate=3,_.save())}),Ot("interpStepSelect","change",300,n=>{jt()}),ya("legHeightFinal",100),ya("legHeightBase",200),ya("legHeightDownwind",300),Ot("customLandingDirectionLL","input",100,n=>{const e=parseInt(n,10);console.log("customLandingDirectionLL input:",{value:n,customDir:e}),!isNaN(e)&&e>=0&&e<=359?(_.state.userSettings.customLandingDirectionLL=e,_.save(),_.state.userSettings.landingDirection==="LL"&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating landing pattern for LL:",e),Je(),On())):(T.handleError("Landing direction must be between 0 and 359°."),yt("customLandingDirectionLL",_.state.userSettings.customLandingDirectionLL||0))}),Ot("customLandingDirectionRR","input",100,n=>{const e=parseInt(n,10);console.log("customLandingDirectionRR input:",{value:n,customDir:e}),!isNaN(e)&&e>=0&&e<=359?(_.state.userSettings.customLandingDirectionRR=e,_.save(),_.state.userSettings.landingDirection==="RR"&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating landing pattern for RR:",e),Je(),On())):(T.handleError("Landing direction must be between 0 and 359°."),yt("customLandingDirectionRR",_.state.userSettings.customLandingDirectionRR||0))}),Ot("jumpRunTrackDirection","change",0,n=>{const e=parseInt(n,10);if(console.log("jumpRunTrackDirection change event:",{value:n,customDir:e,jumpRunTrackOffset:_.state.userSettings.jumpRunTrackOffset}),!isNaN(e)&&e>=0&&e<=359)u.customJumpRunDirection=e,console.log("Set custom direction from input:",e),u.weatherData&&u.lastLat&&u.lastLng?(_.state.userSettings.showJumpRunTrack&&(console.log("Updating JRT for custom direction input"),xt()),_.state.userSettings.calculateJump&&(console.log("Recalculating jump for custom JRT direction"),We(),De())):console.warn("Cannot update JRT or jump: missing conditions",{weatherData:!!u.weatherData,lastLat:u.lastLat,lastLng:u.lastLng});else{console.log("Invalid direction input, resetting to calculated"),T.handleError("Jump run direction must be between 0 and 359°."),u.customJumpRunDirection=null;const o=document.getElementById("jumpRunTrackDirection");o&&o.addEventListener("change",()=>{const a=parseFloat(o.value);Number.isFinite(a)&&a>=0&&a<=359?(_.state.userSettings.customJumpRunDirection=a,console.log("Setting 'customJumpRunDirection' on change to:",a)):(_.state.userSettings.customJumpRunDirection=null,o.value="",console.log("Invalid direction, resetting to calculated.")),_.save(),xt()}),u.weatherData&&u.lastLat&&u.lastLng&&(_.state.userSettings.showJumpRunTrack&&(console.log("Updating JRT for invalid direction input"),xt()),_.state.userSettings.calculateJump&&(console.log("Recalculating jump for reset JRT direction"),We(),De()))}}),Ot("jumpRunTrackOffset","change",0,n=>{const e=parseInt(n,10);if(console.log("jumpRunTrackOffset change event:",{value:n,offset:e}),!isNaN(e)&&e>=-5e4&&e<=5e4&&e%100===0)_.state.userSettings.jumpRunTrackOffset=e,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating JRT for offset change"),xt());else{T.handleError("Offset must be between -50000 and 50000 in steps of 100.");const o=document.getElementById("jumpRunTrackOffset");o&&(o.value=0),_.state.userSettings.jumpRunTrackOffset=0,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&(console.log("Resetting JRT for invalid offset"),xt())}}),Ot("jumpRunTrackForwardOffset","change",0,n=>{const e=parseInt(n,10);if(console.log("jumpRunTrackForwardOffset change event:",{value:n,offset:e}),!isNaN(e)&&e>=-5e4&&e<=5e4&&e%100===0)_.state.userSettings.jumpRunTrackForwardOffset=e,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating JRT for forward offset change"),xt());else{T.handleError("Forward offset must be between -50000 and 50000 in steps of 100.");const o=document.getElementById("jumpRunTrackForwardOffset");o&&(o.value=0),_.state.userSettings.jumpRunTrackForwardOffset=0,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&(console.log("Resetting JRT for invalid forward offset"),xt())}}),Ot("aircraftSpeedKt","change",300,n=>{const e=zr(n);document.getElementById("jumperSeparation").value=e,_.state.userSettings.jumperSeparation=e,_.state.userSettings.aircraftSpeedKt=parseFloat(n),_.save(),Qt(),xt()}),Ot("numberOfJumpers","change",300,n=>{const e=parseFloat(n);!isNaN(e)&&e>=1&&e<=50?(_.state.userSettings.numberOfJumpers=e,_.save(),_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Recalculating jump for jumper number change"),We(),De())):(T.handleError("Jumper number must be between 1 and 50."),yt("numberOfJumpers",defaultSettings.numberOfJumpers),_.state.userSettings.numberOfJumpers=defaultSettings.numberOfJumpers,_.save())}),Ot("jumperSeparation","change",300,n=>{const e=parseFloat(n);!isNaN(e)&&e>=1&&e<=50?(_.state.userSettings.jumperSeparation=e,u.isJumperSeparationManual=!0,_.save(),console.log(`jumperSeparation manually set to ${e}s`),_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Recalculating jump for jumper separation change"),We(),De())):(T.handleError("Jumper separation must be between 1 and 50 seconds."),yt("jumperSeparation",defaultSettings.jumperSeparation),_.state.userSettings.jumperSeparation=defaultSettings.jumperSeparation,u.isJumperSeparationManual=!1,_.save())}),Ot("cutAwayAltitude","change",300,n=>{!isNaN(n)&&n>=400&&n<=15e3?(_.state.userSettings.cutAwayAltitude=n,_.save(),_.state.userSettings.showCutAwayFinder&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Recalculating jump for cut-away altitude change"),Qt())):(T.handleError("Cut away altitude must be between 400 and 15000 meters."),yt("cutAwayAltitude",1e3),_.state.userSettings.cutAwayAltitude=1e3,_.save())}),Ot("historicalDatePicker","change",300,n=>{console.log("historicalDatePicker changed to:",n),u.lastLat&&u.lastLng?cn(u.lastLat,u.lastLng,n?`${n}T00:00:00Z`:null).then(e=>{e&&(u.weatherData=e,jt())}):T.handleError("Please select a position on the map first.")})}function zf(){const n=document.getElementById("downloadButton");n&&n.addEventListener("click",()=>{const e=rc();Kf(e)})}function $f(){const n=document.getElementById("clearHistoricalDate");n&&n.addEventListener("click",()=>{const e=document.getElementById("historicalDatePicker");e&&(e.value="",console.log("Cleared historical date, refetching forecast data"),u.lastLat&&u.lastLng&&cn(u.lastLat,u.lastLng,null).then(o=>{o&&(u.weatherData=o,jt())}))})}function Bf(){tc(),console.log("Coordinate events setup complete.")}function Uf(){const n=document.querySelectorAll('input[name="cutAwayState"]');if(n.length===0)return;const e=_.state.userSettings.cutAwayState||"Partially",o=document.querySelector(`input[name="cutAwayState"][value="${e}"]`);o&&(o.checked=!0),n.forEach(a=>{a.addEventListener("change",()=>{a.checked&&(console.log(`Cut Away State changed to: ${a.value}`),_.state.userSettings.cutAwayState=a.value,_.save(),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&Qt())})})}function Zf(){console.log("App: Richte Event-Listener für Track-Einstellungen ein.");const n=(a,r)=>{const c=document.getElementById(a);c&&(c.value=_.state.userSettings[r]||0,console.log(`Set ${a} to initial value:`,c.value),c.addEventListener("input",()=>{const l=parseFloat(c.value);isNaN(l)||(_.state.userSettings[r]=l,_.save(),xt())}))};n("numberOfJumpers","numberOfJumpers"),n("jumperSeparation","jumperSeparation"),n("jumpRunTrackOffset","jumpRunTrackOffset"),n("jumpRunTrackForwardOffset","jumpRunTrackForwardOffset");const e=document.getElementById("jumpRunTrackDirection");e&&(e.value=_.state.userSettings.customJumpRunDirection||"",e.addEventListener("change",()=>{const a=parseFloat(e.value);Number.isFinite(a)&&a>=0&&a<=359?(_.state.userSettings.customJumpRunDirection=a,console.log("Setting 'customJumpRunDirection' on change to:",a)):(_.state.userSettings.customJumpRunDirection=null,e.value="",console.log("Invalid direction, resetting to calculated.")),_.save(),xt()}));const o=document.getElementById("showJumpRunTrack");o&&o.addEventListener("change",a=>{_.state.userSettings.showJumpRunTrack=a.target.checked,_.save(),xt()})}function Hf(){console.log("App: Richte Event-Listener für Karten-Events ein."),document.addEventListener("map:location_selected",async n=>{const{lat:e,lng:o,source:a}=n.detail;console.log(`App: Event 'map:location_selected' von '${a}' empfangen.`),u.lastLat=e,u.lastLng=o,u.lastAltitude=await T.getAltitude(e,o),Ka(e,o),resetJumpRunDirection(!0),await cn(e,o),_.state.userSettings.calculateJump&&(Qt(),De()),On(!0),u.isManualPanning=!1,xt(),Je()}),document.addEventListener("map:mousemove",n=>{const{lat:e,lng:o}=n.detail;u.lastMouseLatLng={lat:e,lng:o};const a=sc();let r;if(a==="MGRS")r=`MGRS: ${T.decimalToMgrs(e,o)||"N/A"}`;else if(a==="DMS"){const c=l=>`${l.deg}°${l.min}'${l.sec.toFixed(0)}" ${l.dir}`;r=`Lat: ${c(T.decimalToDms(e,!0))}, Lng: ${c(T.decimalToDms(o,!1))}`}else r=`Lat: ${e.toFixed(5)}, Lng: ${o.toFixed(5)}`;u.coordsControl&&u.coordsControl.update(`${r}<br>Elevation: Fetching...<br>QFE: Fetching...`),lc(e,o,{lat:e,lng:o},({elevation:c,qfe:l},d)=>{if(u.lastMouseLatLng&&u.coordsControl){const f=Math.abs(u.lastMouseLatLng.lat-d.lat),p=Math.abs(u.lastMouseLatLng.lng-d.lng),g=.05;if(f<g&&p<g){const y=ri();let v=c==="N/A"?"N/A":c;v!=="N/A"&&(v=T.convertHeight(v,y),v=Math.round(v));const M=l==="N/A"?"N/A":`${l} hPa`;u.coordsControl.update(`${r}<br>Elevation: ${v} ${v==="N/A"?"":y}<br>QFE: ${M}`)}}})})}function Wf(){console.log("setupMenuItemEvents wird aufgerufen für 'Calculate Jump'.");const n=Array.from(document.querySelectorAll(".menu-label")).find(a=>a.textContent.trim()==="Calculate Jump");if(!n){console.error("Calculate Jump menu item not found");return}const e=n.closest("li").querySelector("ul.submenu"),o=()=>{_.isFeatureUnlocked("calculateJump")?(n.style.opacity="1",n.title="Click to open/close jump calculation settings"):(n.style.opacity="0.5",n.title="Feature locked. Click to enter password.",e&&e.classList.add("hidden"))};o(),n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),_.isFeatureUnlocked("calculateJump")?e&&e.classList.toggle("hidden"):_.showPasswordModal("calculateJump",()=>{o(),e&&e.classList.remove("hidden")},()=>{o()})})}function Gf(){const n=document.getElementById("resetCutAwayMarker");n&&n.addEventListener("click",()=>{if(!u.map){console.warn("Map not initialized, cannot reset cut-away marker");return}u.cutAwayMarker&&(u.map.removeLayer(u.cutAwayMarker),u.cutAwayMarker=null,u.cutAwayLat=null,u.cutAwayLng=null,console.log("Cut-away marker reset"),u.cutAwayCircle&&(u.map.removeLayer(u.cutAwayCircle),u.cutAwayCircle=null,console.log("Cleared cut-away circle")),document.getElementById("info").innerHTML="Right-click map to place cut-away marker")})}function Vf(){console.log("[app.js] Setting up track events");const n=document.getElementById("trackFileInput"),e=document.getElementById("loading");n&&n.addEventListener("change",async a=>{const r=a.target.files[0];if(e&&(e.style.display="block"),!r){T.handleError("No file selected."),e&&(e.style.display="none");return}const c=r.name.split(".").pop().toLowerCase();let l=null;try{c==="gpx"?l=await Sf(r):c==="csv"?l=await Pf(r):(T.handleError("Unsupported file type. Please upload a .gpx or .csv file."),e&&(e.style.display="none"))}catch(d){console.error("Error during track file processing:",d),T.handleError("Failed to process track file."),e&&(e.style.display="none")}});const o=document.getElementById("clearTrack");o&&o.addEventListener("click",()=>{if(!u.map){T.handleError("Cannot clear track: map not initialized.");return}if(u.gpxLayer)try{u.map.hasLayer(u.gpxLayer)&&u.map.removeLayer(u.gpxLayer),u.gpxLayer=null,u.gpxPoints=[],u.isTrackLoaded=!1;const a=document.getElementById("info");if(a){const r=/(<br><strong>Available Models:<\/strong><ul>.*?<\/ul>|<br><strong>Available Models:<\/strong> None)/s,l=a.innerHTML.match(r);a.innerHTML="Click on the map to fetch weather data."+(l?l[0]:"")}n&&(n.value="")}catch(a){T.handleError("Failed to clear track: "+a.message)}else T.handleMessage("No track to clear.")}),u.map&&u.map.getContainer().addEventListener("track:loaded",async a=>{try{const{lat:r,lng:c,timestamp:l,historicalDate:d,summary:f}=a.detail;if(console.log('Event "track:loaded" empfangen, starte Aktionen.'),d){console.log("Historischer Track geladen, deaktiviere Autoupdate.");const y=document.getElementById("autoupdateCheckbox");y&&(y.checked=!1),oc(),_.state.userSettings.autoupdate=!1,_.save(),T.handleMessage("Autoupdate disabled for historical track viewing.")}await To(r,c);const p=await cn(r,c,l);if(p){u.weatherData=p;const y=document.getElementById("timeSlider");if(y&&u.weatherData.time){y.max=u.weatherData.time.length-1,y.disabled=y.max<=0;const v=new Date(l).getTime();let M=0,b=1/0;u.weatherData.time.forEach((S,k)=>{const E=Math.abs(new Date(S).getTime()-v);E<b&&(b=E,M=k)}),y.value=M}}await jt(),_.state.isCalculateJumpUnlocked&&_.state.userSettings.calculateJump&&Qt(),_.state.isLandingPatternUnlocked&&_.state.userSettings.showLandingPattern&&Je();const g=document.getElementById("info");if(g&&f){const y=/(<br><strong>Available Models:<\/strong><ul>.*?<\/ul>|<br><strong>Available Models:<\/strong> None)/s,v=g.innerHTML.match(y);g.innerHTML=f+(v?v[0]:"")}if(d){const y=document.getElementById("historicalDatePicker");y&&(y.value=d)}}catch(r){console.error("Fehler bei der Verarbeitung von track:loaded:",r),T.handleError("Konnte Track-Daten nicht vollständig verarbeiten.")}finally{e&&(e.style.display="none")}})}function Jf(){const n=document.getElementById("bottom-container");if(!n){console.error("Bottom container not found; cannot create settings/cache buttons.");return}const e=document.createElement("div");e.id="settings-cache-buttons",e.className="button-wrapper";const o=document.createElement("button");o.id="resetButton",o.textContent="Reset Settings",o.title="Resets all settings to their default values and locks all features",o.addEventListener("click",()=>{confirm("Are you sure you want to reset all settings and lock all features?")&&(localStorage.removeItem("unlockedFeatures"),localStorage.removeItem("upperWindsSettings"),window.location.reload())}),e.appendChild(o);const a=document.createElement("button");a.id="clearCacheButton",a.textContent="Clear Tile Cache",a.title="Clears cached map tiles. Pan/zoom to cache more tiles for offline use.",a.addEventListener("click",async()=>{try{const r=await Ut.getCacheSize();await Ut.clearCache(),T.handleMessage(`Tile cache cleared successfully (freed ${r.toFixed(2)} MB).`),console.log("Tile cache cleared")}catch(r){T.handleError("Failed to clear tile cache: "+r.message)}}),e.appendChild(a),n.appendChild(e)}function jf(){const n=document.getElementById("cacheRadiusSelect");n?(n.addEventListener("change",()=>{if(!_.state||!_.state.userSettings){console.error("Settings not properly initialized");return}_.state.userSettings.cacheRadiusKm=parseInt(n.value,10),_.save(),console.log("Updated cacheRadiusKm:",_.state.userSettings.cacheRadiusKm)}),console.log("cacheRadiusSelect listener attached, initial value:",n.value)):console.warn("cacheRadiusSelect not found in DOM");const e=document.getElementById("cacheZoomLevelsSelect");e?(e.addEventListener("change",()=>{const[a,r]=e.value.split("-").map(Number);_.state.userSettings.cacheZoomLevels=Array.from({length:r-a+1},(c,l)=>a+l),_.save(),console.log("Updated cacheZoomLevels:",_.state.userSettings.cacheZoomLevels)}),console.log("cacheZoomLevelsSelect listener attached, initial value:",e.value)):console.warn("cacheZoomLevelsSelect not found in DOM");const o=document.getElementById("recacheNowButton");o?(o.addEventListener("click",a=>{if(a.stopPropagation(),console.log("Recache Now button clicked"),!navigator.onLine){T.handleError("Cannot recache while offline.");return}const{map:r,lastLat:c,lastLng:l,baseMaps:d}=u;if(!r){console.warn("Map not initialized, cannot recache tiles"),T.handleMessage("Map not initialized, cannot recache tiles.");return}Rd({map:r,lastLat:c,lastLng:l,baseMaps:d})}),console.log("recacheNowButton listener attached")):console.warn("recacheNowButton not found in DOM")}function qf(){console.log("Initializing all UI event listeners..."),If(),Df(),Nf(),Of(),Ff(),Rf(),zf(),Vf(),$f(),Bf(),Uf(),Zf(),Hf(),Wf(),Gf(),Jf(),jf()}const We=T.debounce(Qt,300),rc=()=>_.getValue("downloadFormat","radio","csv");T.handleMessage=se;(void 0).Coordinates=(void 0).extend({options:{position:"bottomleft"},onAdd:function(n){var e=(void 0).create("div","leaflet-control-coordinates");return e.style.background="rgba(255, 255, 255, 0.8)",e.style.padding="5px",e.style.borderRadius="4px",e.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",e.innerHTML="Move mouse over map",this._container=e,e},update:function(n){this._container.innerHTML=n}});let va=new Map,wa=new Map;const lc=T.debounce(async(n,e,o,a)=>{var p,g,y,v;const r=`${n.toFixed(5)},${e.toFixed(5)}`,c=Te(),l=`${r}-${c}`;let d,f;if(va.has(r))d=va.get(r);else try{d=await T.getAltitude(n,e),va.set(r,d)}catch(M){console.warn("Failed to fetch elevation:",M),d="N/A"}if(wa.has(l))f=wa.get(l);else if(u.weatherData&&u.weatherData.surface_pressure&&c>=0&&c<u.weatherData.surface_pressure.length){const M=u.weatherData.surface_pressure[c],b=((p=u.weatherData.temperature_2m)==null?void 0:p[c])||16.1,S=u.lastAltitude!=="N/A"?u.lastAltitude:339;f=T.calculateQFE(M,d,S,b),wa.set(l,f),console.log("Calculated QFE:",{lat:n,lng:e,surfacePressure:M,elevation:d,referenceElevation:S,temperature:b,qfe:f})}else console.warn("Surface pressure not available for QFE:",{hasWeatherData:!!u.weatherData,hasSurfacePressure:!!((g=u.weatherData)!=null&&g.surface_pressure),sliderIndexValid:c>=0&&c<(((v=(y=u.weatherData)==null?void 0:y.surface_pressure)==null?void 0:v.length)||0)}),f="N/A";a({elevation:d,qfe:f},o)},500);function fi(){var F;console.log("Calculating mean wind with model:",document.getElementById("modelSelect").value,"weatherData:",u.weatherData);const n=document.getElementById("timeSlider").value||0,e=un(n);let o=parseFloat(document.getElementById("lowerLimit").value)||0,a=parseFloat(document.getElementById("upperLimit").value);const r=((F=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:F.value)||"AGL",c=_.getValue("heightUnit","radio","m"),l=_.getValue("windUnit","radio","kt"),d=Math.round(u.lastAltitude);if(!u.weatherData||u.lastAltitude==="N/A"){handleError("Cannot calculate mean wind: missing data or altitude");return}o=c==="ft"?o/3.28084:o,a=c==="ft"?a/3.28084:a,r==="AMSL"&&o<d&&(T.handleError(`Lower limit adjusted to terrain altitude (${d} m ${r}) as it cannot be below ground level in ${r} mode.`),o=d,document.getElementById("lowerLimit").value=T.convertHeight(o,c));const f=r==="AGL"?o+d:o,p=r==="AGL"?a+d:a;if(isNaN(o)||isNaN(a)||o>=a){T.handleError("Invalid layer limits. Ensure Lower < Upper and both are numbers.");return}if(!e||e.length===0){T.handleError("No valid weather data available to calculate mean wind.");return}const g=e.map($=>$.height),y=e.map($=>parseFloat($.dir)||0),v=e.map($=>T.convertWind(parseFloat($.spd)||0,l,"km/h")),M=v.map(($,G)=>-$*Math.sin(y[G]*Math.PI/180)),b=v.map(($,G)=>-$*Math.cos(y[G]*Math.PI/180)),S=T.calculateMeanWind(g,M,b,f,p),[k,E]=S,C=T.roundToTens(k)===0&&k>=0&&k<5?360:T.roundToTens(k),I=Math.round(T.convertHeight(o,c)),x=Math.round(T.convertHeight(a,c));T.convertWind(E,l,"kt");const N=Number.isFinite(E)?l==="bft"?Math.round(E):E.toFixed(1):"N/A",R=`Mean wind (${I}-${x} ${c} ${r}): ${C}° ${N} ${l}`;document.getElementById("meanWindResult").innerHTML=R,console.log("Calculated Mean Wind:",R,"u:",S[2],"v:",S[3])}function Kf(n){var V,tt,pt,gt,mt,X;if(!u.weatherData||!u.weatherData.time){T.handleError("No weather data available to download.");return}const e=document.getElementById("timeSlider").value||0,o=document.getElementById("modelSelect").value.toUpperCase(),a=T.formatTime(u.weatherData.time[e]).replace(" ","_"),r=`${a}_${o}_${n}.txt`,c={ATAK:{interpStep:1e3,heightUnit:"ft",refLevel:"AGL",windUnit:"kt"},Windwatch:{interpStep:100,heightUnit:"ft",refLevel:"AGL",windUnit:"km/h"},HEIDIS:{interpStep:100,heightUnit:"m",refLevel:"AGL",temperatureUnit:"C",windUnit:"m/s"},Customized:{}},l={interpStep:Rr(),heightUnit:_.getValue("heightUnit","radio","m"),refLevel:((V=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:V.value)||"AGL",windUnit:_.getValue("windUnit","radio","kt"),temperatureUnit:_.getValue("temperatureUnit","radio","C")};let d={...l};const f=c[n];if(f&&Object.keys(f).length>0){let W=!1;for(const[ht,rt]of Object.entries(f))if(d[ht]!==rt){switch(W=!0,ht){case"interpStep":document.getElementById("interpStepSelect").value=rt,_.state.userSettings.interpStep=rt;break;case"heightUnit":document.querySelector(`input[name="heightUnit"][value="${rt}"]`).checked=!0,_.state.userSettings.heightUnit=rt;break;case"refLevel":document.querySelector(`input[name="refLevel"][value="${rt}"]`).checked=!0,_.state.userSettings.refLevel=rt;break;case"windUnit":document.querySelector(`input[name="windUnit"][value="${rt}"]`).checked=!0,_.state.userSettings.windUnit=rt;break;case"temperatureUnit":document.querySelector(`input[name="temperatureUnit"][value="${rt}"]`).checked=!0,_.state.userSettings.temperatureUnit=rt;break}d[ht]=rt}W&&(_.save(),console.log(`Adjusted settings for ${n} compatibility:`,f),_.updateUnitLabels(),_.updateUnitLabels(),_.updateUnitLabels())}let p="",g=" ";const y=_.getValue("heightUnit","radio","m"),v=_.getValue("temperatureUnit","radio","C"),M=_.getValue("windUnit","radio","kt"),b=((tt=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:tt.value)||"AGL";if(n==="ATAK")p=`Alt Dir Spd
${y}${b}
`;else if(n==="Windwatch"){const W=Math.round(y==="ft"?u.lastAltitude*3.28084:u.lastAltitude);p=`Version 1.0, ID = 9999999999
${a}, Ground Level: ${W} ft
Windsond ${o}
 AGL[ft] Wind[°] Speed[km/h]
`}else if(n==="HEIDIS"){const W=b==="AGL"?`h(${y}AGL)`:`h(${y}AMSL)`,ht=v==="C"?"°C":"°F";p=`${W} p(hPa) T(${ht}) Dew(${ht}) Dir(°) Spd(${M}) RH(%)`}else if(n==="Customized"){const W=b==="AGL"?`h(${y}AGL)`:`h(${y}AMSL)`,ht=v==="C"?"°C":"°F";p=`${W} p(hPa) T(${ht}) Dew(${ht}) Dir(°) Spd(${M}) RH(%)`}const S=Math.round(u.lastAltitude),k=b==="AGL"?0:S,E=(pt=u.weatherData.temperature_2m)==null?void 0:pt[e],C=(gt=u.weatherData.relative_humidity_2m)==null?void 0:gt[e],I=(mt=u.weatherData.wind_speed_10m)==null?void 0:mt[e],x=(X=u.weatherData.wind_direction_10m)==null?void 0:X[e],N=T.calculateDewpoint(E,C),R=u.weatherData.surface_pressure[e],F=Math.round(T.convertHeight(k,y)),$=T.convertTemperature(E,v),G=T.convertTemperature(N,v),K=T.convertWind(I,M,"km/h"),z=$==="N/A"?"N/A":$.toFixed(1),B=G==="N/A"?"N/A":G.toFixed(1),Y=K==="N/A"?"N/A":M==="bft"?Math.round(K):K.toFixed(1),nt=x==="N/A"||x===void 0?"N/A":Math.round(x),wt=C==="N/A"||C===void 0?"N/A":Math.round(C);n==="ATAK"?p+=`${F}${g}${nt}${g}${Y}
`:n==="Windwatch"?p+=`${F}${g}${nt}${g}${Y}
`:n==="HEIDIS"?p+=`
${F}${g}${R==="N/A"?"N/A":R.toFixed(1)}${g}${z}${g}${B}${g}${nt}${g}${Y}${g}${wt}
`:n==="Customized"&&(p+=`
${F}${g}${R==="N/A"?"N/A":R.toFixed(1)}${g}${z}${g}${B}${g}${nt}${g}${Y}${g}${wt}
`);const q=un(e);if(!q||q.length===0){T.handleError("No interpolated data available to download.");return}q.forEach(W=>{if(W.displayHeight!==k){const ht=Math.round(T.convertHeight(W.displayHeight,y)),rt=W.pressure==="N/A"?"N/A":W.pressure.toFixed(1),Ft=T.convertTemperature(W.temp,v),Zt=T.convertTemperature(W.dew,v),Rt=T.convertWind(W.spd,M,_.getValue("windUnit","radio","kt")),qt=Ft==="N/A"?"N/A":Ft.toFixed(1),Kt=Zt==="N/A"?"N/A":Zt.toFixed(1),At=Rt==="N/A"?"N/A":M==="bft"?Math.round(Rt):Rt.toFixed(1),Ht=W.dir==="N/A"?"N/A":Math.round(W.dir),he=W.rh==="N/A"?"N/A":Math.round(W.rh);n==="ATAK"?p+=`${ht}${g}${Ht}${g}${At}
`:n==="Windwatch"?p+=`${ht}${g}${Ht}${g}${At}
`:n==="HEIDIS"?p+=`${ht}${g}${rt}${g}${qt}${g}${Kt}${g}${Ht}${g}${At}${g}${he}
`:n==="Customized"&&(p+=`${ht}${g}${rt}${g}${qt}${g}${Kt}${g}${Ht}${g}${At}${g}${he}
`)}});const Lt=new Blob([p],{type:"text/plain"}),H=window.URL.createObjectURL(Lt),vt=document.createElement("a");vt.href=H,vt.download=r,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),window.URL.revokeObjectURL(H),document.getElementById("interpStepSelect").value=l.interpStep,document.querySelector(`input[name="heightUnit"][value="${l.heightUnit}"]`).checked=!0,document.querySelector(`input[name="refLevel"][value="${l.refLevel}"]`).checked=!0,document.querySelector(`input[name="windUnit"][value="${l.windUnit}"]`).checked=!0,document.querySelector(`input[name="temperatureUnit"][value="${l.temperatureUnit}"]`).checked=!0,_.state.userSettings.interpStep=l.interpStep,_.state.userSettings.heightUnit=l.heightUnit,_.state.userSettings.refLevel=l.refLevel,_.state.userSettings.windUnit=l.windUnit,_.state.userSettings.temperatureUnit=l.temperatureUnit,_.save(),_.updateUnitLabels(),_.updateUnitLabels(),_.updateUnitLabels()}async function Yf(){if(!u.lastLat||!u.lastLng){console.warn("No location selected, cannot update weather data"),T.handleError("Please select a location to enable autoupdate."),stopAutoupdate(),document.getElementById("autoupdateCheckbox").checked=!1,_.state.userSettings.autoupdate=!1,_.save();return}if(!navigator.onLine){console.warn("Cannot update weather data: offline"),T.handleError("Cannot update weather data while offline."),stopAutoupdate(),document.getElementById("autoupdateCheckbox").checked=!1,_.state.userSettings.autoupdate=!1,_.save();return}const n=document.getElementById("timeSlider");if(!n){console.warn("Time slider not found, cannot update to current hour");return}const o=new Date().getUTCHours();n.value=o,console.log(`Set slider to current hour: ${o}`);try{await cn(u.lastLat,u.lastLng,null,!1),console.log("Weather data fetched for current hour"),await Po(o),u.lastAltitude!=="N/A"&&fi(),_.state.userSettings.calculateJump&&_.state.isCalculateJumpUnlocked&&(We(),De(),_.state.userSettings.showJumpRunTrack&&xt()),console.log("Updated all displays for current hour")}catch(a){console.error("Error updating to current hour:",a),T.handleError("Failed to update weather data: "+a.message)}}function Qt(){if(!_.state.isCalculateJumpUnlocked||!_.state.userSettings.calculateJump){co(null),Fa(null);return}if(!u.weatherData||!u.lastLat||!u.lastLng){co(null);return}const n=Te(),e=un(n),o={exitCircles:[],canopyCircles:[],canopyLabels:[]};if(_.state.userSettings.showExitArea){const r=Br(e);if(r){o.exitCircles.push({center:[r.greenLat,r.greenLng],radius:r.greenRadius,color:"green",fillColor:"green",fillOpacity:.2,weight:2});const c=`
                Exit areas calculated with:<br>
                Throw/Drift: ${Number.isFinite(r.freeFallDirection)?Math.round(r.freeFallDirection):"N/A"}° ${Number.isFinite(r.freeFallDistance)?Math.round(r.freeFallDistance):"N/A"} m<br>
                Free Fall Time: ${r.freeFallTime!=null&&!isNaN(r.freeFallTime)?Math.round(r.freeFallTime):"N/A"} sec
            `;o.exitCircles.push({center:[r.darkGreenLat,r.darkGreenLng],radius:r.darkGreenRadius,color:"darkgreen",fillColor:"darkgreen",fillOpacity:.2,weight:2,tooltip:c})}}if(_.state.userSettings.showCanopyArea){const r=Mu(e);if(r){const c=T.calculateNewCenter(r.redLat,r.redLng,r.displacementFull,r.directionFull);o.canopyCircles.push({center:c,radius:r.radiusFull,color:"red",weight:2,opacity:.8,fillOpacity:0}),r.additionalBlueRadii.forEach((l,d)=>{const f=T.calculateNewCenter(r.blueLat,r.blueLng,r.additionalBlueDisplacements[d],r.additionalBlueDirections[d]);o.canopyCircles.push({center:f,radius:l,color:"blue",weight:1,fillColor:"blue",fillOpacity:.1,opacity:1}),o.canopyLabels.push({center:f,radius:l,text:`${Math.round(r.additionalBlueUpperLimits[d])}m`})})}}co(o);let a=null;if(_.state.userSettings.showCutAwayFinder&&u.cutAwayLat!==null){const r=De(e);r&&(a={center:r.center,radius:r.radius,tooltipContent:r.tooltipContent})}Fa(a)}function Xf(){return!_.state.userSettings.showJumpRunTrack||!_.state.userSettings.calculateJump||!u.weatherData||!u.lastLat||!u.lastLng?(console.log("Skipping calculateJumpRunTrack: conditions not met"),null):(console.log("Calculating jump run track..."),xt(),yo())}function Qf(n,e,o){const a=parseInt(n.value)||100,r=parseInt(e.value)||200,c=parseInt(o.value)||300;return r<=a?(T.handleError("Base leg must start higher than final leg."),!1):c<=r?(T.handleError("Downwind leg must start higher than base leg."),!1):!0}function Ne(n=null){const e=_.state.userSettings.showJumpMasterLine;if(!e){Dr(),gf();return}if(!u.liveMarker){Dr();return}const o=u.liveMarker.getLatLng();if(!o)return;const a=n||{latitude:o.lat,longitude:o.lng,speedMs:u.lastSmoothedSpeedMs,direction:u.lastDirection,deviceAltitude:u.lastDeviceAltitude,altitudeAccuracy:u.lastAltitudeAccuracy,accuracy:u.lastAccuracy};let r=null,c=null,l="";if(_.state.userSettings.jumpMasterLineTarget==="HARP"&&u.harpMarker?(c=u.harpMarker.getLatLng(),l="HARP"):u.currentMarker&&(c=u.currentMarker.getLatLng(),l="DIP"),c){const f=u.map.distance(o,c),p=Math.round(T.calculateBearing(o.lat,o.lng,c.lat,c.lng)),g=a.speedMs>1?a.speedMs:1,y=Math.round(f/g);r={distance:f,bearing:p,tot:y,target:l},pf(o,c)}const d={heightUnit:_.getValue("heightUnit","radio","m"),effectiveWindUnit:_.getValue("windUnit","radio","kt")==="bft"?"kt":_.getValue("windUnit","radio","kt"),coordFormat:_.getValue("coordFormat","radio","Decimal"),refLevel:_.getValue("refLevel","radio","AGL")};_f({...a,showJumpMasterLine:e,jumpMasterLineData:r,...d})}function tm(){if(_.initialize(),_.state.isLandingPatternUnlocked=_.state.unlockedFeatures.landingPattern,_.state.isCalculateJumpUnlocked=_.state.unlockedFeatures.calculateJump,_.state.userSettings.showJumpMasterLine=!1,console.log("Initial unlock status:",{isLandingPatternUnlocked:_.state.isLandingPatternUnlocked,isCalculateJumpUnlocked:_.state.isCalculateJumpUnlocked}),u.isInitialized){console.log("App already initialized, skipping");return}u.isInitialized=!0,console.log("Initializing app")}function em(){nm("modelSelect",_.state.userSettings.model),Ze("refLevel",_.state.userSettings.refLevel),Ze("heightUnit",_.state.userSettings.heightUnit),Ze("temperatureUnit",_.state.userSettings.temperatureUnit),Ze("windUnit",_.state.userSettings.windUnit),Ze("timeZone",_.state.userSettings.timeZone),Ze("coordFormat",_.state.userSettings.coordFormat),Ze("downloadFormat",_.state.userSettings.downloadFormat),Ze("landingDirection",_.state.userSettings.landingDirection),yt("canopySpeed",_.state.userSettings.canopySpeed),yt("descentRate",_.state.userSettings.descentRate),yt("legHeightDownwind",_.state.userSettings.legHeightDownwind),yt("legHeightBase",_.state.userSettings.legHeightBase),yt("legHeightFinal",_.state.userSettings.legHeightFinal),yt("customLandingDirectionLL",_.state.userSettings.customLandingDirectionLL),yt("customLandingDirectionRR",_.state.userSettings.customLandingDirectionRR),yt("lowerLimit",_.state.userSettings.lowerLimit),yt("upperLimit",_.state.userSettings.upperLimit),yt("openingAltitude",_.state.userSettings.openingAltitude),yt("exitAltitude",_.state.userSettings.exitAltitude),yt("interpStepSelect",_.state.userSettings.interpStep),yt("aircraftSpeedKt",_.state.userSettings.aircraftSpeedKt),yt("jumpRunTrackOffset",_.state.userSettings.jumpRunTrackOffset),yt("numberOfJumpers",_.state.userSettings.numberOfJumpers),En("showTableCheckbox",_.state.userSettings.showTable),En("calculateJumpCheckbox",_.state.userSettings.calculateJump),En("showLandingPattern",_.state.userSettings.showLandingPattern),En("showJumpRunTrack",_.state.userSettings.showJumpRunTrack),En("showCanopyAreaCheckbox",_.state.userSettings.showCanopyArea),En("showExitAreaCheckbox",_.state.userSettings.showExitArea),_.state.userSettings.isCustomJumpRunDirection=_.state.userSettings.isCustomJumpRunDirection||!1;const n=document.getElementById("customLandingDirectionLL"),e=document.getElementById("customLandingDirectionRR");n&&_.state.userSettings.customLandingDirectionLL!==""&&!isNaN(_.state.userSettings.customLandingDirectionLL)&&(n.value=_.state.userSettings.customLandingDirectionLL),e&&_.state.userSettings.customLandingDirectionRR!==""&&!isNaN(_.state.userSettings.customLandingDirectionRR)&&(e.value=_.state.userSettings.customLandingDirectionRR);const o=zr(_.state.userSettings.aircraftSpeedKt);yt("jumperSeparation",o),_.state.userSettings.jumperSeparation=o,_.save();const a=document.getElementById("showLandingPattern"),r=document.getElementById("calculateJumpCheckbox");a&&(a.title=_.isFeatureUnlocked("landingPattern")&&_.state.isLandingPatternUnlocked?"":"Feature locked. Click to enter password.",a.style.opacity=_.isFeatureUnlocked("landingPattern")&&_.state.isLandingPatternUnlocked?"1":"0.5",console.log("Initialized showLandingPattern UI:",{checked:a.checked,opacity:a.style.opacity})),r&&(r.title=_.isFeatureUnlocked("calculateJump")&&_.state.isCalculateJumpUnlocked?"":"Feature locked. Click to enter password.",r.style.opacity=_.isFeatureUnlocked("calculateJump")&&_.state.isCalculateJumpUnlocked?"1":"0.5",console.log("Initialized calculateJumpCheckbox UI:",{checked:r.checked,opacity:r.style.opacity}));const c=document.getElementById("showJumpMasterLine");c&&(c.disabled=!_.state.userSettings.trackPosition,c.style.opacity=c.disabled?"0.5":"1",c.title=c.disabled?"Enable Live Tracking to use Jump Master Line":"");const l=document.getElementById("jumpRunTrackDirection");l&&(l.textContent="-"),cc()}function cc(){const n=document.getElementById("info");n&&(n.style.display=_.state.userSettings.showTable?"block":"none");const e=document.getElementById("customLandingDirectionLL"),o=document.getElementById("customLandingDirectionRR"),a=document.getElementById("showJumpRunTrack"),r=document.getElementById("showExitAreaCheckbox");e&&(e.disabled=_.state.userSettings.landingDirection!=="LL"),o&&(o.disabled=_.state.userSettings.landingDirection!=="RR"),a&&(a.disabled=!_.state.userSettings.calculateJump),r&&(r.disabled=!_.state.userSettings.calculateJump),_.updateUnitLabels()}async function uc(n){u.weatherData=n;const e=document.getElementById("timeSlider");if(!e)return;const a=(d=>{const f=d==null?void 0:d.temperature_2m;if(!f||f.length===0)return 0;for(let p=f.length-1;p>=0;p--)if(f[p]!==null&&f[p]!==void 0)return p;return 0})(n);console.log(`Daten sind gültig bis Index: ${a}. Setze Slider-Maximum.`),e.max=a,e.disabled=e.max<=0;const r=new Date().getTime();let c=0,l=1/0;n.time.forEach((d,f)=>{if(f<=a){const p=Math.abs(new Date(d).getTime()-r);p<l&&(l=p,c=f)}}),e.value=c,await jt(),_.updateModelRunInfo(u.lastModelRun,u.lastLat,u.lastLng)}async function jt(){console.log("updateAllDisplays called");try{const n=Te();u.weatherData&&u.lastLat&&u.lastLng&&(await Po(n),await So(),u.lastAltitude!=="N/A"&&fi(),Je(),_.state.userSettings.calculateJump&&Qt(),_.state.userSettings.showJumpRunTrack&&xt())}catch(n){console.error("Error in updateAllDisplays:",n),Nn(n.message)}}function En(n,e){const o=document.getElementById(n);o&&(o.checked=e)}function nm(n,e){const o=document.getElementById(n);o?o.value=e:console.warn(`Element ${n} not found`)}function yt(n,e){const o=document.getElementById(n);o&&(o.value=e)}function Or(n,e){const o=document.getElementById(n);if(o){const a=o.value;o.value=e,console.log(`Set ${n} silently:`,{old:a,new:e})}}function Ze(n,e){const o=document.querySelector(`input[name="${n}"][value="${e}"]`);o?o.checked=!0:console.warn(`Radio ${n} with value ${e} not found`)}function im(){console.log("[App] Setting up application event listeners..."),document.addEventListener("tracking:started",()=>{const n=document.getElementById("showJumpMasterLine");n&&(n.disabled=!1,n.style.opacity="1",n.title="")}),document.addEventListener("tracking:stopped",()=>{const n=document.getElementById("showJumpMasterLine");n&&(n.checked=!1,n.disabled=!0,n.style.opacity="0.5",n.title="Enable Live Tracking to use Jump Master Line"),_.state.userSettings.showJumpMasterLine&&(_.state.userSettings.showJumpMasterLine=!1,_.save()),Ne()}),document.addEventListener("ui:showJumpMasterLineChanged",()=>{Ne()}),document.addEventListener("jml:targetChanged",()=>{Ne()}),document.addEventListener("tracking:positionUpdated",n=>{Ne(n.detail)})}document.addEventListener("DOMContentLoaded",async()=>{tm(),em(),await Gd(),im(),Af(),qf(),tc(),document.addEventListener("cutaway:marker_placed",()=>{console.log("App: Event 'cutaway:marker_placed' empfangen. Neuberechnung wird ausgelöst."),u.weatherData&&u.lastLat&&u.lastLng&&Qt()}),document.addEventListener("track:dragend",n=>{console.log("App: Event 'track:dragend' empfangen. Neuberechnung der Offsets relativ zum DIP.");const{newPosition:e,originalTrackData:o}=n.detail,a=(void 0)(u.lastLat,u.lastLng),r=o.trackLength,c=o.airplane.bearing,l=e,[d,f]=T.calculateNewCenter(l.lat,l.lng,r/2,(c+180)%360),p=(void 0)(d,f),g=u.map.distance(a,p);let v=T.calculateBearing(a.lat,a.lng,p.lat,p.lng)-c;v=(v+180)%360-180;const M=v*(Math.PI/180),b=Math.round(g*Math.cos(M)),S=Math.round(g*Math.sin(M));_.state.userSettings.jumpRunTrackOffset=S,_.state.userSettings.jumpRunTrackForwardOffset=b,_.save(),Or("jumpRunTrackOffset",S),Or("jumpRunTrackForwardOffset",b),xt()}),document.addEventListener("location:selected",async n=>{var c,l;const{lat:e,lng:o,source:a}=n.detail;console.log(`App: Event 'location:selected' empfangen. Quelle: ${a}`);const r=document.getElementById("loading");r&&(r.style.display="block");try{const d=Te(),f=((l=(c=u.weatherData)==null?void 0:c.time)==null?void 0:l[d])||null,p=await cn(e,o,f);p?await uc(p):u.weatherData=null,await To(e,o),await So(),On(!0),u.isManualPanning=!1,_.state.userSettings.showJumpMasterLine&&Ne()}catch(d){console.error('Fehler beim Verarbeiten von "location:selected":',d),Nn(d.message)}finally{r&&(r.style.display="none")}}),document.addEventListener("map:zoomend",n=>{console.log("App: Event 'map:zoomend' empfangen.");const e=u.map.getZoom();_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&(e>=le.MIN_ZOOM&&e<=le.MAX_ZOOM?Qt():co(null)),_.state.userSettings.showJumpRunTrack&&(e>=le.MIN_ZOOM&&e<=le.MAX_ZOOM?xt():uo(null)),_.state.userSettings.showLandingPattern&&Je()}),document.addEventListener("autoupdate:tick",async n=>{if(!_.state.userSettings.autoupdate)return;const e=new Date,o=document.getElementById("timeSlider");if(!o)return;const a=e.getUTCHours(),r=parseInt(o.value,10);(a!==r||n.detail.isInitialTick)&&(console.log(`[App] Autoupdate triggered. Current Hour: ${a}, Slider Hour: ${r}`),await Yf())})});
