var gu=Object.defineProperty;var _u=(n,e,a)=>e in n?gu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var yu=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Ks=(n,e,a)=>_u(n,typeof e!="symbol"?e+"":e,a);var um=yu((dm,zo)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=a(s);fetch(s.href,l)}})();const u={isInitialized:!1,coordsControl:null,lastMouseLatLng:null,landingWindDir:null,cutAwayMarker:null,cutAwayLat:null,cutAwayLng:null,cutAwayCircle:null,isJumperSeparationManual:!1,weatherData:null,lastModelRun:null,gpxLayer:null,gpxPoints:[],isLoadingGpx:!1,isTrackLoaded:!1,liveMarker:null,jumpMasterLine:null,isPlacingHarp:!1,harpMarker:null,watchId:null,prevLat:null,prevLng:null,prevTime:null,livePositionControl:null,lastLatitude:null,lastLongitude:null,lastDeviceAltitude:null,lastAltitudeAccuracy:null,lastAccuracy:null,lastSpeed:"N/A",lastEffectiveWindUnit:"kt",lastDirection:"N/A",lastTerrainAltitude:"N/A",lastSmoothedSpeedMs:0,map:null,baseMaps:{},lastLat:null,lastLng:null,lastAltitude:null,currentMarker:null,isManualPanning:!1,autoupdateInterval:null,accuracyCircle:null,ensembleModelsData:null,selectedEnsembleModels:[],currentEnsembleScenario:"all_models",ensembleLayerGroup:null,ensembleScenarioCircles:{},heatmapLayer:null,ismapInitialized:!1,hasTileErrorSwitched:!1,isCachingCancelled:!1,jumpVisualizationLayerGroup:null,landingPatternLayerGroup:null,jumpRunTrackLayerGroup:null,labelZoomListener:null},vu="skydiver2025",Ys={135:5,130:5,125:5,120:5,115:5,110:5,105:5,100:6,95:7,90:7,85:7,80:8,75:8,70:9,65:10,60:10,55:11,50:12,45:14,40:15,35:17,30:20,25:24,20:30,15:40,10:60,5:119},zr={LIST:["icon_seamless","icon_global","icon_eu","icon_d2","ecmwf_ifs025","ecmwf_aifs025_single","gfs_seamless","gfs_global","gfs_hrrr","arome_france","gem_hrdps_continental","gem_regional"],API_MAP:{icon_seamless:"dwd_icon",icon_global:"dwd_icon",icon_eu:"dwd_icon_eu",icon_d2:"dwd_icon_d2",ecmwf_ifs025:"ecmwf_ifs025",ecmwf_aifs025_single:"ecmwf_aifs025_single",gfs_seamless:"ncep_gfs013",gfs_global:"ncep_gfs025",gfs_hrrr:"ncep_hrrr_conus",arome_france:"meteofrance_arome_france0025",gem_hrdps_continental:"cmc_gem_hrdps",gem_regional:"cmc_gem_rdps"}},Qt={METERS_TO_FEET:3.28084,FEET_TO_METERS:.3048,KNOTS_TO_MPS:.514444,KNOTS_TO_KMH:1.852,CELSIUS_TO_KELVIN:273.15},Xs={MOLAR_MASS_AIR:.0289644,UNIVERSAL_GAS_CONSTANT:8.31446261815324},_n={LAPSE_RATE:.0065,SEA_LEVEL_TEMP_KELVIN:288.15,GRAVITY:9.80665,GAS_CONSTANT_AIR:287.05},ta={A_LIQUID:17.27,B_LIQUID:237.7,A_ICE:21.87,B_ICE:265.5},wu=6371e3,Qs={KNOT_THRESHOLDS:[1,4,7,11,17,22,28,34,41,48,56,64],BEAUFORT_THRESHOLDS:[0,1,3,6,10,16,21,27,33,40,47,55,63]},yi={FORECAST:"https://api.open-meteo.com/v1/forecast",HISTORICAL:"https://historical-forecast-api.open-meteo.com/v1/forecast"},ve={SCENARIO_COLORS:{MIN_WIND:"rgba(0, 0, 255, 0.7)",MEAN_WIND:"rgba(0, 255, 0, 0.7)",MAX_WIND:"rgba(255, 0, 0, 0.7)"},HEATMAP_MIN_RADIUS_PX:5,HEATMAP_MAX_RADIUS_PX:50,HEATMAP_SCALING_BASE:1.42,HEATMAP_BASE_RADIUS:20,HEATMAP_REFERENCE_ZOOM:13},Lu=[1e3,950,925,900,850,800,700,600,500,400,300,250,200],Fe=200,ao={OPEN:4.1,PARTIALLY:12.8,COLLAPSED:39.2},Mu=150,ea={DEFAULT_AREA_VERTICAL:.5,DEFAULT_AREA_HORIZONTAL:.5,DEFAULT_MASS_KG:80,DEFAULT_DRAG_COEFFICIENT:1},On={MIN_TRACK_LENGTH_M:100,MAX_TRACK_LENGTH_M:1e4,MIN_APPROACH_LENGTH_M:100,MAX_APPROACH_LENGTH_M:2e4,APPROACH_TIME_SECONDS:120},we={MESSAGE_TIMEOUT_MS:3e3,MOBILE_BREAKPOINT_PX:768,DEFAULT_MAP_CENTER:[48.0179,11.1923],DEFAULT_MAP_ZOOM:11,GEOLOCATION_TIMEOUT_MS:2e4,GEOLOCATION_ACCURACY_THRESHOLD_M:100,MIN_ZOOM:11,MAX_ZOOM:14,LANDING_PATTERN_MIN_ZOOM:14},na={MIN_TIME_DIFF_FOR_SPEED_CALC_S:.5,SPEED_SMOOTHING_LOW:.5,SPEED_SMOOTHING_HIGH:.2,SPEED_SMOOTHING_TRESHOLD:25},bi={TILE_MAX_AGE_DAYS:7,FETCH_TIMEOUT_MS:15e3,SIZE_LIMIT_MB_WARNING:500},$o={DEFAULT_MARKER:"favicon.ico",CUTAWAY_MARKER:"schere_purple.png",AIRPLANE_MARKER:"airplane_orange.png"},$r=()=>_.getValue("interpStepSelect","select",200),_={FEATURE_PASSWORD:"skydiver2025",defaultSettings:{model:"icon_global",refLevel:"AGL",heightUnit:"m",temperatureUnit:"C",windUnit:"kt",timeZone:"Z",coordFormat:"Decimal",downloadFormat:"HEIDIS",showTable:!1,canopySpeed:20,descentRate:3.5,showLandingPattern:!1,landingDirection:"LL",customLandingDirectionLL:"",customLandingDirectionRR:"",legHeightDownwind:300,legHeightBase:200,legHeightFinal:100,interpStep:"200",lowerLimit:0,upperLimit:3e3,baseMaps:"Esri Street",calculateJump:!0,openingAltitude:1200,exitAltitude:3e3,showJumpRunTrack:!1,showExitArea:!1,showCanopyArea:!1,jumpRunTrackOffset:0,jumpRunTrackForwardOffset:0,aircraftSpeedKt:90,jumperSeparation:5,numberOfJumpers:5,cutAwayAltitude:1e3,cutAwayState:"Partially",trackPosition:!1,showJumpMasterLine:!1,jumpMasterLineTarget:"DIP",harpLat:null,harpLng:null,cacheRadiusKm:10,cacheZoomLevels:[11,12,13,14],autoupdate:!1,selectedEnsembleModels:[],currentEnsembleScenario:"all_models"},state:{userSettings:null,unlockedFeatures:{landingPattern:!1,calculateJump:!1},isJumperSeparationManual:!1,isLandingPatternUnlocked:!1,isCalculateJumpUnlocked:!1},initialize(){let n={},e={landingPattern:!1,calculateJump:!1};try{const o=localStorage.getItem("upperWindsSettings");o?(n=JSON.parse(o),console.log("Loaded settings from localStorage:",n)):console.log("No settings found in localStorage, using defaults")}catch(o){this.handleError(o,"Failed to load settings. Using defaults.")}try{const o=localStorage.getItem("unlockedFeatures");o?(e=JSON.parse(o),console.log("Loaded unlocked features from localStorage:",e)):console.log("No unlocked features found in localStorage, using defaults")}catch(o){this.handleError(o,"Failed to load unlocked features. Using defaults.")}this.state.userSettings={...this.defaultSettings,...n},console.log("Initialized userSettings:",this.state.userSettings),this.state.userSettings.harpLat=null,this.state.userSettings.harpLng=null,console.log("Reset HARP coordinates to null at startup"),this.state.userSettings.jumpMasterLineTarget==="HARP"&&(console.log("Reset jumpMasterLineTarget to DIP due to cleared HARP coordinates"),this.state.userSettings.jumpMasterLineTarget="DIP"),this.state.userSettings.selectedEnsembleModels=[...this.defaultSettings.selectedEnsembleModels],this.state.userSettings.currentEnsembleScenario=this.defaultSettings.currentEnsembleScenario,this.state.unlockedFeatures={landingPattern:e.landingPattern||!1,calculateJump:e.calculateJump||!1},["OpenStreetMap","OpenTopoMap","Esri Satellite","Esri Street","Esri Topo","Esri Satellite + OSM"].includes(this.state.userSettings.baseMaps)||(console.warn(`Invalid baseMaps setting: ${this.state.userSettings.baseMaps}, resetting to default`),this.state.userSettings.baseMaps=this.defaultSettings.baseMaps)},save(){const n={...this.state.userSettings};delete n.customJumpRunDirection;try{localStorage.setItem("upperWindsSettings",JSON.stringify(n)),console.log("Settings saved to localStorage:",n)}catch(e){console.error("Failed to save settings to localStorage:",e)}},saveUnlockStatus(n,e){try{n==="landingPattern"?(this.state.unlockedFeatures.landingPattern=e,this.state.isLandingPatternUnlocked=e):n==="calculateJump"&&(this.state.unlockedFeatures.calculateJump=e,this.state.isCalculateJumpUnlocked=e),this.saveUnlockedFeatures(),console.log("Saved unlock status:",{landingPattern:this.state.isLandingPatternUnlocked,calculateJump:this.state.isCalculateJumpUnlocked})}catch{Utils.handleError("Failed to save unlock status.")}},showPasswordModal(n,e,a){console.log("Entering showPasswordModal for feature:",n);const o=document.getElementById("passwordModal"),s=document.getElementById("passwordInput"),l=document.getElementById("passwordError"),c=document.getElementById("passwordSubmit"),d=document.getElementById("passwordCancel"),f=document.getElementById("modalHeader"),p=document.getElementById("modalMessage");if(!o||!s||!c||!d||!f||!p){console.error("Modal elements not found:",{modal:o,input:s,submitBtn:c,cancelBtn:d,header:f,message:p});return}const g=n==="landingPattern"?"Landing Pattern":"Calculate Jump";f.textContent=`${g} Access`,p.textContent=`Please enter the password to enable ${g.toLowerCase()}:`,s.value="",l.style.display="none",o.style.display="flex",console.log("Password modal should now be visible:",{modalDisplay:o.style.display});const y=()=>{if(console.log("Password modal submit clicked, entered value:",s.value),s.value===vu){if(o.style.display="none",this.saveUnlockStatus(n,!0),n==="landingPattern"){const v=document.getElementById("showLandingPattern");v&&(v.style.opacity="1",v.title="")}else if(n==="calculateJump"){const v=document.querySelector('.menu-label[data-label="calculateJump"]');v&&(v.style.opacity="1",v.title="")}console.log("Feature unlocked:",n),e()}else l.textContent="Incorrect password",l.style.display="block",console.log("Incorrect password entered")};c.onclick=y,s.onkeypress=v=>{v.key==="Enter"&&y()},d.onclick=()=>{o.style.display="none",console.log("Password modal cancelled"),a()}},saveUnlockedFeatures(){try{const n=JSON.stringify(this.state.unlockedFeatures);localStorage.setItem("unlockedFeatures",n),console.log("Unlocked features saved:",JSON.parse(n))}catch(n){this.handleError(n,"Failed to save unlocked features to localStorage.")}},getValue(n,e="radio",a){const o=e==="radio"?`input[name="${n}"]:checked`:`#${n}`,s=document.querySelector(o);if(!s)return console.warn(`Setting element not found: ${o}`),a;const l=s.value;return console.log(`Retrieved setting ${n}: ${l}`),l},updateUnitLabels(){const n=this.getValue("heightUnit","radio","m"),e=this.getValue("windUnit","radio","kt"),a=this.getValue("refLevel","radio","AGL"),o=document.querySelector('#controls-row label[for="interpStepSelect"]');o&&(o.textContent=`Step (${n}):`,console.log(`Updated step label to: Step (${n})`));const s=document.querySelector('label[for="lowerLimit"]'),l=document.querySelector('label[for="upperLimit"]');s&&(s.textContent=`Lower Limit (${n}):`,console.log(`Updated lower limit label to: Lower Limit (${n})`)),l&&(l.textContent=`Upper Limit (${n}):`,console.log(`Updated upper limit label to: Upper Limit (${n})`));const c=document.getElementById("meanWindResult");if(c!=null&&c.innerHTML){let d=c.innerHTML;const f=/\((\d+)-(\d+) m\b[^)]*\)/;if(f.test(d)){const[g,y,v]=d.match(f),M=this.convertHeight(parseFloat(y),n),b=this.convertHeight(parseFloat(v),n);d=d.replace(f,`(${Math.round(M)}-${Math.round(b)} ${n} ${a})`),console.log(`Updated mean wind height: (${Math.round(M)}-${Math.round(b)} ${n} ${a})`)}const p=/: (\d+(?:\.\d+)?)\s*([a-zA-Z\/]+)$/;if(p.test(d)){const[g,y,v]=d.match(p),M=parseFloat(y);if(!isNaN(M)){const b=this.convertWind(M,e,v),S=b==="N/A"?"N/A":e==="bft"?Math.round(b):b.toFixed(1);d=d.replace(p,`: ${S} ${e}`),console.log(`Updated mean wind speed: ${S} ${e}`)}}c.innerHTML=d}},updateModelRunInfo(n,e,a){const o=document.getElementById("modelLabel"),s=document.getElementById("modelSelect");if(!o||!s){console.warn("Model run info elements missing:",{modelLabel:o,modelSelect:s,lastModelRun:n,lastLat:e,lastLng:a});return}if(!n){console.log("lastModelRun is falsy, setting default model run info:",{lastModelRun:n,lastLat:e,lastLng:a}),o.title=`Model: ${s.value.replace("_"," ").toUpperCase()}
Run: Not available`;return}const l=s.value,c=`Model: ${l.replace("_"," ").toUpperCase()}
Run: ${n}`;o.title=c,console.log(`Updated model run info: ${c}`,{lastModelRun:n,model:l,lastLat:e,lastLng:a})},handleError(n,e="An error occurred. Please try again."){console.error("Settings Error:",n),Utils.handleError(e)},convertHeight(n,e){return isNaN(n)?n:e==="ft"?n*3.28084:n},convertWind(n,e,a){var s,l;return isNaN(n)?"N/A":((l=(s={kt:{"m/s":c=>c*.514444,"km/h":c=>c*1.852,mph:c=>c*1.15078,bft:c=>this.ktToBeaufort(c)},"m/s":{kt:c=>c/.514444,"km/h":c=>c*3.6,mph:c=>c*2.23694,bft:c=>this.ktToBeaufort(c/.514444)}}[a])==null?void 0:s[e])==null?void 0:l.call(s,n))||n},ktToBeaufort(n){return n<1?0:n<=3?1:n<=6?2:n<=10?3:n<=16?4:n<=21?5:n<=27?6:n<=33?7:n<=40?8:n<=47?9:n<=55?10:n<=63?11:12},isFeatureUnlocked(n){return!!this.state.unlockedFeatures[n]}};function Br(n){const e=_.state.userSettings.exitAltitude*Qt.METERS_TO_FEET,a=T.calculateTAS(n,e);if(a==="N/A")return console.warn("TAS calculation failed, using default separation"),_.defaultSettings.jumperSeparation;const o=Object.keys(Ys).map(Number).sort((c,d)=>d-c);let s=o[0];for(const c of o)if(a<=c)s=c;else break;return Ys[s]||7}function Ur(n,e,a,o,s,l,c){if(!n||!n.time||!o||o.length===0||!Number.isFinite(s)||!Number.isFinite(l)||!Number.isFinite(c))return null;const d=c+e,f=c+a-Fe,p=wa(o),g=p?p.direction:0,y=_.state.userSettings.aircraftSpeedKt,v=e/.3048,M=T.calculateTAS(y,v);let b=M==="N/A"?y*Qt.KNOTS_TO_MPS:M*Qt.KNOTS_TO_MPS;const S=Math.cos(g*Math.PI/180)*b,P=Math.sin(g*Math.PI/180)*b,x=o.map(F=>F.height),A=o.map(F=>Number.isFinite(F.dir)?parseFloat(F.dir):0),N=o.map(F=>T.convertWind(parseFloat(F.spd)||0,"m/s","km/h")),I=o.map(F=>F.temp),B=[{time:0,height:d,vz:0,vxGround:S,vyGround:P,x:0,y:0}],U=n.surface_pressure[0]||1013.25;let $=B[0];for(;$.height>f;){const F=T.linearInterpolate(x,A,$.height),z=T.linearInterpolate(x,N,$.height),it=T.linearInterpolate(x,I,$.height)+Qt.CELSIUS_TO_KELVIN,bt=_n.GAS_CONSTANT_AIR,et=.5,at=U*100*Math.exp(-9.80665*($.height-c)/(bt*it))/(bt*it),G=(F+180)%360,tt=z*Math.cos(G*Math.PI/180),J=z*Math.sin(G*Math.PI/180),Z=$.vxGround-tt,nt=$.vyGround-J,V=Math.sqrt(Z*Z+nt*nt),lt=1,Y=ea.DEFAULT_AREA_VERTICAL,j=ea.DEFAULT_MASS_KG,ft=ea.DEFAULT_DRAG_COEFFICIENT,X=ea.DEFAULT_AREA_HORIZONTAL,ht=.5*lt*Y*at/j,wt=.5*ft*X*at/j,rt=-9.80665-ht*$.vz*Math.abs($.vz),Lt=-wt*V*Z,kt=-wt*V*nt;let pt=$.height+$.vz*et,mt=$.vz+rt*et,ct=$.time+et;if(pt<=f){const yt=($.height-f)/($.height-pt);ct=$.time+et*yt,pt=f,mt=$.vz+rt*et*yt}const Dt={time:ct,height:pt,vz:mt,vxGround:S===0?tt:$.vxGround+Lt*et,vyGround:P===0?J:$.vyGround+kt*et,x:$.x+(S===0?tt:$.vxGround)*et,y:$.y+(P===0?J:$.vyGround)*et};if(B.push(Dt),$=Dt,Dt.height===f)break}const k=B[B.length-1],C=Math.sqrt(k.x*k.x+k.y*k.y);let O=Math.atan2(k.y,k.x)*180/Math.PI;return O=(O+360)%360,{time:k.time,distance:C,directionDeg:O,path:B.map(F=>({latLng:T.calculateNewCenter(s,l,Math.sqrt(F.x*F.x+F.y*F.y),Math.atan2(F.y,F.x)*180/Math.PI),height:F.height,time:F.time}))}}function Hr(n){var C,O,F,z,W;if(!_.state.userSettings.showExitArea||!_.state.userSettings.calculateJump||!u.weatherData||!u.lastLat||!u.lastLng||!n||n.length===0)return null;const e=parseInt((C=document.getElementById("exitAltitude"))==null?void 0:C.value)||3e3,a=parseInt((O=document.getElementById("openingAltitude"))==null?void 0:O.value)||1200,o=parseInt((F=document.getElementById("legHeightDownwind"))==null?void 0:F.value)||300,s=parseFloat((z=document.getElementById("descentRate"))==null?void 0:z.value)||3.5,l=(parseFloat((W=document.getElementById("canopySpeed"))==null?void 0:W.value)||20)*Qt.KNOTS_TO_MPS,c=n.map(it=>it.height),d=n.map(it=>-T.convertWind(it.spd,"m/s","km/h")*Math.sin(it.dir*Math.PI/180)),f=n.map(it=>-T.convertWind(it.spd,"m/s","km/h")*Math.cos(it.dir*Math.PI/180)),p=Math.round(u.lastAltitude),g=(a-Fe-o)/s,y=g*l,v=(a-Fe)/s,M=v*l,b=T.calculateMeanWind(c,d,f,p+o,p+a-Fe),S=T.calculateMeanWind(c,d,f,p,p+a-Fe),P=Zr(u.lastLat,u.lastLng,n);let{downwindLat:x,downwindLng:A}=P;Number.isFinite(x)||(x=u.lastLat,A=u.lastLng);const N=T.calculateNewCenter(x,A,b[1]*g,b[0]),I=T.calculateNewCenter(u.lastLat,u.lastLng,S[1]*v,S[0]),B=Ur(u.weatherData,e,a,n,u.lastLat,u.lastLng,p);if(!B)return null;const U=(B.directionDeg+180)%360,$=T.calculateNewCenter(I[0],I[1],B.distance,U),k=T.calculateNewCenter(N[0],N[1],B.distance,U);return{greenLat:$[0],greenLng:$[1],darkGreenLat:k[0],darkGreenLng:k[1],greenRadius:M,darkGreenRadius:y,freeFallDirection:B.directionDeg,freeFallDistance:B.distance,freeFallTime:B.time}}function Ge(n){if(!u.map||u.cutAwayLat===null||u.cutAwayLng===null||!u.weatherData||u.lastAltitude==="N/A"||!n||n.length===0)return null;const e=Math.round(u.lastAltitude),a=_.state.userSettings.cutAwayAltitude,o=e,s=e+a,l=n.map(I=>I.height),c=n.map(I=>-T.convertWind(I.spd,"m/s","km/h")*Math.sin(I.dir*Math.PI/180)),d=n.map(I=>-T.convertWind(I.spd,"m/s","km/h")*Math.cos(I.dir*Math.PI/180)),f=T.calculateMeanWind(l,c,d,o,s);if(!f)return null;const[p,g]=f,y={Open:ao.OPEN,Partially:ao.PARTIALLY,Collapsed:ao.COLLAPSED},v=y[_.state.userSettings.cutAwayState]||y.Partially,M=a/v,b=g*M,S=(p+180)%360,[P,x]=T.calculateNewCenter(u.cutAwayLat,u.cutAwayLng,b,S),N=`<b>Cut-Away (${_.state.userSettings.cutAwayState.replace(/([A-Z])/g," $1").trim()})</b><br>Cut-Away Altitude: ${a} m<br>Displacement: ${p.toFixed(0)}°, ${b.toFixed(0)} m<br>Descent Time/Speed: ${M.toFixed(0)} s at ${v.toFixed(1)} m/s<br>`;return{center:[P,x],radius:Mu,tooltipContent:N}}function bu(n){var F,z,W,it,bt;if(!_.state.userSettings.showCanopyArea||!_.state.userSettings.calculateJump||!u.weatherData||!u.lastLat||!u.lastLng||!n||n.length===0)return null;const e=parseInt((F=document.getElementById("exitAltitude"))==null?void 0:F.value)||3e3,a=parseInt((z=document.getElementById("openingAltitude"))==null?void 0:z.value)||1200,o=parseInt((W=document.getElementById("legHeightDownwind"))==null?void 0:W.value)||300,s=parseFloat((it=document.getElementById("descentRate"))==null?void 0:it.value)||3.5,l=(parseFloat((bt=document.getElementById("canopySpeed"))==null?void 0:bt.value)||20)*Qt.KNOTS_TO_MPS,c=n.map(et=>et.height),d=n.map(et=>-T.convertWind(et.spd,"m/s","km/h")*Math.sin(et.dir*Math.PI/180)),f=n.map(et=>-T.convertWind(et.spd,"m/s","km/h")*Math.cos(et.dir*Math.PI/180)),p=Math.round(u.lastAltitude),g=(a-Fe-o)/s,y=g*l,v=(a-Fe)/s,M=v*l,b=T.calculateMeanWind(c,d,f,p+o,p+a-Fe),S=T.calculateMeanWind(c,d,f,p,p+a-Fe),P=Ur(u.weatherData,e,a,n,u.lastLat,u.lastLng,p);if(!P)return null;const x=Zr(u.lastLat,u.lastLng,n);let{downwindLat:A,downwindLng:N}=x;Number.isFinite(A)||(A=u.lastLat,N=u.lastLng);const I=p+a-Fe,B=p+o,U=[],$=[],k=[],C=[];let O=I-B<=1e3?200:500;for(let et=I;et>=B+200;et-=O){const at=(et-B)/s,G=at*l;if(G>0){const tt=T.calculateMeanWind(c,d,f,B,et);U.push(G),$.push(tt[1]*at),k.push(tt[0]),C.push(et-p)}}return{blueLat:A,blueLng:N,redLat:u.lastLat,redLng:u.lastLng,radius:y,radiusFull:M,additionalBlueRadii:U,additionalBlueDisplacements:$,additionalBlueDirections:k,additionalBlueUpperLimits:C,displacement:b[1]*g,direction:b[0],displacementFull:S[1]*v,directionFull:S[0],meanWindForFullCanopyDir:S[0],meanWindForFullCanopySpeedMps:S[1],freeFallDirection:P.directionDeg,freeFallDistance:P.distance,freeFallTime:P.time}}function wa(n){var O,F;if(!u.weatherData||!u.lastLat||!u.lastLng||u.lastAltitude==="N/A"||!n||n.length===0)return null;const e=parseInt((O=document.getElementById("openingAltitude"))==null?void 0:O.value)||1e3,a=Math.round(u.lastAltitude),o=n.map(z=>z.height),s=n.map(z=>-T.convertWind(z.spd,"m/s","km/h")*Math.sin(z.dir*Math.PI/180)),l=n.map(z=>-T.convertWind(z.spd,"m/s","km/h")*Math.cos(z.dir*Math.PI/180)),c=T.calculateMeanWind(o,s,l,a,a+e);if(!c)return null;let d=Math.round(c[0]);const f=parseFloat(_.state.userSettings.customJumpRunDirection);Number.isFinite(f)&&f>=0&&f<=359&&(d=f);const p=parseInt((F=document.getElementById("exitAltitude"))==null?void 0:F.value)||3e3,g=a+p,y=T.calculateTAS(_.state.userSettings.aircraftSpeedKt||90,g/.3048);let v=null,M=2e3,b=2e3,S=null;if(y!=="N/A"&&Number.isFinite(y)){const z=T.linearInterpolate(o.map(Z=>Z-a),n.map(Z=>Z.dir),p),W=T.linearInterpolate(o.map(Z=>Z-a),n.map(Z=>T.convertWind(Z.spd,"m/s","km/h")),p),it=y*Qt.KNOTS_TO_MPS,bt=(z+180)*Math.PI/180,et=W*Math.sin(bt),at=W*Math.cos(bt),G=d*Math.PI/180,tt=it*Math.sin(G),J=it*Math.cos(G);v=Math.sqrt(Math.pow(tt+et,2)+Math.pow(J+at,2)),M=Math.max(On.MIN_TRACK_LENGTH_M,Math.min(On.MAX_TRACK_LENGTH_M,Math.round((_.state.userSettings.numberOfJumpers||10)*(_.state.userSettings.jumperSeparation||5)*v))),b=Math.max(On.MIN_APPROACH_LENGTH_M,Math.min(On.MAX_APPROACH_LENGTH_M,Math.round(v*On.APPROACH_TIME_SECONDS)))}const P=_.state.userSettings.jumpRunTrackOffset||0,x=_.state.userSettings.jumpRunTrackForwardOffset||0,A=(Math.atan2(P,x)*180/Math.PI+360)%360,N=Math.sqrt(P**2+x**2),I=(d+A+360)%360,[B,U]=T.calculateNewCenter(u.lastLat,u.lastLng,N,I),$=M/2,k=T.calculateNewCenter(B,U,$,(d+180)%360),C=T.calculateNewCenter(B,U,$,d);if(v){const z=T.calculateNewCenter(k[0],k[1],b,(d+180)%360);S=[k,z]}return{direction:d,trackLength:M,meanWindDirection:c[0],meanWindSpeed:c[1],latlngs:[k,C],approachLatLngs:S,approachLength:b,approachTime:On.APPROACH_TIME_SECONDS}}function Zr(n,e,a){var F,z;if(!a||a.length===0)return{downwindLat:n,downwindLng:e};const o=parseInt(document.getElementById("canopySpeed").value)||20,s=parseFloat(document.getElementById("descentRate").value)||3.5,l=parseInt(document.getElementById("legHeightFinal").value)||100,c=parseInt(document.getElementById("legHeightBase").value)||200,d=parseInt(document.getElementById("legHeightDownwind").value)||300,f=Math.round(u.lastAltitude),p=a.map(W=>W.height),g=a.map(W=>-T.convertWind(W.spd,"kt","km/h")*Math.sin(W.dir*Math.PI/180)),y=a.map(W=>-T.convertWind(W.spd,"kt","km/h")*Math.cos(W.dir*Math.PI/180)),v=((F=document.querySelector('input[name="landingDirection"]:checked'))==null?void 0:F.value)||"LL",M=parseInt((z=document.getElementById(v==="LL"?"customLandingDirectionLL":"customLandingDirectionRR"))==null?void 0:z.value,10);let b=Number.isFinite(M)?M:Number.isFinite(u.landingWindDir)?u.landingWindDir:a[0].dir;const S=(W,it,bt,et,at)=>{const tt=et*Qt.KNOTS_TO_MPS*at,[J,Z]=T.calculateNewCenter(W,it,tt,bt);return[J,Z]},P=T.calculateMeanWind(p,g,y,f,f+l),x=(b+180)%360,A=T.calculateGroundSpeed(o,T.calculateWindComponents(P[1],T.calculateWindAngle(x,P[0])).headwind),N=S(n,e,x,A,l/s),I=T.calculateMeanWind(p,g,y,f+l,f+c),B=(b+(v==="LL"?90:-90)+360)%360,U=T.calculateCourseFromHeading(B,I[0],I[1],o),$=S(N[0],N[1],(U.trueCourse+180)%360,U.groundSpeed,(c-l)/s),k=T.calculateMeanWind(p,g,y,f+c,f+d),C=T.calculateGroundSpeed(o,T.calculateWindComponents(k[1],T.calculateWindAngle(b,k[0])).headwind),O=S($[0],$[1],b,C,(d-c)/s);return{downwindLat:O[0],downwindLng:O[1]}}class wn extends Error{}class Tu extends wn{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Su extends wn{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class ku extends wn{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Bn extends wn{}class Wr extends wn{constructor(e){super(`Invalid unit ${e}`)}}class te extends wn{}class Xe extends wn{constructor(){super("Zone is an abstract class")}}const q="numeric",Ce="short",ue="long",ma={year:q,month:q,day:q},Gr={year:q,month:Ce,day:q},Pu={year:q,month:Ce,day:q,weekday:Ce},Vr={year:q,month:ue,day:q},jr={year:q,month:ue,day:q,weekday:ue},Jr={hour:q,minute:q},qr={hour:q,minute:q,second:q},Kr={hour:q,minute:q,second:q,timeZoneName:Ce},Yr={hour:q,minute:q,second:q,timeZoneName:ue},Xr={hour:q,minute:q,hourCycle:"h23"},Qr={hour:q,minute:q,second:q,hourCycle:"h23"},tl={hour:q,minute:q,second:q,hourCycle:"h23",timeZoneName:Ce},el={hour:q,minute:q,second:q,hourCycle:"h23",timeZoneName:ue},nl={year:q,month:q,day:q,hour:q,minute:q},il={year:q,month:q,day:q,hour:q,minute:q,second:q},al={year:q,month:Ce,day:q,hour:q,minute:q},ol={year:q,month:Ce,day:q,hour:q,minute:q,second:q},Eu={year:q,month:Ce,day:q,weekday:Ce,hour:q,minute:q},sl={year:q,month:ue,day:q,hour:q,minute:q,timeZoneName:Ce},rl={year:q,month:ue,day:q,hour:q,minute:q,second:q,timeZoneName:Ce},ll={year:q,month:ue,day:q,weekday:ue,hour:q,minute:q,timeZoneName:ue},cl={year:q,month:ue,day:q,weekday:ue,hour:q,minute:q,second:q,timeZoneName:ue};class Ti{get type(){throw new Xe}get name(){throw new Xe}get ianaName(){return this.name}get isUniversal(){throw new Xe}offsetName(e,a){throw new Xe}formatOffset(e,a){throw new Xe}offset(e){throw new Xe}equals(e){throw new Xe}get isValid(){throw new Xe}}let oo=null;class La extends Ti{static get instance(){return oo===null&&(oo=new La),oo}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:a,locale:o}){return wl(e,a,o)}formatOffset(e,a){return _i(this.offset(e),a)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}const Mo=new Map;function Cu(n){let e=Mo.get(n);return e===void 0&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),Mo.set(n,e)),e}const xu={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Au(n,e){const a=n.format(e).replace(/\u200E/g,""),o=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(a),[,s,l,c,d,f,p,g]=o;return[c,s,l,d,f,p,g]}function Iu(n,e){const a=n.formatToParts(e),o=[];for(let s=0;s<a.length;s++){const{type:l,value:c}=a[s],d=xu[l];l==="era"?o[d]=c:dt(d)||(o[d]=parseInt(c,10))}return o}const so=new Map;class Je extends Ti{static create(e){let a=so.get(e);return a===void 0&&so.set(e,a=new Je(e)),a}static resetCache(){so.clear(),Mo.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Je.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:a,locale:o}){return wl(e,a,o,this.name)}formatOffset(e,a){return _i(this.offset(e),a)}offset(e){if(!this.valid)return NaN;const a=new Date(e);if(isNaN(a))return NaN;const o=Cu(this.name);let[s,l,c,d,f,p,g]=o.formatToParts?Iu(o,a):Au(o,a);d==="BC"&&(s=-Math.abs(s)+1);const v=ba({year:s,month:l,day:c,hour:f===24?0:f,minute:p,second:g,millisecond:0});let M=+a;const b=M%1e3;return M-=b>=0?b:1e3+b,(v-M)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let tr={};function Du(n,e={}){const a=JSON.stringify([n,e]);let o=tr[a];return o||(o=new Intl.ListFormat(n,e),tr[a]=o),o}const bo=new Map;function To(n,e={}){const a=JSON.stringify([n,e]);let o=bo.get(a);return o===void 0&&(o=new Intl.DateTimeFormat(n,e),bo.set(a,o)),o}const So=new Map;function Ou(n,e={}){const a=JSON.stringify([n,e]);let o=So.get(a);return o===void 0&&(o=new Intl.NumberFormat(n,e),So.set(a,o)),o}const ko=new Map;function Nu(n,e={}){const{base:a,...o}=e,s=JSON.stringify([n,o]);let l=ko.get(s);return l===void 0&&(l=new Intl.RelativeTimeFormat(n,e),ko.set(s,l)),l}let hi=null;function Fu(){return hi||(hi=new Intl.DateTimeFormat().resolvedOptions().locale,hi)}const Po=new Map;function ul(n){let e=Po.get(n);return e===void 0&&(e=new Intl.DateTimeFormat(n).resolvedOptions(),Po.set(n,e)),e}const Eo=new Map;function Ru(n){let e=Eo.get(n);if(!e){const a=new Intl.Locale(n);e="getWeekInfo"in a?a.getWeekInfo():a.weekInfo,"minimalDays"in e||(e={...hl,...e}),Eo.set(n,e)}return e}function zu(n){const e=n.indexOf("-x-");e!==-1&&(n=n.substring(0,e));const a=n.indexOf("-u-");if(a===-1)return[n];{let o,s;try{o=To(n).resolvedOptions(),s=n}catch{const f=n.substring(0,a);o=To(f).resolvedOptions(),s=f}const{numberingSystem:l,calendar:c}=o;return[s,l,c]}}function $u(n,e,a){return(a||e)&&(n.includes("-u-")||(n+="-u"),a&&(n+=`-ca-${a}`),e&&(n+=`-nu-${e}`)),n}function Bu(n){const e=[];for(let a=1;a<=12;a++){const o=ot.utc(2009,a,1);e.push(n(o))}return e}function Uu(n){const e=[];for(let a=1;a<=7;a++){const o=ot.utc(2016,11,13+a);e.push(n(o))}return e}function ia(n,e,a,o){const s=n.listingMode();return s==="error"?null:s==="en"?a(e):o(e)}function Hu(n){return n.numberingSystem&&n.numberingSystem!=="latn"?!1:n.numberingSystem==="latn"||!n.locale||n.locale.startsWith("en")||ul(n.locale).numberingSystem==="latn"}class Zu{constructor(e,a,o){this.padTo=o.padTo||0,this.floor=o.floor||!1;const{padTo:s,floor:l,...c}=o;if(!a||Object.keys(c).length>0){const d={useGrouping:!1,...o};o.padTo>0&&(d.minimumIntegerDigits=o.padTo),this.inf=Ou(e,d)}}format(e){if(this.inf){const a=this.floor?Math.floor(e):e;return this.inf.format(a)}else{const a=this.floor?Math.floor(e):Wo(e,3);return Gt(a,this.padTo)}}}class Wu{constructor(e,a,o){this.opts=o,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const c=-1*(e.offset/60),d=c>=0?`Etc/GMT+${c}`:`Etc/GMT${c}`;e.offset!==0&&Je.create(d).valid?(s=d,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const l={...this.opts};l.timeZone=l.timeZone||s,this.dtf=To(a,l)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(a=>{if(a.type==="timeZoneName"){const o=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...a,value:o}}else return a}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Gu{constructor(e,a,o){this.opts={style:"long",...o},!a&&yl()&&(this.rtf=Nu(e,o))}format(e,a){return this.rtf?this.rtf.format(e,a):fh(a,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,a){return this.rtf?this.rtf.formatToParts(e,a):[]}}const hl={firstDay:1,minimalDays:4,weekend:[6,7]};class xt{static fromOpts(e){return xt.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,a,o,s,l=!1){const c=e||Ut.defaultLocale,d=c||(l?"en-US":Fu()),f=a||Ut.defaultNumberingSystem,p=o||Ut.defaultOutputCalendar,g=xo(s)||Ut.defaultWeekSettings;return new xt(d,f,p,g,c)}static resetCache(){hi=null,bo.clear(),So.clear(),ko.clear(),Po.clear(),Eo.clear()}static fromObject({locale:e,numberingSystem:a,outputCalendar:o,weekSettings:s}={}){return xt.create(e,a,o,s)}constructor(e,a,o,s,l){const[c,d,f]=zu(e);this.locale=c,this.numberingSystem=a||d||null,this.outputCalendar=o||f||null,this.weekSettings=s,this.intl=$u(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=l,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Hu(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),a=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&a?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:xt.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,xo(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,a=!1){return ia(this,e,bl,()=>{const o=a?{month:e,day:"numeric"}:{month:e},s=a?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=Bu(l=>this.extract(l,o,"month"))),this.monthsCache[s][e]})}weekdays(e,a=!1){return ia(this,e,kl,()=>{const o=a?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=a?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=Uu(l=>this.extract(l,o,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return ia(this,void 0,()=>Pl,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ot.utc(2016,11,13,9),ot.utc(2016,11,13,19)].map(a=>this.extract(a,e,"dayperiod"))}return this.meridiemCache})}eras(e){return ia(this,e,El,()=>{const a={era:e};return this.eraCache[e]||(this.eraCache[e]=[ot.utc(-40,1,1),ot.utc(2017,1,1)].map(o=>this.extract(o,a,"era"))),this.eraCache[e]})}extract(e,a,o){const s=this.dtFormatter(e,a),l=s.formatToParts(),c=l.find(d=>d.type.toLowerCase()===o);return c?c.value:null}numberFormatter(e={}){return new Zu(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,a={}){return new Wu(e,this.intl,a)}relFormatter(e={}){return new Gu(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Du(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||ul(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:vl()?Ru(this.locale):hl}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let ro=null;class oe extends Ti{static get utcInstance(){return ro===null&&(ro=new oe(0)),ro}static instance(e){return e===0?oe.utcInstance:new oe(e)}static parseSpecifier(e){if(e){const a=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(a)return new oe(Ta(a[1],a[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${_i(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${_i(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,a){return _i(this.fixed,a)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Vu extends Ti{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function an(n,e){if(dt(n)||n===null)return e;if(n instanceof Ti)return n;if(Xu(n)){const a=n.toLowerCase();return a==="default"?e:a==="local"||a==="system"?La.instance:a==="utc"||a==="gmt"?oe.utcInstance:oe.parseSpecifier(a)||Je.create(n)}else return on(n)?oe.instance(n):typeof n=="object"&&"offset"in n&&typeof n.offset=="function"?n:new Vu(n)}const Bo={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},er={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},ju=Bo.hanidec.replace(/[\[|\]]/g,"").split("");function Ju(n){let e=parseInt(n,10);if(isNaN(e)){e="";for(let a=0;a<n.length;a++){const o=n.charCodeAt(a);if(n[a].search(Bo.hanidec)!==-1)e+=ju.indexOf(n[a]);else for(const s in er){const[l,c]=er[s];o>=l&&o<=c&&(e+=o-l)}}return parseInt(e,10)}else return e}const Co=new Map;function qu(){Co.clear()}function ke({numberingSystem:n},e=""){const a=n||"latn";let o=Co.get(a);o===void 0&&(o=new Map,Co.set(a,o));let s=o.get(e);return s===void 0&&(s=new RegExp(`${Bo[a]}${e}`),o.set(e,s)),s}let nr=()=>Date.now(),ir="system",ar=null,or=null,sr=null,rr=60,lr,cr=null;class Ut{static get now(){return nr}static set now(e){nr=e}static set defaultZone(e){ir=e}static get defaultZone(){return an(ir,La.instance)}static get defaultLocale(){return ar}static set defaultLocale(e){ar=e}static get defaultNumberingSystem(){return or}static set defaultNumberingSystem(e){or=e}static get defaultOutputCalendar(){return sr}static set defaultOutputCalendar(e){sr=e}static get defaultWeekSettings(){return cr}static set defaultWeekSettings(e){cr=xo(e)}static get twoDigitCutoffYear(){return rr}static set twoDigitCutoffYear(e){rr=e%100}static get throwOnInvalid(){return lr}static set throwOnInvalid(e){lr=e}static resetCaches(){xt.resetCache(),Je.resetCache(),ot.resetCache(),qu()}}class Ee{constructor(e,a){this.reason=e,this.explanation=a}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const dl=[0,31,59,90,120,151,181,212,243,273,304,334],fl=[0,31,60,91,121,152,182,213,244,274,305,335];function Le(n,e){return new Ee("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${n}, which is invalid`)}function Uo(n,e,a){const o=new Date(Date.UTC(n,e-1,a));n<100&&n>=0&&o.setUTCFullYear(o.getUTCFullYear()-1900);const s=o.getUTCDay();return s===0?7:s}function ml(n,e,a){return a+(Si(n)?fl:dl)[e-1]}function pl(n,e){const a=Si(n)?fl:dl,o=a.findIndex(l=>l<e),s=e-a[o];return{month:o+1,day:s}}function Ho(n,e){return(n-e+7)%7+1}function pa(n,e=4,a=1){const{year:o,month:s,day:l}=n,c=ml(o,s,l),d=Ho(Uo(o,s,l),a);let f=Math.floor((c-d+14-e)/7),p;return f<1?(p=o-1,f=vi(p,e,a)):f>vi(o,e,a)?(p=o+1,f=1):p=o,{weekYear:p,weekNumber:f,weekday:d,...Sa(n)}}function ur(n,e=4,a=1){const{weekYear:o,weekNumber:s,weekday:l}=n,c=Ho(Uo(o,1,e),a),d=Hn(o);let f=s*7+l-c-7+e,p;f<1?(p=o-1,f+=Hn(p)):f>d?(p=o+1,f-=Hn(o)):p=o;const{month:g,day:y}=pl(p,f);return{year:p,month:g,day:y,...Sa(n)}}function lo(n){const{year:e,month:a,day:o}=n,s=ml(e,a,o);return{year:e,ordinal:s,...Sa(n)}}function hr(n){const{year:e,ordinal:a}=n,{month:o,day:s}=pl(e,a);return{year:e,month:o,day:s,...Sa(n)}}function dr(n,e){if(!dt(n.localWeekday)||!dt(n.localWeekNumber)||!dt(n.localWeekYear)){if(!dt(n.weekday)||!dt(n.weekNumber)||!dt(n.weekYear))throw new Bn("Cannot mix locale-based week fields with ISO-based week fields");return dt(n.localWeekday)||(n.weekday=n.localWeekday),dt(n.localWeekNumber)||(n.weekNumber=n.localWeekNumber),dt(n.localWeekYear)||(n.weekYear=n.localWeekYear),delete n.localWeekday,delete n.localWeekNumber,delete n.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function Ku(n,e=4,a=1){const o=Ma(n.weekYear),s=Me(n.weekNumber,1,vi(n.weekYear,e,a)),l=Me(n.weekday,1,7);return o?s?l?!1:Le("weekday",n.weekday):Le("week",n.weekNumber):Le("weekYear",n.weekYear)}function Yu(n){const e=Ma(n.year),a=Me(n.ordinal,1,Hn(n.year));return e?a?!1:Le("ordinal",n.ordinal):Le("year",n.year)}function gl(n){const e=Ma(n.year),a=Me(n.month,1,12),o=Me(n.day,1,ga(n.year,n.month));return e?a?o?!1:Le("day",n.day):Le("month",n.month):Le("year",n.year)}function _l(n){const{hour:e,minute:a,second:o,millisecond:s}=n,l=Me(e,0,23)||e===24&&a===0&&o===0&&s===0,c=Me(a,0,59),d=Me(o,0,59),f=Me(s,0,999);return l?c?d?f?!1:Le("millisecond",s):Le("second",o):Le("minute",a):Le("hour",e)}function dt(n){return typeof n>"u"}function on(n){return typeof n=="number"}function Ma(n){return typeof n=="number"&&n%1===0}function Xu(n){return typeof n=="string"}function Qu(n){return Object.prototype.toString.call(n)==="[object Date]"}function yl(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function vl(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function th(n){return Array.isArray(n)?n:[n]}function fr(n,e,a){if(n.length!==0)return n.reduce((o,s)=>{const l=[e(s),s];return o&&a(o[0],l[0])===o[0]?o:l},null)[1]}function eh(n,e){return e.reduce((a,o)=>(a[o]=n[o],a),{})}function Wn(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function xo(n){if(n==null)return null;if(typeof n!="object")throw new te("Week settings must be an object");if(!Me(n.firstDay,1,7)||!Me(n.minimalDays,1,7)||!Array.isArray(n.weekend)||n.weekend.some(e=>!Me(e,1,7)))throw new te("Invalid week settings");return{firstDay:n.firstDay,minimalDays:n.minimalDays,weekend:Array.from(n.weekend)}}function Me(n,e,a){return Ma(n)&&n>=e&&n<=a}function nh(n,e){return n-e*Math.floor(n/e)}function Gt(n,e=2){const a=n<0;let o;return a?o="-"+(""+-n).padStart(e,"0"):o=(""+n).padStart(e,"0"),o}function en(n){if(!(dt(n)||n===null||n===""))return parseInt(n,10)}function pn(n){if(!(dt(n)||n===null||n===""))return parseFloat(n)}function Zo(n){if(!(dt(n)||n===null||n==="")){const e=parseFloat("0."+n)*1e3;return Math.floor(e)}}function Wo(n,e,a=!1){const o=10**e;return(a?Math.trunc:Math.round)(n*o)/o}function Si(n){return n%4===0&&(n%100!==0||n%400===0)}function Hn(n){return Si(n)?366:365}function ga(n,e){const a=nh(e-1,12)+1,o=n+(e-a)/12;return a===2?Si(o)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][a-1]}function ba(n){let e=Date.UTC(n.year,n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond);return n.year<100&&n.year>=0&&(e=new Date(e),e.setUTCFullYear(n.year,n.month-1,n.day)),+e}function mr(n,e,a){return-Ho(Uo(n,1,e),a)+e-1}function vi(n,e=4,a=1){const o=mr(n,e,a),s=mr(n+1,e,a);return(Hn(n)-o+s)/7}function Ao(n){return n>99?n:n>Ut.twoDigitCutoffYear?1900+n:2e3+n}function wl(n,e,a,o=null){const s=new Date(n),l={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};o&&(l.timeZone=o);const c={timeZoneName:e,...l},d=new Intl.DateTimeFormat(a,c).formatToParts(s).find(f=>f.type.toLowerCase()==="timezonename");return d?d.value:null}function Ta(n,e){let a=parseInt(n,10);Number.isNaN(a)&&(a=0);const o=parseInt(e,10)||0,s=a<0||Object.is(a,-0)?-o:o;return a*60+s}function Ll(n){const e=Number(n);if(typeof n=="boolean"||n===""||Number.isNaN(e))throw new te(`Invalid unit value ${n}`);return e}function _a(n,e){const a={};for(const o in n)if(Wn(n,o)){const s=n[o];if(s==null)continue;a[e(o)]=Ll(s)}return a}function _i(n,e){const a=Math.trunc(Math.abs(n/60)),o=Math.trunc(Math.abs(n%60)),s=n>=0?"+":"-";switch(e){case"short":return`${s}${Gt(a,2)}:${Gt(o,2)}`;case"narrow":return`${s}${a}${o>0?`:${o}`:""}`;case"techie":return`${s}${Gt(a,2)}${Gt(o,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Sa(n){return eh(n,["hour","minute","second","millisecond"])}const ih=["January","February","March","April","May","June","July","August","September","October","November","December"],Ml=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ah=["J","F","M","A","M","J","J","A","S","O","N","D"];function bl(n){switch(n){case"narrow":return[...ah];case"short":return[...Ml];case"long":return[...ih];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Tl=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Sl=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],oh=["M","T","W","T","F","S","S"];function kl(n){switch(n){case"narrow":return[...oh];case"short":return[...Sl];case"long":return[...Tl];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Pl=["AM","PM"],sh=["Before Christ","Anno Domini"],rh=["BC","AD"],lh=["B","A"];function El(n){switch(n){case"narrow":return[...lh];case"short":return[...rh];case"long":return[...sh];default:return null}}function ch(n){return Pl[n.hour<12?0:1]}function uh(n,e){return kl(e)[n.weekday-1]}function hh(n,e){return bl(e)[n.month-1]}function dh(n,e){return El(e)[n.year<0?0:1]}function fh(n,e,a="always",o=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},l=["hours","minutes","seconds"].indexOf(n)===-1;if(a==="auto"&&l){const y=n==="days";switch(e){case 1:return y?"tomorrow":`next ${s[n][0]}`;case-1:return y?"yesterday":`last ${s[n][0]}`;case 0:return y?"today":`this ${s[n][0]}`}}const c=Object.is(e,-0)||e<0,d=Math.abs(e),f=d===1,p=s[n],g=o?f?p[1]:p[2]||p[1]:f?s[n][0]:n;return c?`${d} ${g} ago`:`in ${d} ${g}`}function pr(n,e){let a="";for(const o of n)o.literal?a+=o.val:a+=e(o.val);return a}const mh={D:ma,DD:Gr,DDD:Vr,DDDD:jr,t:Jr,tt:qr,ttt:Kr,tttt:Yr,T:Xr,TT:Qr,TTT:tl,TTTT:el,f:nl,ff:al,fff:sl,ffff:ll,F:il,FF:ol,FFF:rl,FFFF:cl};class ee{static create(e,a={}){return new ee(e,a)}static parseFormat(e){let a=null,o="",s=!1;const l=[];for(let c=0;c<e.length;c++){const d=e.charAt(c);d==="'"?(o.length>0&&l.push({literal:s||/^\s+$/.test(o),val:o}),a=null,o="",s=!s):s||d===a?o+=d:(o.length>0&&l.push({literal:/^\s+$/.test(o),val:o}),o=d,a=d)}return o.length>0&&l.push({literal:s||/^\s+$/.test(o),val:o}),l}static macroTokenToFormatOpts(e){return mh[e]}constructor(e,a){this.opts=a,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,a){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...a}).format()}dtFormatter(e,a={}){return this.loc.dtFormatter(e,{...this.opts,...a})}formatDateTime(e,a){return this.dtFormatter(e,a).format()}formatDateTimeParts(e,a){return this.dtFormatter(e,a).formatToParts()}formatInterval(e,a){return this.dtFormatter(e.start,a).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,a){return this.dtFormatter(e,a).resolvedOptions()}num(e,a=0){if(this.opts.forceSimple)return Gt(e,a);const o={...this.opts};return a>0&&(o.padTo=a),this.loc.numberFormatter(o).format(e)}formatDateTimeFromString(e,a){const o=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",l=(M,b)=>this.loc.extract(e,M,b),c=M=>e.isOffsetFixed&&e.offset===0&&M.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,M.format):"",d=()=>o?ch(e):l({hour:"numeric",hourCycle:"h12"},"dayperiod"),f=(M,b)=>o?hh(e,M):l(b?{month:M}:{month:M,day:"numeric"},"month"),p=(M,b)=>o?uh(e,M):l(b?{weekday:M}:{weekday:M,month:"long",day:"numeric"},"weekday"),g=M=>{const b=ee.macroTokenToFormatOpts(M);return b?this.formatWithSystemDefault(e,b):M},y=M=>o?dh(e,M):l({era:M},"era"),v=M=>{switch(M){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return c({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return c({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return c({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return d();case"d":return s?l({day:"numeric"},"day"):this.num(e.day);case"dd":return s?l({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return p("short",!0);case"cccc":return p("long",!0);case"ccccc":return p("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return p("short",!1);case"EEEE":return p("long",!1);case"EEEEE":return p("narrow",!1);case"L":return s?l({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?l({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return f("short",!0);case"LLLL":return f("long",!0);case"LLLLL":return f("narrow",!0);case"M":return s?l({month:"numeric"},"month"):this.num(e.month);case"MM":return s?l({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return f("short",!1);case"MMMM":return f("long",!1);case"MMMMM":return f("narrow",!1);case"y":return s?l({year:"numeric"},"year"):this.num(e.year);case"yy":return s?l({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?l({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?l({year:"numeric"},"year"):this.num(e.year,6);case"G":return y("short");case"GG":return y("long");case"GGGGG":return y("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return g(M)}};return pr(ee.parseFormat(a),v)}formatDurationFromString(e,a){const o=f=>{switch(f[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=f=>p=>{const g=o(p);return g?this.num(f.get(g),p.length):p},l=ee.parseFormat(a),c=l.reduce((f,{literal:p,val:g})=>p?f:f.concat(g),[]),d=e.shiftTo(...c.map(o).filter(f=>f));return pr(l,s(d))}}const Cl=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function jn(...n){const e=n.reduce((a,o)=>a+o.source,"");return RegExp(`^${e}$`)}function Jn(...n){return e=>n.reduce(([a,o,s],l)=>{const[c,d,f]=l(e,s);return[{...a,...c},d||o,f]},[{},null,1]).slice(0,2)}function qn(n,...e){if(n==null)return[null,null];for(const[a,o]of e){const s=a.exec(n);if(s)return o(s)}return[null,null]}function xl(...n){return(e,a)=>{const o={};let s;for(s=0;s<n.length;s++)o[n[s]]=en(e[a+s]);return[o,null,a+s]}}const Al=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,ph=`(?:${Al.source}?(?:\\[(${Cl.source})\\])?)?`,Go=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Il=RegExp(`${Go.source}${ph}`),Vo=RegExp(`(?:T${Il.source})?`),gh=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,_h=/(\d{4})-?W(\d\d)(?:-?(\d))?/,yh=/(\d{4})-?(\d{3})/,vh=xl("weekYear","weekNumber","weekDay"),wh=xl("year","ordinal"),Lh=/(\d{4})-(\d\d)-(\d\d)/,Dl=RegExp(`${Go.source} ?(?:${Al.source}|(${Cl.source}))?`),Mh=RegExp(`(?: ${Dl.source})?`);function Zn(n,e,a){const o=n[e];return dt(o)?a:en(o)}function bh(n,e){return[{year:Zn(n,e),month:Zn(n,e+1,1),day:Zn(n,e+2,1)},null,e+3]}function Kn(n,e){return[{hours:Zn(n,e,0),minutes:Zn(n,e+1,0),seconds:Zn(n,e+2,0),milliseconds:Zo(n[e+3])},null,e+4]}function ki(n,e){const a=!n[e]&&!n[e+1],o=Ta(n[e+1],n[e+2]),s=a?null:oe.instance(o);return[{},s,e+3]}function Pi(n,e){const a=n[e]?Je.create(n[e]):null;return[{},a,e+1]}const Th=RegExp(`^T?${Go.source}$`),Sh=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function kh(n){const[e,a,o,s,l,c,d,f,p]=n,g=e[0]==="-",y=f&&f[0]==="-",v=(M,b=!1)=>M!==void 0&&(b||M&&g)?-M:M;return[{years:v(pn(a)),months:v(pn(o)),weeks:v(pn(s)),days:v(pn(l)),hours:v(pn(c)),minutes:v(pn(d)),seconds:v(pn(f),f==="-0"),milliseconds:v(Zo(p),y)}]}const Ph={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function jo(n,e,a,o,s,l,c){const d={year:e.length===2?Ao(en(e)):en(e),month:Ml.indexOf(a)+1,day:en(o),hour:en(s),minute:en(l)};return c&&(d.second=en(c)),n&&(d.weekday=n.length>3?Tl.indexOf(n)+1:Sl.indexOf(n)+1),d}const Eh=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Ch(n){const[,e,a,o,s,l,c,d,f,p,g,y]=n,v=jo(e,s,o,a,l,c,d);let M;return f?M=Ph[f]:p?M=0:M=Ta(g,y),[v,new oe(M)]}function xh(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Ah=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Ih=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Dh=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function gr(n){const[,e,a,o,s,l,c,d]=n;return[jo(e,s,o,a,l,c,d),oe.utcInstance]}function Oh(n){const[,e,a,o,s,l,c,d]=n;return[jo(e,d,a,o,s,l,c),oe.utcInstance]}const Nh=jn(gh,Vo),Fh=jn(_h,Vo),Rh=jn(yh,Vo),zh=jn(Il),Ol=Jn(bh,Kn,ki,Pi),$h=Jn(vh,Kn,ki,Pi),Bh=Jn(wh,Kn,ki,Pi),Uh=Jn(Kn,ki,Pi);function Hh(n){return qn(n,[Nh,Ol],[Fh,$h],[Rh,Bh],[zh,Uh])}function Zh(n){return qn(xh(n),[Eh,Ch])}function Wh(n){return qn(n,[Ah,gr],[Ih,gr],[Dh,Oh])}function Gh(n){return qn(n,[Sh,kh])}const Vh=Jn(Kn);function jh(n){return qn(n,[Th,Vh])}const Jh=jn(Lh,Mh),qh=jn(Dl),Kh=Jn(Kn,ki,Pi);function Yh(n){return qn(n,[Jh,Ol],[qh,Kh])}const _r="Invalid Duration",Nl={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Xh={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Nl},ge=146097/400,Nn=146097/4800,Qh={years:{quarters:4,months:12,weeks:ge/7,days:ge,hours:ge*24,minutes:ge*24*60,seconds:ge*24*60*60,milliseconds:ge*24*60*60*1e3},quarters:{months:3,weeks:ge/28,days:ge/4,hours:ge*24/4,minutes:ge*24*60/4,seconds:ge*24*60*60/4,milliseconds:ge*24*60*60*1e3/4},months:{weeks:Nn/7,days:Nn,hours:Nn*24,minutes:Nn*24*60,seconds:Nn*24*60*60,milliseconds:Nn*24*60*60*1e3},...Nl},yn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],td=yn.slice(0).reverse();function Qe(n,e,a=!1){const o={values:a?e.values:{...n.values,...e.values||{}},loc:n.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||n.conversionAccuracy,matrix:e.matrix||n.matrix};return new St(o)}function Fl(n,e){let a=e.milliseconds??0;for(const o of td.slice(1))e[o]&&(a+=e[o]*n[o].milliseconds);return a}function yr(n,e){const a=Fl(n,e)<0?-1:1;yn.reduceRight((o,s)=>{if(dt(e[s]))return o;if(o){const l=e[o]*a,c=n[s][o],d=Math.floor(l/c);e[s]+=d*a,e[o]-=d*c*a}return s},null),yn.reduce((o,s)=>{if(dt(e[s]))return o;if(o){const l=e[o]%1;e[o]-=l,e[s]+=l*n[o][s]}return s},null)}function ed(n){const e={};for(const[a,o]of Object.entries(n))o!==0&&(e[a]=o);return e}class St{constructor(e){const a=e.conversionAccuracy==="longterm"||!1;let o=a?Qh:Xh;e.matrix&&(o=e.matrix),this.values=e.values,this.loc=e.loc||xt.create(),this.conversionAccuracy=a?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=o,this.isLuxonDuration=!0}static fromMillis(e,a){return St.fromObject({milliseconds:e},a)}static fromObject(e,a={}){if(e==null||typeof e!="object")throw new te(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new St({values:_a(e,St.normalizeUnit),loc:xt.fromObject(a),conversionAccuracy:a.conversionAccuracy,matrix:a.matrix})}static fromDurationLike(e){if(on(e))return St.fromMillis(e);if(St.isDuration(e))return e;if(typeof e=="object")return St.fromObject(e);throw new te(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,a){const[o]=Gh(e);return o?St.fromObject(o,a):St.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,a){const[o]=jh(e);return o?St.fromObject(o,a):St.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,a=null){if(!e)throw new te("need to specify a reason the Duration is invalid");const o=e instanceof Ee?e:new Ee(e,a);if(Ut.throwOnInvalid)throw new ku(o);return new St({invalid:o})}static normalizeUnit(e){const a={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!a)throw new Wr(e);return a}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,a={}){const o={...a,floor:a.round!==!1&&a.floor!==!1};return this.isValid?ee.create(this.loc,o).formatDurationFromString(this,e):_r}toHuman(e={}){if(!this.isValid)return _r;const a=yn.map(o=>{const s=this.values[o];return dt(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:o.slice(0,-1)}).format(s)}).filter(o=>o);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(a)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Wo(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const a=this.toMillis();return a<0||a>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},ot.fromMillis(a,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?Fl(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const a=St.fromDurationLike(e),o={};for(const s of yn)(Wn(a.values,s)||Wn(this.values,s))&&(o[s]=a.get(s)+this.get(s));return Qe(this,{values:o},!0)}minus(e){if(!this.isValid)return this;const a=St.fromDurationLike(e);return this.plus(a.negate())}mapUnits(e){if(!this.isValid)return this;const a={};for(const o of Object.keys(this.values))a[o]=Ll(e(this.values[o],o));return Qe(this,{values:a},!0)}get(e){return this[St.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const a={...this.values,..._a(e,St.normalizeUnit)};return Qe(this,{values:a})}reconfigure({locale:e,numberingSystem:a,conversionAccuracy:o,matrix:s}={}){const c={loc:this.loc.clone({locale:e,numberingSystem:a}),matrix:s,conversionAccuracy:o};return Qe(this,c)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return yr(this.matrix,e),Qe(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=ed(this.normalize().shiftToAll().toObject());return Qe(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(c=>St.normalizeUnit(c));const a={},o={},s=this.toObject();let l;for(const c of yn)if(e.indexOf(c)>=0){l=c;let d=0;for(const p in o)d+=this.matrix[p][c]*o[p],o[p]=0;on(s[c])&&(d+=s[c]);const f=Math.trunc(d);a[c]=f,o[c]=(d*1e3-f*1e3)/1e3}else on(s[c])&&(o[c]=s[c]);for(const c in o)o[c]!==0&&(a[l]+=c===l?o[c]:o[c]/this.matrix[l][c]);return yr(this.matrix,a),Qe(this,{values:a},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const a of Object.keys(this.values))e[a]=this.values[a]===0?0:-this.values[a];return Qe(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function a(o,s){return o===void 0||o===0?s===void 0||s===0:o===s}for(const o of yn)if(!a(this.values[o],e.values[o]))return!1;return!0}}const Fn="Invalid Interval";function nd(n,e){return!n||!n.isValid?Bt.invalid("missing or invalid start"):!e||!e.isValid?Bt.invalid("missing or invalid end"):e<n?Bt.invalid("end before start",`The end of an interval must be after its start, but you had start=${n.toISO()} and end=${e.toISO()}`):null}class Bt{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,a=null){if(!e)throw new te("need to specify a reason the Interval is invalid");const o=e instanceof Ee?e:new Ee(e,a);if(Ut.throwOnInvalid)throw new Su(o);return new Bt({invalid:o})}static fromDateTimes(e,a){const o=ui(e),s=ui(a),l=nd(o,s);return l??new Bt({start:o,end:s})}static after(e,a){const o=St.fromDurationLike(a),s=ui(e);return Bt.fromDateTimes(s,s.plus(o))}static before(e,a){const o=St.fromDurationLike(a),s=ui(e);return Bt.fromDateTimes(s.minus(o),s)}static fromISO(e,a){const[o,s]=(e||"").split("/",2);if(o&&s){let l,c;try{l=ot.fromISO(o,a),c=l.isValid}catch{c=!1}let d,f;try{d=ot.fromISO(s,a),f=d.isValid}catch{f=!1}if(c&&f)return Bt.fromDateTimes(l,d);if(c){const p=St.fromISO(s,a);if(p.isValid)return Bt.after(l,p)}else if(f){const p=St.fromISO(o,a);if(p.isValid)return Bt.before(d,p)}}return Bt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",a){if(!this.isValid)return NaN;const o=this.start.startOf(e,a);let s;return a!=null&&a.useLocaleWeeks?s=this.end.reconfigure({locale:o.locale}):s=this.end,s=s.startOf(e,a),Math.floor(s.diff(o,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:a}={}){return this.isValid?Bt.fromDateTimes(e||this.s,a||this.e):this}splitAt(...e){if(!this.isValid)return[];const a=e.map(ui).filter(c=>this.contains(c)).sort((c,d)=>c.toMillis()-d.toMillis()),o=[];let{s}=this,l=0;for(;s<this.e;){const c=a[l]||this.e,d=+c>+this.e?this.e:c;o.push(Bt.fromDateTimes(s,d)),s=d,l+=1}return o}splitBy(e){const a=St.fromDurationLike(e);if(!this.isValid||!a.isValid||a.as("milliseconds")===0)return[];let{s:o}=this,s=1,l;const c=[];for(;o<this.e;){const d=this.start.plus(a.mapUnits(f=>f*s));l=+d>+this.e?this.e:d,c.push(Bt.fromDateTimes(o,l)),o=l,s+=1}return c}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const a=this.s>e.s?this.s:e.s,o=this.e<e.e?this.e:e.e;return a>=o?null:Bt.fromDateTimes(a,o)}union(e){if(!this.isValid)return this;const a=this.s<e.s?this.s:e.s,o=this.e>e.e?this.e:e.e;return Bt.fromDateTimes(a,o)}static merge(e){const[a,o]=e.sort((s,l)=>s.s-l.s).reduce(([s,l],c)=>l?l.overlaps(c)||l.abutsStart(c)?[s,l.union(c)]:[s.concat([l]),c]:[s,c],[[],null]);return o&&a.push(o),a}static xor(e){let a=null,o=0;const s=[],l=e.map(f=>[{time:f.s,type:"s"},{time:f.e,type:"e"}]),c=Array.prototype.concat(...l),d=c.sort((f,p)=>f.time-p.time);for(const f of d)o+=f.type==="s"?1:-1,o===1?a=f.time:(a&&+a!=+f.time&&s.push(Bt.fromDateTimes(a,f.time)),a=null);return Bt.merge(s)}difference(...e){return Bt.xor([this].concat(e)).map(a=>this.intersection(a)).filter(a=>a&&!a.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Fn}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=ma,a={}){return this.isValid?ee.create(this.s.loc.clone(a),e).formatInterval(this):Fn}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Fn}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Fn}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Fn}toFormat(e,{separator:a=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${a}${this.e.toFormat(e)}`:Fn}toDuration(e,a){return this.isValid?this.e.diff(this.s,e,a):St.invalid(this.invalidReason)}mapEndpoints(e){return Bt.fromDateTimes(e(this.s),e(this.e))}}class aa{static hasDST(e=Ut.defaultZone){const a=ot.now().setZone(e).set({month:12});return!e.isUniversal&&a.offset!==a.set({month:6}).offset}static isValidIANAZone(e){return Je.isValidZone(e)}static normalizeZone(e){return an(e,Ut.defaultZone)}static getStartOfWeek({locale:e=null,locObj:a=null}={}){return(a||xt.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:a=null}={}){return(a||xt.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:a=null}={}){return(a||xt.create(e)).getWeekendDays().slice()}static months(e="long",{locale:a=null,numberingSystem:o=null,locObj:s=null,outputCalendar:l="gregory"}={}){return(s||xt.create(a,o,l)).months(e)}static monthsFormat(e="long",{locale:a=null,numberingSystem:o=null,locObj:s=null,outputCalendar:l="gregory"}={}){return(s||xt.create(a,o,l)).months(e,!0)}static weekdays(e="long",{locale:a=null,numberingSystem:o=null,locObj:s=null}={}){return(s||xt.create(a,o,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:a=null,numberingSystem:o=null,locObj:s=null}={}){return(s||xt.create(a,o,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return xt.create(e).meridiems()}static eras(e="short",{locale:a=null}={}){return xt.create(a,null,"gregory").eras(e)}static features(){return{relative:yl(),localeWeek:vl()}}}function vr(n,e){const a=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),o=a(e)-a(n);return Math.floor(St.fromMillis(o).as("days"))}function id(n,e,a){const o=[["years",(f,p)=>p.year-f.year],["quarters",(f,p)=>p.quarter-f.quarter+(p.year-f.year)*4],["months",(f,p)=>p.month-f.month+(p.year-f.year)*12],["weeks",(f,p)=>{const g=vr(f,p);return(g-g%7)/7}],["days",vr]],s={},l=n;let c,d;for(const[f,p]of o)a.indexOf(f)>=0&&(c=f,s[f]=p(n,e),d=l.plus(s),d>e?(s[f]--,n=l.plus(s),n>e&&(d=n,s[f]--,n=l.plus(s))):n=d);return[n,s,d,c]}function ad(n,e,a,o){let[s,l,c,d]=id(n,e,a);const f=e-s,p=a.filter(y=>["hours","minutes","seconds","milliseconds"].indexOf(y)>=0);p.length===0&&(c<e&&(c=s.plus({[d]:1})),c!==s&&(l[d]=(l[d]||0)+f/(c-s)));const g=St.fromObject(l,o);return p.length>0?St.fromMillis(f,o).shiftTo(...p).plus(g):g}const od="missing Intl.DateTimeFormat.formatToParts support";function Ct(n,e=a=>a){return{regex:n,deser:([a])=>e(Ju(a))}}const sd=" ",Rl=`[ ${sd}]`,zl=new RegExp(Rl,"g");function rd(n){return n.replace(/\./g,"\\.?").replace(zl,Rl)}function wr(n){return n.replace(/\./g,"").replace(zl," ").toLowerCase()}function Pe(n,e){return n===null?null:{regex:RegExp(n.map(rd).join("|")),deser:([a])=>n.findIndex(o=>wr(a)===wr(o))+e}}function Lr(n,e){return{regex:n,deser:([,a,o])=>Ta(a,o),groups:e}}function oa(n){return{regex:n,deser:([e])=>e}}function ld(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function cd(n,e){const a=ke(e),o=ke(e,"{2}"),s=ke(e,"{3}"),l=ke(e,"{4}"),c=ke(e,"{6}"),d=ke(e,"{1,2}"),f=ke(e,"{1,3}"),p=ke(e,"{1,6}"),g=ke(e,"{1,9}"),y=ke(e,"{2,4}"),v=ke(e,"{4,6}"),M=P=>({regex:RegExp(ld(P.val)),deser:([x])=>x,literal:!0}),S=(P=>{if(n.literal)return M(P);switch(P.val){case"G":return Pe(e.eras("short"),0);case"GG":return Pe(e.eras("long"),0);case"y":return Ct(p);case"yy":return Ct(y,Ao);case"yyyy":return Ct(l);case"yyyyy":return Ct(v);case"yyyyyy":return Ct(c);case"M":return Ct(d);case"MM":return Ct(o);case"MMM":return Pe(e.months("short",!0),1);case"MMMM":return Pe(e.months("long",!0),1);case"L":return Ct(d);case"LL":return Ct(o);case"LLL":return Pe(e.months("short",!1),1);case"LLLL":return Pe(e.months("long",!1),1);case"d":return Ct(d);case"dd":return Ct(o);case"o":return Ct(f);case"ooo":return Ct(s);case"HH":return Ct(o);case"H":return Ct(d);case"hh":return Ct(o);case"h":return Ct(d);case"mm":return Ct(o);case"m":return Ct(d);case"q":return Ct(d);case"qq":return Ct(o);case"s":return Ct(d);case"ss":return Ct(o);case"S":return Ct(f);case"SSS":return Ct(s);case"u":return oa(g);case"uu":return oa(d);case"uuu":return Ct(a);case"a":return Pe(e.meridiems(),0);case"kkkk":return Ct(l);case"kk":return Ct(y,Ao);case"W":return Ct(d);case"WW":return Ct(o);case"E":case"c":return Ct(a);case"EEE":return Pe(e.weekdays("short",!1),1);case"EEEE":return Pe(e.weekdays("long",!1),1);case"ccc":return Pe(e.weekdays("short",!0),1);case"cccc":return Pe(e.weekdays("long",!0),1);case"Z":case"ZZ":return Lr(new RegExp(`([+-]${d.source})(?::(${o.source}))?`),2);case"ZZZ":return Lr(new RegExp(`([+-]${d.source})(${o.source})?`),2);case"z":return oa(/[a-z_+-/]{1,256}?/i);case" ":return oa(/[^\S\n\r]/);default:return M(P)}})(n)||{invalidReason:od};return S.token=n,S}const ud={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function hd(n,e,a){const{type:o,value:s}=n;if(o==="literal"){const f=/^\s+$/.test(s);return{literal:!f,val:f?" ":s}}const l=e[o];let c=o;o==="hour"&&(e.hour12!=null?c=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?c="hour12":c="hour24":c=a.hour12?"hour12":"hour24");let d=ud[c];if(typeof d=="object"&&(d=d[l]),d)return{literal:!1,val:d}}function dd(n){return[`^${n.map(a=>a.regex).reduce((a,o)=>`${a}(${o.source})`,"")}$`,n]}function fd(n,e,a){const o=n.match(e);if(o){const s={};let l=1;for(const c in a)if(Wn(a,c)){const d=a[c],f=d.groups?d.groups+1:1;!d.literal&&d.token&&(s[d.token.val[0]]=d.deser(o.slice(l,l+f))),l+=f}return[o,s]}else return[o,{}]}function md(n){const e=l=>{switch(l){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let a=null,o;return dt(n.z)||(a=Je.create(n.z)),dt(n.Z)||(a||(a=new oe(n.Z)),o=n.Z),dt(n.q)||(n.M=(n.q-1)*3+1),dt(n.h)||(n.h<12&&n.a===1?n.h+=12:n.h===12&&n.a===0&&(n.h=0)),n.G===0&&n.y&&(n.y=-n.y),dt(n.u)||(n.S=Zo(n.u)),[Object.keys(n).reduce((l,c)=>{const d=e(c);return d&&(l[d]=n[c]),l},{}),a,o]}let co=null;function pd(){return co||(co=ot.fromMillis(1555555555555)),co}function gd(n,e){if(n.literal)return n;const a=ee.macroTokenToFormatOpts(n.val),o=Hl(a,e);return o==null||o.includes(void 0)?n:o}function $l(n,e){return Array.prototype.concat(...n.map(a=>gd(a,e)))}class Bl{constructor(e,a){if(this.locale=e,this.format=a,this.tokens=$l(ee.parseFormat(a),e),this.units=this.tokens.map(o=>cd(o,e)),this.disqualifyingUnit=this.units.find(o=>o.invalidReason),!this.disqualifyingUnit){const[o,s]=dd(this.units);this.regex=RegExp(o,"i"),this.handlers=s}}explainFromTokens(e){if(this.isValid){const[a,o]=fd(e,this.regex,this.handlers),[s,l,c]=o?md(o):[null,null,void 0];if(Wn(o,"a")&&Wn(o,"H"))throw new Bn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:a,matches:o,result:s,zone:l,specificOffset:c}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function Ul(n,e,a){return new Bl(n,a).explainFromTokens(e)}function _d(n,e,a){const{result:o,zone:s,specificOffset:l,invalidReason:c}=Ul(n,e,a);return[o,s,l,c]}function Hl(n,e){if(!n)return null;const o=ee.create(e,n).dtFormatter(pd()),s=o.formatToParts(),l=o.resolvedOptions();return s.map(c=>hd(c,n,l))}const uo="Invalid DateTime",Mr=864e13;function di(n){return new Ee("unsupported zone",`the zone "${n.name}" is not supported`)}function ho(n){return n.weekData===null&&(n.weekData=pa(n.c)),n.weekData}function fo(n){return n.localWeekData===null&&(n.localWeekData=pa(n.c,n.loc.getMinDaysInFirstWeek(),n.loc.getStartOfWeek())),n.localWeekData}function gn(n,e){const a={ts:n.ts,zone:n.zone,c:n.c,o:n.o,loc:n.loc,invalid:n.invalid};return new ot({...a,...e,old:a})}function Zl(n,e,a){let o=n-e*60*1e3;const s=a.offset(o);if(e===s)return[o,e];o-=(s-e)*60*1e3;const l=a.offset(o);return s===l?[o,s]:[n-Math.min(s,l)*60*1e3,Math.max(s,l)]}function sa(n,e){n+=e*60*1e3;const a=new Date(n);return{year:a.getUTCFullYear(),month:a.getUTCMonth()+1,day:a.getUTCDate(),hour:a.getUTCHours(),minute:a.getUTCMinutes(),second:a.getUTCSeconds(),millisecond:a.getUTCMilliseconds()}}function ca(n,e,a){return Zl(ba(n),e,a)}function br(n,e){const a=n.o,o=n.c.year+Math.trunc(e.years),s=n.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,l={...n.c,year:o,month:s,day:Math.min(n.c.day,ga(o,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},c=St.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),d=ba(l);let[f,p]=Zl(d,a,n.zone);return c!==0&&(f+=c,p=n.zone.offset(f)),{ts:f,o:p}}function Rn(n,e,a,o,s,l){const{setZone:c,zone:d}=a;if(n&&Object.keys(n).length!==0||e){const f=e||d,p=ot.fromObject(n,{...a,zone:f,specificOffset:l});return c?p:p.setZone(d)}else return ot.invalid(new Ee("unparsable",`the input "${s}" can't be parsed as ${o}`))}function ra(n,e,a=!0){return n.isValid?ee.create(xt.create("en-US"),{allowZ:a,forceSimple:!0}).formatDateTimeFromString(n,e):null}function mo(n,e){const a=n.c.year>9999||n.c.year<0;let o="";return a&&n.c.year>=0&&(o+="+"),o+=Gt(n.c.year,a?6:4),e?(o+="-",o+=Gt(n.c.month),o+="-",o+=Gt(n.c.day)):(o+=Gt(n.c.month),o+=Gt(n.c.day)),o}function Tr(n,e,a,o,s,l){let c=Gt(n.c.hour);return e?(c+=":",c+=Gt(n.c.minute),(n.c.millisecond!==0||n.c.second!==0||!a)&&(c+=":")):c+=Gt(n.c.minute),(n.c.millisecond!==0||n.c.second!==0||!a)&&(c+=Gt(n.c.second),(n.c.millisecond!==0||!o)&&(c+=".",c+=Gt(n.c.millisecond,3))),s&&(n.isOffsetFixed&&n.offset===0&&!l?c+="Z":n.o<0?(c+="-",c+=Gt(Math.trunc(-n.o/60)),c+=":",c+=Gt(Math.trunc(-n.o%60))):(c+="+",c+=Gt(Math.trunc(n.o/60)),c+=":",c+=Gt(Math.trunc(n.o%60)))),l&&(c+="["+n.zone.ianaName+"]"),c}const Wl={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},yd={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},vd={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Gl=["year","month","day","hour","minute","second","millisecond"],wd=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Ld=["year","ordinal","hour","minute","second","millisecond"];function Md(n){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[n.toLowerCase()];if(!e)throw new Wr(n);return e}function Sr(n){switch(n.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return Md(n)}}function bd(n){if(fi===void 0&&(fi=Ut.now()),n.type!=="iana")return n.offset(fi);const e=n.name;let a=Io.get(e);return a===void 0&&(a=n.offset(fi),Io.set(e,a)),a}function kr(n,e){const a=an(e.zone,Ut.defaultZone);if(!a.isValid)return ot.invalid(di(a));const o=xt.fromObject(e);let s,l;if(dt(n.year))s=Ut.now();else{for(const f of Gl)dt(n[f])&&(n[f]=Wl[f]);const c=gl(n)||_l(n);if(c)return ot.invalid(c);const d=bd(a);[s,l]=ca(n,d,a)}return new ot({ts:s,zone:a,loc:o,o:l})}function Pr(n,e,a){const o=dt(a.round)?!0:a.round,s=(c,d)=>(c=Wo(c,o||a.calendary?0:2,!0),e.loc.clone(a).relFormatter(a).format(c,d)),l=c=>a.calendary?e.hasSame(n,c)?0:e.startOf(c).diff(n.startOf(c),c).get(c):e.diff(n,c).get(c);if(a.unit)return s(l(a.unit),a.unit);for(const c of a.units){const d=l(c);if(Math.abs(d)>=1)return s(d,c)}return s(n>e?-0:0,a.units[a.units.length-1])}function Er(n){let e={},a;return n.length>0&&typeof n[n.length-1]=="object"?(e=n[n.length-1],a=Array.from(n).slice(0,n.length-1)):a=Array.from(n),[e,a]}let fi;const Io=new Map;class ot{constructor(e){const a=e.zone||Ut.defaultZone;let o=e.invalid||(Number.isNaN(e.ts)?new Ee("invalid input"):null)||(a.isValid?null:di(a));this.ts=dt(e.ts)?Ut.now():e.ts;let s=null,l=null;if(!o)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(a))[s,l]=[e.old.c,e.old.o];else{const d=on(e.o)&&!e.old?e.o:a.offset(this.ts);s=sa(this.ts,d),o=Number.isNaN(s.year)?new Ee("invalid input"):null,s=o?null:s,l=o?null:d}this._zone=a,this.loc=e.loc||xt.create(),this.invalid=o,this.weekData=null,this.localWeekData=null,this.c=s,this.o=l,this.isLuxonDateTime=!0}static now(){return new ot({})}static local(){const[e,a]=Er(arguments),[o,s,l,c,d,f,p]=a;return kr({year:o,month:s,day:l,hour:c,minute:d,second:f,millisecond:p},e)}static utc(){const[e,a]=Er(arguments),[o,s,l,c,d,f,p]=a;return e.zone=oe.utcInstance,kr({year:o,month:s,day:l,hour:c,minute:d,second:f,millisecond:p},e)}static fromJSDate(e,a={}){const o=Qu(e)?e.valueOf():NaN;if(Number.isNaN(o))return ot.invalid("invalid input");const s=an(a.zone,Ut.defaultZone);return s.isValid?new ot({ts:o,zone:s,loc:xt.fromObject(a)}):ot.invalid(di(s))}static fromMillis(e,a={}){if(on(e))return e<-Mr||e>Mr?ot.invalid("Timestamp out of range"):new ot({ts:e,zone:an(a.zone,Ut.defaultZone),loc:xt.fromObject(a)});throw new te(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,a={}){if(on(e))return new ot({ts:e*1e3,zone:an(a.zone,Ut.defaultZone),loc:xt.fromObject(a)});throw new te("fromSeconds requires a numerical input")}static fromObject(e,a={}){e=e||{};const o=an(a.zone,Ut.defaultZone);if(!o.isValid)return ot.invalid(di(o));const s=xt.fromObject(a),l=_a(e,Sr),{minDaysInFirstWeek:c,startOfWeek:d}=dr(l,s),f=Ut.now(),p=dt(a.specificOffset)?o.offset(f):a.specificOffset,g=!dt(l.ordinal),y=!dt(l.year),v=!dt(l.month)||!dt(l.day),M=y||v,b=l.weekYear||l.weekNumber;if((M||g)&&b)throw new Bn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(v&&g)throw new Bn("Can't mix ordinal dates with month/day");const S=b||l.weekday&&!M;let P,x,A=sa(f,p);S?(P=wd,x=yd,A=pa(A,c,d)):g?(P=Ld,x=vd,A=lo(A)):(P=Gl,x=Wl);let N=!1;for(const O of P){const F=l[O];dt(F)?N?l[O]=x[O]:l[O]=A[O]:N=!0}const I=S?Ku(l,c,d):g?Yu(l):gl(l),B=I||_l(l);if(B)return ot.invalid(B);const U=S?ur(l,c,d):g?hr(l):l,[$,k]=ca(U,p,o),C=new ot({ts:$,zone:o,o:k,loc:s});return l.weekday&&M&&e.weekday!==C.weekday?ot.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${C.toISO()}`):C.isValid?C:ot.invalid(C.invalid)}static fromISO(e,a={}){const[o,s]=Hh(e);return Rn(o,s,a,"ISO 8601",e)}static fromRFC2822(e,a={}){const[o,s]=Zh(e);return Rn(o,s,a,"RFC 2822",e)}static fromHTTP(e,a={}){const[o,s]=Wh(e);return Rn(o,s,a,"HTTP",a)}static fromFormat(e,a,o={}){if(dt(e)||dt(a))throw new te("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:l=null}=o,c=xt.fromOpts({locale:s,numberingSystem:l,defaultToEN:!0}),[d,f,p,g]=_d(c,e,a);return g?ot.invalid(g):Rn(d,f,o,`format ${a}`,e,p)}static fromString(e,a,o={}){return ot.fromFormat(e,a,o)}static fromSQL(e,a={}){const[o,s]=Yh(e);return Rn(o,s,a,"SQL",e)}static invalid(e,a=null){if(!e)throw new te("need to specify a reason the DateTime is invalid");const o=e instanceof Ee?e:new Ee(e,a);if(Ut.throwOnInvalid)throw new Tu(o);return new ot({invalid:o})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,a={}){const o=Hl(e,xt.fromObject(a));return o?o.map(s=>s?s.val:null).join(""):null}static expandFormat(e,a={}){return $l(ee.parseFormat(e),xt.fromObject(a)).map(s=>s.val).join("")}static resetCache(){fi=void 0,Io.clear()}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?ho(this).weekYear:NaN}get weekNumber(){return this.isValid?ho(this).weekNumber:NaN}get weekday(){return this.isValid?ho(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?fo(this).weekday:NaN}get localWeekNumber(){return this.isValid?fo(this).weekNumber:NaN}get localWeekYear(){return this.isValid?fo(this).weekYear:NaN}get ordinal(){return this.isValid?lo(this.c).ordinal:NaN}get monthShort(){return this.isValid?aa.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?aa.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?aa.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?aa.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,a=6e4,o=ba(this.c),s=this.zone.offset(o-e),l=this.zone.offset(o+e),c=this.zone.offset(o-s*a),d=this.zone.offset(o-l*a);if(c===d)return[this];const f=o-c*a,p=o-d*a,g=sa(f,c),y=sa(p,d);return g.hour===y.hour&&g.minute===y.minute&&g.second===y.second&&g.millisecond===y.millisecond?[gn(this,{ts:f}),gn(this,{ts:p})]:[this]}get isInLeapYear(){return Si(this.year)}get daysInMonth(){return ga(this.year,this.month)}get daysInYear(){return this.isValid?Hn(this.year):NaN}get weeksInWeekYear(){return this.isValid?vi(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?vi(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:a,numberingSystem:o,calendar:s}=ee.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:a,numberingSystem:o,outputCalendar:s}}toUTC(e=0,a={}){return this.setZone(oe.instance(e),a)}toLocal(){return this.setZone(Ut.defaultZone)}setZone(e,{keepLocalTime:a=!1,keepCalendarTime:o=!1}={}){if(e=an(e,Ut.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(a||o){const l=e.offset(this.ts),c=this.toObject();[s]=ca(c,l,e)}return gn(this,{ts:s,zone:e})}else return ot.invalid(di(e))}reconfigure({locale:e,numberingSystem:a,outputCalendar:o}={}){const s=this.loc.clone({locale:e,numberingSystem:a,outputCalendar:o});return gn(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const a=_a(e,Sr),{minDaysInFirstWeek:o,startOfWeek:s}=dr(a,this.loc),l=!dt(a.weekYear)||!dt(a.weekNumber)||!dt(a.weekday),c=!dt(a.ordinal),d=!dt(a.year),f=!dt(a.month)||!dt(a.day),p=d||f,g=a.weekYear||a.weekNumber;if((p||c)&&g)throw new Bn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&c)throw new Bn("Can't mix ordinal dates with month/day");let y;l?y=ur({...pa(this.c,o,s),...a},o,s):dt(a.ordinal)?(y={...this.toObject(),...a},dt(a.day)&&(y.day=Math.min(ga(y.year,y.month),y.day))):y=hr({...lo(this.c),...a});const[v,M]=ca(y,this.o,this.zone);return gn(this,{ts:v,o:M})}plus(e){if(!this.isValid)return this;const a=St.fromDurationLike(e);return gn(this,br(this,a))}minus(e){if(!this.isValid)return this;const a=St.fromDurationLike(e).negate();return gn(this,br(this,a))}startOf(e,{useLocaleWeeks:a=!1}={}){if(!this.isValid)return this;const o={},s=St.normalizeUnit(e);switch(s){case"years":o.month=1;case"quarters":case"months":o.day=1;case"weeks":case"days":o.hour=0;case"hours":o.minute=0;case"minutes":o.second=0;case"seconds":o.millisecond=0;break}if(s==="weeks")if(a){const l=this.loc.getStartOfWeek(),{weekday:c}=this;c<l&&(o.weekNumber=this.weekNumber-1),o.weekday=l}else o.weekday=1;if(s==="quarters"){const l=Math.ceil(this.month/3);o.month=(l-1)*3+1}return this.set(o)}endOf(e,a){return this.isValid?this.plus({[e]:1}).startOf(e,a).minus(1):this}toFormat(e,a={}){return this.isValid?ee.create(this.loc.redefaultToEN(a)).formatDateTimeFromString(this,e):uo}toLocaleString(e=ma,a={}){return this.isValid?ee.create(this.loc.clone(a),e).formatDateTime(this):uo}toLocaleParts(e={}){return this.isValid?ee.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:a=!1,suppressMilliseconds:o=!1,includeOffset:s=!0,extendedZone:l=!1}={}){if(!this.isValid)return null;const c=e==="extended";let d=mo(this,c);return d+="T",d+=Tr(this,c,a,o,s,l),d}toISODate({format:e="extended"}={}){return this.isValid?mo(this,e==="extended"):null}toISOWeekDate(){return ra(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:a=!1,includeOffset:o=!0,includePrefix:s=!1,extendedZone:l=!1,format:c="extended"}={}){return this.isValid?(s?"T":"")+Tr(this,c==="extended",a,e,o,l):null}toRFC2822(){return ra(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ra(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?mo(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:a=!1,includeOffsetSpace:o=!0}={}){let s="HH:mm:ss.SSS";return(a||e)&&(o&&(s+=" "),a?s+="z":e&&(s+="ZZ")),ra(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():uo}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const a={...this.c};return e.includeConfig&&(a.outputCalendar=this.outputCalendar,a.numberingSystem=this.loc.numberingSystem,a.locale=this.loc.locale),a}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,a="milliseconds",o={}){if(!this.isValid||!e.isValid)return St.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...o},l=th(a).map(St.normalizeUnit),c=e.valueOf()>this.valueOf(),d=c?this:e,f=c?e:this,p=ad(d,f,l,s);return c?p.negate():p}diffNow(e="milliseconds",a={}){return this.diff(ot.now(),e,a)}until(e){return this.isValid?Bt.fromDateTimes(this,e):this}hasSame(e,a,o){if(!this.isValid)return!1;const s=e.valueOf(),l=this.setZone(e.zone,{keepLocalTime:!0});return l.startOf(a,o)<=s&&s<=l.endOf(a,o)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const a=e.base||ot.fromObject({},{zone:this.zone}),o=e.padding?this<a?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],l=e.unit;return Array.isArray(e.unit)&&(s=e.unit,l=void 0),Pr(a,this.plus(o),{...e,numeric:"always",units:s,unit:l})}toRelativeCalendar(e={}){return this.isValid?Pr(e.base||ot.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(ot.isDateTime))throw new te("min requires all arguments be DateTimes");return fr(e,a=>a.valueOf(),Math.min)}static max(...e){if(!e.every(ot.isDateTime))throw new te("max requires all arguments be DateTimes");return fr(e,a=>a.valueOf(),Math.max)}static fromFormatExplain(e,a,o={}){const{locale:s=null,numberingSystem:l=null}=o,c=xt.fromOpts({locale:s,numberingSystem:l,defaultToEN:!0});return Ul(c,e,a)}static fromStringExplain(e,a,o={}){return ot.fromFormatExplain(e,a,o)}static buildFormatParser(e,a={}){const{locale:o=null,numberingSystem:s=null}=a,l=xt.fromOpts({locale:o,numberingSystem:s,defaultToEN:!0});return new Bl(l,e)}static fromFormatParser(e,a,o={}){if(dt(e)||dt(a))throw new te("fromFormatParser requires an input string and a format parser");const{locale:s=null,numberingSystem:l=null}=o,c=xt.fromOpts({locale:s,numberingSystem:l,defaultToEN:!0});if(!c.equals(a.locale))throw new te(`fromFormatParser called with a locale of ${c}, but the format parser was created for ${a.locale}`);const{result:d,zone:f,specificOffset:p,invalidReason:g}=a.explainFromTokens(e);return g?ot.invalid(g):Rn(d,f,o,`format ${a.format}`,e,p)}static get DATE_SHORT(){return ma}static get DATE_MED(){return Gr}static get DATE_MED_WITH_WEEKDAY(){return Pu}static get DATE_FULL(){return Vr}static get DATE_HUGE(){return jr}static get TIME_SIMPLE(){return Jr}static get TIME_WITH_SECONDS(){return qr}static get TIME_WITH_SHORT_OFFSET(){return Kr}static get TIME_WITH_LONG_OFFSET(){return Yr}static get TIME_24_SIMPLE(){return Xr}static get TIME_24_WITH_SECONDS(){return Qr}static get TIME_24_WITH_SHORT_OFFSET(){return tl}static get TIME_24_WITH_LONG_OFFSET(){return el}static get DATETIME_SHORT(){return nl}static get DATETIME_SHORT_WITH_SECONDS(){return il}static get DATETIME_MED(){return al}static get DATETIME_MED_WITH_SECONDS(){return ol}static get DATETIME_MED_WITH_WEEKDAY(){return Eu}static get DATETIME_FULL(){return sl}static get DATETIME_FULL_WITH_SECONDS(){return rl}static get DATETIME_HUGE(){return ll}static get DATETIME_HUGE_WITH_SECONDS(){return cl}}function ui(n){if(ot.isDateTime(n))return n;if(n&&n.valueOf&&on(n.valueOf()))return ot.fromJSDate(n);if(n&&typeof n=="object")return ot.fromObject(n);throw new te(`Unknown datetime argument: ${n}, of type ${typeof n}`)}async function Ln(n,e,a=null){return console.log("[weatherManager] Starting full weather fetch for location:",{lat:n,lng:e}),await Sd(n,e),await Td(n,e,a)}async function Td(n,e,a=null){var s,l;const o=document.getElementById("loading");o&&(o.style.display="block");try{const c=((s=document.getElementById("modelSelect"))==null?void 0:s.value)||_.defaultSettings.model;if(!c)throw new Error("No weather model selected.");const f=zr.API_MAP[c]||c;let p=!1,g,y;const v=ot.utc().startOf("day");let M=null;if(a){let N=ot.fromISO(a,{zone:"utc"});N.isValid&&(M=N.startOf("day"),M<v&&(p=!0))}else{const N=(l=document.getElementById("historicalDatePicker"))==null?void 0:l.value;if(N){let I=ot.fromISO(N,{zone:"utc"}).startOf("day");I<v&&(p=!0,M=I)}}let b=yi.FORECAST;if(p&&M)b=yi.HISTORICAL,g=y=M.toFormat("yyyy-MM-dd"),u.lastModelRun="N/A (Historical Data)";else{let N;try{const U=`https://api.open-meteo.com/data/${f}/static/meta.json`,k=await(await fetch(U)).json();N=new Date(k.last_run_initialisation_time*1e3),u.lastModelRun=N.toISOString().replace("T"," ").substring(0,17)+"Z"}catch{N=new Date,u.lastModelRun="N/A"}let I=ot.fromJSDate(N).setZone("utc").plus({hours:6});I>ot.utc()&&(I=ot.utc()),g=I.toFormat("yyyy-MM-dd");const B=c.includes("_d2")?2:7;y=I.plus({days:B}).toFormat("yyyy-MM-dd")}const P=`${b}?latitude=${n}&longitude=${e}&hourly=surface_pressure,temperature_2m,relative_humidity_2m,wind_speed_10m,wind_direction_10m,wind_gusts_10m,temperature_1000hPa,relative_humidity_1000hPa,wind_speed_1000hPa,wind_direction_1000hPa,geopotential_height_1000hPa,temperature_950hPa,relative_humidity_950hPa,wind_speed_950hPa,wind_direction_950hPa,geopotential_height_950hPa,temperature_925hPa,relative_humidity_925hPa,wind_speed_925hPa,wind_direction_925hPa,geopotential_height_925hPa,temperature_900hPa,relative_humidity_900hPa,wind_speed_900hPa,wind_direction_900hPa,geopotential_height_900hPa,temperature_850hPa,relative_humidity_850hPa,wind_speed_850hPa,wind_direction_850hPa,geopotential_height_850hPa,temperature_800hPa,relative_humidity_800hPa,wind_speed_800hPa,wind_direction_800hPa,geopotential_height_800hPa,temperature_700hPa,relative_humidity_700hPa,wind_speed_700hPa,wind_direction_700hPa,geopotential_height_700hPa,temperature_600hPa,relative_humidity_600hPa,wind_speed_600hPa,wind_direction_600hPa,geopotential_height_600hPa,temperature_500hPa,relative_humidity_500hPa,wind_speed_500hPa,wind_direction_500hPa,geopotential_height_500hPa,temperature_400hPa,relative_humidity_400hPa,wind_speed_400hPa,wind_direction_400hPa,geopotential_height_400hPa,temperature_300hPa,relative_humidity_300hPa,wind_speed_300hPa,wind_direction_300hPa,geopotential_height_300hPa,temperature_250hPa,relative_humidity_250hPa,wind_speed_250hPa,wind_direction_250hPa,geopotential_height_250hPa,temperature_200hPa,relative_humidity_200hPa,wind_speed_200hPa,wind_direction_200hPa,geopotential_height_200hPa&models=${c}&start_date=${g}&end_date=${y}`,x=await fetch(P);if(!x.ok)throw new Error(`HTTP error! Status: ${x.status}`);const A=await x.json();if(!A.hourly||!A.hourly.time||!A.hourly.time.length)throw new Error("No hourly data in API response.");return A.hourly}catch(c){return console.error("[fetchWeather] Error:",c),Gn(`Failed to fetch weather: ${c.message}`),null}finally{o&&(o.style.display="none")}}async function Sd(n,e){const a=zr.LIST;let o=[];for(const s of a)try{const l=await fetch(`${yi.FORECAST}?latitude=${n}&longitude=${e}&hourly=temperature_2m&models=${s}`);if(l.ok){const c=await l.json();c.hourly&&c.hourly.temperature_2m&&c.hourly.temperature_2m.some(d=>d!==null)&&o.push(s)}else console.warn(`Modell '${s}' ist nicht verfügbar (Server-Antwort: ${l.status})`)}catch(l){console.error(`Netzwerkfehler beim Abruf von Modell '${s}':`,l)}return Od(o),Nd(o),Fd(o),o}function Mn(n){if(!u.weatherData||!u.weatherData.time||n>=u.weatherData.time.length)return console.warn("No weather data available for interpolation"),[];const e=Math.round(u.lastAltitude),a=parseInt($r())||100,o=_.getValue("heightUnit","radio","m"),l=Lu.filter($=>{var C;const k=(C=u.weatherData[`geopotential_height_${$}hPa`])==null?void 0:C[n];return k!=null});if(l.length<2)return console.warn("Insufficient valid pressure level data for interpolation:",l),[];let c=l.map($=>u.weatherData[`geopotential_height_${$}hPa`][n]),d=l.map($=>u.weatherData[`temperature_${$}hPa`][n]),f=l.map($=>u.weatherData[`relative_humidity_${$}hPa`][n]),p=l.map($=>u.weatherData[`wind_speed_${$}hPa`][n]),g=l.map($=>u.weatherData[`wind_direction_${$}hPa`][n]);const y=u.weatherData.surface_pressure[n];if(y==null)return console.warn("Surface pressure missing"),[];let v=p.map(($,k)=>-$*Math.sin(g[k]*Math.PI/180)),M=p.map(($,k)=>-$*Math.cos(g[k]*Math.PI/180));const b=Math.max(...l),S=u.weatherData[`geopotential_height_${b}hPa`][n];if(y>b&&Number.isFinite(S)&&S>e){const $=Math.floor((S-e)/a),k=-u.weatherData.wind_speed_10m[n]*Math.sin(u.weatherData.wind_direction_10m[n]*Math.PI/180),C=-u.weatherData.wind_speed_10m[n]*Math.cos(u.weatherData.wind_direction_10m[n]*Math.PI/180),O=v[l.indexOf(b)],F=M[l.indexOf(b)];for(let z=$-1;z>=1;z--){const W=e+z*a;if(W>=S)continue;const it=(W-e)/(S-e),bt=Math.log(y),et=Math.log(b),at=bt+it*(et-bt),G=Math.exp(at),tt=Math.log(W-e+1),J=Math.log(1),Z=Math.log(S-e),nt=T.linearInterpolate([J,Z],[k,O],tt),V=T.linearInterpolate([J,Z],[C,F],tt),lt=T.windSpeed(nt,V),Y=T.windDirection(nt,V);c.unshift(W),l.unshift(G),d.unshift(T.linearInterpolate([e,S],[u.weatherData.temperature_2m[n],u.weatherData[`temperature_${b}hPa`][n]],W)),f.unshift(T.linearInterpolate([e,S],[u.weatherData.relative_humidity_2m[n],u.weatherData[`relative_humidity_${b}hPa`][n]],W)),p.unshift(lt),g.unshift(Y),v.unshift(nt),M.unshift(V)}c.unshift(e),l.unshift(y),d.unshift(u.weatherData.temperature_2m[n]),f.unshift(u.weatherData.relative_humidity_2m[n]),p.unshift(u.weatherData.wind_speed_10m[n]),g.unshift(u.weatherData.wind_direction_10m[n]),v.unshift(k),M.unshift(C)}const P=l.indexOf(Math.min(...l)),x=c[P],A=x-e;if(A<=0||isNaN(A))return console.warn("Invalid max height at lowest pressure level:",{maxHeightASL:x,baseHeight:e,minPressure:l[P]}),[];const N=o==="ft"?A*3.28084:A,I=Math.floor(N/a),B=Array.from({length:I+1},($,k)=>k*a);console.log("Interpolating up to lowest pressure level:",{maxHeightAGL:A,minPressure:l[P],interpStep:a});const U=[];return B.forEach($=>{const k=o==="ft"?$/3.28084:$,C=e+k;let O;if(k===0)O={height:C,pressure:y,temp:u.weatherData.temperature_2m[n],rh:u.weatherData.relative_humidity_2m[n],spd:u.weatherData.wind_speed_10m[n],dir:u.weatherData.wind_direction_10m[n],dew:T.calculateDewpoint(u.weatherData.temperature_2m[n],u.weatherData.relative_humidity_2m[n])};else{const F=T.interpolatePressure(C,l,c),z=T.interpolateWindAtAltitude(C,l,c,v,M),W=T.windSpeed(z.u,z.v),it=T.windDirection(z.u,z.v),bt=T.linearInterpolate(c,d,C),et=T.linearInterpolate(c,f,C),at=T.calculateDewpoint(bt,et);O={height:C,pressure:F==="N/A"?"N/A":Number(F.toFixed(1)),temp:Number(bt.toFixed(1)),rh:Number(et.toFixed(0)),spd:Number(W.toFixed(1)),dir:Number(it.toFixed(0)),dew:Number(at.toFixed(1))}}O.displayHeight=$,U.push(O)}),console.log("Interpolated data length:",U.length,"Max height:",U[U.length-1].displayHeight),U}function kd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mi={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var Pd=mi.exports,Cr;function Ed(){return Cr||(Cr=1,function(n,e){(function(a,o){o(e)})(Pd,function(a){var o="1.9.4";function s(t){var i,r,h,m;for(r=1,h=arguments.length;r<h;r++){m=arguments[r];for(i in m)t[i]=m[i]}return t}var l=Object.create||function(){function t(){}return function(i){return t.prototype=i,new t}}();function c(t,i){var r=Array.prototype.slice;if(t.bind)return t.bind.apply(t,r.call(arguments,1));var h=r.call(arguments,2);return function(){return t.apply(i,h.length?h.concat(r.call(arguments)):arguments)}}var d=0;function f(t){return"_leaflet_id"in t||(t._leaflet_id=++d),t._leaflet_id}function p(t,i,r){var h,m,w,E;return E=function(){h=!1,m&&(w.apply(r,m),m=!1)},w=function(){h?m=arguments:(t.apply(r,arguments),setTimeout(E,i),h=!0)},w}function g(t,i,r){var h=i[1],m=i[0],w=h-m;return t===h&&r?t:((t-m)%w+w)%w+m}function y(){return!1}function v(t,i){if(i===!1)return t;var r=Math.pow(10,i===void 0?6:i);return Math.round(t*r)/r}function M(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function b(t){return M(t).split(/\s+/)}function S(t,i){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?l(t.options):{});for(var r in i)t.options[r]=i[r];return t.options}function P(t,i,r){var h=[];for(var m in t)h.push(encodeURIComponent(r?m.toUpperCase():m)+"="+encodeURIComponent(t[m]));return(!i||i.indexOf("?")===-1?"?":"&")+h.join("&")}var x=/\{ *([\w_ -]+) *\}/g;function A(t,i){return t.replace(x,function(r,h){var m=i[h];if(m===void 0)throw new Error("No value provided for variable "+r);return typeof m=="function"&&(m=m(i)),m})}var N=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function I(t,i){for(var r=0;r<t.length;r++)if(t[r]===i)return r;return-1}var B="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function U(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var $=0;function k(t){var i=+new Date,r=Math.max(0,16-(i-$));return $=i+r,window.setTimeout(t,r)}var C=window.requestAnimationFrame||U("RequestAnimationFrame")||k,O=window.cancelAnimationFrame||U("CancelAnimationFrame")||U("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function F(t,i,r){if(r&&C===k)t.call(i);else return C.call(window,c(t,i))}function z(t){t&&O.call(window,t)}var W={__proto__:null,extend:s,create:l,bind:c,get lastId(){return d},stamp:f,throttle:p,wrapNum:g,falseFn:y,formatNum:v,trim:M,splitWords:b,setOptions:S,getParamString:P,template:A,isArray:N,indexOf:I,emptyImageUrl:B,requestFn:C,cancelFn:O,requestAnimFrame:F,cancelAnimFrame:z};function it(){}it.extend=function(t){var i=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=i.__super__=this.prototype,h=l(r);h.constructor=i,i.prototype=h;for(var m in this)Object.prototype.hasOwnProperty.call(this,m)&&m!=="prototype"&&m!=="__super__"&&(i[m]=this[m]);return t.statics&&s(i,t.statics),t.includes&&(bt(t.includes),s.apply(null,[h].concat(t.includes))),s(h,t),delete h.statics,delete h.includes,h.options&&(h.options=r.options?l(r.options):{},s(h.options,t.options)),h._initHooks=[],h.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var w=0,E=h._initHooks.length;w<E;w++)h._initHooks[w].call(this)}},i},it.include=function(t){var i=this.prototype.options;return s(this.prototype,t),t.options&&(this.prototype.options=i,this.mergeOptions(t.options)),this},it.mergeOptions=function(t){return s(this.prototype.options,t),this},it.addInitHook=function(t){var i=Array.prototype.slice.call(arguments,1),r=typeof t=="function"?t:function(){this[t].apply(this,i)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(r),this};function bt(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=N(t)?t:[t];for(var i=0;i<t.length;i++)t[i]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var et={on:function(t,i,r){if(typeof t=="object")for(var h in t)this._on(h,t[h],i);else{t=b(t);for(var m=0,w=t.length;m<w;m++)this._on(t[m],i,r)}return this},off:function(t,i,r){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var h in t)this._off(h,t[h],i);else{t=b(t);for(var m=arguments.length===1,w=0,E=t.length;w<E;w++)m?this._off(t[w]):this._off(t[w],i,r)}return this},_on:function(t,i,r,h){if(typeof i!="function"){console.warn("wrong listener type: "+typeof i);return}if(this._listens(t,i,r)===!1){r===this&&(r=void 0);var m={fn:i,ctx:r};h&&(m.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(m)}},_off:function(t,i,r){var h,m,w;if(this._events&&(h=this._events[t],!!h)){if(arguments.length===1){if(this._firingCount)for(m=0,w=h.length;m<w;m++)h[m].fn=y;delete this._events[t];return}if(typeof i!="function"){console.warn("wrong listener type: "+typeof i);return}var E=this._listens(t,i,r);if(E!==!1){var D=h[E];this._firingCount&&(D.fn=y,this._events[t]=h=h.slice()),h.splice(E,1)}}},fire:function(t,i,r){if(!this.listens(t,r))return this;var h=s({},i,{type:t,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var m=this._events[t];if(m){this._firingCount=this._firingCount+1||1;for(var w=0,E=m.length;w<E;w++){var D=m[w],R=D.fn;D.once&&this.off(t,R,D.ctx),R.call(D.ctx||this,h)}this._firingCount--}}return r&&this._propagateEvent(h),this},listens:function(t,i,r,h){typeof t!="string"&&console.warn('"string" type argument expected');var m=i;typeof i!="function"&&(h=!!i,m=void 0,r=void 0);var w=this._events&&this._events[t];if(w&&w.length&&this._listens(t,m,r)!==!1)return!0;if(h){for(var E in this._eventParents)if(this._eventParents[E].listens(t,i,r,h))return!0}return!1},_listens:function(t,i,r){if(!this._events)return!1;var h=this._events[t]||[];if(!i)return!!h.length;r===this&&(r=void 0);for(var m=0,w=h.length;m<w;m++)if(h[m].fn===i&&h[m].ctx===r)return m;return!1},once:function(t,i,r){if(typeof t=="object")for(var h in t)this._on(h,t[h],i,!0);else{t=b(t);for(var m=0,w=t.length;m<w;m++)this._on(t[m],i,r,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[f(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[f(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,s({layer:t.target,propagatedFrom:t.target},t),!0)}};et.addEventListener=et.on,et.removeEventListener=et.clearAllEventListeners=et.off,et.addOneTimeEventListener=et.once,et.fireEvent=et.fire,et.hasEventListeners=et.listens;var at=it.extend(et);function G(t,i,r){this.x=r?Math.round(t):t,this.y=r?Math.round(i):i}var tt=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};G.prototype={clone:function(){return new G(this.x,this.y)},add:function(t){return this.clone()._add(J(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(J(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new G(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new G(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=tt(this.x),this.y=tt(this.y),this},distanceTo:function(t){t=J(t);var i=t.x-this.x,r=t.y-this.y;return Math.sqrt(i*i+r*r)},equals:function(t){return t=J(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=J(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+v(this.x)+", "+v(this.y)+")"}};function J(t,i,r){return t instanceof G?t:N(t)?new G(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new G(t.x,t.y):new G(t,i,r)}function Z(t,i){if(t)for(var r=i?[t,i]:t,h=0,m=r.length;h<m;h++)this.extend(r[h])}Z.prototype={extend:function(t){var i,r;if(!t)return this;if(t instanceof G||typeof t[0]=="number"||"x"in t)i=r=J(t);else if(t=nt(t),i=t.min,r=t.max,!i||!r)return this;return!this.min&&!this.max?(this.min=i.clone(),this.max=r.clone()):(this.min.x=Math.min(i.x,this.min.x),this.max.x=Math.max(r.x,this.max.x),this.min.y=Math.min(i.y,this.min.y),this.max.y=Math.max(r.y,this.max.y)),this},getCenter:function(t){return J((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return J(this.min.x,this.max.y)},getTopRight:function(){return J(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var i,r;return typeof t[0]=="number"||t instanceof G?t=J(t):t=nt(t),t instanceof Z?(i=t.min,r=t.max):i=r=t,i.x>=this.min.x&&r.x<=this.max.x&&i.y>=this.min.y&&r.y<=this.max.y},intersects:function(t){t=nt(t);var i=this.min,r=this.max,h=t.min,m=t.max,w=m.x>=i.x&&h.x<=r.x,E=m.y>=i.y&&h.y<=r.y;return w&&E},overlaps:function(t){t=nt(t);var i=this.min,r=this.max,h=t.min,m=t.max,w=m.x>i.x&&h.x<r.x,E=m.y>i.y&&h.y<r.y;return w&&E},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var i=this.min,r=this.max,h=Math.abs(i.x-r.x)*t,m=Math.abs(i.y-r.y)*t;return nt(J(i.x-h,i.y-m),J(r.x+h,r.y+m))},equals:function(t){return t?(t=nt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function nt(t,i){return!t||t instanceof Z?t:new Z(t,i)}function V(t,i){if(t)for(var r=i?[t,i]:t,h=0,m=r.length;h<m;h++)this.extend(r[h])}V.prototype={extend:function(t){var i=this._southWest,r=this._northEast,h,m;if(t instanceof Y)h=t,m=t;else if(t instanceof V){if(h=t._southWest,m=t._northEast,!h||!m)return this}else return t?this.extend(j(t)||lt(t)):this;return!i&&!r?(this._southWest=new Y(h.lat,h.lng),this._northEast=new Y(m.lat,m.lng)):(i.lat=Math.min(h.lat,i.lat),i.lng=Math.min(h.lng,i.lng),r.lat=Math.max(m.lat,r.lat),r.lng=Math.max(m.lng,r.lng)),this},pad:function(t){var i=this._southWest,r=this._northEast,h=Math.abs(i.lat-r.lat)*t,m=Math.abs(i.lng-r.lng)*t;return new V(new Y(i.lat-h,i.lng-m),new Y(r.lat+h,r.lng+m))},getCenter:function(){return new Y((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Y(this.getNorth(),this.getWest())},getSouthEast:function(){return new Y(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof Y||"lat"in t?t=j(t):t=lt(t);var i=this._southWest,r=this._northEast,h,m;return t instanceof V?(h=t.getSouthWest(),m=t.getNorthEast()):h=m=t,h.lat>=i.lat&&m.lat<=r.lat&&h.lng>=i.lng&&m.lng<=r.lng},intersects:function(t){t=lt(t);var i=this._southWest,r=this._northEast,h=t.getSouthWest(),m=t.getNorthEast(),w=m.lat>=i.lat&&h.lat<=r.lat,E=m.lng>=i.lng&&h.lng<=r.lng;return w&&E},overlaps:function(t){t=lt(t);var i=this._southWest,r=this._northEast,h=t.getSouthWest(),m=t.getNorthEast(),w=m.lat>i.lat&&h.lat<r.lat,E=m.lng>i.lng&&h.lng<r.lng;return w&&E},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,i){return t?(t=lt(t),this._southWest.equals(t.getSouthWest(),i)&&this._northEast.equals(t.getNorthEast(),i)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function lt(t,i){return t instanceof V?t:new V(t,i)}function Y(t,i,r){if(isNaN(t)||isNaN(i))throw new Error("Invalid LatLng object: ("+t+", "+i+")");this.lat=+t,this.lng=+i,r!==void 0&&(this.alt=+r)}Y.prototype={equals:function(t,i){if(!t)return!1;t=j(t);var r=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return r<=(i===void 0?1e-9:i)},toString:function(t){return"LatLng("+v(this.lat,t)+", "+v(this.lng,t)+")"},distanceTo:function(t){return X.distance(this,j(t))},wrap:function(){return X.wrapLatLng(this)},toBounds:function(t){var i=180*t/40075017,r=i/Math.cos(Math.PI/180*this.lat);return lt([this.lat-i,this.lng-r],[this.lat+i,this.lng+r])},clone:function(){return new Y(this.lat,this.lng,this.alt)}};function j(t,i,r){return t instanceof Y?t:N(t)&&typeof t[0]!="object"?t.length===3?new Y(t[0],t[1],t[2]):t.length===2?new Y(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new Y(t.lat,"lng"in t?t.lng:t.lon,t.alt):i===void 0?null:new Y(t,i,r)}var ft={latLngToPoint:function(t,i){var r=this.projection.project(t),h=this.scale(i);return this.transformation._transform(r,h)},pointToLatLng:function(t,i){var r=this.scale(i),h=this.transformation.untransform(t,r);return this.projection.unproject(h)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var i=this.projection.bounds,r=this.scale(t),h=this.transformation.transform(i.min,r),m=this.transformation.transform(i.max,r);return new Z(h,m)},infinite:!1,wrapLatLng:function(t){var i=this.wrapLng?g(t.lng,this.wrapLng,!0):t.lng,r=this.wrapLat?g(t.lat,this.wrapLat,!0):t.lat,h=t.alt;return new Y(r,i,h)},wrapLatLngBounds:function(t){var i=t.getCenter(),r=this.wrapLatLng(i),h=i.lat-r.lat,m=i.lng-r.lng;if(h===0&&m===0)return t;var w=t.getSouthWest(),E=t.getNorthEast(),D=new Y(w.lat-h,w.lng-m),R=new Y(E.lat-h,E.lng-m);return new V(D,R)}},X=s({},ft,{wrapLng:[-180,180],R:6371e3,distance:function(t,i){var r=Math.PI/180,h=t.lat*r,m=i.lat*r,w=Math.sin((i.lat-t.lat)*r/2),E=Math.sin((i.lng-t.lng)*r/2),D=w*w+Math.cos(h)*Math.cos(m)*E*E,R=2*Math.atan2(Math.sqrt(D),Math.sqrt(1-D));return this.R*R}}),ht=6378137,wt={R:ht,MAX_LATITUDE:85.0511287798,project:function(t){var i=Math.PI/180,r=this.MAX_LATITUDE,h=Math.max(Math.min(r,t.lat),-r),m=Math.sin(h*i);return new G(this.R*t.lng*i,this.R*Math.log((1+m)/(1-m))/2)},unproject:function(t){var i=180/Math.PI;return new Y((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*i,t.x*i/this.R)},bounds:function(){var t=ht*Math.PI;return new Z([-t,-t],[t,t])}()};function rt(t,i,r,h){if(N(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=i,this._c=r,this._d=h}rt.prototype={transform:function(t,i){return this._transform(t.clone(),i)},_transform:function(t,i){return i=i||1,t.x=i*(this._a*t.x+this._b),t.y=i*(this._c*t.y+this._d),t},untransform:function(t,i){return i=i||1,new G((t.x/i-this._b)/this._a,(t.y/i-this._d)/this._c)}};function Lt(t,i,r,h){return new rt(t,i,r,h)}var kt=s({},X,{code:"EPSG:3857",projection:wt,transformation:function(){var t=.5/(Math.PI*wt.R);return Lt(t,.5,-t,.5)}()}),pt=s({},kt,{code:"EPSG:900913"});function mt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ct(t,i){var r="",h,m,w,E,D,R;for(h=0,w=t.length;h<w;h++){for(D=t[h],m=0,E=D.length;m<E;m++)R=D[m],r+=(m?"L":"M")+R.x+" "+R.y;r+=i?st.svg?"z":"x":""}return r||"M0 0"}var Dt=document.documentElement.style,yt="ActiveXObject"in window,At=yt&&!document.addEventListener,Ft="msLaunchUri"in navigator&&!("documentMode"in document),de=ce("webkit"),It=ce("android"),xe=ce("android 2")||ce("android 3"),Rt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Vt=It&&ce("Google")&&Rt<537&&!("AudioNode"in window),Et=!!window.opera,zt=!Ft&&ce("chrome"),qt=ce("gecko")&&!de&&!Et&&!yt,rn=!zt&&ce("safari"),qe=ce("phantom"),be="OTransition"in Dt,ie=navigator.platform.indexOf("Win")===0,Ae=yt&&"transition"in Dt,ln="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!xe,bn="MozPerspective"in Dt,Ci=!window.L_DISABLE_3D&&(Ae||ln||bn)&&!be&&!qe,cn=typeof orientation<"u"||ce("mobile"),$e=cn&&de,Ca=cn&&ln,xi=!window.PointerEvent&&window.MSPointerEvent,Ai=!!(window.PointerEvent||xi),Ii="ontouchstart"in window||!!window.TouchEvent,xa=!window.L_NO_TOUCH&&(Ii||Ai),Di=cn&&Et,Kt=cn&&qt,Ie=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Tn=function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",y,i),window.removeEventListener("testPassiveEventSupport",y,i)}catch{}return t}(),Aa=function(){return!!document.createElement("canvas").getContext}(),Yn=!!(document.createElementNS&&mt("svg").createSVGRect),Qo=!!Yn&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),ts=!Yn&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&typeof i.adj=="object"}catch{return!1}}(),es=navigator.platform.indexOf("Mac")===0,Oi=navigator.platform.indexOf("Linux")===0;function ce(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var st={ie:yt,ielt9:At,edge:Ft,webkit:de,android:It,android23:xe,androidStock:Vt,opera:Et,chrome:zt,gecko:qt,safari:rn,phantom:qe,opera12:be,win:ie,ie3d:Ae,webkit3d:ln,gecko3d:bn,any3d:Ci,mobile:cn,mobileWebkit:$e,mobileWebkit3d:Ca,msPointer:xi,pointer:Ai,touch:xa,touchNative:Ii,mobileOpera:Di,mobileGecko:Kt,retina:Ie,passiveEvents:Tn,canvas:Aa,svg:Yn,vml:ts,inlineSvg:Qo,mac:es,linux:Oi},Ni=st.msPointer?"MSPointerDown":"pointerdown",ns=st.msPointer?"MSPointerMove":"pointermove",is=st.msPointer?"MSPointerUp":"pointerup",as=st.msPointer?"MSPointerCancel":"pointercancel",Ia={touchstart:Ni,touchmove:ns,touchend:is,touchcancel:as},os={touchstart:gc,touchmove:Fi,touchend:Fi,touchcancel:Fi},Sn={},ss=!1;function hc(t,i,r){return i==="touchstart"&&pc(),os[i]?(r=os[i].bind(this,r),t.addEventListener(Ia[i],r,!1),r):(console.warn("wrong event specified:",i),y)}function dc(t,i,r){if(!Ia[i]){console.warn("wrong event specified:",i);return}t.removeEventListener(Ia[i],r,!1)}function fc(t){Sn[t.pointerId]=t}function mc(t){Sn[t.pointerId]&&(Sn[t.pointerId]=t)}function rs(t){delete Sn[t.pointerId]}function pc(){ss||(document.addEventListener(Ni,fc,!0),document.addEventListener(ns,mc,!0),document.addEventListener(is,rs,!0),document.addEventListener(as,rs,!0),ss=!0)}function Fi(t,i){if(i.pointerType!==(i.MSPOINTER_TYPE_MOUSE||"mouse")){i.touches=[];for(var r in Sn)i.touches.push(Sn[r]);i.changedTouches=[i],t(i)}}function gc(t,i){i.MSPOINTER_TYPE_TOUCH&&i.pointerType===i.MSPOINTER_TYPE_TOUCH&&Yt(i),Fi(t,i)}function _c(t){var i={},r,h;for(h in t)r=t[h],i[h]=r&&r.bind?r.bind(t):r;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var yc=200;function vc(t,i){t.addEventListener("dblclick",i);var r=0,h;function m(w){if(w.detail!==1){h=w.detail;return}if(!(w.pointerType==="mouse"||w.sourceCapabilities&&!w.sourceCapabilities.firesTouchEvents)){var E=ds(w);if(!(E.some(function(R){return R instanceof HTMLLabelElement&&R.attributes.for})&&!E.some(function(R){return R instanceof HTMLInputElement||R instanceof HTMLSelectElement}))){var D=Date.now();D-r<=yc?(h++,h===2&&i(_c(w))):h=1,r=D}}}return t.addEventListener("click",m),{dblclick:i,simDblclick:m}}function wc(t,i){t.removeEventListener("dblclick",i.dblclick),t.removeEventListener("click",i.simDblclick)}var Da=$i(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Xn=$i(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ls=Xn==="webkitTransition"||Xn==="OTransition"?Xn+"End":"transitionend";function cs(t){return typeof t=="string"?document.getElementById(t):t}function Qn(t,i){var r=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!r||r==="auto")&&document.defaultView){var h=document.defaultView.getComputedStyle(t,null);r=h?h[i]:null}return r==="auto"?null:r}function Pt(t,i,r){var h=document.createElement(t);return h.className=i||"",r&&r.appendChild(h),h}function $t(t){var i=t.parentNode;i&&i.removeChild(t)}function Ri(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function kn(t){var i=t.parentNode;i&&i.lastChild!==t&&i.appendChild(t)}function Pn(t){var i=t.parentNode;i&&i.firstChild!==t&&i.insertBefore(t,i.firstChild)}function Oa(t,i){if(t.classList!==void 0)return t.classList.contains(i);var r=zi(t);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function vt(t,i){if(t.classList!==void 0)for(var r=b(i),h=0,m=r.length;h<m;h++)t.classList.add(r[h]);else if(!Oa(t,i)){var w=zi(t);Na(t,(w?w+" ":"")+i)}}function Ht(t,i){t.classList!==void 0?t.classList.remove(i):Na(t,M((" "+zi(t)+" ").replace(" "+i+" "," ")))}function Na(t,i){t.className.baseVal===void 0?t.className=i:t.className.baseVal=i}function zi(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function fe(t,i){"opacity"in t.style?t.style.opacity=i:"filter"in t.style&&Lc(t,i)}function Lc(t,i){var r=!1,h="DXImageTransform.Microsoft.Alpha";try{r=t.filters.item(h)}catch{if(i===1)return}i=Math.round(i*100),r?(r.Enabled=i!==100,r.Opacity=i):t.style.filter+=" progid:"+h+"(opacity="+i+")"}function $i(t){for(var i=document.documentElement.style,r=0;r<t.length;r++)if(t[r]in i)return t[r];return!1}function un(t,i,r){var h=i||new G(0,0);t.style[Da]=(st.ie3d?"translate("+h.x+"px,"+h.y+"px)":"translate3d("+h.x+"px,"+h.y+"px,0)")+(r?" scale("+r+")":"")}function Zt(t,i){t._leaflet_pos=i,st.any3d?un(t,i):(t.style.left=i.x+"px",t.style.top=i.y+"px")}function hn(t){return t._leaflet_pos||new G(0,0)}var ti,ei,Fa;if("onselectstart"in document)ti=function(){gt(window,"selectstart",Yt)},ei=function(){Ot(window,"selectstart",Yt)};else{var ni=$i(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ti=function(){if(ni){var t=document.documentElement.style;Fa=t[ni],t[ni]="none"}},ei=function(){ni&&(document.documentElement.style[ni]=Fa,Fa=void 0)}}function Ra(){gt(window,"dragstart",Yt)}function za(){Ot(window,"dragstart",Yt)}var Bi,$a;function Ba(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(Ui(),Bi=t,$a=t.style.outlineStyle,t.style.outlineStyle="none",gt(window,"keydown",Ui))}function Ui(){Bi&&(Bi.style.outlineStyle=$a,Bi=void 0,$a=void 0,Ot(window,"keydown",Ui))}function us(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function Ua(t){var i=t.getBoundingClientRect();return{x:i.width/t.offsetWidth||1,y:i.height/t.offsetHeight||1,boundingClientRect:i}}var Mc={__proto__:null,TRANSFORM:Da,TRANSITION:Xn,TRANSITION_END:ls,get:cs,getStyle:Qn,create:Pt,remove:$t,empty:Ri,toFront:kn,toBack:Pn,hasClass:Oa,addClass:vt,removeClass:Ht,setClass:Na,getClass:zi,setOpacity:fe,testProp:$i,setTransform:un,setPosition:Zt,getPosition:hn,get disableTextSelection(){return ti},get enableTextSelection(){return ei},disableImageDrag:Ra,enableImageDrag:za,preventOutline:Ba,restoreOutline:Ui,getSizedParentNode:us,getScale:Ua};function gt(t,i,r,h){if(i&&typeof i=="object")for(var m in i)Za(t,m,i[m],r);else{i=b(i);for(var w=0,E=i.length;w<E;w++)Za(t,i[w],r,h)}return this}var De="_leaflet_events";function Ot(t,i,r,h){if(arguments.length===1)hs(t),delete t[De];else if(i&&typeof i=="object")for(var m in i)Wa(t,m,i[m],r);else if(i=b(i),arguments.length===2)hs(t,function(D){return I(i,D)!==-1});else for(var w=0,E=i.length;w<E;w++)Wa(t,i[w],r,h);return this}function hs(t,i){for(var r in t[De]){var h=r.split(/\d/)[0];(!i||i(h))&&Wa(t,h,null,null,r)}}var Ha={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Za(t,i,r,h){var m=i+f(r)+(h?"_"+f(h):"");if(t[De]&&t[De][m])return this;var w=function(D){return r.call(h||t,D||window.event)},E=w;!st.touchNative&&st.pointer&&i.indexOf("touch")===0?w=hc(t,i,w):st.touch&&i==="dblclick"?w=vc(t,w):"addEventListener"in t?i==="touchstart"||i==="touchmove"||i==="wheel"||i==="mousewheel"?t.addEventListener(Ha[i]||i,w,st.passiveEvents?{passive:!1}:!1):i==="mouseenter"||i==="mouseleave"?(w=function(D){D=D||window.event,Va(t,D)&&E(D)},t.addEventListener(Ha[i],w,!1)):t.addEventListener(i,E,!1):t.attachEvent("on"+i,w),t[De]=t[De]||{},t[De][m]=w}function Wa(t,i,r,h,m){m=m||i+f(r)+(h?"_"+f(h):"");var w=t[De]&&t[De][m];if(!w)return this;!st.touchNative&&st.pointer&&i.indexOf("touch")===0?dc(t,i,w):st.touch&&i==="dblclick"?wc(t,w):"removeEventListener"in t?t.removeEventListener(Ha[i]||i,w,!1):t.detachEvent("on"+i,w),t[De][m]=null}function dn(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ga(t){return Za(t,"wheel",dn),this}function ii(t){return gt(t,"mousedown touchstart dblclick contextmenu",dn),t._leaflet_disable_click=!0,this}function Yt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function fn(t){return Yt(t),dn(t),this}function ds(t){if(t.composedPath)return t.composedPath();for(var i=[],r=t.target;r;)i.push(r),r=r.parentNode;return i}function fs(t,i){if(!i)return new G(t.clientX,t.clientY);var r=Ua(i),h=r.boundingClientRect;return new G((t.clientX-h.left)/r.x-i.clientLeft,(t.clientY-h.top)/r.y-i.clientTop)}var bc=st.linux&&st.chrome?window.devicePixelRatio:st.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ms(t){return st.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/bc:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function Va(t,i){var r=i.relatedTarget;if(!r)return!0;try{for(;r&&r!==t;)r=r.parentNode}catch{return!1}return r!==t}var Tc={__proto__:null,on:gt,off:Ot,stopPropagation:dn,disableScrollPropagation:Ga,disableClickPropagation:ii,preventDefault:Yt,stop:fn,getPropagationPath:ds,getMousePosition:fs,getWheelDelta:ms,isExternalTarget:Va,addListener:gt,removeListener:Ot},ps=at.extend({run:function(t,i,r,h){this.stop(),this._el=t,this._inProgress=!0,this._duration=r||.25,this._easeOutPower=1/Math.max(h||.5,.2),this._startPos=hn(t),this._offset=i.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=F(this._animate,this),this._step()},_step:function(t){var i=+new Date-this._startTime,r=this._duration*1e3;i<r?this._runFrame(this._easeOut(i/r),t):(this._runFrame(1),this._complete())},_runFrame:function(t,i){var r=this._startPos.add(this._offset.multiplyBy(t));i&&r._round(),Zt(this._el,r),this.fire("step")},_complete:function(){z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Tt=at.extend({options:{crs:kt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,i){i=S(this,i),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=c(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),i.zoom!==void 0&&(this._zoom=this._limitZoom(i.zoom)),i.center&&i.zoom!==void 0&&this.setView(j(i.center),i.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Xn&&st.any3d&&!st.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),gt(this._proxy,ls,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,i,r){if(i=i===void 0?this._zoom:this._limitZoom(i),t=this._limitCenter(j(t),i,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&r!==!0){r.animate!==void 0&&(r.zoom=s({animate:r.animate},r.zoom),r.pan=s({animate:r.animate,duration:r.duration},r.pan));var h=this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,r.zoom):this._tryAnimatedPan(t,r.pan);if(h)return clearTimeout(this._sizeTimer),this}return this._resetView(t,i,r.pan&&r.pan.noMoveStart),this},setZoom:function(t,i){return this._loaded?this.setView(this.getCenter(),t,{zoom:i}):(this._zoom=t,this)},zoomIn:function(t,i){return t=t||(st.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,i)},zoomOut:function(t,i){return t=t||(st.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,i)},setZoomAround:function(t,i,r){var h=this.getZoomScale(i),m=this.getSize().divideBy(2),w=t instanceof G?t:this.latLngToContainerPoint(t),E=w.subtract(m).multiplyBy(1-1/h),D=this.containerPointToLatLng(m.add(E));return this.setView(D,i,{zoom:r})},_getBoundsCenterZoom:function(t,i){i=i||{},t=t.getBounds?t.getBounds():lt(t);var r=J(i.paddingTopLeft||i.padding||[0,0]),h=J(i.paddingBottomRight||i.padding||[0,0]),m=this.getBoundsZoom(t,!1,r.add(h));if(m=typeof i.maxZoom=="number"?Math.min(i.maxZoom,m):m,m===1/0)return{center:t.getCenter(),zoom:m};var w=h.subtract(r).divideBy(2),E=this.project(t.getSouthWest(),m),D=this.project(t.getNorthEast(),m),R=this.unproject(E.add(D).divideBy(2).add(w),m);return{center:R,zoom:m}},fitBounds:function(t,i){if(t=lt(t),!t.isValid())throw new Error("Bounds are not valid.");var r=this._getBoundsCenterZoom(t,i);return this.setView(r.center,r.zoom,i)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,i){return this.setView(t,this._zoom,{pan:i})},panBy:function(t,i){if(t=J(t).round(),i=i||{},!t.x&&!t.y)return this.fire("moveend");if(i.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ps,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),i.noMoveStart||this.fire("movestart"),i.animate!==!1){vt(this._mapPane,"leaflet-pan-anim");var r=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,r,i.duration||.25,i.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,i,r){if(r=r||{},r.animate===!1||!st.any3d)return this.setView(t,i,r);this._stop();var h=this.project(this.getCenter()),m=this.project(t),w=this.getSize(),E=this._zoom;t=j(t),i=i===void 0?E:i;var D=Math.max(w.x,w.y),R=D*this.getZoomScale(E,i),H=m.distanceTo(h)||1,Q=1.42,ut=Q*Q;function Mt(Wt){var Qi=Wt?-1:1,du=Wt?R:D,fu=R*R-D*D+Qi*ut*ut*H*H,mu=2*du*ut*H,io=fu/mu,qs=Math.sqrt(io*io+1)-io,pu=qs<1e-9?-18:Math.log(qs);return pu}function ae(Wt){return(Math.exp(Wt)-Math.exp(-Wt))/2}function jt(Wt){return(Math.exp(Wt)+Math.exp(-Wt))/2}function pe(Wt){return ae(Wt)/jt(Wt)}var se=Mt(0);function Dn(Wt){return D*(jt(se)/jt(se+Q*Wt))}function lu(Wt){return D*(jt(se)*pe(se+Q*Wt)-ae(se))/ut}function cu(Wt){return 1-Math.pow(1-Wt,1.5)}var uu=Date.now(),js=(Mt(1)-se)/Q,hu=r.duration?1e3*r.duration:1e3*js*.8;function Js(){var Wt=(Date.now()-uu)/hu,Qi=cu(Wt)*js;Wt<=1?(this._flyToFrame=F(Js,this),this._move(this.unproject(h.add(m.subtract(h).multiplyBy(lu(Qi)/H)),E),this.getScaleZoom(D/Dn(Qi),E),{flyTo:!0})):this._move(t,i)._moveEnd(!0)}return this._moveStart(!0,r.noMoveStart),Js.call(this),this},flyToBounds:function(t,i){var r=this._getBoundsCenterZoom(t,i);return this.flyTo(r.center,r.zoom,i)},setMaxBounds:function(t){return t=lt(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var i=this.options.minZoom;return this.options.minZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var i=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,i){this._enforcingBounds=!0;var r=this.getCenter(),h=this._limitCenter(r,this._zoom,lt(t));return r.equals(h)||this.panTo(h,i),this._enforcingBounds=!1,this},panInside:function(t,i){i=i||{};var r=J(i.paddingTopLeft||i.padding||[0,0]),h=J(i.paddingBottomRight||i.padding||[0,0]),m=this.project(this.getCenter()),w=this.project(t),E=this.getPixelBounds(),D=nt([E.min.add(r),E.max.subtract(h)]),R=D.getSize();if(!D.contains(w)){this._enforcingBounds=!0;var H=w.subtract(D.getCenter()),Q=D.extend(w).getSize().subtract(R);m.x+=H.x<0?-Q.x:Q.x,m.y+=H.y<0?-Q.y:Q.y,this.panTo(this.unproject(m),i),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=s({animate:!1,pan:!0},t===!0?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),h=i.divideBy(2).round(),m=r.divideBy(2).round(),w=h.subtract(m);return!w.x&&!w.y?this:(t.animate&&t.pan?this.panBy(w):(t.pan&&this._rawPanBy(w),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(c(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:r}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=s({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var i=c(this._handleGeolocationResponse,this),r=c(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(i,r,t):navigator.geolocation.getCurrentPosition(i,r,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var i=t.code,r=t.message||(i===1?"permission denied":i===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:i,message:"Geolocation error: "+r+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var i=t.coords.latitude,r=t.coords.longitude,h=new Y(i,r),m=h.toBounds(t.coords.accuracy*2),w=this._locateOptions;if(w.setView){var E=this.getBoundsZoom(m);this.setView(h,w.maxZoom?Math.min(E,w.maxZoom):E)}var D={latlng:h,bounds:m,timestamp:t.timestamp};for(var R in t.coords)typeof t.coords[R]=="number"&&(D[R]=t.coords[R]);this.fire("locationfound",D)}},addHandler:function(t,i){if(!i)return this;var r=this[t]=new i(this);return this._handlers.push(r),this.options[t]&&r.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),$t(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)$t(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,i){var r="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),h=Pt("div",r,i||this._mapPane);return t&&(this._panes[t]=h),h},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),i=this.unproject(t.getBottomLeft()),r=this.unproject(t.getTopRight());return new V(i,r)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,i,r){t=lt(t),r=J(r||[0,0]);var h=this.getZoom()||0,m=this.getMinZoom(),w=this.getMaxZoom(),E=t.getNorthWest(),D=t.getSouthEast(),R=this.getSize().subtract(r),H=nt(this.project(D,h),this.project(E,h)).getSize(),Q=st.any3d?this.options.zoomSnap:1,ut=R.x/H.x,Mt=R.y/H.y,ae=i?Math.max(ut,Mt):Math.min(ut,Mt);return h=this.getScaleZoom(ae,h),Q&&(h=Math.round(h/(Q/100))*(Q/100),h=i?Math.ceil(h/Q)*Q:Math.floor(h/Q)*Q),Math.max(m,Math.min(w,h))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new G(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,i){var r=this._getTopLeftPoint(t,i);return new Z(r,r.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,i){var r=this.options.crs;return i=i===void 0?this._zoom:i,r.scale(t)/r.scale(i)},getScaleZoom:function(t,i){var r=this.options.crs;i=i===void 0?this._zoom:i;var h=r.zoom(t*r.scale(i));return isNaN(h)?1/0:h},project:function(t,i){return i=i===void 0?this._zoom:i,this.options.crs.latLngToPoint(j(t),i)},unproject:function(t,i){return i=i===void 0?this._zoom:i,this.options.crs.pointToLatLng(J(t),i)},layerPointToLatLng:function(t){var i=J(t).add(this.getPixelOrigin());return this.unproject(i)},latLngToLayerPoint:function(t){var i=this.project(j(t))._round();return i._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(j(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(lt(t))},distance:function(t,i){return this.options.crs.distance(j(t),j(i))},containerPointToLayerPoint:function(t){return J(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return J(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var i=this.containerPointToLayerPoint(J(t));return this.layerPointToLatLng(i)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(j(t)))},mouseEventToContainerPoint:function(t){return fs(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var i=this._container=cs(t);if(i){if(i._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");gt(i,"scroll",this._onScroll,this),this._containerId=f(i)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&st.any3d,vt(t,"leaflet-container"+(st.touch?" leaflet-touch":"")+(st.retina?" leaflet-retina":"")+(st.ielt9?" leaflet-oldie":"")+(st.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var i=Qn(t,"position");i!=="absolute"&&i!=="relative"&&i!=="fixed"&&i!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Zt(this._mapPane,new G(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(vt(t.markerPane,"leaflet-zoom-hide"),vt(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,i,r){Zt(this._mapPane,new G(0,0));var h=!this._loaded;this._loaded=!0,i=this._limitZoom(i),this.fire("viewprereset");var m=this._zoom!==i;this._moveStart(m,r)._move(t,i)._moveEnd(m),this.fire("viewreset"),h&&this.fire("load")},_moveStart:function(t,i){return t&&this.fire("zoomstart"),i||this.fire("movestart"),this},_move:function(t,i,r,h){i===void 0&&(i=this._zoom);var m=this._zoom!==i;return this._zoom=i,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),h?r&&r.pinch&&this.fire("zoom",r):((m||r&&r.pinch)&&this.fire("zoom",r),this.fire("move",r)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){Zt(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[f(this._container)]=this;var i=t?Ot:gt;i(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&i(window,"resize",this._onResize,this),st.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){z(this._resizeRequest),this._resizeRequest=F(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,i){for(var r=[],h,m=i==="mouseout"||i==="mouseover",w=t.target||t.srcElement,E=!1;w;){if(h=this._targets[f(w)],h&&(i==="click"||i==="preclick")&&this._draggableMoved(h)){E=!0;break}if(h&&h.listens(i,!0)&&(m&&!Va(w,t)||(r.push(h),m))||w===this._container)break;w=w.parentNode}return!r.length&&!E&&!m&&this.listens(i,!0)&&(r=[this]),r},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var i=t.target||t.srcElement;if(!(!this._loaded||i._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(i))){var r=t.type;r==="mousedown"&&Ba(i),this._fireDOMEvent(t,r)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,i,r){if(t.type==="click"){var h=s({},t);h.type="preclick",this._fireDOMEvent(h,h.type,r)}var m=this._findEventTargets(t,i);if(r){for(var w=[],E=0;E<r.length;E++)r[E].listens(i,!0)&&w.push(r[E]);m=w.concat(m)}if(m.length){i==="contextmenu"&&Yt(t);var D=m[0],R={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var H=D.getLatLng&&(!D._radius||D._radius<=10);R.containerPoint=H?this.latLngToContainerPoint(D.getLatLng()):this.mouseEventToContainerPoint(t),R.layerPoint=this.containerPointToLayerPoint(R.containerPoint),R.latlng=H?D.getLatLng():this.layerPointToLatLng(R.layerPoint)}for(E=0;E<m.length;E++)if(m[E].fire(i,R,!0),R.originalEvent._stopped||m[E].options.bubblingMouseEvents===!1&&I(this._mouseEvents,i)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,i=this._handlers.length;t<i;t++)this._handlers[t].disable()},whenReady:function(t,i){return this._loaded?t.call(i||this,{target:this}):this.on("load",t,i),this},_getMapPanePos:function(){return hn(this._mapPane)||new G(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,i){var r=t&&i!==void 0?this._getNewPixelOrigin(t,i):this.getPixelOrigin();return r.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,i){var r=this.getSize()._divideBy(2);return this.project(t,i)._subtract(r)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,i,r){var h=this._getNewPixelOrigin(r,i);return this.project(t,i)._subtract(h)},_latLngBoundsToNewLayerBounds:function(t,i,r){var h=this._getNewPixelOrigin(r,i);return nt([this.project(t.getSouthWest(),i)._subtract(h),this.project(t.getNorthWest(),i)._subtract(h),this.project(t.getSouthEast(),i)._subtract(h),this.project(t.getNorthEast(),i)._subtract(h)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,i,r){if(!r)return t;var h=this.project(t,i),m=this.getSize().divideBy(2),w=new Z(h.subtract(m),h.add(m)),E=this._getBoundsOffset(w,r,i);return Math.abs(E.x)<=1&&Math.abs(E.y)<=1?t:this.unproject(h.add(E),i)},_limitOffset:function(t,i){if(!i)return t;var r=this.getPixelBounds(),h=new Z(r.min.add(t),r.max.add(t));return t.add(this._getBoundsOffset(h,i))},_getBoundsOffset:function(t,i,r){var h=nt(this.project(i.getNorthEast(),r),this.project(i.getSouthWest(),r)),m=h.min.subtract(t.min),w=h.max.subtract(t.max),E=this._rebound(m.x,-w.x),D=this._rebound(m.y,-w.y);return new G(E,D)},_rebound:function(t,i){return t+i>0?Math.round(t-i)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(i))},_limitZoom:function(t){var i=this.getMinZoom(),r=this.getMaxZoom(),h=st.any3d?this.options.zoomSnap:1;return h&&(t=Math.round(t/h)*h),Math.max(i,Math.min(r,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ht(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,i){var r=this._getCenterOffset(t)._trunc();return(i&&i.animate)!==!0&&!this.getSize().contains(r)?!1:(this.panBy(r,i),!0)},_createAnimProxy:function(){var t=this._proxy=Pt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(i){var r=Da,h=this._proxy.style[r];un(this._proxy,this.project(i.center,i.zoom),this.getZoomScale(i.zoom,1)),h===this._proxy.style[r]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){$t(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),i=this.getZoom();un(this._proxy,this.project(t,i),this.getZoomScale(i,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,i,r){if(this._animatingZoom)return!0;if(r=r||{},!this._zoomAnimated||r.animate===!1||this._nothingToAnimate()||Math.abs(i-this._zoom)>this.options.zoomAnimationThreshold)return!1;var h=this.getZoomScale(i),m=this._getCenterOffset(t)._divideBy(1-1/h);return r.animate!==!0&&!this.getSize().contains(m)?!1:(F(function(){this._moveStart(!0,r.noMoveStart||!1)._animateZoom(t,i,!0)},this),!0)},_animateZoom:function(t,i,r,h){this._mapPane&&(r&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=i,vt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:i,noUpdate:h}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(c(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ht(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Sc(t,i){return new Tt(t,i)}var Te=it.extend({options:{position:"topright"},initialize:function(t){S(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var i=this._map;return i&&i.removeControl(this),this.options.position=t,i&&i.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var i=this._container=this.onAdd(t),r=this.getPosition(),h=t._controlCorners[r];return vt(i,"leaflet-control"),r.indexOf("bottom")!==-1?h.insertBefore(i,h.firstChild):h.appendChild(i),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?($t(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),ai=function(t){return new Te(t)};Tt.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},i="leaflet-",r=this._controlContainer=Pt("div",i+"control-container",this._container);function h(m,w){var E=i+m+" "+i+w;t[m+w]=Pt("div",E,r)}h("top","left"),h("top","right"),h("bottom","left"),h("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)$t(this._controlCorners[t]);$t(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var gs=Te.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,i,r,h){return r<h?-1:h<r?1:0}},initialize:function(t,i,r){S(this,r),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var h in t)this._addLayer(t[h],h);for(h in i)this._addLayer(i[h],h,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Te.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,i){return this._addLayer(t,i),this._map?this._update():this},addOverlay:function(t,i){return this._addLayer(t,i,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var i=this._getLayer(f(t));return i&&this._layers.splice(this._layers.indexOf(i),1),this._map?this._update():this},expand:function(){vt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(vt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):Ht(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ht(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",i=this._container=Pt("div",t),r=this.options.collapsed;i.setAttribute("aria-haspopup",!0),ii(i),Ga(i);var h=this._section=Pt("section",t+"-list");r&&(this._map.on("click",this.collapse,this),gt(i,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var m=this._layersLink=Pt("a",t+"-toggle",i);m.href="#",m.title="Layers",m.setAttribute("role","button"),gt(m,{keydown:function(w){w.keyCode===13&&this._expandSafely()},click:function(w){Yt(w),this._expandSafely()}},this),r||this.expand(),this._baseLayersList=Pt("div",t+"-base",h),this._separator=Pt("div",t+"-separator",h),this._overlaysList=Pt("div",t+"-overlays",h),i.appendChild(h)},_getLayer:function(t){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&f(this._layers[i].layer)===t)return this._layers[i]},_addLayer:function(t,i,r){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:i,overlay:r}),this.options.sortLayers&&this._layers.sort(c(function(h,m){return this.options.sortFunction(h.layer,m.layer,h.name,m.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ri(this._baseLayersList),Ri(this._overlaysList),this._layerControlInputs=[];var t,i,r,h,m=0;for(r=0;r<this._layers.length;r++)h=this._layers[r],this._addItem(h),i=i||h.overlay,t=t||!h.overlay,m+=h.overlay?0:1;return this.options.hideSingleBase&&(t=t&&m>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=i&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var i=this._getLayer(f(t.target)),r=i.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;r&&this._map.fire(r,i)},_createRadioElement:function(t,i){var r='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",h=document.createElement("div");return h.innerHTML=r,h.firstChild},_addItem:function(t){var i=document.createElement("label"),r=this._map.hasLayer(t.layer),h;t.overlay?(h=document.createElement("input"),h.type="checkbox",h.className="leaflet-control-layers-selector",h.defaultChecked=r):h=this._createRadioElement("leaflet-base-layers_"+f(this),r),this._layerControlInputs.push(h),h.layerId=f(t.layer),gt(h,"click",this._onInputClick,this);var m=document.createElement("span");m.innerHTML=" "+t.name;var w=document.createElement("span");i.appendChild(w),w.appendChild(h),w.appendChild(m);var E=t.overlay?this._overlaysList:this._baseLayersList;return E.appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,i,r,h=[],m=[];this._handlingClick=!0;for(var w=t.length-1;w>=0;w--)i=t[w],r=this._getLayer(i.layerId).layer,i.checked?h.push(r):i.checked||m.push(r);for(w=0;w<m.length;w++)this._map.hasLayer(m[w])&&this._map.removeLayer(m[w]);for(w=0;w<h.length;w++)this._map.hasLayer(h[w])||this._map.addLayer(h[w]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,i,r,h=this._map.getZoom(),m=t.length-1;m>=0;m--)i=t[m],r=this._getLayer(i.layerId).layer,i.disabled=r.options.minZoom!==void 0&&h<r.options.minZoom||r.options.maxZoom!==void 0&&h>r.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,gt(t,"click",Yt),this.expand();var i=this;setTimeout(function(){Ot(t,"click",Yt),i._preventClick=!1})}}),kc=function(t,i,r){return new gs(t,i,r)},ja=Te.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var i="leaflet-control-zoom",r=Pt("div",i+" leaflet-bar"),h=this.options;return this._zoomInButton=this._createButton(h.zoomInText,h.zoomInTitle,i+"-in",r,this._zoomIn),this._zoomOutButton=this._createButton(h.zoomOutText,h.zoomOutTitle,i+"-out",r,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),r},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,i,r,h,m){var w=Pt("a",r,h);return w.innerHTML=t,w.href="#",w.title=i,w.setAttribute("role","button"),w.setAttribute("aria-label",i),ii(w),gt(w,"click",fn),gt(w,"click",m,this),gt(w,"click",this._refocusOnMap,this),w},_updateDisabled:function(){var t=this._map,i="leaflet-disabled";Ht(this._zoomInButton,i),Ht(this._zoomOutButton,i),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(vt(this._zoomOutButton,i),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(vt(this._zoomInButton,i),this._zoomInButton.setAttribute("aria-disabled","true"))}});Tt.mergeOptions({zoomControl:!0}),Tt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ja,this.addControl(this.zoomControl))});var Pc=function(t){return new ja(t)},_s=Te.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var i="leaflet-control-scale",r=Pt("div",i),h=this.options;return this._addScales(h,i+"-line",r),t.on(h.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),r},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,i,r){t.metric&&(this._mScale=Pt("div",i,r)),t.imperial&&(this._iScale=Pt("div",i,r))},_update:function(){var t=this._map,i=t.getSize().y/2,r=t.distance(t.containerPointToLatLng([0,i]),t.containerPointToLatLng([this.options.maxWidth,i]));this._updateScales(r)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var i=this._getRoundNum(t),r=i<1e3?i+" m":i/1e3+" km";this._updateScale(this._mScale,r,i/t)},_updateImperial:function(t){var i=t*3.2808399,r,h,m;i>5280?(r=i/5280,h=this._getRoundNum(r),this._updateScale(this._iScale,h+" mi",h/r)):(m=this._getRoundNum(i),this._updateScale(this._iScale,m+" ft",m/i))},_updateScale:function(t,i,r){t.style.width=Math.round(this.options.maxWidth*r)+"px",t.innerHTML=i},_getRoundNum:function(t){var i=Math.pow(10,(Math.floor(t)+"").length-1),r=t/i;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:1,i*r}}),Ec=function(t){return new _s(t)},Cc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ja=Te.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(st.inlineSvg?Cc+" ":"")+"Leaflet</a>"},initialize:function(t){S(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=Pt("div","leaflet-control-attribution"),ii(this._container);for(var i in t._layers)t._layers[i].getAttribution&&this.addAttribution(t._layers[i].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var i in this._attributions)this._attributions[i]&&t.push(i);var r=[];this.options.prefix&&r.push(this.options.prefix),t.length&&r.push(t.join(", ")),this._container.innerHTML=r.join(' <span aria-hidden="true">|</span> ')}}});Tt.mergeOptions({attributionControl:!0}),Tt.addInitHook(function(){this.options.attributionControl&&new Ja().addTo(this)});var xc=function(t){return new Ja(t)};Te.Layers=gs,Te.Zoom=ja,Te.Scale=_s,Te.Attribution=Ja,ai.layers=kc,ai.zoom=Pc,ai.scale=Ec,ai.attribution=xc;var Oe=it.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Oe.addTo=function(t,i){return t.addHandler(i,this),this};var Ac={Events:et},ys=st.touch?"touchstart mousedown":"mousedown",Ke=at.extend({options:{clickTolerance:3},initialize:function(t,i,r,h){S(this,h),this._element=t,this._dragStartTarget=i||t,this._preventOutline=r},enable:function(){this._enabled||(gt(this._dragStartTarget,ys,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ke._dragging===this&&this.finishDrag(!0),Ot(this._dragStartTarget,ys,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!Oa(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){Ke._dragging===this&&this.finishDrag();return}if(!(Ke._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(Ke._dragging=this,this._preventOutline&&Ba(this._element),Ra(),ti(),!this._moving)){this.fire("down");var i=t.touches?t.touches[0]:t,r=us(this._element);this._startPoint=new G(i.clientX,i.clientY),this._startPos=hn(this._element),this._parentScale=Ua(r);var h=t.type==="mousedown";gt(document,h?"mousemove":"touchmove",this._onMove,this),gt(document,h?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var i=t.touches&&t.touches.length===1?t.touches[0]:t,r=new G(i.clientX,i.clientY)._subtract(this._startPoint);!r.x&&!r.y||Math.abs(r.x)+Math.abs(r.y)<this.options.clickTolerance||(r.x/=this._parentScale.x,r.y/=this._parentScale.y,Yt(t),this._moved||(this.fire("dragstart"),this._moved=!0,vt(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),vt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(r),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),Zt(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){Ht(document.body,"leaflet-dragging"),this._lastTarget&&(Ht(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ot(document,"mousemove touchmove",this._onMove,this),Ot(document,"mouseup touchend touchcancel",this._onUp,this),za(),ei();var i=this._moved&&this._moving;this._moving=!1,Ke._dragging=!1,i&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function vs(t,i,r){var h,m=[1,4,2,8],w,E,D,R,H,Q,ut,Mt;for(w=0,Q=t.length;w<Q;w++)t[w]._code=mn(t[w],i);for(D=0;D<4;D++){for(ut=m[D],h=[],w=0,Q=t.length,E=Q-1;w<Q;E=w++)R=t[w],H=t[E],R._code&ut?H._code&ut||(Mt=Hi(H,R,ut,i,r),Mt._code=mn(Mt,i),h.push(Mt)):(H._code&ut&&(Mt=Hi(H,R,ut,i,r),Mt._code=mn(Mt,i),h.push(Mt)),h.push(R));t=h}return t}function ws(t,i){var r,h,m,w,E,D,R,H,Q;if(!t||t.length===0)throw new Error("latlngs not passed");me(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var ut=j([0,0]),Mt=lt(t),ae=Mt.getNorthWest().distanceTo(Mt.getSouthWest())*Mt.getNorthEast().distanceTo(Mt.getNorthWest());ae<1700&&(ut=qa(t));var jt=t.length,pe=[];for(r=0;r<jt;r++){var se=j(t[r]);pe.push(i.project(j([se.lat-ut.lat,se.lng-ut.lng])))}for(D=R=H=0,r=0,h=jt-1;r<jt;h=r++)m=pe[r],w=pe[h],E=m.y*w.x-w.y*m.x,R+=(m.x+w.x)*E,H+=(m.y+w.y)*E,D+=E*3;D===0?Q=pe[0]:Q=[R/D,H/D];var Dn=i.unproject(J(Q));return j([Dn.lat+ut.lat,Dn.lng+ut.lng])}function qa(t){for(var i=0,r=0,h=0,m=0;m<t.length;m++){var w=j(t[m]);i+=w.lat,r+=w.lng,h++}return j([i/h,r/h])}var Ic={__proto__:null,clipPolygon:vs,polygonCenter:ws,centroid:qa};function Ls(t,i){if(!i||!t.length)return t.slice();var r=i*i;return t=Nc(t,r),t=Oc(t,r),t}function Ms(t,i,r){return Math.sqrt(oi(t,i,r,!0))}function Dc(t,i,r){return oi(t,i,r)}function Oc(t,i){var r=t.length,h=typeof Uint8Array<"u"?Uint8Array:Array,m=new h(r);m[0]=m[r-1]=1,Ka(t,m,i,0,r-1);var w,E=[];for(w=0;w<r;w++)m[w]&&E.push(t[w]);return E}function Ka(t,i,r,h,m){var w=0,E,D,R;for(D=h+1;D<=m-1;D++)R=oi(t[D],t[h],t[m],!0),R>w&&(E=D,w=R);w>r&&(i[E]=1,Ka(t,i,r,h,E),Ka(t,i,r,E,m))}function Nc(t,i){for(var r=[t[0]],h=1,m=0,w=t.length;h<w;h++)Fc(t[h],t[m])>i&&(r.push(t[h]),m=h);return m<w-1&&r.push(t[w-1]),r}var bs;function Ts(t,i,r,h,m){var w=h?bs:mn(t,r),E=mn(i,r),D,R,H;for(bs=E;;){if(!(w|E))return[t,i];if(w&E)return!1;D=w||E,R=Hi(t,i,D,r,m),H=mn(R,r),D===w?(t=R,w=H):(i=R,E=H)}}function Hi(t,i,r,h,m){var w=i.x-t.x,E=i.y-t.y,D=h.min,R=h.max,H,Q;return r&8?(H=t.x+w*(R.y-t.y)/E,Q=R.y):r&4?(H=t.x+w*(D.y-t.y)/E,Q=D.y):r&2?(H=R.x,Q=t.y+E*(R.x-t.x)/w):r&1&&(H=D.x,Q=t.y+E*(D.x-t.x)/w),new G(H,Q,m)}function mn(t,i){var r=0;return t.x<i.min.x?r|=1:t.x>i.max.x&&(r|=2),t.y<i.min.y?r|=4:t.y>i.max.y&&(r|=8),r}function Fc(t,i){var r=i.x-t.x,h=i.y-t.y;return r*r+h*h}function oi(t,i,r,h){var m=i.x,w=i.y,E=r.x-m,D=r.y-w,R=E*E+D*D,H;return R>0&&(H=((t.x-m)*E+(t.y-w)*D)/R,H>1?(m=r.x,w=r.y):H>0&&(m+=E*H,w+=D*H)),E=t.x-m,D=t.y-w,h?E*E+D*D:new G(m,w)}function me(t){return!N(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function Ss(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),me(t)}function ks(t,i){var r,h,m,w,E,D,R,H;if(!t||t.length===0)throw new Error("latlngs not passed");me(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var Q=j([0,0]),ut=lt(t),Mt=ut.getNorthWest().distanceTo(ut.getSouthWest())*ut.getNorthEast().distanceTo(ut.getNorthWest());Mt<1700&&(Q=qa(t));var ae=t.length,jt=[];for(r=0;r<ae;r++){var pe=j(t[r]);jt.push(i.project(j([pe.lat-Q.lat,pe.lng-Q.lng])))}for(r=0,h=0;r<ae-1;r++)h+=jt[r].distanceTo(jt[r+1])/2;if(h===0)H=jt[0];else for(r=0,w=0;r<ae-1;r++)if(E=jt[r],D=jt[r+1],m=E.distanceTo(D),w+=m,w>h){R=(w-h)/m,H=[D.x-R*(D.x-E.x),D.y-R*(D.y-E.y)];break}var se=i.unproject(J(H));return j([se.lat+Q.lat,se.lng+Q.lng])}var Rc={__proto__:null,simplify:Ls,pointToSegmentDistance:Ms,closestPointOnSegment:Dc,clipSegment:Ts,_getEdgeIntersection:Hi,_getBitCode:mn,_sqClosestPointOnSegment:oi,isFlat:me,_flat:Ss,polylineCenter:ks},Ya={project:function(t){return new G(t.lng,t.lat)},unproject:function(t){return new Y(t.y,t.x)},bounds:new Z([-180,-90],[180,90])},Xa={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Z([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var i=Math.PI/180,r=this.R,h=t.lat*i,m=this.R_MINOR/r,w=Math.sqrt(1-m*m),E=w*Math.sin(h),D=Math.tan(Math.PI/4-h/2)/Math.pow((1-E)/(1+E),w/2);return h=-r*Math.log(Math.max(D,1e-10)),new G(t.lng*i*r,h)},unproject:function(t){for(var i=180/Math.PI,r=this.R,h=this.R_MINOR/r,m=Math.sqrt(1-h*h),w=Math.exp(-t.y/r),E=Math.PI/2-2*Math.atan(w),D=0,R=.1,H;D<15&&Math.abs(R)>1e-7;D++)H=m*Math.sin(E),H=Math.pow((1-H)/(1+H),m/2),R=Math.PI/2-2*Math.atan(w*H)-E,E+=R;return new Y(E*i,t.x*i/r)}},zc={__proto__:null,LonLat:Ya,Mercator:Xa,SphericalMercator:wt},$c=s({},X,{code:"EPSG:3395",projection:Xa,transformation:function(){var t=.5/(Math.PI*Xa.R);return Lt(t,.5,-t,.5)}()}),Ps=s({},X,{code:"EPSG:4326",projection:Ya,transformation:Lt(1/180,1,-1/180,.5)}),Bc=s({},ft,{projection:Ya,transformation:Lt(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,i){var r=i.lng-t.lng,h=i.lat-t.lat;return Math.sqrt(r*r+h*h)},infinite:!0});ft.Earth=X,ft.EPSG3395=$c,ft.EPSG3857=kt,ft.EPSG900913=pt,ft.EPSG4326=Ps,ft.Simple=Bc;var Se=at.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[f(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[f(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var i=t.target;if(i.hasLayer(this)){if(this._map=i,this._zoomAnimated=i._zoomAnimated,this.getEvents){var r=this.getEvents();i.on(r,this),this.once("remove",function(){i.off(r,this)},this)}this.onAdd(i),this.fire("add"),i.fire("layeradd",{layer:this})}}});Tt.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var i=f(t);return this._layers[i]?this:(this._layers[i]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var i=f(t);return this._layers[i]?(this._loaded&&t.onRemove(this),delete this._layers[i],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return f(t)in this._layers},eachLayer:function(t,i){for(var r in this._layers)t.call(i,this._layers[r]);return this},_addLayers:function(t){t=t?N(t)?t:[t]:[];for(var i=0,r=t.length;i<r;i++)this.addLayer(t[i])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[f(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var i=f(t);this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,i=-1/0,r=this._getZoomSpan();for(var h in this._zoomBoundLayers){var m=this._zoomBoundLayers[h].options;t=m.minZoom===void 0?t:Math.min(t,m.minZoom),i=m.maxZoom===void 0?i:Math.max(i,m.maxZoom)}this._layersMaxZoom=i===-1/0?void 0:i,this._layersMinZoom=t===1/0?void 0:t,r!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var En=Se.extend({initialize:function(t,i){S(this,i),this._layers={};var r,h;if(t)for(r=0,h=t.length;r<h;r++)this.addLayer(t[r])},addLayer:function(t){var i=this.getLayerId(t);return this._layers[i]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var i=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this},hasLayer:function(t){var i=typeof t=="number"?t:this.getLayerId(t);return i in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var i=Array.prototype.slice.call(arguments,1),r,h;for(r in this._layers)h=this._layers[r],h[t]&&h[t].apply(h,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,i){for(var r in this._layers)t.call(i,this._layers[r]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return f(t)}}),Uc=function(t,i){return new En(t,i)},Be=En.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),En.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),En.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new V;for(var i in this._layers){var r=this._layers[i];t.extend(r.getBounds?r.getBounds():r.getLatLng())}return t}}),Hc=function(t,i){return new Be(t,i)},Cn=it.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){S(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,i){var r=this._getIconUrl(t);if(!r){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var h=this._createImg(r,i&&i.tagName==="IMG"?i:null);return this._setIconStyles(h,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(h.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),h},_setIconStyles:function(t,i){var r=this.options,h=r[i+"Size"];typeof h=="number"&&(h=[h,h]);var m=J(h),w=J(i==="shadow"&&r.shadowAnchor||r.iconAnchor||m&&m.divideBy(2,!0));t.className="leaflet-marker-"+i+" "+(r.className||""),w&&(t.style.marginLeft=-w.x+"px",t.style.marginTop=-w.y+"px"),m&&(t.style.width=m.x+"px",t.style.height=m.y+"px")},_createImg:function(t,i){return i=i||document.createElement("img"),i.src=t,i},_getIconUrl:function(t){return st.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Zc(t){return new Cn(t)}var si=Cn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof si.imagePath!="string"&&(si.imagePath=this._detectIconPath()),(this.options.imagePath||si.imagePath)+Cn.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var i=function(r,h,m){var w=h.exec(r);return w&&w[m]};return t=i(t,/^url\((['"])?(.+)\1\)$/,2),t&&i(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=Pt("div","leaflet-default-icon-path",document.body),i=Qn(t,"background-image")||Qn(t,"backgroundImage");if(document.body.removeChild(t),i=this._stripUrl(i),i)return i;var r=document.querySelector('link[href$="leaflet.css"]');return r?r.href.substring(0,r.href.length-11-1):""}}),Es=Oe.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new Ke(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),vt(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ht(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var i=this._marker,r=i._map,h=this._marker.options.autoPanSpeed,m=this._marker.options.autoPanPadding,w=hn(i._icon),E=r.getPixelBounds(),D=r.getPixelOrigin(),R=nt(E.min._subtract(D).add(m),E.max._subtract(D).subtract(m));if(!R.contains(w)){var H=J((Math.max(R.max.x,w.x)-R.max.x)/(E.max.x-R.max.x)-(Math.min(R.min.x,w.x)-R.min.x)/(E.min.x-R.min.x),(Math.max(R.max.y,w.y)-R.max.y)/(E.max.y-R.max.y)-(Math.min(R.min.y,w.y)-R.min.y)/(E.min.y-R.min.y)).multiplyBy(h);r.panBy(H,{animate:!1}),this._draggable._newPos._add(H),this._draggable._startPos._add(H),Zt(i._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=F(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(z(this._panRequest),this._panRequest=F(this._adjustPan.bind(this,t)))},_onDrag:function(t){var i=this._marker,r=i._shadow,h=hn(i._icon),m=i._map.layerPointToLatLng(h);r&&Zt(r,h),i._latlng=m,t.latlng=m,t.oldLatLng=this._oldLatLng,i.fire("move",t).fire("drag",t)},_onDragEnd:function(t){z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Zi=Se.extend({options:{icon:new si,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,i){S(this,i),this._latlng=j(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var i=this._latlng;return this._latlng=j(t),this.update(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,i="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),r=t.icon.createIcon(this._icon),h=!1;r!==this._icon&&(this._icon&&this._removeIcon(),h=!0,t.title&&(r.title=t.title),r.tagName==="IMG"&&(r.alt=t.alt||"")),vt(r,i),t.keyboard&&(r.tabIndex="0",r.setAttribute("role","button")),this._icon=r,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&gt(r,"focus",this._panOnFocus,this);var m=t.icon.createShadow(this._shadow),w=!1;m!==this._shadow&&(this._removeShadow(),w=!0),m&&(vt(m,i),m.alt=""),this._shadow=m,t.opacity<1&&this._updateOpacity(),h&&this.getPane().appendChild(this._icon),this._initInteraction(),m&&w&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ot(this._icon,"focus",this._panOnFocus,this),$t(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&$t(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&Zt(this._icon,t),this._shadow&&Zt(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(i)},_initInteraction:function(){if(this.options.interactive&&(vt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Es)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Es(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&fe(this._icon,t),this._shadow&&fe(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var i=this.options.icon.options,r=i.iconSize?J(i.iconSize):J(0,0),h=i.iconAnchor?J(i.iconAnchor):J(0,0);t.panInside(this._latlng,{paddingTopLeft:h,paddingBottomRight:r.subtract(h)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Wc(t,i){return new Zi(t,i)}var Ye=Se.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return S(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Wi=Ye.extend({options:{fill:!0,radius:10},initialize:function(t,i){S(this,i),this._latlng=j(t),this._radius=this.options.radius},setLatLng:function(t){var i=this._latlng;return this._latlng=j(t),this.redraw(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var i=t&&t.radius||this._radius;return Ye.prototype.setStyle.call(this,t),this.setRadius(i),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,i=this._radiusY||t,r=this._clickTolerance(),h=[t+r,i+r];this._pxBounds=new Z(this._point.subtract(h),this._point.add(h))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Gc(t,i){return new Wi(t,i)}var Qa=Wi.extend({initialize:function(t,i,r){if(typeof i=="number"&&(i=s({},r,{radius:i})),S(this,i),this._latlng=j(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new V(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Ye.prototype.setStyle,_project:function(){var t=this._latlng.lng,i=this._latlng.lat,r=this._map,h=r.options.crs;if(h.distance===X.distance){var m=Math.PI/180,w=this._mRadius/X.R/m,E=r.project([i+w,t]),D=r.project([i-w,t]),R=E.add(D).divideBy(2),H=r.unproject(R).lat,Q=Math.acos((Math.cos(w*m)-Math.sin(i*m)*Math.sin(H*m))/(Math.cos(i*m)*Math.cos(H*m)))/m;(isNaN(Q)||Q===0)&&(Q=w/Math.cos(Math.PI/180*i)),this._point=R.subtract(r.getPixelOrigin()),this._radius=isNaN(Q)?0:R.x-r.project([H,t-Q]).x,this._radiusY=R.y-E.y}else{var ut=h.unproject(h.project(this._latlng).subtract([this._mRadius,0]));this._point=r.latLngToLayerPoint(this._latlng),this._radius=this._point.x-r.latLngToLayerPoint(ut).x}this._updateBounds()}});function Vc(t,i,r){return new Qa(t,i,r)}var Ue=Ye.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,i){S(this,i),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var i=1/0,r=null,h=oi,m,w,E=0,D=this._parts.length;E<D;E++)for(var R=this._parts[E],H=1,Q=R.length;H<Q;H++){m=R[H-1],w=R[H];var ut=h(t,m,w,!0);ut<i&&(i=ut,r=h(t,m,w))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ks(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,i){return i=i||this._defaultShape(),t=j(t),i.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new V,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return me(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var i=[],r=me(t),h=0,m=t.length;h<m;h++)r?(i[h]=j(t[h]),this._bounds.extend(i[h])):i[h]=this._convertLatLngs(t[h]);return i},_project:function(){var t=new Z;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),i=new G(t,t);this._rawPxBounds&&(this._pxBounds=new Z([this._rawPxBounds.min.subtract(i),this._rawPxBounds.max.add(i)]))},_projectLatlngs:function(t,i,r){var h=t[0]instanceof Y,m=t.length,w,E;if(h){for(E=[],w=0;w<m;w++)E[w]=this._map.latLngToLayerPoint(t[w]),r.extend(E[w]);i.push(E)}else for(w=0;w<m;w++)this._projectLatlngs(t[w],i,r)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var i=this._parts,r,h,m,w,E,D,R;for(r=0,m=0,w=this._rings.length;r<w;r++)for(R=this._rings[r],h=0,E=R.length;h<E-1;h++)D=Ts(R[h],R[h+1],t,h,!0),D&&(i[m]=i[m]||[],i[m].push(D[0]),(D[1]!==R[h+1]||h===E-2)&&(i[m].push(D[1]),m++))}},_simplifyPoints:function(){for(var t=this._parts,i=this.options.smoothFactor,r=0,h=t.length;r<h;r++)t[r]=Ls(t[r],i)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,i){var r,h,m,w,E,D,R=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(r=0,w=this._parts.length;r<w;r++)for(D=this._parts[r],h=0,E=D.length,m=E-1;h<E;m=h++)if(!(!i&&h===0)&&Ms(t,D[m],D[h])<=R)return!0;return!1}});function jc(t,i){return new Ue(t,i)}Ue._flat=Ss;var xn=Ue.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ws(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var i=Ue.prototype._convertLatLngs.call(this,t),r=i.length;return r>=2&&i[0]instanceof Y&&i[0].equals(i[r-1])&&i.pop(),i},_setLatLngs:function(t){Ue.prototype._setLatLngs.call(this,t),me(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return me(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,i=this.options.weight,r=new G(i,i);if(t=new Z(t.min.subtract(r),t.max.add(r)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var h=0,m=this._rings.length,w;h<m;h++)w=vs(this._rings[h],t,!0),w.length&&this._parts.push(w)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var i=!1,r,h,m,w,E,D,R,H;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(w=0,R=this._parts.length;w<R;w++)for(r=this._parts[w],E=0,H=r.length,D=H-1;E<H;D=E++)h=r[E],m=r[D],h.y>t.y!=m.y>t.y&&t.x<(m.x-h.x)*(t.y-h.y)/(m.y-h.y)+h.x&&(i=!i);return i||Ue.prototype._containsPoint.call(this,t,!0)}});function Jc(t,i){return new xn(t,i)}var He=Be.extend({initialize:function(t,i){S(this,i),this._layers={},t&&this.addData(t)},addData:function(t){var i=N(t)?t:t.features,r,h,m;if(i){for(r=0,h=i.length;r<h;r++)m=i[r],(m.geometries||m.geometry||m.features||m.coordinates)&&this.addData(m);return this}var w=this.options;if(w.filter&&!w.filter(t))return this;var E=Gi(t,w);return E?(E.feature=Ji(t),E.defaultOptions=E.options,this.resetStyle(E),w.onEachFeature&&w.onEachFeature(t,E),this.addLayer(E)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=s({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(i){this._setLayerStyle(i,t)},this)},_setLayerStyle:function(t,i){t.setStyle&&(typeof i=="function"&&(i=i(t.feature)),t.setStyle(i))}});function Gi(t,i){var r=t.type==="Feature"?t.geometry:t,h=r?r.coordinates:null,m=[],w=i&&i.pointToLayer,E=i&&i.coordsToLatLng||to,D,R,H,Q;if(!h&&!r)return null;switch(r.type){case"Point":return D=E(h),Cs(w,t,D,i);case"MultiPoint":for(H=0,Q=h.length;H<Q;H++)D=E(h[H]),m.push(Cs(w,t,D,i));return new Be(m);case"LineString":case"MultiLineString":return R=Vi(h,r.type==="LineString"?0:1,E),new Ue(R,i);case"Polygon":case"MultiPolygon":return R=Vi(h,r.type==="Polygon"?1:2,E),new xn(R,i);case"GeometryCollection":for(H=0,Q=r.geometries.length;H<Q;H++){var ut=Gi({geometry:r.geometries[H],type:"Feature",properties:t.properties},i);ut&&m.push(ut)}return new Be(m);case"FeatureCollection":for(H=0,Q=r.features.length;H<Q;H++){var Mt=Gi(r.features[H],i);Mt&&m.push(Mt)}return new Be(m);default:throw new Error("Invalid GeoJSON object.")}}function Cs(t,i,r,h){return t?t(i,r):new Zi(r,h&&h.markersInheritOptions&&h)}function to(t){return new Y(t[1],t[0],t[2])}function Vi(t,i,r){for(var h=[],m=0,w=t.length,E;m<w;m++)E=i?Vi(t[m],i-1,r):(r||to)(t[m]),h.push(E);return h}function eo(t,i){return t=j(t),t.alt!==void 0?[v(t.lng,i),v(t.lat,i),v(t.alt,i)]:[v(t.lng,i),v(t.lat,i)]}function ji(t,i,r,h){for(var m=[],w=0,E=t.length;w<E;w++)m.push(i?ji(t[w],me(t[w])?0:i-1,r,h):eo(t[w],h));return!i&&r&&m.length>0&&m.push(m[0].slice()),m}function An(t,i){return t.feature?s({},t.feature,{geometry:i}):Ji(i)}function Ji(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var no={toGeoJSON:function(t){return An(this,{type:"Point",coordinates:eo(this.getLatLng(),t)})}};Zi.include(no),Qa.include(no),Wi.include(no),Ue.include({toGeoJSON:function(t){var i=!me(this._latlngs),r=ji(this._latlngs,i?1:0,!1,t);return An(this,{type:(i?"Multi":"")+"LineString",coordinates:r})}}),xn.include({toGeoJSON:function(t){var i=!me(this._latlngs),r=i&&!me(this._latlngs[0]),h=ji(this._latlngs,r?2:i?1:0,!0,t);return i||(h=[h]),An(this,{type:(r?"Multi":"")+"Polygon",coordinates:h})}}),En.include({toMultiPoint:function(t){var i=[];return this.eachLayer(function(r){i.push(r.toGeoJSON(t).geometry.coordinates)}),An(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(t){var i=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(i==="MultiPoint")return this.toMultiPoint(t);var r=i==="GeometryCollection",h=[];return this.eachLayer(function(m){if(m.toGeoJSON){var w=m.toGeoJSON(t);if(r)h.push(w.geometry);else{var E=Ji(w);E.type==="FeatureCollection"?h.push.apply(h,E.features):h.push(E)}}}),r?An(this,{geometries:h,type:"GeometryCollection"}):{type:"FeatureCollection",features:h}}});function xs(t,i){return new He(t,i)}var qc=xs,qi=Se.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,i,r){this._url=t,this._bounds=lt(i),S(this,r)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(vt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){$t(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&kn(this._image),this},bringToBack:function(){return this._map&&Pn(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=lt(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",i=this._image=t?this._url:Pt("img");if(vt(i,"leaflet-image-layer"),this._zoomAnimated&&vt(i,"leaflet-zoom-animated"),this.options.className&&vt(i,this.options.className),i.onselectstart=y,i.onmousemove=y,i.onload=c(this.fire,this,"load"),i.onerror=c(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=i.src;return}i.src=this._url,i.alt=this.options.alt},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),r=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;un(this._image,r,i)},_reset:function(){var t=this._image,i=new Z(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),r=i.getSize();Zt(t,i.min),t.style.width=r.x+"px",t.style.height=r.y+"px"},_updateOpacity:function(){fe(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Kc=function(t,i,r){return new qi(t,i,r)},As=qi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",i=this._image=t?this._url:Pt("video");if(vt(i,"leaflet-image-layer"),this._zoomAnimated&&vt(i,"leaflet-zoom-animated"),this.options.className&&vt(i,this.options.className),i.onselectstart=y,i.onmousemove=y,i.onloadeddata=c(this.fire,this,"load"),t){for(var r=i.getElementsByTagName("source"),h=[],m=0;m<r.length;m++)h.push(r[m].src);this._url=r.length>0?h:[i.src];return}N(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(i.style,"objectFit")&&(i.style.objectFit="fill"),i.autoplay=!!this.options.autoplay,i.loop=!!this.options.loop,i.muted=!!this.options.muted,i.playsInline=!!this.options.playsInline;for(var w=0;w<this._url.length;w++){var E=Pt("source");E.src=this._url[w],i.appendChild(E)}}});function Yc(t,i,r){return new As(t,i,r)}var Is=qi.extend({_initImage:function(){var t=this._image=this._url;vt(t,"leaflet-image-layer"),this._zoomAnimated&&vt(t,"leaflet-zoom-animated"),this.options.className&&vt(t,this.options.className),t.onselectstart=y,t.onmousemove=y}});function Xc(t,i,r){return new Is(t,i,r)}var Ne=Se.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,i){t&&(t instanceof Y||N(t))?(this._latlng=j(t),S(this,i)):(S(this,t),this._source=i),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&fe(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&fe(this._container,1),this.bringToFront(),this.options.interactive&&(vt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(fe(this._container,0),this._removeTimeout=setTimeout(c($t,void 0,this._container),200)):$t(this._container),this.options.interactive&&(Ht(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=j(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&kn(this._container),this},bringToBack:function(){return this._map&&Pn(this._container),this},_prepareOpen:function(t){var i=this._source;if(!i._map)return!1;if(i instanceof Be){i=null;var r=this._source._layers;for(var h in r)if(r[h]._map){i=r[h];break}if(!i)return!1;this._source=i}if(!t)if(i.getCenter)t=i.getCenter();else if(i.getLatLng)t=i.getLatLng();else if(i.getBounds)t=i.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,i=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof i=="string")t.innerHTML=i;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(i)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),i=J(this.options.offset),r=this._getAnchor();this._zoomAnimated?Zt(this._container,t.add(r)):i=i.add(t).add(r);var h=this._containerBottom=-i.y,m=this._containerLeft=-Math.round(this._containerWidth/2)+i.x;this._container.style.bottom=h+"px",this._container.style.left=m+"px"}},_getAnchor:function(){return[0,0]}});Tt.include({_initOverlay:function(t,i,r,h){var m=i;return m instanceof t||(m=new t(h).setContent(i)),r&&m.setLatLng(r),m}}),Se.include({_initOverlay:function(t,i,r,h){var m=r;return m instanceof t?(S(m,h),m._source=this):(m=i&&!h?i:new t(h,this),m.setContent(r)),m}});var Ki=Ne.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Ne.prototype.openOn.call(this,t)},onAdd:function(t){Ne.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ye||this._source.on("preclick",dn))},onRemove:function(t){Ne.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ye||this._source.off("preclick",dn))},getEvents:function(){var t=Ne.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",i=this._container=Pt("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),r=this._wrapper=Pt("div",t+"-content-wrapper",i);if(this._contentNode=Pt("div",t+"-content",r),ii(i),Ga(this._contentNode),gt(i,"contextmenu",dn),this._tipContainer=Pt("div",t+"-tip-container",i),this._tip=Pt("div",t+"-tip",this._tipContainer),this.options.closeButton){var h=this._closeButton=Pt("a",t+"-close-button",i);h.setAttribute("role","button"),h.setAttribute("aria-label","Close popup"),h.href="#close",h.innerHTML='<span aria-hidden="true">&#215;</span>',gt(h,"click",function(m){Yt(m),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,i=t.style;i.width="",i.whiteSpace="nowrap";var r=t.offsetWidth;r=Math.min(r,this.options.maxWidth),r=Math.max(r,this.options.minWidth),i.width=r+1+"px",i.whiteSpace="",i.height="";var h=t.offsetHeight,m=this.options.maxHeight,w="leaflet-popup-scrolled";m&&h>m?(i.height=m+"px",vt(t,w)):Ht(t,w),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),r=this._getAnchor();Zt(this._container,i.add(r))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,i=parseInt(Qn(this._container,"marginBottom"),10)||0,r=this._container.offsetHeight+i,h=this._containerWidth,m=new G(this._containerLeft,-r-this._containerBottom);m._add(hn(this._container));var w=t.layerPointToContainerPoint(m),E=J(this.options.autoPanPadding),D=J(this.options.autoPanPaddingTopLeft||E),R=J(this.options.autoPanPaddingBottomRight||E),H=t.getSize(),Q=0,ut=0;w.x+h+R.x>H.x&&(Q=w.x+h-H.x+R.x),w.x-Q-D.x<0&&(Q=w.x-D.x),w.y+r+R.y>H.y&&(ut=w.y+r-H.y+R.y),w.y-ut-D.y<0&&(ut=w.y-D.y),(Q||ut)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([Q,ut]))}},_getAnchor:function(){return J(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Qc=function(t,i){return new Ki(t,i)};Tt.mergeOptions({closePopupOnClick:!0}),Tt.include({openPopup:function(t,i,r){return this._initOverlay(Ki,t,i,r).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),Se.include({bindPopup:function(t,i){return this._popup=this._initOverlay(Ki,this._popup,t,i),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Be||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){fn(t);var i=t.layer||t.target;if(this._popup._source===i&&!(i instanceof Ye)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=i,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var Yi=Ne.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Ne.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Ne.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Ne.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",i=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Pt("div",i),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+f(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var i,r,h=this._map,m=this._container,w=h.latLngToContainerPoint(h.getCenter()),E=h.layerPointToContainerPoint(t),D=this.options.direction,R=m.offsetWidth,H=m.offsetHeight,Q=J(this.options.offset),ut=this._getAnchor();D==="top"?(i=R/2,r=H):D==="bottom"?(i=R/2,r=0):D==="center"?(i=R/2,r=H/2):D==="right"?(i=0,r=H/2):D==="left"?(i=R,r=H/2):E.x<w.x?(D="right",i=0,r=H/2):(D="left",i=R+(Q.x+ut.x)*2,r=H/2),t=t.subtract(J(i,r,!0)).add(Q).add(ut),Ht(m,"leaflet-tooltip-right"),Ht(m,"leaflet-tooltip-left"),Ht(m,"leaflet-tooltip-top"),Ht(m,"leaflet-tooltip-bottom"),vt(m,"leaflet-tooltip-"+D),Zt(m,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&fe(this._container,t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(i)},_getAnchor:function(){return J(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),tu=function(t,i){return new Yi(t,i)};Tt.include({openTooltip:function(t,i,r){return this._initOverlay(Yi,t,i,r).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Se.include({bindTooltip:function(t,i){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Yi,this._tooltip,t,i),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var i=t?"off":"on",r={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?r.add=this._openTooltip:(r.mouseover=this._openTooltip,r.mouseout=this.closeTooltip,r.click=this._openTooltip,this._map?this._addFocusListeners():r.add=this._addFocusListeners),this._tooltip.options.sticky&&(r.mousemove=this._moveTooltip),this[i](r),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Be||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var i=typeof t.getElement=="function"&&t.getElement();i&&(gt(i,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),gt(i,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var i=typeof t.getElement=="function"&&t.getElement();i&&i.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var i=this;this._map.once("moveend",function(){i._openOnceFlag=!1,i._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var i=t.latlng,r,h;this._tooltip.options.sticky&&t.originalEvent&&(r=this._map.mouseEventToContainerPoint(t.originalEvent),h=this._map.containerPointToLayerPoint(r),i=this._map.layerPointToLatLng(h)),this._tooltip.setLatLng(i)}});var Ds=Cn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&t.tagName==="DIV"?t:document.createElement("div"),r=this.options;if(r.html instanceof Element?(Ri(i),i.appendChild(r.html)):i.innerHTML=r.html!==!1?r.html:"",r.bgPos){var h=J(r.bgPos);i.style.backgroundPosition=-h.x+"px "+-h.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}});function eu(t){return new Ds(t)}Cn.Default=si;var ri=Se.extend({options:{tileSize:256,opacity:1,updateWhenIdle:st.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){S(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),$t(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(kn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Pn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=p(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof G?t:new G(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var i=this.getPane().children,r=-t(-1/0,1/0),h=0,m=i.length,w;h<m;h++)w=i[h].style.zIndex,i[h]!==this._container&&w&&(r=t(r,+w));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!st.ielt9){fe(this._container,this.options.opacity);var t=+new Date,i=!1,r=!1;for(var h in this._tiles){var m=this._tiles[h];if(!(!m.current||!m.loaded)){var w=Math.min(1,(t-m.loaded)/200);fe(m.el,w),w<1?i=!0:(m.active?r=!0:this._onOpaqueTile(m),m.active=!0)}}r&&!this._noPrune&&this._pruneTiles(),i&&(z(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this))}},_onOpaqueTile:y,_initContainer:function(){this._container||(this._container=Pt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,i=this.options.maxZoom;if(t!==void 0){for(var r in this._levels)r=Number(r),this._levels[r].el.children.length||r===t?(this._levels[r].el.style.zIndex=i-Math.abs(t-r),this._onUpdateLevel(r)):($t(this._levels[r].el),this._removeTilesAtZoom(r),this._onRemoveLevel(r),delete this._levels[r]);var h=this._levels[t],m=this._map;return h||(h=this._levels[t]={},h.el=Pt("div","leaflet-tile-container leaflet-zoom-animated",this._container),h.el.style.zIndex=i,h.origin=m.project(m.unproject(m.getPixelOrigin()),t).round(),h.zoom=t,this._setZoomTransform(h,m.getCenter(),m.getZoom()),y(h.el.offsetWidth),this._onCreateLevel(h)),this._level=h,h}},_onUpdateLevel:y,_onRemoveLevel:y,_onCreateLevel:y,_pruneTiles:function(){if(this._map){var t,i,r=this._map.getZoom();if(r>this.options.maxZoom||r<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)i=this._tiles[t],i.retain=i.current;for(t in this._tiles)if(i=this._tiles[t],i.current&&!i.active){var h=i.coords;this._retainParent(h.x,h.y,h.z,h.z-5)||this._retainChildren(h.x,h.y,h.z,h.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var i in this._tiles)this._tiles[i].coords.z===t&&this._removeTile(i)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)$t(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,i,r,h){var m=Math.floor(t/2),w=Math.floor(i/2),E=r-1,D=new G(+m,+w);D.z=+E;var R=this._tileCoordsToKey(D),H=this._tiles[R];return H&&H.active?(H.retain=!0,!0):(H&&H.loaded&&(H.retain=!0),E>h?this._retainParent(m,w,E,h):!1)},_retainChildren:function(t,i,r,h){for(var m=2*t;m<2*t+2;m++)for(var w=2*i;w<2*i+2;w++){var E=new G(m,w);E.z=r+1;var D=this._tileCoordsToKey(E),R=this._tiles[D];if(R&&R.active){R.retain=!0;continue}else R&&R.loaded&&(R.retain=!0);r+1<h&&this._retainChildren(m,w,r+1,h)}},_resetView:function(t){var i=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),i,i)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var i=this.options;return i.minNativeZoom!==void 0&&t<i.minNativeZoom?i.minNativeZoom:i.maxNativeZoom!==void 0&&i.maxNativeZoom<t?i.maxNativeZoom:t},_setView:function(t,i,r,h){var m=Math.round(i);this.options.maxZoom!==void 0&&m>this.options.maxZoom||this.options.minZoom!==void 0&&m<this.options.minZoom?m=void 0:m=this._clampZoom(m);var w=this.options.updateWhenZooming&&m!==this._tileZoom;(!h||w)&&(this._tileZoom=m,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),m!==void 0&&this._update(t),r||this._pruneTiles(),this._noPrune=!!r),this._setZoomTransforms(t,i)},_setZoomTransforms:function(t,i){for(var r in this._levels)this._setZoomTransform(this._levels[r],t,i)},_setZoomTransform:function(t,i,r){var h=this._map.getZoomScale(r,t.zoom),m=t.origin.multiplyBy(h).subtract(this._map._getNewPixelOrigin(i,r)).round();st.any3d?un(t.el,m,h):Zt(t.el,m)},_resetGrid:function(){var t=this._map,i=t.options.crs,r=this._tileSize=this.getTileSize(),h=this._tileZoom,m=this._map.getPixelWorldBounds(this._tileZoom);m&&(this._globalTileRange=this._pxBoundsToTileRange(m)),this._wrapX=i.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,i.wrapLng[0]],h).x/r.x),Math.ceil(t.project([0,i.wrapLng[1]],h).x/r.y)],this._wrapY=i.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([i.wrapLat[0],0],h).y/r.x),Math.ceil(t.project([i.wrapLat[1],0],h).y/r.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var i=this._map,r=i._animatingZoom?Math.max(i._animateToZoom,i.getZoom()):i.getZoom(),h=i.getZoomScale(r,this._tileZoom),m=i.project(t,this._tileZoom).floor(),w=i.getSize().divideBy(h*2);return new Z(m.subtract(w),m.add(w))},_update:function(t){var i=this._map;if(i){var r=this._clampZoom(i.getZoom());if(t===void 0&&(t=i.getCenter()),this._tileZoom!==void 0){var h=this._getTiledPixelBounds(t),m=this._pxBoundsToTileRange(h),w=m.getCenter(),E=[],D=this.options.keepBuffer,R=new Z(m.getBottomLeft().subtract([D,-D]),m.getTopRight().add([D,-D]));if(!(isFinite(m.min.x)&&isFinite(m.min.y)&&isFinite(m.max.x)&&isFinite(m.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var H in this._tiles){var Q=this._tiles[H].coords;(Q.z!==this._tileZoom||!R.contains(new G(Q.x,Q.y)))&&(this._tiles[H].current=!1)}if(Math.abs(r-this._tileZoom)>1){this._setView(t,r);return}for(var ut=m.min.y;ut<=m.max.y;ut++)for(var Mt=m.min.x;Mt<=m.max.x;Mt++){var ae=new G(Mt,ut);if(ae.z=this._tileZoom,!!this._isValidTile(ae)){var jt=this._tiles[this._tileCoordsToKey(ae)];jt?jt.current=!0:E.push(ae)}}if(E.sort(function(se,Dn){return se.distanceTo(w)-Dn.distanceTo(w)}),E.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var pe=document.createDocumentFragment();for(Mt=0;Mt<E.length;Mt++)this._addTile(E[Mt],pe);this._level.el.appendChild(pe)}}}},_isValidTile:function(t){var i=this._map.options.crs;if(!i.infinite){var r=this._globalTileRange;if(!i.wrapLng&&(t.x<r.min.x||t.x>r.max.x)||!i.wrapLat&&(t.y<r.min.y||t.y>r.max.y))return!1}if(!this.options.bounds)return!0;var h=this._tileCoordsToBounds(t);return lt(this.options.bounds).overlaps(h)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var i=this._map,r=this.getTileSize(),h=t.scaleBy(r),m=h.add(r),w=i.unproject(h,t.z),E=i.unproject(m,t.z);return[w,E]},_tileCoordsToBounds:function(t){var i=this._tileCoordsToNwSe(t),r=new V(i[0],i[1]);return this.options.noWrap||(r=this._map.wrapLatLngBounds(r)),r},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var i=t.split(":"),r=new G(+i[0],+i[1]);return r.z=+i[2],r},_removeTile:function(t){var i=this._tiles[t];i&&($t(i.el),delete this._tiles[t],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){vt(t,"leaflet-tile");var i=this.getTileSize();t.style.width=i.x+"px",t.style.height=i.y+"px",t.onselectstart=y,t.onmousemove=y,st.ielt9&&this.options.opacity<1&&fe(t,this.options.opacity)},_addTile:function(t,i){var r=this._getTilePos(t),h=this._tileCoordsToKey(t),m=this.createTile(this._wrapCoords(t),c(this._tileReady,this,t));this._initTile(m),this.createTile.length<2&&F(c(this._tileReady,this,t,null,m)),Zt(m,r),this._tiles[h]={el:m,coords:t,current:!0},i.appendChild(m),this.fire("tileloadstart",{tile:m,coords:t})},_tileReady:function(t,i,r){i&&this.fire("tileerror",{error:i,tile:r,coords:t});var h=this._tileCoordsToKey(t);r=this._tiles[h],r&&(r.loaded=+new Date,this._map._fadeAnimated?(fe(r.el,0),z(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this)):(r.active=!0,this._pruneTiles()),i||(vt(r.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:r.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),st.ielt9||!this._map._fadeAnimated?F(this._pruneTiles,this):setTimeout(c(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var i=new G(this._wrapX?g(t.x,this._wrapX):t.x,this._wrapY?g(t.y,this._wrapY):t.y);return i.z=t.z,i},_pxBoundsToTileRange:function(t){var i=this.getTileSize();return new Z(t.min.unscaleBy(i).floor(),t.max.unscaleBy(i).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function nu(t){return new ri(t)}var In=ri.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,i){this._url=t,i=S(this,i),i.detectRetina&&st.retina&&i.maxZoom>0?(i.tileSize=Math.floor(i.tileSize/2),i.zoomReverse?(i.zoomOffset--,i.minZoom=Math.min(i.maxZoom,i.minZoom+1)):(i.zoomOffset++,i.maxZoom=Math.max(i.minZoom,i.maxZoom-1)),i.minZoom=Math.max(0,i.minZoom)):i.zoomReverse?i.minZoom=Math.min(i.maxZoom,i.minZoom):i.maxZoom=Math.max(i.minZoom,i.maxZoom),typeof i.subdomains=="string"&&(i.subdomains=i.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,i){return this._url===t&&i===void 0&&(i=!0),this._url=t,i||this.redraw(),this},createTile:function(t,i){var r=document.createElement("img");return gt(r,"load",c(this._tileOnLoad,this,i,r)),gt(r,"error",c(this._tileOnError,this,i,r)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(r.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(r.referrerPolicy=this.options.referrerPolicy),r.alt="",r.src=this.getTileUrl(t),r},getTileUrl:function(t){var i={r:st.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=r),i["-y"]=r}return A(this._url,s(i,this.options))},_tileOnLoad:function(t,i){st.ielt9?setTimeout(c(t,this,null,i),0):t(null,i)},_tileOnError:function(t,i,r){var h=this.options.errorTileUrl;h&&i.getAttribute("src")!==h&&(i.src=h),t(r,i)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,i=this.options.maxZoom,r=this.options.zoomReverse,h=this.options.zoomOffset;return r&&(t=i-t),t+h},_getSubdomain:function(t){var i=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var t,i;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(i=this._tiles[t].el,i.onload=y,i.onerror=y,!i.complete)){i.src=B;var r=this._tiles[t].coords;$t(i),delete this._tiles[t],this.fire("tileabort",{tile:i,coords:r})}},_removeTile:function(t){var i=this._tiles[t];if(i)return i.el.setAttribute("src",B),ri.prototype._removeTile.call(this,t)},_tileReady:function(t,i,r){if(!(!this._map||r&&r.getAttribute("src")===B))return ri.prototype._tileReady.call(this,t,i,r)}});function Os(t,i){return new In(t,i)}var Ns=In.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,i){this._url=t;var r=s({},this.defaultWmsParams);for(var h in i)h in this.options||(r[h]=i[h]);i=S(this,i);var m=i.detectRetina&&st.retina?2:1,w=this.getTileSize();r.width=w.x*m,r.height=w.y*m,this.wmsParams=r},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code,In.prototype.onAdd.call(this,t)},getTileUrl:function(t){var i=this._tileCoordsToNwSe(t),r=this._crs,h=nt(r.project(i[0]),r.project(i[1])),m=h.min,w=h.max,E=(this._wmsVersion>=1.3&&this._crs===Ps?[m.y,m.x,w.y,w.x]:[m.x,m.y,w.x,w.y]).join(","),D=In.prototype.getTileUrl.call(this,t);return D+P(this.wmsParams,D,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+E},setParams:function(t,i){return s(this.wmsParams,t),i||this.redraw(),this}});function iu(t,i){return new Ns(t,i)}In.WMS=Ns,Os.wms=iu;var Ze=Se.extend({options:{padding:.1},initialize:function(t){S(this,t),f(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),vt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,i){var r=this._map.getZoomScale(i,this._zoom),h=this._map.getSize().multiplyBy(.5+this.options.padding),m=this._map.project(this._center,i),w=h.multiplyBy(-r).add(m).subtract(this._map._getNewPixelOrigin(t,i));st.any3d?un(this._container,w,r):Zt(this._container,w)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,i=this._map.getSize(),r=this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();this._bounds=new Z(r,r.add(i.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Fs=Ze.extend({options:{tolerance:0},getEvents:function(){var t=Ze.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ze.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");gt(t,"mousemove",this._onMouseMove,this),gt(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),gt(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){z(this._redrawRequest),delete this._ctx,$t(this._container),Ot(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var i in this._layers)t=this._layers[i],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ze.prototype._update.call(this);var t=this._bounds,i=this._container,r=t.getSize(),h=st.retina?2:1;Zt(i,t.min),i.width=h*r.x,i.height=h*r.y,i.style.width=r.x+"px",i.style.height=r.y+"px",st.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Ze.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[f(t)]=t;var i=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=i),this._drawLast=i,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var i=t._order,r=i.next,h=i.prev;r?r.prev=h:this._drawLast=h,h?h.next=r:this._drawFirst=r,delete t._order,delete this._layers[f(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var i=t.options.dashArray.split(/[, ]+/),r=[],h,m;for(m=0;m<i.length;m++){if(h=Number(i[m]),isNaN(h))return;r.push(h)}t.options._dashArray=r}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||F(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var i=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Z,this._redrawBounds.extend(t._pxBounds.min.subtract([i,i])),this._redrawBounds.extend(t._pxBounds.max.add([i,i]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var i=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,i.x,i.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,i=this._redrawBounds;if(this._ctx.save(),i){var r=i.getSize();this._ctx.beginPath(),this._ctx.rect(i.min.x,i.min.y,r.x,r.y),this._ctx.clip()}this._drawing=!0;for(var h=this._drawFirst;h;h=h.next)t=h.layer,(!i||t._pxBounds&&t._pxBounds.intersects(i))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,i){if(this._drawing){var r,h,m,w,E=t._parts,D=E.length,R=this._ctx;if(D){for(R.beginPath(),r=0;r<D;r++){for(h=0,m=E[r].length;h<m;h++)w=E[r][h],R[h?"lineTo":"moveTo"](w.x,w.y);i&&R.closePath()}this._fillStroke(R,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var i=t._point,r=this._ctx,h=Math.max(Math.round(t._radius),1),m=(Math.max(Math.round(t._radiusY),1)||h)/h;m!==1&&(r.save(),r.scale(1,m)),r.beginPath(),r.arc(i.x,i.y/m,h,0,Math.PI*2,!1),m!==1&&r.restore(),this._fillStroke(r,t)}},_fillStroke:function(t,i){var r=i.options;r.fill&&(t.globalAlpha=r.fillOpacity,t.fillStyle=r.fillColor||r.color,t.fill(r.fillRule||"evenodd")),r.stroke&&r.weight!==0&&(t.setLineDash&&t.setLineDash(i.options&&i.options._dashArray||[]),t.globalAlpha=r.opacity,t.lineWidth=r.weight,t.strokeStyle=r.color,t.lineCap=r.lineCap,t.lineJoin=r.lineJoin,t.stroke())},_onClick:function(t){for(var i=this._map.mouseEventToLayerPoint(t),r,h,m=this._drawFirst;m;m=m.next)r=m.layer,r.options.interactive&&r._containsPoint(i)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(r))&&(h=r);this._fireEvent(h?[h]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var i=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,i)}},_handleMouseOut:function(t){var i=this._hoveredLayer;i&&(Ht(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,i){if(!this._mouseHoverThrottled){for(var r,h,m=this._drawFirst;m;m=m.next)r=m.layer,r.options.interactive&&r._containsPoint(i)&&(h=r);h!==this._hoveredLayer&&(this._handleMouseOut(t),h&&(vt(this._container,"leaflet-interactive"),this._fireEvent([h],t,"mouseover"),this._hoveredLayer=h)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(c(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,i,r){this._map._fireDOMEvent(i,r||i.type,t)},_bringToFront:function(t){var i=t._order;if(i){var r=i.next,h=i.prev;if(r)r.prev=h;else return;h?h.next=r:r&&(this._drawFirst=r),i.prev=this._drawLast,this._drawLast.next=i,i.next=null,this._drawLast=i,this._requestRedraw(t)}},_bringToBack:function(t){var i=t._order;if(i){var r=i.next,h=i.prev;if(h)h.next=r;else return;r?r.prev=h:h&&(this._drawLast=h),i.prev=null,i.next=this._drawFirst,this._drawFirst.prev=i,this._drawFirst=i,this._requestRedraw(t)}}});function Rs(t){return st.canvas?new Fs(t):null}var li=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),au={_initContainer:function(){this._container=Pt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ze.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var i=t._container=li("shape");vt(i,"leaflet-vml-shape "+(this.options.className||"")),i.coordsize="1 1",t._path=li("path"),i.appendChild(t._path),this._updateStyle(t),this._layers[f(t)]=t},_addPath:function(t){var i=t._container;this._container.appendChild(i),t.options.interactive&&t.addInteractiveTarget(i)},_removePath:function(t){var i=t._container;$t(i),t.removeInteractiveTarget(i),delete this._layers[f(t)]},_updateStyle:function(t){var i=t._stroke,r=t._fill,h=t.options,m=t._container;m.stroked=!!h.stroke,m.filled=!!h.fill,h.stroke?(i||(i=t._stroke=li("stroke")),m.appendChild(i),i.weight=h.weight+"px",i.color=h.color,i.opacity=h.opacity,h.dashArray?i.dashStyle=N(h.dashArray)?h.dashArray.join(" "):h.dashArray.replace(/( *, *)/g," "):i.dashStyle="",i.endcap=h.lineCap.replace("butt","flat"),i.joinstyle=h.lineJoin):i&&(m.removeChild(i),t._stroke=null),h.fill?(r||(r=t._fill=li("fill")),m.appendChild(r),r.color=h.fillColor||h.color,r.opacity=h.fillOpacity):r&&(m.removeChild(r),t._fill=null)},_updateCircle:function(t){var i=t._point.round(),r=Math.round(t._radius),h=Math.round(t._radiusY||r);this._setPath(t,t._empty()?"M0 0":"AL "+i.x+","+i.y+" "+r+","+h+" 0,"+65535*360)},_setPath:function(t,i){t._path.v=i},_bringToFront:function(t){kn(t._container)},_bringToBack:function(t){Pn(t._container)}},Xi=st.vml?li:mt,ci=Ze.extend({_initContainer:function(){this._container=Xi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Xi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){$t(this._container),Ot(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ze.prototype._update.call(this);var t=this._bounds,i=t.getSize(),r=this._container;(!this._svgSize||!this._svgSize.equals(i))&&(this._svgSize=i,r.setAttribute("width",i.x),r.setAttribute("height",i.y)),Zt(r,t.min),r.setAttribute("viewBox",[t.min.x,t.min.y,i.x,i.y].join(" ")),this.fire("update")}},_initPath:function(t){var i=t._path=Xi("path");t.options.className&&vt(i,t.options.className),t.options.interactive&&vt(i,"leaflet-interactive"),this._updateStyle(t),this._layers[f(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){$t(t._path),t.removeInteractiveTarget(t._path),delete this._layers[f(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var i=t._path,r=t.options;i&&(r.stroke?(i.setAttribute("stroke",r.color),i.setAttribute("stroke-opacity",r.opacity),i.setAttribute("stroke-width",r.weight),i.setAttribute("stroke-linecap",r.lineCap),i.setAttribute("stroke-linejoin",r.lineJoin),r.dashArray?i.setAttribute("stroke-dasharray",r.dashArray):i.removeAttribute("stroke-dasharray"),r.dashOffset?i.setAttribute("stroke-dashoffset",r.dashOffset):i.removeAttribute("stroke-dashoffset")):i.setAttribute("stroke","none"),r.fill?(i.setAttribute("fill",r.fillColor||r.color),i.setAttribute("fill-opacity",r.fillOpacity),i.setAttribute("fill-rule",r.fillRule||"evenodd")):i.setAttribute("fill","none"))},_updatePoly:function(t,i){this._setPath(t,ct(t._parts,i))},_updateCircle:function(t){var i=t._point,r=Math.max(Math.round(t._radius),1),h=Math.max(Math.round(t._radiusY),1)||r,m="a"+r+","+h+" 0 1,0 ",w=t._empty()?"M0 0":"M"+(i.x-r)+","+i.y+m+r*2+",0 "+m+-r*2+",0 ";this._setPath(t,w)},_setPath:function(t,i){t._path.setAttribute("d",i)},_bringToFront:function(t){kn(t._path)},_bringToBack:function(t){Pn(t._path)}});st.vml&&ci.include(au);function zs(t){return st.svg||st.vml?new ci(t):null}Tt.include({getRenderer:function(t){var i=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return i||(i=this._renderer=this._createRenderer()),this.hasLayer(i)||this.addLayer(i),i},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var i=this._paneRenderers[t];return i===void 0&&(i=this._createRenderer({pane:t}),this._paneRenderers[t]=i),i},_createRenderer:function(t){return this.options.preferCanvas&&Rs(t)||zs(t)}});var $s=xn.extend({initialize:function(t,i){xn.prototype.initialize.call(this,this._boundsToLatLngs(t),i)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=lt(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function ou(t,i){return new $s(t,i)}ci.create=Xi,ci.pointsToPath=ct,He.geometryToLayer=Gi,He.coordsToLatLng=to,He.coordsToLatLngs=Vi,He.latLngToCoords=eo,He.latLngsToCoords=ji,He.getFeature=An,He.asFeature=Ji,Tt.mergeOptions({boxZoom:!0});var Bs=Oe.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){gt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ot(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){$t(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ti(),Ra(),this._startPoint=this._map.mouseEventToContainerPoint(t),gt(document,{contextmenu:fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Pt("div","leaflet-zoom-box",this._container),vt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var i=new Z(this._point,this._startPoint),r=i.getSize();Zt(this._box,i.min),this._box.style.width=r.x+"px",this._box.style.height=r.y+"px"},_finish:function(){this._moved&&($t(this._box),Ht(this._container,"leaflet-crosshair")),ei(),za(),Ot(document,{contextmenu:fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(c(this._resetState,this),0);var i=new V(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(i).fire("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Tt.addInitHook("addHandler","boxZoom",Bs),Tt.mergeOptions({doubleClickZoom:!0});var Us=Oe.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var i=this._map,r=i.getZoom(),h=i.options.zoomDelta,m=t.originalEvent.shiftKey?r-h:r+h;i.options.doubleClickZoom==="center"?i.setZoom(m):i.setZoomAround(t.containerPoint,m)}});Tt.addInitHook("addHandler","doubleClickZoom",Us),Tt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Hs=Oe.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new Ke(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}vt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ht(this._map._container,"leaflet-grab"),Ht(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var i=lt(this._map.options.maxBounds);this._offsetLimit=nt(this._map.latLngToContainerPoint(i.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(i.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var i=this._lastTime=+new Date,r=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(r),this._times.push(i),this._prunePositions(i)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,i){return t-(t-i)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),i=this._offsetLimit;t.x<i.min.x&&(t.x=this._viscousLimit(t.x,i.min.x)),t.y<i.min.y&&(t.y=this._viscousLimit(t.y,i.min.y)),t.x>i.max.x&&(t.x=this._viscousLimit(t.x,i.max.x)),t.y>i.max.y&&(t.y=this._viscousLimit(t.y,i.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,i=Math.round(t/2),r=this._initialWorldOffset,h=this._draggable._newPos.x,m=(h-i+r)%t+i-r,w=(h+i+r)%t-i-r,E=Math.abs(m+r)<Math.abs(w+r)?m:w;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=E},_onDragEnd:function(t){var i=this._map,r=i.options,h=!r.inertia||t.noInertia||this._times.length<2;if(i.fire("dragend",t),h)i.fire("moveend");else{this._prunePositions(+new Date);var m=this._lastPos.subtract(this._positions[0]),w=(this._lastTime-this._times[0])/1e3,E=r.easeLinearity,D=m.multiplyBy(E/w),R=D.distanceTo([0,0]),H=Math.min(r.inertiaMaxSpeed,R),Q=D.multiplyBy(H/R),ut=H/(r.inertiaDeceleration*E),Mt=Q.multiplyBy(-ut/2).round();!Mt.x&&!Mt.y?i.fire("moveend"):(Mt=i._limitOffset(Mt,i.options.maxBounds),F(function(){i.panBy(Mt,{duration:ut,easeLinearity:E,noMoveStart:!0,animate:!0})}))}}});Tt.addInitHook("addHandler","dragging",Hs),Tt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Zs=Oe.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),gt(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ot(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,i=document.documentElement,r=t.scrollTop||i.scrollTop,h=t.scrollLeft||i.scrollLeft;this._map._container.focus(),window.scrollTo(h,r)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var i=this._panKeys={},r=this.keyCodes,h,m;for(h=0,m=r.left.length;h<m;h++)i[r.left[h]]=[-1*t,0];for(h=0,m=r.right.length;h<m;h++)i[r.right[h]]=[t,0];for(h=0,m=r.down.length;h<m;h++)i[r.down[h]]=[0,t];for(h=0,m=r.up.length;h<m;h++)i[r.up[h]]=[0,-1*t]},_setZoomDelta:function(t){var i=this._zoomKeys={},r=this.keyCodes,h,m;for(h=0,m=r.zoomIn.length;h<m;h++)i[r.zoomIn[h]]=t;for(h=0,m=r.zoomOut.length;h<m;h++)i[r.zoomOut[h]]=-t},_addHooks:function(){gt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ot(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=t.keyCode,r=this._map,h;if(i in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(h=this._panKeys[i],t.shiftKey&&(h=J(h).multiplyBy(3)),r.options.maxBounds&&(h=r._limitOffset(J(h),r.options.maxBounds)),r.options.worldCopyJump){var m=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(h)));r.panTo(m)}else r.panBy(h)}else if(i in this._zoomKeys)r.setZoom(r.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else if(i===27&&r._popup&&r._popup.options.closeOnEscapeKey)r.closePopup();else return;fn(t)}}});Tt.addInitHook("addHandler","keyboard",Zs),Tt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ws=Oe.extend({addHooks:function(){gt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ot(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var i=ms(t),r=this._map.options.wheelDebounceTime;this._delta+=i,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var h=Math.max(r-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(c(this._performZoom,this),h),fn(t)},_performZoom:function(){var t=this._map,i=t.getZoom(),r=this._map.options.zoomSnap||0;t._stop();var h=this._delta/(this._map.options.wheelPxPerZoomLevel*4),m=4*Math.log(2/(1+Math.exp(-Math.abs(h))))/Math.LN2,w=r?Math.ceil(m/r)*r:m,E=t._limitZoom(i+(this._delta>0?w:-w))-i;this._delta=0,this._startTime=null,E&&(t.options.scrollWheelZoom==="center"?t.setZoom(i+E):t.setZoomAround(this._lastMousePos,i+E))}});Tt.addInitHook("addHandler","scrollWheelZoom",Ws);var su=600;Tt.mergeOptions({tapHold:st.touchNative&&st.safari&&st.mobile,tapTolerance:15});var Gs=Oe.extend({addHooks:function(){gt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ot(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var i=t.touches[0];this._startPos=this._newPos=new G(i.clientX,i.clientY),this._holdTimeout=setTimeout(c(function(){this._cancel(),this._isTapValid()&&(gt(document,"touchend",Yt),gt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",i))},this),su),gt(document,"touchend touchcancel contextmenu",this._cancel,this),gt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){Ot(document,"touchend",Yt),Ot(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),Ot(document,"touchend touchcancel contextmenu",this._cancel,this),Ot(document,"touchmove",this._onMove,this)},_onMove:function(t){var i=t.touches[0];this._newPos=new G(i.clientX,i.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,i){var r=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY});r._simulated=!0,i.target.dispatchEvent(r)}});Tt.addInitHook("addHandler","tapHold",Gs),Tt.mergeOptions({touchZoom:st.touch,bounceAtZoomLimits:!0});var Vs=Oe.extend({addHooks:function(){vt(this._map._container,"leaflet-touch-zoom"),gt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ht(this._map._container,"leaflet-touch-zoom"),Ot(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(!(!t.touches||t.touches.length!==2||i._animatingZoom||this._zooming)){var r=i.mouseEventToContainerPoint(t.touches[0]),h=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),i.options.touchZoom!=="center"&&(this._pinchStartLatLng=i.containerPointToLatLng(r.add(h)._divideBy(2))),this._startDist=r.distanceTo(h),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),gt(document,"touchmove",this._onTouchMove,this),gt(document,"touchend touchcancel",this._onTouchEnd,this),Yt(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var i=this._map,r=i.mouseEventToContainerPoint(t.touches[0]),h=i.mouseEventToContainerPoint(t.touches[1]),m=r.distanceTo(h)/this._startDist;if(this._zoom=i.getScaleZoom(m,this._startZoom),!i.options.bounceAtZoomLimits&&(this._zoom<i.getMinZoom()&&m<1||this._zoom>i.getMaxZoom()&&m>1)&&(this._zoom=i._limitZoom(this._zoom)),i.options.touchZoom==="center"){if(this._center=this._startLatLng,m===1)return}else{var w=r._add(h)._divideBy(2)._subtract(this._centerPoint);if(m===1&&w.x===0&&w.y===0)return;this._center=i.unproject(i.project(this._pinchStartLatLng,this._zoom).subtract(w),this._zoom)}this._moved||(i._moveStart(!0,!1),this._moved=!0),z(this._animRequest);var E=c(i._move,i,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=F(E,this,!0),Yt(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,z(this._animRequest),Ot(document,"touchmove",this._onTouchMove,this),Ot(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Tt.addInitHook("addHandler","touchZoom",Vs),Tt.BoxZoom=Bs,Tt.DoubleClickZoom=Us,Tt.Drag=Hs,Tt.Keyboard=Zs,Tt.ScrollWheelZoom=Ws,Tt.TapHold=Gs,Tt.TouchZoom=Vs,a.Bounds=Z,a.Browser=st,a.CRS=ft,a.Canvas=Fs,a.Circle=Qa,a.CircleMarker=Wi,a.Class=it,a.Control=Te,a.DivIcon=Ds,a.DivOverlay=Ne,a.DomEvent=Tc,a.DomUtil=Mc,a.Draggable=Ke,a.Evented=at,a.FeatureGroup=Be,a.GeoJSON=He,a.GridLayer=ri,a.Handler=Oe,a.Icon=Cn,a.ImageOverlay=qi,a.LatLng=Y,a.LatLngBounds=V,a.Layer=Se,a.LayerGroup=En,a.LineUtil=Rc,a.Map=Tt,a.Marker=Zi,a.Mixin=Ac,a.Path=Ye,a.Point=G,a.PolyUtil=Ic,a.Polygon=xn,a.Polyline=Ue,a.Popup=Ki,a.PosAnimation=ps,a.Projection=zc,a.Rectangle=$s,a.Renderer=Ze,a.SVG=ci,a.SVGOverlay=Is,a.TileLayer=In,a.Tooltip=Yi,a.Transformation=rt,a.Util=W,a.VideoOverlay=As,a.bind=c,a.bounds=nt,a.canvas=Rs,a.circle=Vc,a.circleMarker=Gc,a.control=ai,a.divIcon=eu,a.extend=s,a.featureGroup=Hc,a.geoJSON=xs,a.geoJson=qc,a.gridLayer=nu,a.icon=Zc,a.imageOverlay=Kc,a.latLng=j,a.latLngBounds=lt,a.layerGroup=Uc,a.map=Sc,a.marker=Wc,a.point=J,a.polygon=Jc,a.polyline=jc,a.popup=Qc,a.rectangle=ou,a.setOptions=S,a.stamp=f,a.svg=zs,a.svgOverlay=Xc,a.tileLayer=Os,a.tooltip=tu,a.transformation=Lt,a.version=o,a.videoOverlay=Yc;var ru=window.L;a.noConflict=function(){return window.L=ru,this},window.L=a})}(mi,mi.exports)),mi.exports}var Cd=Ed();const K=kd(Cd);(function(){function n(e){return this instanceof n?(this._canvas=e=typeof e=="string"?document.getElementById(e):e,this._ctx=e.getContext("2d"),this._width=e.width,this._height=e.height,this._max=1,void this.clear()):new n(e)}n.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(e,a){return this._data=e,this},max:function(e){return this._max=e,this},add:function(e){return this._data.push(e),this},clear:function(){return this._data=[],this},radius:function(e,a){a=a||15;var o=this._circle=document.createElement("canvas"),s=o.getContext("2d"),l=this._r=e+a;return o.width=o.height=2*l,s.shadowOffsetX=s.shadowOffsetY=200,s.shadowBlur=a,s.shadowColor="black",s.beginPath(),s.arc(l-200,l-200,e,0,2*Math.PI,!0),s.closePath(),s.fill(),this},gradient:function(e){var a=document.createElement("canvas"),o=a.getContext("2d"),s=o.createLinearGradient(0,0,0,256);a.width=1,a.height=256;for(var l in e)s.addColorStop(l,e[l]);return o.fillStyle=s,o.fillRect(0,0,1,256),this._grad=o.getImageData(0,0,1,256).data,this},draw:function(e){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var a=this._ctx;a.clearRect(0,0,this._width,this._height);for(var o,s=0,l=this._data.length;l>s;s++)o=this._data[s],a.globalAlpha=Math.max(o[2]/this._max,e||.05),a.drawImage(this._circle,o[0]-this._r,o[1]-this._r);var c=a.getImageData(0,0,this._width,this._height);return this._colorize(c.data,this._grad),a.putImageData(c,0,0),this},_colorize:function(e,a){for(var o,s=3,l=e.length;l>s;s+=4)o=4*e[s],o&&(e[s-3]=a[o],e[s-2]=a[o+1],e[s-1]=a[o+2])}},window.simpleheat=n})(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(n,e){this._latlngs=n,L.setOptions(this,e)},setLatLngs:function(n){return this._latlngs=n,this.redraw()},addLatLng:function(n){return this._latlngs.push(n),this.redraw()},setOptions:function(n){return L.setOptions(this,n),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(n){this._map=n,this._canvas||this._initCanvas(),n._panes.overlayPane.appendChild(this._canvas),n.on("moveend",this._reset,this),n.options.zoomAnimation&&L.Browser.any3d&&n.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(n){n.getPanes().overlayPane.removeChild(this._canvas),n.off("moveend",this._reset,this),n.options.zoomAnimation&&n.off("zoomanim",this._animateZoom,this)},addTo:function(n){return n.addLayer(this),this},_initCanvas:function(){var n=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),e=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);n.style[e]="50% 50%";var a=this._map.getSize();n.width=a.x,n.height=a.y;var o=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(n,"leaflet-zoom-"+(o?"animated":"hide")),this._heat=simpleheat(n),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var n=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,n);var e=this._map.getSize();this._heat._width!==e.x&&(this._canvas.width=this._heat._width=e.x),this._heat._height!==e.y&&(this._canvas.height=this._heat._height=e.y),this._redraw()},_redraw:function(){var n,e,a,o,s,l,c,d,f,p=[],g=this._heat._r,y=this._map.getSize(),v=new L.Bounds(L.point([-g,-g]),y.add([g,g])),M=this.options.max===void 0?1:this.options.max,b=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,S=1/Math.pow(2,Math.max(0,Math.min(b-this._map.getZoom(),12))),P=g/2,x=[],A=this._map._getMapPanePos(),N=A.x%P,I=A.y%P;for(n=0,e=this._latlngs.length;e>n;n++)if(a=this._map.latLngToContainerPoint(this._latlngs[n]),v.contains(a)){s=Math.floor((a.x-N)/P)+2,l=Math.floor((a.y-I)/P)+2;var B=this._latlngs[n].alt!==void 0?this._latlngs[n].alt:this._latlngs[n][2]!==void 0?+this._latlngs[n][2]:1;f=B*S,x[l]=x[l]||[],o=x[l][s],o?(o[0]=(o[0]*o[2]+a.x*f)/(o[2]+f),o[1]=(o[1]*o[2]+a.y*f)/(o[2]+f),o[2]+=f):x[l][s]=[a.x,a.y,f]}for(n=0,e=x.length;e>n;n++)if(x[n])for(c=0,d=x[n].length;d>c;c++)o=x[n][c],o&&p.push([Math.round(o[0]),Math.round(o[1]),Math.min(o[2],M)]);this._heat.data(p).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(n){var e=this._map.getZoomScale(n.zoom),a=this._map._getCenterOffset(n.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,a,e):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+" scale("+e+")"}}),L.heatLayer=function(n,e){return new L.HeatLayer(n,e)};async function Jo(){if(!u.lastLat||!u.lastLng){T.handleMessage("Please select a location first.");return}if(!_.state.userSettings.selectedEnsembleModels||_.state.userSettings.selectedEnsembleModels.length===0){u.ensembleModelsData=null,vn(),console.log("No ensemble models selected. Cleared ensemble data and visualizations.");return}const n=u.lastLat,e=u.lastLng,a=_.state.userSettings.selectedEnsembleModels;console.log(`Fetching ensemble weather data for models: ${a.join(", ")} at ${n}, ${e}`);const o=document.getElementById("loading");o&&(o.style.display="block");const s=a.join(","),l=["surface_pressure","temperature_2m","relative_humidity_2m","wind_speed_10m","wind_direction_10m","geopotential_height_1000hPa","temperature_1000hPa","relative_humidity_1000hPa","wind_speed_1000hPa","wind_direction_1000hPa","geopotential_height_950hPa","temperature_950hPa","relative_humidity_950hPa","wind_speed_950hPa","wind_direction_950hPa","geopotential_height_925hPa","temperature_925hPa","relative_humidity_925hPa","wind_speed_925hPa","wind_direction_925hPa","geopotential_height_900hPa","temperature_900hPa","relative_humidity_900hPa","wind_speed_900hPa","wind_direction_900hPa","geopotential_height_850hPa","temperature_850hPa","relative_humidity_850hPa","wind_speed_850hPa","wind_direction_850hPa","geopotential_height_800hPa","temperature_800hPa","relative_humidity_800hPa","wind_speed_800hPa","wind_direction_800hPa","geopotential_height_700hPa","temperature_700hPa","relative_humidity_700hPa","wind_speed_700hPa","wind_direction_700hPa","geopotential_height_600hPa","temperature_600hPa","relative_humidity_600hPa","wind_speed_600hPa","wind_direction_600hPa","geopotential_height_500hPa","temperature_500hPa","relative_humidity_500hPa","wind_speed_500hPa","wind_direction_500hPa","geopotential_height_400hPa","temperature_400hPa","relative_humidity_400hPa","wind_speed_400hPa","wind_direction_400hPa","geopotential_height_300hPa","temperature_300hPa","relative_humidity_300hPa","wind_speed_300hPa","wind_direction_300hPa","geopotential_height_250hPa","temperature_250hPa","relative_humidity_250hPa","wind_speed_250hPa","wind_direction_250hPa","geopotential_height_200hPa","temperature_200hPa","relative_humidity_200hPa","wind_speed_200hPa","wind_direction_200hPa"],c=l.join(","),d=document.getElementById("historicalDatePicker"),f=d?d.value:null,p=f?ot.fromISO(f,{zone:"utc"}):null,g=ot.utc().startOf("day"),y=p&&p<g;let v,M,b=yi.FORECAST;if(y)b=yi.HISTORICAL,v=p.toFormat("yyyy-MM-dd"),M=v;else{const P=ot.utc();v=P.toFormat("yyyy-MM-dd"),M=P.plus({days:7}).toFormat("yyyy-MM-dd")}const S=`${b}?latitude=${n}&longitude=${e}&hourly=${c}&models=${s}&start_date=${v}&end_date=${M}`;console.log("Constructed ensemble URL:",S);try{const P=await fetch(S);if(!P.ok){const N=await P.text();throw new Error(`API request failed: ${P.status} - ${N}`)}const x=await P.json();if(console.log("Raw data from OpenMeteo for ensemble request:",JSON.stringify(x,null,2)),console.log("Models requested:",a),u.ensembleModelsData={},x.error&&x.reason)throw new Error(`API Error: ${x.reason}`);if(!x.hourly){let N='Unexpected data format: "hourly" field missing in API response.';throw x&&typeof x.latitude<"u"&&(N="Received metadata but no 'hourly' data for any requested ensemble model."),console.error(N,x),new Error(N)}const A=x.hourly.time;if(!A)throw new Error("Shared 'time' array missing in hourly data.");if(a.forEach(N=>{const I={time:[...A]};let B=!1;l.forEach(U=>{const $=`${U}_${N}`;x.hourly[$]?(I[U]=x.hourly[$],B=!0):a.length===1&&x.hourly[U]?(I[U]=x.hourly[U],B=!0):I[U]=null}),B?(u.ensembleModelsData[N]=I,console.log(`Successfully processed and stored data for model: ${N}`)):console.warn(`No data found for model ${N} with suffixed keys in the 'hourly' object. Available keys for this model might be missing or the model is unavailable for this specific request. Hourly keys in response:`,Object.keys(x.hourly))}),Object.keys(u.ensembleModelsData).length===0&&a.length>0){const N="Could not retrieve and process data for any of the selected ensemble models. They might be unavailable or the API response structure was not as expected for these models.";console.warn(N,"Original API response:",x),T.handleMessage(N)}else console.log("Ensemble weather data processed and stored in AppState.ensembleModelsData:",u.ensembleModelsData);ya()}catch(P){console.error("Error in fetchEnsembleWeatherData:",P),T.handleError(`Failed to fetch ensemble weather data: ${P.message}`),u.ensembleModelsData=null,vn()}finally{o&&(o.style.display="none")}}function vn(){u.ensembleLayerGroup&&u.map.removeLayer(u.ensembleLayerGroup),u.heatmapLayer&&u.map.removeLayer(u.heatmapLayer),u.heatmapLayer=null,u.ensembleScenarioCircles={},u.ensembleLayerGroup=K.layerGroup().addTo(u.map),console.log("Ensemble visualizations cleared and a new, clean layer group was created.")}function ya(){if(vn(),!u.ensembleModelsData||Object.keys(u.ensembleModelsData).length===0){console.log("No ensemble data to process."),_.state.userSettings.selectedEnsembleModels.length>0&&_.state.userSettings.currentEnsembleScenario!=="all_models"&&(T.handleMessage("Data for selected ensemble models not yet available. Fetching..."),Jo());return}const n=_.state.userSettings.currentEnsembleScenario,e=ze();if(console.log(`Processing ensemble scenario: ${n} for slider index: ${e}`),n==="heatmap")Dd();else if(n==="all_models"){for(const a in u.ensembleModelsData)if(Object.hasOwnProperty.call(u.ensembleModelsData,a)){const s={hourly:u.ensembleModelsData[a]},l=Do(a,s);if(l){const c=xd(a);xr(l,c,a)}}}else{const a=Id(n);if(a){const o=Do(n,a);if(o){const s=Ad(n);xr(o,s,n.replace("_"," "))}}else console.warn(`Could not calculate profile for scenario: ${n}`),T.handleMessage(`Could not generate '${n.replace("_"," ")}' profile. Not enough data?`)}}function xd(n){let e=0;for(let o=0;o<n.length;o++)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;return`hsl(${e%360}, 70%, 60%)`}function Ad(n){return n==="min_wind"?ve.SCENARIO_COLORS.MIN_WIND:n==="mean_wind"?ve.SCENARIO_COLORS.MEAN_WIND:n==="max_wind"?ve.SCENARIO_COLORS.MAX_WIND:"rgba(128, 128, 128, 0.7)"}function xr(n,e,a){var S,P;if(!u.map||!n||!u.ensembleLayerGroup)return;const o=[n.centerLat,n.centerLng],s=K.circle(o,{radius:n.radius,color:e,fillColor:e,fillOpacity:.15,weight:2,dashArray:"5, 10"}).addTo(u.ensembleLayerGroup),l=_.getValue("windUnit","radio","kt");let c="N/A";if(n.meanWindSpeedMps!=="N/A"&&Number.isFinite(n.meanWindSpeedMps)){const x=T.convertWind(n.meanWindSpeedMps,l,"m/s");x!=="N/A"&&Number.isFinite(x)&&(c=l==="bft"?Math.round(x):x.toFixed(1))}const d=parseInt((S=document.getElementById("openingAltitude"))==null?void 0:S.value)||_.state.userSettings.openingAltitude||1200,f=parseInt((P=document.getElementById("legHeightDownwind"))==null?void 0:P.value)||_.state.userSettings.legHeightDownwind||0,p=d-200,g=_.getValue("heightUnit","radio","m"),y=Math.round(T.convertHeight(f,g)),v=Math.round(T.convertHeight(p,g)),M=n.meanWindDir!=="N/A"&&Number.isFinite(n.meanWindDir)?T.roundToTens(n.meanWindDir):"N/A",b=`<strong>${a}</strong><br>Mean Wind ${y}-${v} ${g} AGL:<br>${M}° ${c} ${l}`;s.bindTooltip(b,{permanent:!1,direction:"top",className:"wind-tooltip",opacity:.9}),u.ensembleScenarioCircles[a]=s,console.log(`Drew ensemble circle for ${a} at [${o.join(", ")}], radius ${n.radius}`)}function Id(n){var p;if(!u.ensembleModelsData||Object.keys(u.ensembleModelsData).length===0)return console.warn("No ensemble data available for profile calculation."),null;if(Object.keys(u.ensembleModelsData).length===0)return null;console.log(`Calculating full time-series ensemble profile for: ${n}`);const a={},o=Object.keys(u.ensembleModelsData)[0],s=(p=u.ensembleModelsData[o])==null?void 0:p.time;if(!s||s.length===0)return console.error("Time data missing or empty in the first ensemble model for profile calculation."),null;a.time=[...s];const l=a.time.length,c=["surface_pressure","temperature_2m","relative_humidity_2m","geopotential_height_1000hPa","temperature_1000hPa","relative_humidity_1000hPa","geopotential_height_950hPa","temperature_950hPa","relative_humidity_950hPa","geopotential_height_925hPa","temperature_925hPa","relative_humidity_925hPa","geopotential_height_900hPa","temperature_900hPa","relative_humidity_900hPa","geopotential_height_850hPa","temperature_850hPa","relative_humidity_850hPa","geopotential_height_800hPa","temperature_800hPa","relative_humidity_800hPa","geopotential_height_700hPa","temperature_700hPa","relative_humidity_700hPa","geopotential_height_600hPa","temperature_600hPa","relative_humidity_600hPa","geopotential_height_500hPa","temperature_500hPa","relative_humidity_500hPa","geopotential_height_400hPa","temperature_400hPa","relative_humidity_400hPa","geopotential_height_300hPa","temperature_300hPa","relative_humidity_300hPa","geopotential_height_250hPa","temperature_250hPa","relative_humidity_250hPa","geopotential_height_200hPa","temperature_200hPa","relative_humidity_200hPa"],d=[["wind_speed_10m","wind_direction_10m"]];[1e3,950,925,900,850,800,700,600,500,400,300,250,200].forEach(g=>{d.push([`wind_speed_${g}hPa`,`wind_direction_${g}hPa`])}),c.forEach(g=>{a[g]=new Array(l).fill(null)}),d.forEach(g=>{a[g[0]]=new Array(l).fill(null),a[g[1]]=new Array(l).fill(null)});for(let g=0;g<l;g++)c.forEach(y=>{const v=[];for(const M in u.ensembleModelsData){const b=u.ensembleModelsData[M];if(b&&b[y]){const S=b[y][g];S!=null&&!isNaN(S)&&v.push(S)}}v.length>0&&(n==="min_wind"?a[y][g]=Math.min(...v):n==="max_wind"?a[y][g]=Math.max(...v):a[y][g]=v.reduce((M,b)=>M+b,0)/v.length)}),d.forEach(y=>{const v=y[0],M=y[1];let b=[],S=[],P=[],x=[];for(const A in u.ensembleModelsData){const N=u.ensembleModelsData[A];if(N&&N[v]&&N[M]){const I=N[v][g],B=N[M][g];I!=null&&!isNaN(I)&&B!==null&&B!==void 0&&!isNaN(B)&&(P.push(I),x.push(B),b.push(-I*Math.sin(B*Math.PI/180)),S.push(-I*Math.cos(B*Math.PI/180)))}}if(P.length>0)if(n==="min_wind"){const A=Math.min(...P),N=P.indexOf(A);a[v][g]=A,a[M][g]=x[N]}else if(n==="max_wind"){const A=Math.max(...P),N=P.indexOf(A);a[v][g]=A,a[M][g]=x[N]}else{const A=b.reduce((I,B)=>I+B,0)/b.length,N=S.reduce((I,B)=>I+B,0)/S.length;a[v][g]=T.windSpeed(A,N),a[M][g]=T.windDirection(A,N)}});return{hourly:a}}function Do(n,e=null){var c,d;console.log(`Calculating exit circle for ensemble profile/model: ${n}`);let a;if(e)a=e;else if(u.ensembleModelsData&&u.ensembleModelsData[n])a={hourly:u.ensembleModelsData[n]};else return console.warn(`No data for profile/model ${n} in calculateExitCircleForEnsemble found.`),null;if(!a.hourly||!u.lastLat||!u.lastLng||u.lastAltitude==="N/A")return console.warn(`Incomplete data for calculateExitCircleForEnsemble: ${n}`),null;const o=u.weatherData;u.weatherData=a.hourly;let s=null,l={meanWindDir:"N/A",meanWindSpeedMps:"N/A"};try{const f=_.state.userSettings.calculateJump,p=_.state.userSettings.showExitArea;_.state.userSettings.calculateJump=!0,_.state.userSettings.showExitArea=!0;const g=ze(),y=Mn(g);if(s=Hr(y),y&&y.length>0){const v=y.map(B=>B.height),M=y.map(B=>-T.convertWind(B.spd,"m/s","km/h")*Math.sin(B.dir*Math.PI/180)),b=y.map(B=>-T.convertWind(B.spd,"m/s","km/h")*Math.cos(B.dir*Math.PI/180)),S=parseInt((c=document.getElementById("openingAltitude"))==null?void 0:c.value)||1200,P=parseInt((d=document.getElementById("legHeightDownwind"))==null?void 0:d.value)||0,x=Math.round(u.lastAltitude),A=x+S-200,N=x+P,I=T.calculateMeanWind(v,M,b,N,A);I&&Number.isFinite(I[0])&&Number.isFinite(I[1])&&(l={meanWindDir:I[0],meanWindSpeedMps:I[1]})}_.state.userSettings.calculateJump=f,_.state.userSettings.showExitArea=p}catch(f){console.error(`Error in calculateExitCircle for profile ${n}:`,f),s=null}finally{u.weatherData=o}return s?{centerLat:s.darkGreenLat,centerLng:s.darkGreenLng,radius:s.darkGreenRadius,freeFallDirection:s.freeFallDirection,freeFallDistance:s.freeFallDistance,freeFallTime:s.freeFallTime,meanWindDir:l.meanWindDir,meanWindSpeedMps:l.meanWindSpeedMps,profileIdentifier:n}:(console.warn(`calculateExitCircle returned null for profile ${n}`),null)}function Dd(){if(vn(),u.heatmapLayer&&(u.map.removeLayer(u.heatmapLayer),u.heatmapLayer=null),!u.ensembleModelsData||Object.keys(u.ensembleModelsData).length<2){T.handleMessage("Please select at least two ensemble models to generate a heatmap.");return}const n=[];for(const p in u.ensembleModelsData)if(Object.hasOwnProperty.call(u.ensembleModelsData,p)){const g=u.ensembleModelsData[p],y=Do(p,{hourly:g});y&&n.push({centerLat:y.centerLat,centerLng:y.centerLng,radius:y.radius})}if(n.length===0){console.warn("Could not calculate any circles for the heatmap.");return}console.log(`[Heatmap] Calculated ${n.length} model circles.`);let e=90,a=-90,o=180,s=-180;const l=111320;n.forEach(p=>{const g=p.radius/l,y=p.radius/(l*Math.cos(p.centerLat*Math.PI/180));e=Math.min(e,p.centerLat-g),a=Math.max(a,p.centerLat+g),o=Math.min(o,p.centerLng-y),s=Math.max(s,p.centerLng+y)});const c=40,d=c/l,f=[];console.log("[Heatmap] Starting grid calculation...");for(let p=e;p<=a;p+=d){const g=c/(l*Math.cos(p*Math.PI/180));for(let y=o;y<=s;y+=g){let v=0;const M=K.latLng(p,y);n.forEach(b=>{const S=K.latLng(b.centerLat,b.centerLng);u.map.distance(M,S)<=b.radius&&v++}),v>0&&f.push([p,y,v])}}if(console.log(`[Heatmap] Finished grid calculation. Generated ${f.length} heatmap points.`),f.length>0){const p=n.length,g={};if(p===1)g[1]="lime";else for(let v=1;v<=p;v++){const M=v/p;v===1?g[M]="red":v<p?g[M]="yellow":g[M]="lime"}console.log("[Heatmap] Using gradient:",g),u.heatmapLayer&&u.map.removeLayer(u.heatmapLayer);const y=T.calculateDynamicRadius(ve.HEATMAP_BASE_RADIUS,ve.HEATMAP_REFERENCE_ZOOM);u.heatmapLayer=K.heatLayer(f,{radius:y,blur:10,max:p,minOpacity:.01,gradient:g}).addTo(u.map)}else T.handleMessage("No overlapping landing areas found for the selected models.")}function wi(){const n=window.innerWidth<we.MOBILE_BREAKPOINT_PX;return console.log(`isMobileDevice check: window.innerWidth=${window.innerWidth}, isMobile=${n}`),n}function ye(n){console.log("displayMessage called with:",n);let e=document.getElementById("message");e||(e=document.createElement("div"),e.id="message",e.style.position="fixed",e.style.top="5px",e.style.right="5px",e.style.width=wi()?"70%":"30%",e.style.backgroundColor="#ccffcc",e.style.borderRadius="5px 5px 5px 5px",e.style.color="#000000",e.style.padding="6px",e.style.zIndex="9998",e.style.textAlign="center",document.body.appendChild(e),window.addEventListener("resize",()=>{e.style.width=wi()?"70%":"30%"})),e.textContent=n,e.style.display="block",clearTimeout(window.messageTimeout),window.messageTimeout=setTimeout(()=>{e.style.display="none"},we.MESSAGE_TIMEOUT_MS)}function va(n,e,a){const o=Math.round(n/e*100);let s=document.getElementById("progress");s||(s=document.createElement("div"),s.id="progress",s.style.position="fixed",s.style.top="5px",s.style.right="5px",s.style.width=wi()?"70%":"30%",s.style.backgroundColor="#ccffcc",s.style.borderRadius="5px 5px 5px 5px",s.style.color="#000000",s.style.padding="6px",s.style.zIndex="9998",s.style.display="flex",s.style.alignItems="center",s.style.gap="10px",document.body.appendChild(s),window.addEventListener("resize",()=>{s.style.width=wi()?"70%":"30%"}));const l=document.createElement("div");l.style.flex="1",l.style.display="flex",l.style.flexDirection="column",l.style.gap="3px";const c=document.createElement("div");c.textContent=`Caching (${n}/${e}, ${o}%)`,c.style.fontSize="12px",c.style.textAlign="center";const d=document.createElement("div");d.style.width="100%",d.style.height="8px",d.style.backgroundColor="#e0e0e0",d.style.borderRadius="3px",d.style.overflow="hidden";const f=document.createElement("div");f.style.width=`${o}%`,f.style.height="100%",f.style.backgroundColor="#4caf50",f.style.transition="width 0.3s ease-in-out",d.appendChild(f),l.appendChild(c),l.appendChild(d);let p=document.getElementById("cancel-caching");p||(p=document.createElement("button"),p.id="cancel-caching",p.textContent="Cancel",p.style.backgroundColor="#ff4444",p.style.color="#ffffff",p.style.border="none",p.style.borderRadius="3px",p.style.padding="5px 3px",p.style.cursor="pointer",p.style.fontSize="12px",p.addEventListener("click",()=>{a(),s.style.display="none",T.handleMessage("Caching cancelled.")})),s.innerHTML="",s.appendChild(l),s.appendChild(p),s.style.display="flex"}function Vl(){const n=document.getElementById("progress");n&&(n.style.display="none")}function Oo(){console.log("updateOfflineIndicator called, navigator.onLine:",navigator.onLine);let n=document.getElementById("offline-indicator");n||(n=document.createElement("div"),n.id="offline-indicator",document.body.appendChild(n),console.log("Offline indicator created and appended")),n.style.display=navigator.onLine?"none":"block",n.textContent="Offline Mode"}function Gn(n){console.log("displayError called with:",n);let e=document.getElementById("error-message");e||(e=document.createElement("div"),e.id="error-message",document.body.appendChild(e),window.addEventListener("resize",()=>{e.style.width=wi()?"70%":"30%"})),e.textContent=n,e.style.display="block",console.log("Error element state:",{display:e.style.display,text:e.textContent,position:e.style.position,zIndex:e.style.zIndex}),clearTimeout(window.errorTimeout),window.errorTimeout=setTimeout(()=>{e.style.display="none",console.log("Error hidden after 3s")},we.MESSAGE_TIMEOUT_MS)}function ze(){var n;return parseInt((n=document.getElementById("timeSlider"))==null?void 0:n.value)||0}function Od(n){const e=document.getElementById("modelSelect");if(!e)return;const a=e.value;e.innerHTML="",n.forEach(o=>{const s=document.createElement("option");s.value=o,s.textContent=o.replace(/_/g," ").toUpperCase(),e.appendChild(s)}),n.includes(_.state.userSettings.model)?e.value=_.state.userSettings.model:n.includes(a)?e.value=a:n.length>0&&(e.value=n[0])}function Nd(n){const e=document.getElementById("ensembleModelsSubmenu");e&&(e.innerHTML="",n.forEach(a=>{const o=document.createElement("li"),s=document.createElement("label");s.className="radio-label";const l=document.createElement("input");l.type="checkbox",l.name="ensembleModel",l.value=a,l.checked=_.state.userSettings.selectedEnsembleModels.includes(a),l.addEventListener("change",()=>{const c=Array.from(e.querySelectorAll("input:checked")).map(d=>d.value);_.state.userSettings.selectedEnsembleModels=c,_.save(),Jo()}),s.append(l,` ${a.replace(/_/g," ").toUpperCase()}`),o.appendChild(s),e.appendChild(o)}))}function Fd(n){let e=_.state.userSettings.selectedEnsembleModels||[],a=e.filter(o=>n.includes(o));e.length!==a.length&&(_.state.userSettings.selectedEnsembleModels=a,_.save())}const Un=65,re=73,_e=79;function jl(n,e){if(e=typeof e=="number"?e:5,!Array.isArray(n))throw new TypeError("forward did not receive an array");if(typeof n[0]=="string"||typeof n[1]=="string")throw new TypeError("forward received an array of strings, but it only accepts an array of numbers.");const[a,o]=n;if(a<-180||a>180)throw new TypeError("forward received an invalid longitude of "+a);if(o<-90||o>90)throw new TypeError("forward received an invalid latitude of "+o);if(o<-80||o>84)throw new TypeError(`forward received a latitude of ${o}, but this library does not support conversions of points in polar regions below 80°S and above 84°N`);return function(s,l){const c="00000"+s.easting,d="00000"+s.northing;return s.zoneNumber+s.zoneLetter+function(f,p,g){const y=ql(g),v=Math.floor(f/1e5),M=Math.floor(p/1e5)%20;return function(b,S,P){const x=P-1,A="AJSAJS".charCodeAt(x),N="AFAFAF".charCodeAt(x);let I=A+b-1,B=N+S,U=!1;return I>90&&(I=I-90+Un-1,U=!0),(I===re||A<re&&I>re||(I>re||A<re)&&U)&&I++,(I===_e||A<_e&&I>_e||(I>_e||A<_e)&&U)&&(I++,I===re&&I++),I>90&&(I=I-90+Un-1),B>86?(B=B-86+Un-1,U=!0):U=!1,(B===re||N<re&&B>re||(B>re||N<re)&&U)&&B++,(B===_e||N<_e&&B>_e||(B>_e||N<_e)&&U)&&(B++,B===re&&B++),B>86&&(B=B-86+Un-1),String.fromCharCode(I)+String.fromCharCode(B)}(v,M,y)}(s.easting,s.northing,s.zoneNumber)+c.substr(c.length-5,l)+d.substr(d.length-5,l)}(function(s){const l=s.lat,c=s.lon,d=6378137,f=po(l),p=po(c);let g;g=Math.floor((c+180)/6)+1,c===180&&(g=60),l>=56&&l<64&&c>=3&&c<12&&(g=32),l>=72&&l<84&&(c>=0&&c<9?g=31:c>=9&&c<21?g=33:c>=21&&c<33?g=35:c>=33&&c<42&&(g=37));const y=po(6*(g-1)-180+3),v=d/Math.sqrt(1-.00669438*Math.sin(f)*Math.sin(f)),M=Math.tan(f)*Math.tan(f),b=.006739496752268451*Math.cos(f)*Math.cos(f),S=Math.cos(f)*(p-y),P=d*(.9983242984503243*f-.002514607064228144*Math.sin(2*f)+2639046602129982e-21*Math.sin(4*f)-3418046101696858e-24*Math.sin(6*f)),x=.9996*v*(S+(1-M+b)*S*S*S/6+(5-18*M+M*M+72*b-.39089081163157013)*S*S*S*S*S/120)+5e5;let A=.9996*(P+v*Math.tan(f)*(S*S/2+(5-M+9*b+4*b*b)*S*S*S*S/24+(61-58*M+M*M+600*b-2.2240339282485886)*S*S*S*S*S*S/720));return l<0&&(A+=1e7),{northing:Math.trunc(A),easting:Math.trunc(x),zoneNumber:g,zoneLetter:Jl(l)}}({lat:o,lon:a}),e)}function Rd(n){const e=Ko(Kl(n.toUpperCase()));return typeof e.lat=="number"&&typeof e.lon=="number"?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function qo(n){if(n==="")throw new TypeError("toPoint received a blank string");const e=Ko(Kl(n.toUpperCase()));return typeof e.lat=="number"&&typeof e.lon=="number"?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function po(n){return n*(Math.PI/180)}function Ar(n){return n/Math.PI*180}function Ko(n){const e=n.northing,a=n.easting,{zoneLetter:o,zoneNumber:s}=n;if(s<0||s>60)return null;const l=6378137,c=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),d=a-5e5;let f=e;o<"N"&&(f-=1e7);const p=6*(s-1)-180+3,g=f/.9996/6367449145945056e-9,y=g+(3*c/2-27*c*c*c/32)*Math.sin(2*g)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*g)+151*c*c*c/96*Math.sin(6*g),v=l/Math.sqrt(1-.00669438*Math.sin(y)*Math.sin(y)),M=Math.tan(y)*Math.tan(y),b=.006739496752268451*Math.cos(y)*Math.cos(y),S=.99330562*l/Math.pow(1-.00669438*Math.sin(y)*Math.sin(y),1.5),P=d/(.9996*v);let x=y-v*Math.tan(y)/S*(P*P/2-(5+3*M+10*b-4*b*b-.06065547077041606)*P*P*P*P/24+(61+90*M+298*b+45*M*M-1.6983531815716497-3*b*b)*P*P*P*P*P*P/720);x=Ar(x);let A,N=(P-(1+2*M+b)*P*P*P/6+(5-2*b+28*M-3*b*b+.05391597401814761+24*M*M)*P*P*P*P*P/120)/Math.cos(y);if(N=p+Ar(N),typeof n.accuracy=="number"){const I=Ko({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});A={top:I.lat,right:I.lon,bottom:x,left:N}}else A={lat:x,lon:N};return A}function Jl(n){return n<=84&&n>=72?"X":n<72&&n>=-80?"CDEFGHJKLMNPQRSTUVWX"[Math.floor((n- -80)/8)]:n>84||n<-80?"Z":void 0}function ql(n){let e=n%6;return e===0&&(e=6),e}function Kl(n){if(n&&n.length===0)throw new TypeError("MGRSPoint coverting from nothing");n=n.replace(/ /g,"");const{length:e}=n;let a,o=null,s="",l=0;for(;!/[A-Z]/.test(a=n.charAt(l));){if(l>=2)throw new Error("MGRSPoint bad conversion from: "+n);s+=a,l++}const c=parseInt(s,10);if(l===0||l+3>e)throw new Error("MGRSPoint bad conversion from "+n);const d=n.charAt(l++);if(d<="A"||d==="B"||d==="Y"||d>="Z"||d==="I"||d==="O")throw new Error(`MGRSPoint zone letter ${d} not handled: ${n}`);o=n.substring(l,l+=2);const f=ql(c),p=function(A,N){let I="AJSAJS".charCodeAt(N-1),B=1e5,U=!1;for(;I!==A.charCodeAt(0);){if(I++,I===re&&I++,I===_e&&I++,I>90){if(U)throw new Error("Bad character: "+A);I=Un,U=!0}B+=1e5}return B}(o.charAt(0),f);let g=function(A,N){if(A>"V")throw new TypeError("MGRSPoint given invalid Northing "+A);let I="AFAFAF".charCodeAt(N-1),B=0,U=!1;for(;I!==A.charCodeAt(0);){if(I++,I===re&&I++,I===_e&&I++,I>86){if(U)throw new Error("Bad character: "+A);I=Un,U=!0}B+=1e5}return B}(o.charAt(1),f);for(;g<zd(d);)g+=2e6;const y=e-l;if(y%2!=0)throw new Error(`MGRSPoint has to have an even number
of digits after the zone letter and two 100km letters - front
half for easting meters, second half for
northing meters `+n);const v=y/2;let M,b,S,P=0,x=0;return v>0&&(M=1e5/Math.pow(10,v),b=n.substring(l,l+v),P=parseFloat(b)*M,S=n.substring(l+v),x=parseFloat(S)*M),{easting:P+p,northing:x+g,zoneLetter:d,zoneNumber:c,accuracy:M}}function zd(n){let e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw new TypeError("Invalid zone letter: "+n)}const $d=Object.freeze(Object.defineProperty({__proto__:null,forward:jl,getLetterDesignator:Jl,inverse:Rd,toPoint:qo},Symbol.toStringTag,{value:"Module"}));var _t;let T=(_t=class{static formatTime(e){return ot.fromISO(e,{zone:"UTC"}).toFormat("yyyy-MM-dd HHmm")+"Z"}static roundToTens(e){return Math.round(e/10)*10}static convertTemperature(e,a){const o=parseFloat(e);return isNaN(o)?"N/A":a==="°F"?o*9/5+32:o}static convertHeight(e,a){const o=parseFloat(e);return isNaN(o)?"N/A":a==="ft"?parseFloat((e*Qt.METERS_TO_FEET).toFixed(0)):e}static convertWind(e,a,o="km/h"){if(e==null||isNaN(e))return"N/A";let s;switch(o){case"km/h":s=e;break;case"m/s":s=e*3.6;break;case"kt":s=e*Qt.KNOTS_TO_KMH;break;case"mph":s=e*1.60934;break;case"bft":s=_t.beaufortToKnots(e)*Qt.KNOTS_TO_KMH;break;default:s=e;break}switch(a){case"km/h":return s;case"m/s":return s/3.6;case"kt":return s/Qt.KNOTS_TO_KMH;case"mph":return s/1.60934;case"bft":return _t.knotsToBeaufort(s/Qt.KNOTS_TO_KMH);default:return s/Qt.KNOTS_TO_KMH}}static knotsToBeaufort(e){const a=Qs.KNOT_THRESHOLDS.findIndex(o=>e<o);return a===-1?12:a}static beaufortToKnots(e){return Qs.BEAUFORT_THRESHOLDS[e]||63}static calculateDewpoint(e,a){const o=ta.A_LIQUID,s=ta.B_LIQUID,l=ta.A_ICE,c=ta.B_ICE;let d,f;return e>=0?(d=o*e/(s+e)+Math.log(a/100),f=s*d/(o-d)):(d=l*e/(c+e)+Math.log(a/100),f=c*d/(l-d)),isNaN(f)?null:f}static gaussianInterpolation(e,a,o,s,l){if(o===l)return e;if(s===l)return a;let c=1/Math.abs(o-l),d=1/Math.abs(s-l);return(c*e+d*a)/(c+d)}static interpolateWindAtAltitude(e,a,o,s,l){if(a.length!=o.length||a.length!=s.length||a.length!=l.length)return{u:"Invalid input",v:"Invalid input"};const c=a.map(y=>Math.log(y)),d=_t.linearInterpolate(o,c,e);if(typeof d=="string"&&d.includes("error"))return{u:"Interpolation error",v:"Interpolation error"};const f=Math.exp(d),p=_t.linearInterpolate(c,s,Math.log(f)),g=_t.linearInterpolate(c,l,Math.log(f));return typeof p=="string"&&p.includes("error")||typeof g=="string"&&g.includes("error")?{u:"Interpolation error",v:"Interpolation error"}:{u:p,v:g}}static interpolatePressure(e,a,o){if(!a||!o||a.length!==o.length||a.length<2||e<o[0]||e>o[o.length-1])return"N/A";for(let s=0;s<o.length-1;s++)if(e>=o[s]&&e<=o[s+1]){const l=o[s],c=o[s+1],d=a[s],f=a[s+1];return d+(f-d)*(e-l)/(c-l)}return"N/A"}static linearInterpolate(e,a,o){if(!(e!=null&&e.length)||!(a!=null&&a.length)||e.length!==a.length)return"invalid input for linearInterpolate";let s=!1;e[1]>e[0]&&(a=[...a].reverse(),e=[...e].reverse(),s=!0);const l=e.length-1;try{if(o>e[0]||o<e[l]){let c,d;return o>e[0]?(c=(a[1]-a[0])/(e[1]-e[0]),d=a[1]-c*e[1]):(c=(a[l]-a[l-1])/(e[l]-e[l-1]),d=a[l]-c*e[l]),c*o+d}else{let c;for(c=1;c<=l&&!(o>=e[c]);c++);const d=(a[c]-a[c-1])/(e[c]-e[c-1]),f=a[c]-d*e[c];return d*o+f}}catch{return"interpolation error"}finally{s&&(a.reverse(),e.reverse())}}static windSpeed(e,a){return Math.sqrt(e*e+a*a)}static windDirection(e,a){return(Math.atan2(-e,-a)*180/Math.PI+360)%360}static calculateMeanWind(e,a,o,s,l){try{if(!e||!a||!o||e.length<2)throw new Error("Invalid input data for calculateMeanWind");const c=new Array(4);let d=[l],f=[Number(_t.linearInterpolate(e,a,l))],p=[Number(_t.linearInterpolate(e,o,l))];const g=Number(_t.linearInterpolate(e,a,s)),y=Number(_t.linearInterpolate(e,o,s));for(let x=0;x<e.length;x++)e[x]<l&&e[x]>s&&(d.push(e[x]),f.push(a[x]),p.push(o[x]));d.push(s),f.push(g),p.push(y);const v=d.map((x,A)=>A);v.sort((x,A)=>d[A]-d[x]),d=v.map(x=>d[x]),f=v.map(x=>f[x]),p=v.map(x=>p[x]);let M=0,b=0;for(let x=0;x<d.length-1;x++)M+=.5*(f[x]+f[x+1])*(d[x]-d[x+1]),b+=.5*(p[x]+p[x+1])*(d[x]-d[x+1]);const S=M/(d[0]-d[d.length-1]),P=b/(d[0]-d[d.length-1]);return c[2]=S,c[3]=P,c[1]=_t.windSpeed(S,P),c[0]=_t.windDirection(S,P),c}catch(c){return console.error("Error in calculateMeanWind:",c,{heights:e,xComponents:a,yComponents:o,lowerLimit:s,upperLimit:l}),_t.handleError("Failed to calculate mean wind: "+c.message),null}}static async getLocationData(e,a){const o=`${e.toFixed(4)},${a.toFixed(4)}`;if(_t.locationCache.has(o))return _t.locationCache.get(o);try{const s=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${a}&timezone=auto`);if(!s.ok)throw new Error(`Open-Meteo fetch failed: ${s.status}`);const l=await s.json(),c={timezone:l.timezone||"GMT",timezone_abbreviation:l.timezone_abbreviation||"GMT",elevation:l.elevation!==void 0?l.elevation:"N/A"};return _t.locationCache.set(o,c),console.log(`Fetched location data for ${o}:`,c),c}catch(s){return console.error("Error fetching location data:",s.message),{timezone:"UTC",elevation:"N/A"}}}static async formatLocalTime(e,a,o){const{timezone:s,timezone_abbreviation:l}=await _t.getLocationData(a,o);return ot.fromISO(e,{zone:"UTC"}).setZone(s).toFormat("yyyy-MM-dd HHmm")+` ${l}`}static normalizeAngle(e){return(e%360+360)%360}static calculateWindAngle(e,a){let o=_t.normalizeAngle(a-e);return o>180&&(o-=360),o}static calculateWindComponents(e,a){const o=a*(Math.PI/180),s=e*Math.sin(o),l=e*Math.cos(o);return{crosswind:s,headwind:l}}static calculateWCA(e,a){const s=Math.abs(Math.asin(e/a))*(180/Math.PI);return isNaN(s)?0:s}static calculateGroundSpeed(e,a){return e-a}static calculateCourseFromHeading(e,a,o,s){const l=_t.calculateWindAngle(e,a),{crosswind:c,headwind:d}=_t.calculateWindComponents(o,l),f=s*Math.sin(e*Math.PI/180),p=s*Math.cos(e*Math.PI/180),g=(a+180)%360,y=o*Math.sin(g*Math.PI/180),v=o*Math.cos(g*Math.PI/180),M=f+y,b=p+v,S=Math.atan2(M,b)*(180/Math.PI),P=_t.normalizeAngle(S),x=Math.sqrt(M*M+b*b),A=_t.calculateWCA(c,s)*(c<0?-1:1);return{trueCourse:Number(P.toFixed(2)),groundSpeed:Number(x.toFixed(2)),wca:Number(A.toFixed(2)),crosswind:Number(c.toFixed(2)),headwind:Number(d.toFixed(2))}}static calculateFlightParameters(e,a,o,s){const l=_t.calculateWindAngle(e,a),{crosswind:c,headwind:d}=_t.calculateWindComponents(o,l),f=_t.calculateWCA(c,s),p=_t.calculateGroundSpeed(s,d);return{crosswind:Number(c.toFixed(2)),headwind:Number(d.toFixed(2)),wca:Number(f.toFixed(2)),groundSpeed:Number(p.toFixed(2))}}static handleError(e,a=!0){a&&console.error(e),typeof Gn=="function"?Gn(e):(console.warn("Utils.js: displayError function is not available, logging to console only."),console.error("Error message:",e))}static dmsToDecimal(e,a,o,s){if(isNaN(e)||isNaN(a)||isNaN(o)||!s)throw console.warn("Invalid DMS inputs:",{deg:e,min:a,sec:o,dir:s}),new Error("Invalid DMS values");let l=e+a/60+o/3600;if((s==="S"||s==="W")&&(l=-l),isNaN(l))throw console.warn("DMS to decimal conversion failed:",{deg:e,min:a,sec:o,dir:s}),new Error("Failed to convert DMS to decimal");return l}static decimalToDms(e,a){if(isNaN(e)||e===null||e===void 0)throw console.warn("Invalid decimal value for DMS conversion:",e),new Error("Invalid coordinate for DMS conversion");const o=Math.abs(e),s=Math.floor(o),l=Math.floor((o-s)*60),c=(o-s)*3600-l*60,d=a?e>=0?"N":"S":e>=0?"E":"W";if(isNaN(s)||isNaN(l)||isNaN(c))throw console.warn("DMS calculation resulted in invalid values:",{deg:s,min:l,sec:c}),new Error("Failed to convert to DMS");return{deg:s,min:l,sec:c,dir:d}}static decimalToMgrs(e,a){try{return jl([a,e])}catch(o){return console.error("Error converting to MGRS:",o),"Invalid MGRS"}}static mgrsToDecimal(e){try{const[a,o]=qo(e);return{lat:o,lng:a}}catch(a){return console.error("Error converting MGRS to decimal:",a),null}}static convertCoords(e,a,o="Decimal"){if(e===null||a===null||e===void 0||a===void 0)return{lat:"N/A",lng:"N/A"};const s={Decimal:{lat:e.toFixed(6),lng:a.toFixed(6)},DMS:{lat:_t.decimalToDms(e,!0),lng:_t.decimalToDms(a,!1)},MGRS:_t.decimalToMgrs(e,a)};switch(o){case"DMS":return s.DMS;case"MGRS":return{lat:s.MGRS,lng:s.MGRS};case"Decimal":default:return s.Decimal}}static calculateTAS(e,a){if(isNaN(e)||isNaN(a)||e<0||a<0)return console.warn("Invalid inputs for calculateTAS:",{ias:e,heightFt:a}),"N/A";const o=_n.LAPSE_RATE,s=_n.SEA_LEVEL_TEMP_KELVIN,l=_n.GRAVITY,c=_n.GAS_CONSTANT_AIR,d=Qt.FEET_TO_METERS,f=a*d,p=s-o*f,g=p/s,y=1-o*f/s,v=l/(o*c)-1,M=Math.pow(y,v),b=e/Math.sqrt(M);return console.log("calculateTAS debug:",{ias:e,heightFt:a,heightM:f,tempAtAltitude:p,tempRatio:g,base:y,exponent:v,densityRatio:M,tas:b,tasRounded:Number(b.toFixed(2))}),Number(b.toFixed(2))}static calculateTASFromGroundSpeed(e,a,o,s,l){if(isNaN(e)||isNaN(a)||isNaN(o)||isNaN(s))return"N/A";const c=_t.convertWind(e,"kt","m/s"),d=_t.convertWind(a,"kt","m/s"),f=_t.calculateWindAngle(s,o),{crosswind:p,headwind:g}=_t.calculateWindComponents(d,f),y=c+g,v=_t.calculateTAS(y,l);return Number(v.toFixed(1))}static handleMessage(e){const a=document.getElementById("info");a?(a.textContent=e,a.style.display="block",setTimeout(()=>{a.style.display="none"},3e3),console.log("Displayed message:",e)):(console.warn("Info div not found for handleMessage, using alert"),alert(e))}static calculateQFE(e,a,o,s=15){if(!e||a==="N/A"||o==="N/A"||isNaN(e)||isNaN(a)||isNaN(o))return"N/A";console.log("QFE reference elevation: ",o);const l=_n.GRAVITY,c=Xs.MOLAR_MASS_AIR,d=Xs.UNIVERSAL_GAS_CONSTANT,f=s+Qt.CELSIUS_TO_KELVIN,p=_n.LAPSE_RATE,g=e*100,y=a-o,v=l*c/(d*p),M=g*Math.pow(1-p*y/f,v);console.log(e,a,o);const b=Math.round(M/100);return isNaN(b)?"N/A":b}static calculateNewCenter(e,a,o,s){const l=wu,c=e*Math.PI/180,d=a*Math.PI/180,f=s*Math.PI/180,p=o/l,g=Math.asin(Math.sin(c)*Math.cos(p)+Math.cos(c)*Math.sin(p)*Math.cos(f)),y=d+Math.atan2(Math.sin(f)*Math.sin(p)*Math.cos(c),Math.cos(p)-Math.sin(c)*Math.sin(g)),v=g*180/Math.PI,b=(y*180/Math.PI+540)%360-180;return[v,b]}static debounce(e,a){let o;return function(...s){clearTimeout(o),o=setTimeout(()=>e.apply(this,s),a)}}static calculateBearing(e,a,o,s){const l=y=>y*Math.PI/180,c=y=>y*180/Math.PI,d=l(s-a),f=Math.sin(d)*Math.cos(l(o)),p=Math.cos(l(e))*Math.sin(l(o))-Math.sin(l(e))*Math.cos(l(o))*Math.cos(d);let g=c(Math.atan2(f,p));return g=(g+360)%360,g}static async getAltitude(e,a){const{elevation:o}=await _t.getLocationData(e,a);return console.log("Fetched elevation from Open-Meteo:",o),o!=="N/A"?o:"N/A"}static getLastFullHourUTC(){const e=new Date,a=e.getUTCFullYear(),o=e.getUTCMonth(),s=e.getUTCDate(),l=e.getUTCHours(),c=new Date(Date.UTC(a,o,s,l,0,0));return console.log("Last full hour UTC:",c.toISOString()),c}static async getDisplayTime(e,a,o){var l;return(((l=document.querySelector('input[name="timeZone"]:checked'))==null?void 0:l.value)||"Z")==="Z"||!a||!o?_t.formatTime(e):await _t.formatLocalTime(e,a,o)}static calculateDynamicRadius(e=ve.HEATMAP_SCALING_BASE,a=ve.HEATMAP_REFERENCE_ZOOM){const o=u.map.getZoom(),s=ve.HEATMAP_SCALING_BASE,l=Math.pow(s,o-a),c=e*l,d=ve.HEATMAP_MIN_RADIUS_PX,f=ve.HEATMAP_MAX_RADIUS_PX,p=Math.max(d,Math.min(f,c));return console.log("[calculateDynamicRadius] Calculated dynamic radius:",{currentZoom:o,baseRadius:e,scaleFactor:l,dynamicRadius:c,adjustedRadius:p}),p}static interpolateColor(e,a=0,o=3e3){const s=Math.min(Math.max((e-a)/(o-a),0),1);return e<0||isNaN(e)?"#808080":s<=.5?`rgb(255, ${Math.round(255*(s*2))}, 0)`:`rgb(${Math.round(255*(1-(s-.5)*2))}, 255, 0)`}static generateWindBarb(e,a,o=null){const s=Math.round(a),l=40,c=40,d=l/2,f=c/2,p=20,y=(typeof o=="number"&&!isNaN(o)?o>=0:!0)?-1:1;let v=Math.floor(s/50),M=s%50,b=Math.floor(M/10),S=Math.floor(M%10/5);s<5?(b=0,S=0):s<10&&S>0&&(S=1);let P=`<svg width="${l}" height="${c}" viewBox="0 0 ${l} ${c}">`;const x=e+180;P+=`<g transform="translate(${d}, ${f}) rotate(${x})">`,P+=`<line x1="0" y1="${p/2}" x2="0" y2="${-p/2}" stroke="black" stroke-width="1"/>`;let A=p/2;const N=4;for(let I=0;I<v;I++)P+=`<polygon points="0,${A-5} 0,${A+5} ${10*y},${A}" fill="black"/>`,A-=N+5;for(let I=0;I<b;I++)P+=`<line x1="0" y1="${A}" x2="${10*y}" y2="${A}" stroke="black" stroke-width="1"/>`,A-=N;return S>0&&(P+=`<line x1="0" y1="${A}" x2="${5*y}" y2="${A}" stroke="black" stroke-width="1"/>`),s<5&&(P+='<circle cx="0" cy="0" r="3" fill="none" stroke="black" stroke-width="1"/>'),P+="</g></svg>",P}},Ks(_t,"locationCache",new Map),_t);window.Utils=T;const ne={dbName:"SkydivingTileCache",storeName:"tiles",db:null,async init(){return new Promise((n,e)=>{const a=indexedDB.open(this.dbName,1);a.onupgradeneeded=o=>{o.target.result.createObjectStore(this.storeName,{keyPath:"url"})},a.onsuccess=o=>{this.db=o.target.result,n()},a.onerror=o=>{console.error("IndexedDB initialization failed:",o),e(o)}})},async storeTile(n,e){return this.db||await this.init(),new Promise((a,o)=>{const c=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({url:n,blob:e,timestamp:Date.now()});c.onsuccess=()=>{console.log(`Stored tile: ${n}`),a(!0)},c.onerror=d=>{console.warn(`Failed to store tile: ${n}`,d),T.handleError("Failed to store some tiles. Try clearing cache."),o(d)}})},async getTile(n){return this.db||await this.init(),new Promise((e,a)=>{const s=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),l=s.get(n);l.onsuccess=c=>{const d=c.target.result;if(d)e(d.blob);else{const f=[n.replace("https://tile.opentopomap.org","https://a.tile.opentopomap.org"),n.replace("https://tile.opentopomap.org","https://b.tile.opentopomap.org"),n.replace("https://tile.opentopomap.org","https://c.tile.opentopomap.org"),n.replace("https://tile.openstreetmap.org","https://a.tile.openstreetmap.org"),n.replace("https://tile.openstreetmap.org","https://b.tile.openstreetmap.org"),n.replace("https://tile.openstreetmap.org","https://c.tile.openstreetmap.org"),n.replace("https://basemaps.cartocdn.com","https://a.basemaps.cartocdn.com"),n.replace("https://basemaps.cartocdn.com","https://b.basemaps.cartocdn.com"),n.replace("https://basemaps.cartocdn.com","https://c.basemaps.cartocdn.com"),n.replace("https://basemaps.cartocdn.com","https://d.basemaps.cartocdn.com")];let p=null;for(const g of f){if(g===n)continue;const y=s.get(g);y.onsuccess=v=>{const M=v.target.result;M&&(p=M.blob,e(p))},y.onerror=()=>{}}setTimeout(()=>{p||e(null)},100)}},l.onerror=c=>{console.warn(`Failed to retrieve tile: ${n}`,c),a(c)}})},async clearCache(){return this.db||await this.init(),new Promise((n,e)=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onsuccess=()=>{console.log("Tile cache cleared"),n()},s.onerror=l=>{console.error("Failed to clear cache:",l),e(l)}})},async clearOldTiles(n=bi.MAX_AGE_DAYS){this.db||await this.init();const e=n*24*60*60*1e3;return new Promise((a,o)=>{const c=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).openCursor();let d=0,f=0;c.onsuccess=p=>{const g=p.target.result;if(g)Date.now()-g.value.timestamp>e&&(f+=g.value.blob.size||0,g.delete(),d++),g.continue();else{const y=f/1048576;console.log(`Cleared ${d} old tiles, freed ${y.toFixed(2)} MB`),a({deletedCount:d,deletedSizeMB:y})}},c.onerror=p=>{console.error("Failed to clear old tiles:",p),o(p)}})},async getCacheSize(){return this.db||await this.init(),new Promise((n,e)=>{const s=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).openCursor();let l=0,c=0;s.onsuccess=d=>{var p;const f=d.target.result;if(f)try{const g=((p=f.value.blob)==null?void 0:p.size)||0;typeof g!="number"||isNaN(g)?console.warn(`Invalid blob size for tile: ${f.value.url}, size: ${g}`):(l+=g,c++),f.continue()}catch(g){console.warn(`Error processing tile during size calculation: ${f.value.url}`,g),f.continue()}else{const g=l/1048576;console.log(`Cache size calculation completed: ${g.toFixed(2)} MB, ${c} tiles`),n(g)}},s.onerror=d=>{console.error("Failed to calculate cache size:",d),e(d)}})},async migrateTiles(){return this.db||await this.init(),new Promise((n,e)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),s=o.openCursor();let l=0;s.onsuccess=c=>{const d=c.target.result;if(d){const{url:f,blob:p,timestamp:g}=d.value,y=f.replace(/^(https?:\/\/[a-c]\.tile\.openstreetmap\.org)/,"https://tile.openstreetmap.org").replace(/^(https?:\/\/[a-d]\.basemaps\.cartocdn\.com)/,"https://basemaps.cartocdn.com").replace(/^(https?:\/\/[a-c]\.tile\.opentopomap\.org)/,"https://tile.opentopomap.org");f!==y&&(d.delete(),o.put({url:y,blob:p,timestamp:g}),l++),d.continue()}else console.log(`Migrated ${l} tiles to normalized URLs`),n()},s.onerror=c=>{console.error("Failed to migrate tiles:",c),e(c)}})}};K.TileLayer.Cached=K.TileLayer.extend({createTile(n,e){const a=document.createElement("img");K.DomEvent.on(a,"load",()=>{console.log("Tile loaded:",this.getTileUrl(n)),e(null,a)}),K.DomEvent.on(a,"error",()=>{console.warn("Tile error:",this.getTileUrl(n)),e(new Error("Failed to load tile"),a)});const o=this.getTileUrl(n);a.setAttribute("role","presentation");const s=o.replace(/^(https?:\/\/[a-c]\.tile\.openstreetmap\.org)/,"https://tile.openstreetmap.org").replace(/^(https?:\/\/[a-d]\.basemaps\.cartocdn\.com)/,"https://basemaps.cartocdn.com").replace(/^(https?:\/\/[a-c]\.tile\.opentopomap\.org)/,"https://tile.opentopomap.org");return!navigator.onLine&&(n.z<11||n.z>14)?(console.log(`Skipping tile request outside cached zoom levels (11–14): ${o}`),T.handleError("Offline: Zoom restricted to levels 11–14 for cached tiles."),e(new Error("Zoom level not cached"),a),a):(navigator.onLine?(a.src=o,fetch(o,{signal:AbortSignal.timeout(bi.FETCH_TIMEOUT_MS)}).then(l=>{if(!l.ok)throw new Error(`HTTP ${l.status}`);return l.blob()}).then(l=>{ne.storeTile(s,l).catch(c=>console.warn("Failed to cache tile during rendering:",s,c))}).catch(l=>{console.warn("Fetch error for tile during rendering:",o,l),ne.getTile(s).then(c=>{c?(a.src=URL.createObjectURL(c),console.log(`Tile loaded from cache (fallback): ${s}`)):e(l,a)}).catch(c=>{console.warn("Cache fallback error:",s,c),e(c,a)})})):ne.getTile(s).then(l=>{l?(a.src=URL.createObjectURL(l),console.log(`Tile loaded from cache: ${s}`)):(console.warn(`Tile not in cache: ${s}`),T.handleError("This area is not cached. Please cache more tiles while online."),e(new Error("Tile not in cache"),a))}).catch(l=>{console.warn("Cache error for offline tile:",s,l),T.handleError("This area is not cached. Please cache more tiles while online."),e(l,a)}),a)}});K.tileLayer.cached=function(n,e){return new K.TileLayer.Cached(n,e)};function Bd(n,e,a,o,s){if(!s)return console.warn("Map not initialized, cannot calculate tiles"),[];const l=new Set,c=40075016686e-3,d=a*1e3;return o.forEach(f=>{const p=s.project([n,e],f),g=256,y=p.x/g,v=p.y/g,M=n*Math.PI/180,b=c*Math.cos(M)/(g*Math.pow(2,f)),S=Math.ceil(d/(b*g))+1,P=Math.pow(2,f);for(let x=Math.floor(y-S);x<=Math.ceil(y+S);x++)for(let A=Math.floor(v-S);A<=Math.ceil(v+S);A++)x>=0&&x<P&&A>=0&&A<P&&l.add(`${f}/${x}/${A}`)}),Array.from(l).map(f=>{const[p,g,y]=f.split("/").map(Number);return{zoom:p,x:g,y}})}async function Yl(n,e=3){let a=null;for(let o=1;o<=e;o++){try{const s=new AbortController,l=setTimeout(()=>s.abort(),bi.FETCH_TIMEOUT_MS),c=await fetch(n,{signal:s.signal});if(clearTimeout(l),c.ok)return{success:!0,blob:await c.blob()};console.warn(`Attempt ${o} failed for ${n}: HTTP ${c.status}`),a=new Error(`HTTP ${c.status}`)}catch(s){console.warn(`Attempt ${o} error for ${n}: ${s.message}`),a=s,s.name==="AbortError"&&console.warn(`Fetch timeout after 15s for ${n}`)}o<e&&await new Promise(s=>setTimeout(s,1e3))}return{success:!1,error:a}}async function Ud({map:n,lastLat:e,lastLng:a,baseMaps:o}){if(!n){console.warn("Map not initialized, cannot cache tiles"),ye("Map not initialized, cannot cache tiles.");return}if(console.log("cacheTilesForDIP called with:",{lastLat:e,lastLng:a,cacheRadiusKm:_.state.userSettings.cacheRadiusKm,cacheZoomLevels:_.state.userSettings.cacheZoomLevels}),!e||!a){console.warn("No DIP coordinates for caching, skipping"),ye("Please select a location to cache map tiles.");return}if(!_.state.userSettings.baseMaps||!o[_.state.userSettings.baseMaps]){console.warn(`Base map ${_.state.userSettings.baseMaps} not found, skipping caching`),ye("Selected base map not available for caching.");return}const s=_.state.userSettings.cacheRadiusKm||_.defaultSettings.cacheRadiusKm,l=_.state.userSettings.cacheZoomLevels||_.defaultSettings.cacheZoomLevels,c=Bd(e,a,s,l,n);console.log(`Caching ${c.length} tiles for DIP:`,{lat:e,lng:a,radiusKm:s,zoomLevels:l,baseMap:_.state.userSettings.baseMaps});const d=[];if(_.state.userSettings.baseMaps==="Esri Satellite + OSM")d.push({name:"Esri Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",normalizedUrl:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{name:"OSM Overlay",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],normalizedUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"});else{const v=o[_.state.userSettings.baseMaps];d.push({name:_.state.userSettings.baseMaps,url:v.options.url||v._url,subdomains:v.options.subdomains,normalizedUrl:(v.options.url||v._url).replace(/{s}\./,"")})}let f=0,p=0;const g=c.length*d.length,y=[];u.isCachingCancelled=!1,console.log("Calling displayProgress with initial values:",{cachedCount:f,failedCount:p,totalTiles:g}),va(f+p,g,()=>{u.isCachingCancelled=!0});try{for(const v of d){if(console.log("Processing layer:",v.name),u.isCachingCancelled){console.log("Caching cancelled by user");break}const M=c.map(async(b,S)=>{if(u.isCachingCancelled){console.log("Caching cancelled during tile processing");return}const P=v.url.replace("{z}",b.zoom).replace("{x}",b.x).replace("{y}",b.y).replace("{s}",v.subdomains?v.subdomains[Math.floor(Math.random()*v.subdomains.length)]:""),x=v.normalizedUrl.replace("{z}",b.zoom).replace("{x}",b.x).replace("{y}",b.y);if(console.log(`Processing tile ${S+1}/${c.length} for layer ${v.name}:`,{url:P,normalizedUrl:x}),await ne.getTile(x).catch(I=>(console.error(`Error retrieving tile from cache: ${x}`,I),null)))f++,console.log(`Tile ${S+1} already in cache`);else{const I=await Yl(P);I.success?await ne.storeTile(x,I.blob).catch(U=>(console.error(`Error storing tile: ${x}`,U),!1))?(f++,console.log(`Tile ${S+1} cached successfully`)):(p++,y.push(P),console.log(`Tile ${S+1} failed to store`)):(p++,y.push(P),console.log(`Tile ${S+1} failed to fetch:`,I.error.message))}const N=f+p;((S+1)%10===0||S===c.length-1)&&(console.log("Updating progress:",{currentCount:N,totalTiles:g}),va(N,g,()=>{u.isCachingCancelled=!0}))});console.log(`Processing batch of ${c.length} tiles for layer ${v.name}`);for(let b=0;b<M.length;b+=20){if(u.isCachingCancelled){console.log("Caching cancelled during batch processing");break}const S=M.slice(b,b+20);await Promise.all(S).catch(P=>{console.error("Error processing batch of tiles:",P)}),console.log(`Completed batch ${b/20+1} for layer ${v.name}`)}}}catch(v){console.error("Unexpected error in cacheTilesForDIP:",v),T.handleError("Failed to cache map tiles: "+v.message)}finally{console.log("Hiding progress bar"),Vl()}y.length>0&&console.warn(`Failed to cache ${y.length} tiles:`,y),console.log(`DIP caching complete: ${f} tiles cached, ${p} failed`),u.isCachingCancelled?ye(`Caching cancelled: ${f} tiles cached, ${p} failed.`):p>0?ye(`Cached ${f} tiles around DIP (${p} failed). Pan or zoom to cache more tiles.`):ye(`Cached ${f} tiles around DIP successfully.`);try{const v=await ne.getCacheSize();console.log(`Cache size after DIP caching: ${v.toFixed(2)} MB`),v>bi.SIZE_LIMIT_MB_WARNING&&T.handleError(`Cache size large (${v.toFixed(2)} MB). Consider clearing cache to free up space.`)}catch(v){console.error("Failed to check cache size after DIP caching:",v),T.handleError("Unable to check cache size. Consider clearing cache to free up space.")}}T.debounce(async({map:n,baseMaps:e})=>{if(!n||!navigator.onLine){console.log("Skipping visible tile caching: offline or map not initialized");return}const a=n.getBounds(),o=n.getZoom(),s=_.state.userSettings.cacheZoomLevels||_.defaultSettings.cacheZoomLevels;if(!s.includes(o)){console.log(`Skipping caching: zoom ${o} not in cacheZoomLevels`,s);return}const l=256,c=n.project(a.getSouthWest(),o),d=n.project(a.getNorthEast(),o),f=Math.floor(c.x/l),p=Math.floor(d.x/l),g=Math.floor(d.y/l),y=Math.floor(c.y/l),v=[];for(let A=f;A<=p;A++)for(let N=g;N<=y;N++){const I=2**o;A>=0&&A<I&&N>=0&&N<I&&v.push({zoom:o,x:A,y:N})}console.log(`Caching ${v.length} visible tiles at zoom ${o} for ${_.state.userSettings.baseMaps}`);const M=[];if(!e[_.state.userSettings.baseMaps]){console.warn(`Base map ${_.state.userSettings.baseMaps} not found, skipping caching`),ye("Selected base map not available for caching.");return}if(_.state.userSettings.baseMaps==="Esri Satellite + OSM")M.push({name:"Esri Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",normalizedUrl:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{name:"OSM Overlay",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],normalizedUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"});else{const A=e[_.state.userSettings.baseMaps];M.push({name:_.state.userSettings.baseMaps,url:A.options.url||A._url,subdomains:A.options.subdomains,normalizedUrl:(A.options.url||A._url).replace(/{s}\./,"")})}let b=0,S=0;const P=v.length*M.length,x=[];u.isCachingCancelled=!1,va(b+S,P,()=>{u.isCachingCancelled=!0});for(const A of M){if(u.isCachingCancelled){console.log("Visible tile caching cancelled by user");break}const N=v.map(async(I,B)=>{if(u.isCachingCancelled)return;const U=A.url.replace("{z}",I.zoom).replace("{x}",I.x).replace("{y}",I.y).replace("{s}",A.subdomains?A.subdomains[Math.floor(Math.random()*A.subdomains.length)]:""),$=A.normalizedUrl.replace("{z}",I.zoom).replace("{x}",I.x).replace("{y}",I.y);if(await ne.getTile($).catch(()=>null))b++;else{const O=await Yl(U);O.success&&await ne.storeTile($,O.blob).catch(()=>!1)?b++:(S++,x.push(U))}const C=b+S;((B+1)%10===0||B===v.length-1)&&va(C,P,()=>{u.isCachingCancelled=!0})});for(let I=0;I<N.length&&!u.isCachingCancelled;I+=20){const B=N.slice(I,I+20);await Promise.all(B)}}Vl(),x.length>0&&console.warn(`Failed to cache ${x.length} visible tiles:`,x),u.isCachingCancelled?ye(`Visible tile caching cancelled: ${b} tiles cached.`):ye("Visible map tiles cached.");try{const A=await ne.getCacheSize();console.log(`Cache size after visible tiles caching: ${A.toFixed(2)} MB`),A>bi.SIZE_LIMIT_MB_WARNING&&T.handleError(`Cache size large (${A.toFixed(2)} MB). Consider clearing cache to free up space.`)}catch(A){console.error("Failed to check cache size after visible tiles caching:",A),T.handleError("Unable to check cache size. Consider clearing cache to free up space.")}},1e3);(function(n){if(typeof define=="function"&&define.amd)define(["leaflet"],n);else if(typeof zo<"u")zo.exports=n(require("leaflet"));else{if(typeof window.L>"u")throw new Error("Leaflet must be loaded first");n(window.L)}})(function(n){var e="polyline-measure-control",a="polyline-measure-unicode-icon",o=navigator.platform==="MacIntel";return n.Control.PolylineMeasure=n.Control.extend({options:{position:"topleft",unit:"kilometres",useSubunits:!0,clearMeasurementsOnStop:!0,showBearings:!1,bearingTextIn:"In",bearingTextOut:"Out",tooltipTextFinish:"Click to <b>finish line</b><br>",tooltipTextDelete:"Press SHIFT-key and click to <b>delete point</b>",tooltipTextMove:"Click and drag to <b>move point</b><br>",tooltipTextResume:"<br>Press "+(o?"⌘":"CTRL-key")+" and click to <b>resume line</b>",tooltipTextAdd:"Press "+(o?"⌘":"CTRL-key")+" and click to <b>add point</b>",measureControlTitleOn:"Turn on PolylineMeasure",measureControlTitleOff:"Turn off PolylineMeasure",measureControlLabel:"&#8614;",measureControlClasses:[],showClearControl:!1,clearControlTitle:"Clear Measurements",clearControlLabel:"&times;",clearControlClasses:[],showUnitControl:!1,unitControlUnits:["kilometres","landmiles","nauticalmiles"],unitControlTitle:{text:"Change Units",kilometres:"kilometres",landmiles:"land miles",nauticalmiles:"nautical miles"},unitControlLabel:{metres:"m",kilometres:"km",feet:"ft",landmiles:"mi",nauticalmiles:"nm"},unitControlClasses:[],tempLine:{color:"#00f",weight:2},fixedLine:{color:"#006",weight:2},arrow:{color:"#000"},startCircle:{color:"#000",weight:1,fillColor:"#0f0",fillOpacity:1,radius:3},intermedCircle:{color:"#000",weight:1,fillColor:"#ff0",fillOpacity:1,radius:3},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:6},endCircle:{color:"#000",weight:1,fillColor:"#f00",fillOpacity:1,radius:3}},_arcpoints:99,_circleNr:-1,_lineNr:-1,_createControl:function(s,l,c,d,f,p){var g=document.createElement("a");return g.innerHTML=s,g.setAttribute("title",l),c.forEach(function(y){g.classList.add(y)}),n.DomEvent.on(g,"click",f,p),d.appendChild(g),g},onAdd:function(s){var l=this;s.on("movestart ",function(){l._mapdragging=!0}),this._container=document.createElement("div"),this._container.classList.add("leaflet-bar"),n.DomEvent.disableClickPropagation(this._container);var c=this.options.measureControlTitleOn,d=this.options.measureControlLabel,f=this.options.measureControlClasses;if(d.indexOf("&")!=-1&&f.push(a),this._arrPolylines=[],this._measureControl=this._createControl(d,c,f,this._container,this._toggleMeasure,this),this._defaultControlBgColor=this._measureControl.style.backgroundColor,this._measureControl.setAttribute("id",e),this.options.showClearControl){var c=this.options.clearControlTitle,d=this.options.clearControlLabel,f=this.options.clearControlClasses;d.indexOf("&")!=-1&&f.push(a),this._clearMeasureControl=this._createControl(d,c,f,this._container,this._clearAllMeasurements,this),this._clearMeasureControl.classList.add("polyline-measure-clearControl")}if(this.options.showUnitControl&&this.options.unitControlUnits.length>1){var d=this.options.unitControlLabel[this.options.unit],c=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle[this.options.unit]+"]",f=this.options.unitControlClasses;this._unitControl=this._createControl(d,c,f,this._container,this._changeUnit,this),this._unitControl.setAttribute("id","unitControlId")}return this._container},onRemove:function(){this._measuring&&this._toggleMeasure()},_saveNonpolylineEvents:function(){this._nonpolylineTargets=this._map._targets,typeof this._polylineTargets<"u"?this._map._targets=this._polylineTargets:this._map._targets={}},_savePolylineEvents:function(){this._polylineTargets=this._map._targets,this._map._targets=this._nonpolylineTargets},_toggleMeasure:function(){this._measuring=!this._measuring,this._measuring?(this._mapdragging=!1,this._saveNonpolylineEvents(),this._measureControl.classList.add("polyline-measure-controlOnBgColor"),this._measureControl.style.backgroundColor=this.options.backgroundColor,this._measureControl.title=this.options.measureControlTitleOff,this._oldCursor=this._map._container.style.cursor,this._map._container.style.cursor="crosshair",this._doubleClickZoom=this._map.doubleClickZoom.enabled(),this._map.doubleClickZoom.disable(),this._layerPaint||(this._layerPaint=n.layerGroup().addTo(this._map)),this._map.on("mousemove",this._mouseMove,this),this._map.on("click",this._mouseClick,this),n.DomEvent.on(document,"keydown",this._onKeyDown,this),this._resetPathVariables()):(this._savePolylineEvents(),this._measureControl.classList.remove("polyline-measure-controlOnBgColor"),this._measureControl.style.backgroundColor=this._defaultControlBgColor,this._measureControl.title=this.options.measureControlTitleOn,this._map._container.style.cursor=this._oldCursor,this._map.off("mousemove",this._mouseMove,this),this._map.off("click",this._mouseClick,this),this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._map.off("mousemove",this._dragCircleMousemove,this),this._map.off("mouseup",this._dragCircleMouseup,this),n.DomEvent.off(document,"keydown",this._onKeyDown,this),this._doubleClickZoom&&this._map.doubleClickZoom.enable(),this.options.clearMeasurementsOnStop&&this._layerPaint&&this._clearAllMeasurements(),this._cntCircle!==0&&this._finishPolylinePath()),this._map.fire("polylinemeasure:toggle",{status:this._measuring})},_clearAllMeasurements:function(){this._cntCircle!==void 0&&this._cntCircle!==0&&this._finishPolylinePath(),this._layerPaint&&this._layerPaint.clearLayers(),this._arrPolylines=[],this._map.fire("polylinemeasure:clear")},_changeUnit:function(){let l=(this.options.unitControlUnits.indexOf(this.options.unit)+1)%this.options.unitControlUnits.length;this.options.unit=this.options.unitControlUnits[l],this._unitControl.innerHTML=this.options.unitControlLabel[this.options.unit],this._unitControl.title=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle[this.options.unit]+"]",this._currentLine&&this._computeDistance(this._currentLine),this._arrPolylines.map(this._computeDistance.bind(this))},_computeDistance:function(s){var l=0;s.circleCoords.map((function(c,d){if(d>=1){var f=s.circleCoords[d-1].distanceTo(s.circleCoords[d]);l+=f,this._updateTooltip(s.tooltips[d],s.tooltips[d-1],l,f,s.circleCoords[d-1],s.circleCoords[d])}}).bind(this))},_onKeyDown:function(s){if(s.keyCode===27){if(this._resumeFirstpointFlag===!0){this._resumeFirstpointFlag=!1;var l=this._lineNr;this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._layerPaint.removeLayer(this._rubberlinePath2),this._layerPaint.removeLayer(this._tooltipNew),this._arrPolylines[l].circleMarkers[0].setStyle(this.options.startCircle);var c="",d=0;this.options.showBearings===!0&&(c=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),c=c+'<div class="polyline-measure-tooltip-difference">+0</div>',c=c+'<div class="polyline-measure-tooltip-total">0</div>',this._arrPolylines[l].tooltips[0]._icon.innerHTML=c,this._arrPolylines[l].tooltips.map((function(f,p){if(p>=1){var g=this._arrPolylines[l].circleCoords[p-1].distanceTo(this._arrPolylines[l].circleCoords[p]),y=this._arrPolylines[l].circleCoords[p-1],v=this._arrPolylines[l].circleCoords[p];d+=g;var M=this._arrPolylines[l].tooltips[p-1];this._updateTooltip(f,M,d,g,y,v)}}).bind(this)),this._map.on("mousemove",this._mouseMove,this);return}this._currentLine?this._finishPolylinePath(s):this._toggleMeasure()}},_getDistance:function(s){var l=s,c;return this.options.unit==="nauticalmiles"?(c=this.options.unitControlLabel.nauticalmiles,l>=185200?l=(l/1852).toFixed(0):l>=18520?l=(l/1852).toFixed(1):l>=1852?l=(l/1852).toFixed(2):l=(l/1852).toFixed(3)):this.options.unit==="landmiles"?(c=this.options.unitControlLabel.landmiles,l>=160934.4?l=(l/1609.344).toFixed(0):l>=16093.44?l=(l/1609.344).toFixed(1):l>=1609.344?l=(l/1609.344).toFixed(2):this.options.useSubunits?(l=(l/.3048).toFixed(0),c=this.options.unitControlLabel.feet):l=(l/1609.344).toFixed(4)):(c=this.options.unitControlLabel.kilometres,l>=1e5?l=(l/1e3).toFixed(0):l>=1e4?l=(l/1e3).toFixed(1):l>=1e3?l=(l/1e3).toFixed(2):this.options.useSubunits?(l=l.toFixed(1),c=this.options.unitControlLabel.metres):l=(l/1e3).toFixed(4)),{value:l,unit:c}},_polylineArc:function(s,l){function c(b){var S=Math.sin((1-b)*v)/Math.sin(v),P=Math.sin(b*v)/Math.sin(v),x=S*Math.cos(f)*Math.cos(p)+P*Math.cos(g)*Math.cos(y),A=S*Math.cos(f)*Math.sin(p)+P*Math.cos(g)*Math.sin(y),N=S*Math.sin(f)+P*Math.sin(g),I=180/Math.PI*Math.atan2(N,Math.sqrt(Math.pow(x,2)+Math.pow(A,2))),B=180/Math.PI*Math.atan2(A,x),U=B-p*180/Math.PI;function $(k){return Math[k>0?"floor":"ceil"](k)}return U<0?B=B-$((U-180)/360)*360:B=B-$((U+180)/360)*360,[I,B]}function d(b){for(var S=[],P=1/(b-1),x=0;x<b;x++){var A=P*x,N=c(A);S.push(N)}return S}var f=s.lat,p=s.lng,g=l.lat,y=l.lng;f=f*Math.PI/180,p=p*Math.PI/180,g=g*Math.PI/180,y=y*Math.PI/180;var v=2*Math.asin(Math.sqrt(Math.pow(Math.sin((f-g)/2),2)+Math.cos(f)*Math.cos(g)*Math.pow(Math.sin((p-y)/2),2))),M;return v===0?M=[[f,p]]:M=d(this._arcpoints),M},_updateTooltip:function(s,l,c,d,f,p){var g=function(N,I,B){var U=N.lat/180*Math.PI,$=I.lat/180*Math.PI,k=N.lng/180*Math.PI,C=I.lng/180*Math.PI,O=Math.sin(C-k)*Math.cos($),F=Math.cos(U)*Math.sin($)-Math.sin(U)*Math.cos($)*Math.cos(C-k);if(B==="inbound")var z=(Math.atan2(O,F)*180/Math.PI+180).toFixed(0);else var z=(Math.atan2(O,F)*180/Math.PI+360).toFixed(0);return z%360},y=g(p,f,"inbound"),v=g(f,p,"outbound"),M=this._getDistance(c),b=this._getDistance(d),S="";if(b.value>0&&(this.options.showBearings===!0&&(S=this.options.bearingTextIn+": "+y+"°<br>"+this.options.bearingTextOut+":---°"),S+='<div class="polyline-measure-tooltip-difference">+'+b.value+"&nbsp;"+b.unit+"</div>"),S+='<div class="polyline-measure-tooltip-total">'+M.value+"&nbsp;"+M.unit+"</div>",s._icon.innerHTML=S,this.options.showBearings===!0&&l){var P=l._icon.innerHTML,x=new RegExp(this.options.bearingTextOut+".*°"),A=P.replace(x,this.options.bearingTextOut+": "+v+"°");l._icon.innerHTML=A}},_drawArrow:function(s){var l=Math.trunc(s.length/2);if(s.length%2==0)var c=s[l-1],d=s[l],f=d[1]-c[1],p=d[0]-c[0],g=[c[0]+p/2,c[1]+f/2];else var c=s[l-1],d=s[l+1],f=d[1]-c[1],p=d[0]-c[0],g=s[l];var y=-Math.atan2(p,f)*57.29578,v=n.divIcon({className:"",iconSize:[16,16],iconAnchor:[8,8],html:"<div style = 'color:"+this.options.arrow.color+"; font-size: 16px; line-height: 16px; vertical-align:top; transform: rotate("+y+"deg)'>&#x27a4;</div>"}),M=n.marker(g,{icon:v,zIndexOffset:-50}).addTo(this._layerPaint);return this._currentLine||M.bindTooltip(this.options.tooltipTextAdd,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),M.on("click",this._clickedArrow,this),M},_mouseMove:function(s){var l=s.latlng;if(this._map.on("click",this._mouseClick,this),!(!l||!this._currentLine)){var c=this._currentLine.circleCoords.last();this._rubberlinePath.setLatLngs(this._polylineArc(c,l));var d=this._currentLine.tooltips.last(),f=this._currentLine.tooltips.slice(-2,-1)[0];d.setLatLng(l);var p=l.distanceTo(c);this._updateTooltip(d,f,this._currentLine.distance+p,p,c,l)}},_startLine:function(s){var l=n.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),c=function(){return this.slice(-1)[0]};this._rubberlinePath=n.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack();var d=this;this._currentLine={id:0,circleCoords:[],circleMarkers:[],arrowMarkers:[],tooltips:[],distance:0,polylinePath:n.polyline([],{color:this.options.fixedLine.color,weight:this.options.fixedLine.weight,interactive:!1}).addTo(this._layerPaint).bringToBack(),handleMarkers:function(g){var y=this.circleMarkers.last();y&&(y.bindTooltip(d.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),y.off("click",d._finishPolylinePath,d),this.circleMarkers.length===1?y.setStyle(d.options.startCircle):y.setStyle(d.options.intermedCircle));var v=new n.CircleMarker(g,d.options.currentCircle).addTo(d._layerPaint);v.bindTooltip(d.options.tooltipTextFinish+d.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),v.cntLine=d._currentLine.id,v.cntCircle=d._cntCircle,d._cntCircle++,v.on("mousedown",d._dragCircle,d),v.on("click",d._finishPolylinePath,d),this.circleMarkers.push(v)},getNewToolTip:function(g){return n.marker(g,{icon:l,interactive:!1})},addPoint:function(g){var y=this.circleCoords.last();if(!(y&&y.equals(g))){if(this.circleCoords.push(g),this.circleCoords.length>1){var v=d._polylineArc(y,g),M=d._drawArrow(v);this.circleCoords.length>2&&v.shift(),this.polylinePath.setLatLngs(this.polylinePath.getLatLngs().concat(v)),M.cntLine=d._currentLine.id,M.cntArrow=d._cntCircle-1,d._currentLine.arrowMarkers.push(M);var b=y.distanceTo(g);this.distance+=b;var S=d._currentLine.tooltips.last(),P=d._currentLine.tooltips.slice(-1,-2)[0];d._updateTooltip(S,P,this.distance,b,y,g)}S&&S.setLatLng(g);var x=this.getNewToolTip(g);x.addTo(d._layerPaint),this.tooltips.push(x),this.handleMarkers(g)}},finalize:function(){if(d._layerPaint.removeLayer(this.tooltips.last()),this.tooltips.pop(),d._layerPaint.removeLayer(d._rubberlinePath),this.circleCoords.length>1){this.tooltips.last()._icon.classList.add("polyline-measure-tooltip-end");var g=this.circleMarkers.last();g.setStyle(d.options.endCircle),g.unbindTooltip(),d._currentLine.circleMarkers.map(function(y){y.bindTooltip(d.options.tooltipTextMove+d.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"})}),d._currentLine.circleMarkers[0].bindTooltip(d.options.tooltipTextMove+d.options.tooltipTextDelete+d.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),g.bindTooltip(d.options.tooltipTextMove+d.options.tooltipTextDelete+d.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),d._currentLine.arrowMarkers.map(function(y){y.bindTooltip(d.options.tooltipTextAdd,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"})}),g.off("click",d._finishPolylinePath,d),g.on("click",d._resumePolylinePath,d),d._arrPolylines[this.id]=this}else d._layerPaint.removeLayer(this.circleMarkers.last()),d._layerPaint.removeLayer(this.tooltips.last());d._resetPathVariables()}};var f=n.marker(s,{icon:l,interactive:!1});f.addTo(this._layerPaint);var p="";this.options.showBearings===!0&&(p=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),p=p+'<div class="polyline-measure-tooltip-difference">+0</div>',p=p+'<div class="polyline-measure-tooltip-total">0</div>',f._icon.innerHTML=p,this._currentLine.tooltips.push(f),this._currentLine.circleCoords.last=c,this._currentLine.tooltips.last=c,this._currentLine.circleMarkers.last=c,this._currentLine.id=this._arrPolylines.length},_mouseClick:function(s){!s.latlng||this._finishCircleScreencoords&&this._finishCircleScreencoords.equals(s.containerPoint)||(!this._currentLine&&!this._mapdragging&&(this._startLine(s.latlng),this._map.fire("polylinemeasure:start",this._currentLine)),this._mapdragging?this._mapdragging=!1:(this._currentLine.addPoint(s.latlng),this._map.fire("polylinemeasure:add",s),this._map.fire("polylinemeasure:change",this._currentLine)))},_finishPolylinePath:function(s){this._map.fire("polylinemeasure:finish",this._currentLine),this._currentLine.finalize(),s&&(this._finishCircleScreencoords=s.containerPoint)},_resumePolylinePath:function(s){if(s.originalEvent.ctrlKey===!0||s.originalEvent.metaKey===!0){this._currentLine=this._arrPolylines[s.target.cntLine],this._rubberlinePath=n.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack(),this._currentLine.tooltips.last()._icon.classList.remove("polyline-measure-tooltip-end");var l=this._currentLine.getNewToolTip(s.latlng);l.addTo(this._layerPaint),this._currentLine.tooltips.push(l),this._currentLine.circleMarkers.last().unbindTooltip(),this._currentLine.circleMarkers.last().bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.circleMarkers.last().setStyle(this.options.currentCircle),this._cntCircle=this._currentLine.circleCoords.length,this._map.fire("polylinemeasure:resume",this._currentLine)}},_resetPathVariables:function(){this._cntCircle=0,this._currentLine=null},_clickedArrow:function(s){if(s.originalEvent.ctrlKey||s.originalEvent.metaKey){var l=s.target.cntLine,c=s.target.cntArrow;this._arrPolylines[l].arrowMarkers[c].removeFrom(this._layerPaint);var d=new n.CircleMarker(s.latlng,this.options.intermedCircle).addTo(this._layerPaint);d.cntLine=l,d.on("mousedown",this._dragCircle,this),d.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[l].circleMarkers.splice(c+1,0,d),this._arrPolylines[l].circleMarkers.map(function(M,b){M.cntCircle=b}),this._arrPolylines[l].circleCoords.splice(c+1,0,s.latlng);var f=this._arrPolylines[l].polylinePath.getLatLngs(),p=this._polylineArc(this._arrPolylines[l].circleCoords[c],s.latlng);p.pop();var g=this._polylineArc(s.latlng,this._arrPolylines[l].circleCoords[c+2]);Array.prototype.splice.apply(f,[c*(this._arcpoints-1),this._arcpoints].concat(p,g)),this._arrPolylines[l].polylinePath.setLatLngs(f);var y=this._drawArrow(p);this._arrPolylines[l].arrowMarkers[c]=y,y=this._drawArrow(g),this._arrPolylines[l].arrowMarkers.splice(c+1,0,y),this._arrPolylines[l].arrowMarkers.map(function(M,b){M.cntLine=l,M.cntArrow=b}),this._tooltipNew=n.marker(s.latlng,{icon:n.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),interactive:!1}),this._tooltipNew.addTo(this._layerPaint),this._arrPolylines[l].tooltips.splice(c+1,0,this._tooltipNew);var v=0;this._arrPolylines[l].tooltips.map((function(M,b){if(b>=1){var S=this._arrPolylines[l].circleCoords[b-1].distanceTo(this._arrPolylines[l].circleCoords[b]),P=this._arrPolylines[l].circleCoords[b-1],x=this._arrPolylines[l].circleCoords[b];v+=S;var A=this._arrPolylines[l].tooltips[b-1];this._updateTooltip(M,A,v,S,P,x)}}).bind(this)),this._map.fire("polylinemeasure:insert",s),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])}},_dragCircleMouseup:function(){this._circleNr===0||this._circleNr===this._arrPolylines[this._lineNr].circleCoords.length-1?this._e1.target.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}):this._e1.target.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._resetPathVariables(),this._map.off("mousemove",this._dragCircleMousemove,this),this._map.dragging.enable(),this._map.on("mousemove",this._mouseMove,this),this._map.off("mouseup",this._dragCircleMouseup,this),this._map.fire("polylinemeasure:move",this._e1),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])},_dragCircleMousemove:function(s){var l=s.latlng.lat,c=s.latlng.lng,d=l-this._mouseStartingLat,f=c-this._mouseStartingLng,p=n.latLng(this._circleStartingLat+d,this._circleStartingLng+f),g=this._arcpoints,y=this._e1.target.cntLine;this._lineNr=y;var v=this._e1.target.cntCircle;this._circleNr=v,this._e1.target.setLatLng(p),this._e1.target.unbindTooltip(),this._arrPolylines[y].circleCoords[v]=p;var M=this._arrPolylines[y].polylinePath.getLatLngs();if(v>=1){var b=this._polylineArc(this._arrPolylines[y].circleCoords[v-1],p);Array.prototype.splice.apply(M,[(v-1)*(g-1),g].concat(b));var S=this._drawArrow(b);S.cntLine=y,S.cntArrow=v-1,this._arrPolylines[y].arrowMarkers[v-1].removeFrom(this._layerPaint),this._arrPolylines[y].arrowMarkers[v-1]=S}if(v<this._arrPolylines[y].circleCoords.length-1){var P=this._polylineArc(p,this._arrPolylines[y].circleCoords[v+1]);Array.prototype.splice.apply(M,[v*(g-1),g].concat(P)),S=this._drawArrow(P),S.cntLine=y,S.cntArrow=v,this._arrPolylines[y].arrowMarkers[v].removeFrom(this._layerPaint),this._arrPolylines[y].arrowMarkers[v]=S}this._arrPolylines[y].polylinePath.setLatLngs(M),v>=0&&this._arrPolylines[y].tooltips[v].setLatLng(p);var x=0;this._arrPolylines[y].tooltips.map((function(A,N){if(N>=1){var I=this._arrPolylines[y].circleCoords[N-1].distanceTo(this._arrPolylines[y].circleCoords[N]),B=this._arrPolylines[y].circleCoords[N-1],U=this._arrPolylines[y].circleCoords[N];x+=I,this._arrPolylines[y].distance=x;var $=this._arrPolylines[y].tooltips[N-1];this._updateTooltip(A,$,x,I,B,U)}}).bind(this)),this._map.on("mouseup",this._dragCircleMouseup,this)},_resumeFirstpointMousemove:function(s){var l=this._lineNr;this._map.on("click",this._resumeFirstpointClick,this);var c=s.latlng;this._rubberlinePath2.setLatLngs(this._polylineArc(c,currentCircleCoords)),this._tooltipNew.setLatLng(c);var d=0,f=c.distanceTo(this._arrPolylines[l].circleCoords[0]),p=c,g=this._arrPolylines[l].circleCoords[0];d+=f;var y=this._tooltipNew,v=this._arrPolylines[l].tooltips[0];this._updateTooltip(v,y,d,f,p,g),this._arrPolylines[l].tooltips.map((function(M,b){if(b>=1){var S=this._arrPolylines[l].circleCoords[b-1].distanceTo(this._arrPolylines[l].circleCoords[b]),P=this._arrPolylines[l].circleCoords[b-1],x=this._arrPolylines[l].circleCoords[b];d+=S;var A=this._arrPolylines[l].tooltips[b-1];this._updateTooltip(M,A,d,S,P,x)}}).bind(this))},_resumeFirstpointClick:function(s){var l=this._lineNr;this._resumeFirstpointFlag=!1,this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._layerPaint.removeLayer(this._rubberlinePath2),this._arrPolylines[l].circleMarkers[0].setStyle(this.options.intermedCircle),this._arrPolylines[l].circleMarkers[0].unbindTooltip(),this._arrPolylines[l].circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"});var c=new n.CircleMarker(s.latlng,this.options.startCircle).addTo(this._layerPaint);c.cntLine=l,c.cntCircle=0,c.on("mousedown",this._dragCircle,this),c.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[l].circleMarkers.unshift(c),this._arrPolylines[l].circleMarkers.map(function(p,g){p.cntCircle=g}),this._arrPolylines[l].circleCoords.unshift(s.latlng);var d=this._polylineArc(s.latlng,currentCircleCoords),f=this._drawArrow(d);this._arrPolylines[l].arrowMarkers.unshift(f),this._arrPolylines[l].arrowMarkers.map(function(p,g){p.cntLine=l,p.cntArrow=g}),d.pop(),this._arrPolylines[l].polylinePath.setLatLngs(d.concat(this._arrPolylines[l].polylinePath.getLatLngs())),this._arrPolylines[l].tooltips.unshift(this._tooltipNew),this._map.on("mousemove",this._mouseMove,this)},_dragCircle:function(s){var l=this._arcpoints;if(s.originalEvent.ctrlKey||s.originalEvent.metaKey){if(this._map.off("click",this._mouseClick,this),s.target.cntCircle===0){this._resumeFirstpointFlag=!0,this._lineNr=s.target.cntLine;var c=this._lineNr;this._circleNr=s.target.cntCircle,currentCircleCoords=s.latlng,this._arrPolylines[c].circleMarkers[0].setStyle(this.options.currentCircle),this._rubberlinePath2=n.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack(),this._tooltipNew=n.marker(currentCircleCoords,{icon:n.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),interactive:!1}),this._tooltipNew.addTo(this._layerPaint);var d="";this.options.showBearings===!0&&(d=d+this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),d=d+'<div class="polyline-measure-tooltip-difference">+0</div>',d=d+'<div class="polyline-measure-tooltip-total">0</div>',this._tooltipNew._icon.innerHTML=d,this._map.off("mousemove",this._mouseMove,this),this._map.on("mousemove",this._resumeFirstpointMousemove,this)}return}if(s.originalEvent.shiftKey){this._lineNr=s.target.cntLine;var c=this._lineNr;this._circleNr=s.target.cntCircle;var f=this._circleNr;if(this._layerPaint.hasLayer(this._rubberlinePath)&&c===this._currentLine.id){if(this._cntCircle--,this._currentLine.circleMarkers.length===1){this._currentLine.finalize();return}if(this._currentLine.circleCoords.splice(f,1),this._currentLine.circleMarkers[f].removeFrom(this._layerPaint),this._currentLine.circleMarkers.splice(f,1),this._currentLine.circleMarkers.map(function(S,P){S.cntCircle=P}),g=this._currentLine.polylinePath.getLatLngs(),this._currentLine.tooltips[f].removeFrom(this._layerPaint),this._currentLine.tooltips.splice(f,1),f===0){this._currentLine.circleMarkers.length===1?this._currentLine.circleMarkers[0].setStyle(this.options.currentCircle):this._currentLine.circleMarkers[0].setStyle(this.options.startCircle),g.splice(0,l-1),this._currentLine.circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.arrowMarkers[f].removeFrom(this._layerPaint),this._currentLine.arrowMarkers.splice(0,1);var d="";this.options.showBearings===!0&&(d=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),d=d+'<div class="polyline-measure-tooltip-difference">+0</div>',d=d+'<div class="polyline-measure-tooltip-total">0</div>',this._currentLine.tooltips[0]._icon.innerHTML=d}else f===this._currentLine.circleCoords.length?(this._currentLine.circleMarkers[f-1].on("click",this._resumePolylinePath,this),this._currentLine.circleMarkers[f-1].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.circleMarkers.slice(-1)[0].setStyle(this.options.currentCircle),g.splice(-(l-1),l-1),this._currentLine.arrowMarkers[f-1].removeFrom(this._layerPaint),this._currentLine.arrowMarkers.splice(-1,1)):(y=this._polylineArc(this._currentLine.circleCoords[f-1],this._currentLine.circleCoords[f]),Array.prototype.splice.apply(g,[(f-1)*(l-1),2*l-1].concat(y)),this._currentLine.arrowMarkers[f-1].removeFrom(this._layerPaint),this._currentLine.arrowMarkers[f].removeFrom(this._layerPaint),v=this._drawArrow(y),this._currentLine.arrowMarkers.splice(f-1,2,v));this._currentLine.polylinePath.setLatLngs(g),this._currentLine.arrowMarkers.map(function(S,P){S.cntLine=c,S.cntArrow=P});var p=0;this._currentLine.tooltips.map((function(S,P,x){if(P>=1){var A,N,I=this._currentLine.tooltips[P-1],B=this._currentLine.circleCoords[P-1];P===x.length-1?(A=this._currentLine.circleCoords[P-1].distanceTo(s.latlng),N=s.latlng,this._updateTooltip(S,I,p+A,A,B,N)):(A=this._currentLine.circleCoords[P-1].distanceTo(this._currentLine.circleCoords[P]),N=this._currentLine.circleCoords[P],p+=A,this._updateTooltip(S,I,p,A,B,N))}}).bind(this)),this._currentLine.distance=p}else{if(this._arrPolylines[c].circleMarkers.length===2){this._layerPaint.removeLayer(this._arrPolylines[c].circleMarkers[1]),this._layerPaint.removeLayer(this._arrPolylines[c].tooltips[1]),this._layerPaint.removeLayer(this._arrPolylines[c].circleMarkers[0]),this._layerPaint.removeLayer(this._arrPolylines[c].tooltips[0]),this._layerPaint.removeLayer(this._arrPolylines[c].arrowMarkers[0]),this._layerPaint.removeLayer(this._arrPolylines[c].polylinePath),this._map.fire("polylinemeasure:remove",s),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr]);return}this._arrPolylines[c].circleCoords.splice(f,1),this._arrPolylines[c].circleMarkers[f].removeFrom(this._layerPaint),this._arrPolylines[c].circleMarkers.splice(f,1),this._arrPolylines[c].circleMarkers.map(function(S,P){S.cntCircle=P});var g=this._arrPolylines[c].polylinePath.getLatLngs();if(this._arrPolylines[c].tooltips[f].removeFrom(this._layerPaint),this._arrPolylines[c].tooltips.splice(f,1),!this._arrPolylines[c].circleMarkers.length){this._arrPolylines.splice(c,1),this._arrPolylines.forEach(function(S,P){S.circleMarkers.map(function(x){x.cntLine=P}),S.arrowMarkers.map(function(x){x.cntLine=P})});return}if(f===0){this._arrPolylines[c].circleMarkers[0].setStyle(this.options.startCircle),g.splice(0,l-1),this._arrPolylines[c].circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[c].arrowMarkers[f].removeFrom(this._layerPaint),this._arrPolylines[c].arrowMarkers.splice(0,1);var d="";this.options.showBearings===!0&&(d=this.options.bearingTextIn+":---°<br>"+this.options.bearingTextOut+":---°"),d=d+'<div class="polyline-measure-tooltip-difference">+0</div>',d=d+'<div class="polyline-measure-tooltip-total">0</div>',this._arrPolylines[c].tooltips[0]._icon.innerHTML=d}else if(f===this._arrPolylines[c].circleCoords.length)this._arrPolylines[c].circleMarkers[f-1].on("click",this._resumePolylinePath,this),this._arrPolylines[c].circleMarkers[f-1].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[c].circleMarkers.slice(-1)[0].setStyle(this.options.endCircle),this._arrPolylines[c].tooltips.slice(-1)[0]._icon.classList.add("polyline-measure-tooltip-end"),g.splice(-(l-1),l-1),this._arrPolylines[c].arrowMarkers[f-1].removeFrom(this._layerPaint),this._arrPolylines[c].arrowMarkers.splice(-1,1);else{var y=this._polylineArc(this._arrPolylines[c].circleCoords[f-1],this._arrPolylines[c].circleCoords[f]);Array.prototype.splice.apply(g,[(f-1)*(l-1),2*l-1].concat(y)),this._arrPolylines[c].arrowMarkers[f-1].removeFrom(this._layerPaint),this._arrPolylines[c].arrowMarkers[f].removeFrom(this._layerPaint);var v=this._drawArrow(y);this._arrPolylines[c].arrowMarkers.splice(f-1,2,v)}this._arrPolylines[c].polylinePath.setLatLngs(g),this._arrPolylines[c].arrowMarkers.map(function(S,P){S.cntLine=c,S.cntArrow=P});var M=0;this._arrPolylines[c].tooltips.map((function(S,P){if(P>=1){var x=this._arrPolylines[c].circleCoords[P-1].distanceTo(this._arrPolylines[c].circleCoords[P]),A=this._arrPolylines[c].circleCoords[P-1],N=this._arrPolylines[c].circleCoords[P];M+=x,this._arrPolylines[c].distance=M;var I=this._arrPolylines[c].tooltips[P-1];this._updateTooltip(S,I,M,x,A,N)}}).bind(this))}this._map.fire("polylinemeasure:remove",s),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr]);return}this._e1=s,this._measuring&&this._cntCircle===0&&(this._map.dragging.disable(),this._map.off("mousemove",this._mouseMove,this),this._map.off("click",this._mouseClick,this),this._mouseStartingLat=s.latlng.lat,this._mouseStartingLng=s.latlng.lng,this._circleStartingLat=s.target._latlng.lat,this._circleStartingLng=s.target._latlng.lng,this._map.on("mousemove",this._dragCircleMousemove,this))},seed:function(s){s.forEach(l=>{this._toggleMeasure(),this._startLine(l[0]),l.forEach((c,d)=>{const f=n.latLng(c);this._mouseMove({latLng:f}),this._currentLine.addPoint(f),d===l.length-1&&(this._finishPolylinePath(),this._toggleMeasure())})})}}),n.Map.mergeOptions({PolylineMeasureControl:!1}),n.Map.addInitHook(function(){this.options.polylineMeasureControl&&(this.PMControl=new n.Control.PolylineMeasure,this.addControl(this.PMControl))}),n.control.polylineMeasure=function(s){return new n.Control.PolylineMeasure(s)},n.Control.PolylineMeasure});var Hd=15e3,No=1e3,Fo=60*No,ua=60*Fo,go=24*ua,Zd="http://www.topografix.com/GPX/gpx_style/0/2",la=new L.Icon.Default,Wd={startIcon:la,endIcon:la,wptIcons:{"":la},wptTypeIcons:{"":la},pointMatchers:[]},Gd={iconSize:[33,45],iconAnchor:[16,45],clickable:!1},Vd={color:"blue"},jd={parseElements:["track","route","waypoint"],joinTrackSegments:!0};L.GPX=L.FeatureGroup.extend({initialize:function(n,e){e.max_point_interval=e.max_point_interval||Hd,e.markers=this._merge_objs(Wd,e.markers||{}),e.marker_options=this._merge_objs(Gd,e.marker_options||{}),e.polyline_options=e.polyline_options||[],e.gpx_options=this._merge_objs(jd,e.gpx_options||{}),L.Util.setOptions(this,e),L.GPXTrackIcon=L.Icon.extend({options:e.marker_options}),this._gpx=n,this._layers={},this._prepare_markers(e.markers),this._init_info(),n&&this._parse(n,e,this.options.async)},get_duration_string:function(n,e){var a="";n>=go&&(a+=Math.floor(n/go)+"d ",n=n%go),n>=ua&&(a+=Math.floor(n/ua)+":",n=n%ua);var o=Math.floor(n/Fo);n=n%Fo,o<10&&(a+="0"),a+=o+"'";var s=Math.floor(n/No);return n=n%No,s<10&&(a+="0"),a+=s,!e&&n>0?a+="."+Math.round(Math.floor(n)*1e3)/1e3:a+='"',a},get_duration_string_iso:function(n,e){var a=this.get_duration_string(n,e);return a.replace("'",":").replace('"',"")},_toFixed_helper:function(n,e=0){return typeof n=="number"?n.toFixed(e):"?"},to_miles:function(n){return n/1.60934},to_ft:function(n){return n*3.28084},m_to_km:function(n){return n/1e3},m_to_mi:function(n){return n/1609.34},ms_to_kmh:function(n){return n*3.6},ms_to_mih:function(n){return n/1609.34*3600},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/(3600*1e3))},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/(3600*1e3))},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/(3600*1e3))},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/(3600*1e3))},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var n=this;return this._info.elevation._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(a,o){return n._toFixed_helper(a,2)+" km, "+n._toFixed_helper(o,0)+" m"})})},get_elevation_data_imp:function(){var n=this;return this._info.elevation._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,n.to_ft,function(a,o){return n._toFixed_helper(a,2)+" mi, "+n._toFixed_helper(o,0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_speed_data:function(){var n=this;return this._info.speed._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,n.ms_to_kmh,function(a,o){return n._toFixed_helper(a,2)+" km, "+n._toFixed_helper(o,2)+" km/h"})})},get_speed_data_imp:function(){var n=this;return this._info.speed._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,n.ms_to_mih,function(a,o){return n._toFixed_helper(a,2)+" mi, "+n._toFixed_helper(o,2)+" mi/h"})})},get_speed_max:function(){return this.m_to_km(this._info.speed.max)*3600},get_speed_max_imp:function(){return this.to_miles(this.get_speed_max())},get_average_hr:function(){return this._info.hr.avg},get_average_temp:function(){return this._info.atemp.avg},get_average_cadence:function(){return this._info.cad.avg},get_heartrate_data:function(){var n=this;return this._info.hr._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(a,o){return n._toFixed_helper(a,2)+" km, "+n._toFixed_helper(o,0)+" bpm"})})},get_heartrate_data_imp:function(){var n=this;return this._info.hr._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,null,function(a,o){return n._toFixed_helper(a,2)+" mi, "+n._toFixed_helper(o,0)+" bpm"})})},get_cadence_data:function(){var n=this;return this._info.cad._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(a,o){return n._toFixed_helper(a,2)+" km, "+n._toFixed_helper(o,0)+" rpm"})})},get_temp_data:function(){var n=this;return this._info.atemp._points.map(function(e){return n._prepare_data_point(e,n.m_to_km,null,function(a,o){return n._toFixed_helper(a,2)+" km, "+n._toFixed_helper(o,0)+" degrees"})})},get_cadence_data_imp:function(){var n=this;return this._info.cad._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,null,function(a,o){return n._toFixed_helper(a,2)+" mi, "+n._toFixed_helper(o,0)+" rpm"})})},get_temp_data_imp:function(){var n=this;return this._info.atemp._points.map(function(e){return n._prepare_data_point(e,n.m_to_mi,null,function(a,o){return n._toFixed_helper(a,2)+" mi, "+n._toFixed_helper(o,0)+" degrees"})})},reload:function(){this._init_info(),this.clearLayers(),this._parse(this._gpx,this.options,this.options.async)},_merge_objs:function(n,e){var a={};for(var o in n)a[o]=n[o];for(var o in e)a[o]=e[o];return a},_prepare_data_point:function(n,e,a,o){var s=[e&&e(n[0])||n[0],a&&a(n[1])||n[1]];return s.push(o&&o(s[0],s[1])||s[0]+": "+s[1]),s},_prepare_markers:function(n){function e(a){return new L.GPXTrackIcon({iconUrl:a})}return Object.entries(n).forEach(([a,o])=>{a==="wptIcons"||a==="wptTypeIcons"?n[a]=this._prepare_markers(o):a==="pointMatchers"?n[a]=o.map(s=>(typeof s.icon=="string"&&(s.icon=e(s.icon)),s)):typeof o=="string"?n[a]=e(o):typeof o=="object"&&o!==null&&(n[a]=o)}),n},_init_info:function(){this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},speed:{max:0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0},atemp:{avg:0,_total:0,_points:[]},cad:{avg:0,_total:0,_points:[]}}},_load_xml:function(n,e,a,o){o==null&&(o=this.options.async),a==null&&(a=this.options);var s=this,l=new window.XMLHttpRequest;l.open("GET",n,o);try{l.overrideMimeType("text/xml")}catch{}l.onloadend=function(){l.status==200?e(l.responseXML,a):s.fire("error",{err:"Error fetching resource: "+n})},l.send(null)},_parse:function(n,e,a){var o=this,s=function(c,d){var f=o._parse_gpx_data(c,d);if(!f){o.fire("error",{err:"No parseable layers of type(s) "+JSON.stringify(d.gpx_options.parseElements)});return}o.addLayer(f),o.fire("loaded",{layers:f,element:c})};if(n.substr(0,1)==="<"){var l=new DOMParser;a?setTimeout(function(){s(l.parseFromString(n,"text/xml"),e)}):s(l.parseFromString(n,"text/xml"),e)}else this._load_xml(n,s,e,a)},_parse_gpx_data:function(n,e){var a,o,s=[],l=n.getElementsByTagName("name");l.length>0&&(this._info.name=l[0].textContent);var c=n.getElementsByTagName("desc");c.length>0&&(this._info.desc=c[0].textContent);var d=n.getElementsByTagName("author");d.length>0&&(this._info.author=d[0].textContent);var f=n.getElementsByTagName("copyright");f.length>0&&(this._info.copyright=f[0].textContent);var p=e.gpx_options.parseElements;if(p.indexOf("route")>-1){var g=n.getElementsByTagName("rte");for(a=0;a<g.length;a++){var y=g[a],v=this._extract_styling(y),M=this._get_polyline_options(e.polyline_options,a);s=s.concat(this._parse_segment(g[a],e,v,M,"rtept"))}}if(p.indexOf("track")>-1){var b=n.getElementsByTagName("trk");for(a=0;a<b.length;a++){var S=b[a],v=this._extract_styling(S),M=this._get_polyline_options(e.polyline_options,a);if(e.gpx_options.joinTrackSegments)s=s.concat(this._parse_segment(S,e,v,M,"trkpt"));else{var P=S.getElementsByTagName("trkseg");for(z=0;z<P.length;z++)s=s.concat(this._parse_segment(P[z],e,v,M,"trkpt"))}}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),this._info.cad.avg=Math.round(this._info.cad._total/this._info.cad._points.length),this._info.atemp.avg=Math.round(this._info.atemp._total/this._info.atemp._points.length),p.indexOf("waypoint")>-1)for(o=n.getElementsByTagName("wpt"),a=0;a<o.length;a++){var x=new L.LatLng(o[a].getAttribute("lat"),o[a].getAttribute("lon")),A=o[a].getElementsByTagName("name"),l=A.length>0?A[0].textContent:"",N=o[a].getElementsByTagName("desc"),c=N.length>0?N[0].textContent:"",I=o[a].getElementsByTagName("sym"),B=I.length>0?I[0].textContent:null,U=o[a].getElementsByTagName("type"),$=U.length>0?U[0].textContent:null,k=e.markers.wptIcons,C=e.markers.wptTypeIcons,O=e.markers.pointMatchers||[],F;if(k&&B&&k[B])F=k[B];else if(C&&$&&C[$])F=C[$];else if(O.length>0){for(var z=0;z<O.length;z++)if(O[z].regex.test(l)){F=O[z].icon;break}}else k&&k[""]&&(F=k[""]);if(!F){console.log("No waypoint icon could be matched for symKey=%s,typeKey=%s,name=%s on waypoint %o",B,$,l,o[a]);continue}var W=new L.Marker(x,{clickable:e.marker_options.clickable,title:l,icon:F,type:"waypoint"});W.bindPopup("<b>"+l+"</b>"+(c.length>0?"<br>"+c:"")).openPopup(),this.fire("addpoint",{point:W,point_type:"waypoint",element:o[a]}),s.push(W)}if(s.length>1)return new L.FeatureGroup(s);if(s.length==1)return s[0]},_parse_segment:function(n,e,a,o,s){var l=n.getElementsByTagName(s);if(!l.length)return[];for(var c=[],d=[],f=[],p=null,g=0;g<l.length;g++){var y,v=new L.LatLng(l[g].getAttribute("lat"),l[g].getAttribute("lon"));v.meta={time:null,ele:null,hr:null,cad:null,atemp:null,speed:null},y=l[g].getElementsByTagName("time"),y.length>0?v.meta.time=new Date(Date.parse(y[0].textContent)):v.meta.time=new Date("1970-01-01T00:00:00");var M=p!=null?Math.abs(v.meta.time-p.meta.time):0;y=l[g].getElementsByTagName("ele"),y.length>0?v.meta.ele=parseFloat(y[0].textContent):v.meta.ele=p!=null?p.meta.ele:null;var b=p!=null?v.meta.ele-p.meta.ele:0,S=p!=null?this._dist3d(p,v):0;if(y=l[g].getElementsByTagName("speed"),y.length>0?v.meta.speed=parseFloat(y[0].textContent):v.meta.speed=M>0?1e3*S/M:0,y=l[g].getElementsByTagName("name"),y.length>0){for(var P=y[0].textContent,x=e.markers.pointMatchers||[],A=0;A<x.length;A++)if(x[A].regex.test(P)){d.push({label:P,coords:v,icon:x[A].icon,element:l[g]});break}}this._info.length+=S,y=l[g].getElementsByTagNameNS("*","hr"),y.length>0&&(v.meta.hr=parseInt(y[0].textContent),this._info.hr._points.push([this._info.length,v.meta.hr]),this._info.hr._total+=v.meta.hr),y=l[g].getElementsByTagNameNS("*","cad"),y.length>0&&(v.meta.cad=parseInt(y[0].textContent),this._info.cad._points.push([this._info.length,v.meta.cad]),this._info.cad._total+=v.meta.cad),y=l[g].getElementsByTagNameNS("*","atemp"),y.length>0&&(v.meta.atemp=parseInt(y[0].textContent),this._info.atemp._points.push([this._info.length,v.meta.atemp]),this._info.atemp._total+=v.meta.atemp),v.meta.ele>this._info.elevation.max&&(this._info.elevation.max=v.meta.ele),v.meta.ele<this._info.elevation.min&&(this._info.elevation.min=v.meta.ele),this._info.elevation._points.push([this._info.length,v.meta.ele]),v.meta.speed>this._info.speed.max&&(this._info.speed.max=v.meta.speed),this._info.speed._points.push([this._info.length,v.meta.speed]),p==null&&this._info.duration.start==null&&(this._info.duration.start=v.meta.time),this._info.duration.end=v.meta.time,this._info.duration.total+=M,M<e.max_point_interval&&(this._info.duration.moving+=M),b>0?this._info.elevation.gain+=b:this._info.elevation.loss+=Math.abs(b),p=v,c.push(v)}var N=new L.Polyline(c,this._extract_styling(n,a,o));if(this.fire("addline",{line:N,element:n}),f.push(N),e.markers.startIcon){var I=new L.Marker(c[0],{clickable:e.marker_options.clickable,icon:e.markers.startIcon});this.fire("addpoint",{point:I,point_type:"start",element:l[0],line:n}),f.push(I)}if(e.markers.endIcon){var I=new L.Marker(c[c.length-1],{clickable:e.marker_options.clickable,icon:e.markers.endIcon});this.fire("addpoint",{point:I,point_type:"end",element:l[l.length-1],line:n}),f.push(I)}for(var g=0;g<d.length;g++){var I=new L.Marker(d[g].coords,{clickable:e.marker_options.clickable,title:d[g].label,icon:d[g].icon});this.fire("addpoint",{point:I,point_type:"label",element:d[g].element}),f.push(I)}return f},_get_polyline_options:function(n,e){return Array.isArray(n)?n[e]||{}:n},_extract_styling:function(n,e,a){var o=this._merge_objs(Vd,e),s=n.getElementsByTagNameNS(Zd,"line");if(s.length>0){var l=s[0].getElementsByTagName("color");l.length>0&&(o.color="#"+l[0].textContent);var l=s[0].getElementsByTagName("opacity");l.length>0&&(o.opacity=l[0].textContent);var l=s[0].getElementsByTagName("weight");l.length>0&&(o.weight=l[0].textContent);var l=s[0].getElementsByTagName("linecap");l.length>0&&(o.lineCap=l[0].textContent);var l=s[0].getElementsByTagName("linejoin");l.length>0&&(o.lineJoin=l[0].textContent);var l=s[0].getElementsByTagName("dasharray");l.length>0&&(o.dashArray=l[0].textContent);var l=s[0].getElementsByTagName("dashoffset");l.length>0&&(o.dashOffset=l[0].textContent)}return this._merge_objs(o,a)},_dist2d:function(n,e){var a=6371e3,o=this._deg2rad(e.lat-n.lat),s=this._deg2rad(e.lng-n.lng),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this._deg2rad(n.lat))*Math.cos(this._deg2rad(e.lat))*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),d=a*c;return d},_dist3d:function(n,e){var a=this._dist2d(n,e),o=Math.abs(e.meta.ele-n.meta.ele);return Math.sqrt(Math.pow(a,2)+Math.pow(o,2))},_deg2rad:function(n){return n*Math.PI/180}});(function(){var n=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,a=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var o=this.options.icon&&this.options.icon.options,s=o&&this.options.icon.options.iconAnchor;s&&(s=s[0]+"px "+s[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||s||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(l){l.target._applyRotation()})}),L.Marker.include({_initIcon:function(){n.call(this)},_setPos:function(o){e.call(this,o),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,a?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(o){return this.options.rotationAngle=o,this.update(),this},setRotationOrigin:function(o){return this.options.rotationOrigin=o,this.update(),this}})})();window.L=K;async function Jd(){return console.log("MapManager: Starte Karteninitialisierung..."),await qd(),console.log("MapManager: Karteninitialisierung abgeschlossen."),u.map}async function qd(){if(u.ismapInitialized||u.map){console.warn("Map already initialized or init in progress.");return}u.ismapInitialized=!0,console.log("initMap started...");const n=we.DEFAULT_MAP_CENTER,e=we.DEFAULT_MAP_ZOOM;Kd(n,e),u.jumpVisualizationLayerGroup=K.layerGroup().addTo(u.map),u.landingPatternLayerGroup=K.layerGroup().addTo(u.map),u.jumpRunTrackLayerGroup=K.layerGroup().addTo(u.map),Yd(),Xd(),Qd(),tf(),ef(n),rf(),Promise.all([nf(),of(n,e)]).then(()=>{console.log("Initial tile caching and geolocation promise resolved.")}).catch(a=>{console.error("Error during parallel initialization of cache/geolocation:",a)}),Oo(),console.log("initMap finished.")}function Kd(n,e){u.lastLat=u.lastLat||n[0],u.lastLng=u.lastLng||n[1],u.map=K.map("map",{center:n,zoom:e,zoomControl:!1,doubleClickZoom:!1,maxZoom:19,minZoom:navigator.onLine?6:11}),console.log("Map instance created.")}function Yd(){u.baseMaps={OpenStreetMap:K.tileLayer.cached("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}),OpenTopoMap:K.tileLayer.cached("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'© <a href="https://www.openstreetmap.org/copyright">OSM</a>, <a href="https://opentopomap.org">OpenTopoMap</a> (CC-BY-SA)',subdomains:["a","b","c"]}),"Esri Satellite":K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USDA, USGS"}),"Esri Street":K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USGS"}),"Esri Topo":K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USGS"}),"Esri Satellite + OSM":K.layerGroup([K.tileLayer.cached("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri, USDA, USGS",zIndex:1}),K.tileLayer.cached("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',opacity:.5,zIndex:2,updateWhenIdle:!0,keepBuffer:2,subdomains:["a","b","c"]})],{attribution:'© Esri, USDA, USGS | © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'})},u.map&&u.map.attributionControl&&u.map.attributionControl.addAttribution('Weather data by <a href="https://open-meteo.com">Open-Meteo</a>');const e=_.state.userSettings.baseMaps in u.baseMaps?_.state.userSettings.baseMaps:"Esri Street",a=u.baseMaps[e];a&&typeof a.on=="function"?(a.on("tileerror",()=>{if(!navigator.onLine){u.hasTileErrorSwitched||(console.warn(`${e} tiles unavailable offline. Zoom restricted.`),T.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles."),u.hasTileErrorSwitched=!0);return}if(!u.hasTileErrorSwitched&&u.map.hasLayer(a)){const o="OpenStreetMap";console.warn(`${e} tiles unavailable, switching to ${o}`),u.map.removeLayer(a),u.baseMaps[o].addTo(u.map),_.state.userSettings.baseMaps=o,_.save(),T.handleMessage(`${e} tiles unavailable. Switched to ${o}.`),u.hasTileErrorSwitched=!0}else u.hasTileErrorSwitched||console.warn(`Tile error in ${e}, attempting to continue.`)}),a.addTo(u.map)):(console.error(`Default base map "${e}" could not be added.`),u.baseMaps.OpenStreetMap.addTo(u.map)),u.map&&u.map.invalidateSize(),window.addEventListener("online",()=>{u.hasTileErrorSwitched=!1,u.map&&(u.map.options.minZoom=6),Oo()}),window.addEventListener("offline",()=>{u.map&&(u.map.options.minZoom=9),Oo()}),console.log("Base layers and online/offline handlers set up.")}function Xd(){if(!u.map){console.error("Karte nicht initialisiert, bevor Controls hinzugefügt werden können.");return}K.control.layers(u.baseMaps,null,{position:"topright"}).addTo(u.map),u.map.on("baselayerchange",function(n){console.log(`Base map changed to: ${n.name}`),_&&_.state&&_.state.userSettings?(_.state.userSettings.baseMaps=n.name,_.save(),console.log(`Saved selected base map "${n.name}" to settings.`)):console.error("Settings object not properly available to save base map choice."),u.hasTileErrorSwitched=!1,u.lastLat&&u.lastLng&&typeof cacheTilesForDIP=="function"&&cacheTilesForDIP({map:u.map,lastLat:u.lastLat,lastLng:u.lastLng,baseMaps:u.baseMaps})}),K.control.zoom({position:"topright"}).addTo(u.map),K.control.polylineMeasure({position:"topright",unit:"kilometres",showBearings:!0,clearMeasurementsOnStop:!1,showClearControl:!0,showUnitControl:!0,tooltipTextFinish:"Click to finish the line<br>",tooltipTextDelete:"Shift-click to delete point",tooltipTextMove:"Drag to move point<br>",tooltipTextResume:"Click to resume line<br>",tooltipTextAdd:"Click to add point<br>",measureControlTitleOn:"Start measuring distance and bearing",measureControlTitleOff:"Stop measuring"}).addTo(u.map),K.control.scale({position:"bottomleft",metric:!0,imperial:!1,maxWidth:100}).addTo(u.map),console.log("Standard map controls and baselayerchange handler added.")}function Qd(){u.map.createPane("gpxTrackPane"),u.map.getPane("gpxTrackPane").style.zIndex=650,u.map.getPane("tooltipPane").style.zIndex=700,u.map.getPane("popupPane").style.zIndex=700,console.log("Custom map panes created.")}function tf(){u.livePositionControl=new _f({position:"bottomright"}).addTo(u.map),console.log("Initialized livePositionControl and hid by default")}async function ef(n,e){console.log("MapManager: Initialisiere den Standard-Marker..."),await ka(n[0],n[1]),u.isManualPanning=!1,console.log("Default marker initialized using the new standard method.")}async function nf(){try{if(await ne.init(),await ne.migrateTiles(),await ne.getCacheSize()>500){const e=await ne.clearOldTiles(3);T.handleMessage(`Cleared ${e.deletedCount} old tiles: ${e.deletedSizeMB.toFixed(2)} MB freed.`)}else await ne.clearOldTiles()}catch(n){console.error("Failed to initialize or manage tile cache:",n),T.handleError("Tile caching setup failed.")}console.log("Tile cache logic initialized.")}async function af(n,e){const{latitude:a,longitude:o}=n.coords;console.log("MapManager: Geolocation erfolgreich. Sende Event."),u.lastLat=a,u.lastLng=o,u.lastAltitude=await T.getAltitude(a,o),u.map.setView([a,o],e);const s=new CustomEvent("location:selected",{detail:{lat:a,lng:o,source:"geolocation"},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(s)}async function Ir(n,e,a){console.warn(`Geolocation error: ${n.message}`),T.handleMessage("Unable to retrieve your location. Using default location."),await ka(e[0],e[1]),u.map.setView(e,a),Vn(!0),u.isManualPanning=!1;const o=new CustomEvent("location:selected",{detail:{lat:e[0],lng:e[1],source:"geolocation_fallback"},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(o),console.log("Dispatched 'location:selected' event from geolocation fallback.")}async function of(n,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>af(a,e),a=>Ir(a,n,e),{enableHighAccuracy:!0,timeout:we.GEOLOCATION_TIMEOUT_MS,maximumAge:0}):(console.warn("Geolocation not supported."),await Ir({message:"Geolocation not supported by this browser."},n,e))}function sf(n){const{lat:e,lng:a}=n.latlng,o=new CustomEvent("map:mousemove",{detail:{lat:e,lng:a},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(o)}function rf(){if(!u.map){console.error("Karte nicht initialisiert in _setupCoreMapEventHandlers");return}u.coordsControl||(u.coordsControl=new K.Control.Coordinates,u.coordsControl.addTo(u.map),console.log("CoordsControl initialized in _setupCoreMapEventHandlers.")),u.map.on("mousemove",sf),u.map.on("mouseout",function(){u.coordsControl&&u.coordsControl.getContainer()&&(u.coordsControl.getContainer().innerHTML="Move mouse over map")}),u.map.on("dblclick",Dr),u.map.on("zoomstart",e=>{if(!navigator.onLine){const a=e.target._zoom||u.map.getZoom();a<11?(e.target._zoom=11,u.map.setZoom(11),T.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles.")):a>14&&(e.target._zoom=14,u.map.setZoom(14),T.handleMessage("Offline: Zoom restricted to levels 11–14 for cached tiles."))}}),u.map.on("zoomend",()=>{const e=u.map.getZoom(),a=new CustomEvent("map:zoomend",{detail:{zoom:e},bubbles:!0,cancelable:!0});if(u.map.getContainer().dispatchEvent(a),u.jumpRunTrackLayer&&_.state.userSettings.showJumpRunTrack){const o=u.jumpRunTrackLayer.getLayers().find(s=>{var l;return((l=s.options.icon)==null?void 0:l.options.className)==="jrt-anchor-marker"});if(o){const s=e<=11?10:e<=12?12:e<=13?14:16;o.setIcon(K.divIcon({className:"jrt-anchor-marker",html:`<div style="background-color: orange; width: ${s}px; height: ${s}px; border-radius: 50%; border: 2px solid white; opacity: 0.8;"></div>`,iconSize:[s,s],iconAnchor:[s/2,s/2],tooltipAnchor:[0,-(s/2+5)]}))}}if(u.heatmapLayer){const o=T.calculateDynamicRadius(ve.HEATMAP_BASE_RADIUS,ve.HEATMAP_REFERENCE_ZOOM);u.heatmapLayer.setOptions({radius:o}),console.log("Heatmap radius updated on zoom:",{currentZoom:u.map.getZoom(),newRadius:o})}}),u.map.on("movestart",e=>{e.target===u.map&&(!e.originalEvent||e.originalEvent.target===u.map.getContainer())&&(u.isManualPanning=!0,console.log("Manual map panning detected."))}),u.map.on("contextmenu",e=>{if(!_.state.userSettings.showCutAwayFinder||!_.state.userSettings.calculateJump)return;const{lat:a,lng:o}=e.latlng;u.cutAwayMarker?u.cutAwayMarker.setLatLng([a,o]):(u.cutAwayMarker=df(a,o).addTo(u.map),ff(u.cutAwayMarker)),u.cutAwayLat=a,u.cutAwayLng=o,Xl(u.cutAwayMarker,a,o);const s=new CustomEvent("cutaway:marker_placed",{bubbles:!0});u.map.getContainer().dispatchEvent(s)});const n=u.map.getContainer();n.addEventListener("touchstart",async e=>{if(e.touches.length!==1||e.target.closest(".leaflet-marker-icon"))return;const a=new Date().getTime(),o=a-lastTapTime;if(o<300&&o>0){e.preventDefault();const l=n.getBoundingClientRect(),c=e.touches[0].clientX-l.left,d=e.touches[0].clientY-l.top,f=u.map.containerPointToLatLng([c,d]);await Dr({latlng:f,containerPoint:K.point(c,d),layerPoint:u.map.latLngToLayerPoint(f)})}lastTapTime=a},{passive:!1}),u.map.on("click",e=>{}),u.map.on("mousedown",e=>{}),console.log("All core map event handlers have been set up.")}function Dr(n){const{lat:e,lng:a}=n.latlng;console.log('MapManager: Doppelklick erkannt. Sende "location:selected"-Event.');const o=new CustomEvent("location:selected",{detail:{lat:e,lng:a,source:"dblclick"},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(o)}function ha(n){if(lf(),u.labelZoomListener&&u.map&&(u.map.off("zoomend",u.labelZoomListener),u.labelZoomListener=null),!n||!u.jumpVisualizationLayerGroup)return;const e=[];n.exitCircles&&n.exitCircles.forEach(o=>{const s=K.circle(o.center,{radius:o.radius,color:o.color,fillColor:o.fillColor,fillOpacity:o.fillOpacity,weight:o.weight||2}).addTo(u.jumpVisualizationLayerGroup);o.tooltip&&s.bindTooltip(o.tooltip,{direction:"top",offset:[0,0],className:"wind-tooltip"})}),n.canopyCircles&&n.canopyCircles.forEach(o=>{K.circle(o.center,o).addTo(u.jumpVisualizationLayerGroup)});function a(o,s){const l=K.latLng(o[0],o[1]),d=s/6378137*(180/Math.PI),f=K.latLng(o[0]+d,o[1]),p=u.map.latLngToLayerPoint(l),g=u.map.latLngToLayerPoint(f);return[25,p.y-g.y+10]}if(n.canopyLabels){const o=u.map.getZoom();n.canopyLabels.forEach(s=>{const l=o<=11,c=K.marker(s.center,{icon:K.divIcon({className:`isoline-label ${l?"isoline-label-small":"isoline-label-large"}`,html:`<span style="font-size: ${l?"8px":"10px"}">${s.text}</span>`,iconSize:l?[50,12]:[60,14],iconAnchor:a(s.center,s.radius)}),zIndexOffset:2100}).addTo(u.jumpVisualizationLayerGroup);e.push({marker:c,center:s.center,radius:s.radius,text:s.text})})}e.length>0&&(u.labelZoomListener=function(){const s=u.map.getZoom()<=11;e.forEach(l=>{l.marker.setIcon(K.divIcon({className:`isoline-label ${s?"isoline-label-small":"isoline-label-large"}`,html:`<span style="font-size: ${s?"8px":"10px"}">${l.text}</span>`,iconSize:s?[50,12]:[60,14],iconAnchor:a(l.center,l.radius)}))})},u.map.on("zoomend",u.labelZoomListener))}function lf(){u.map&&u.jumpVisualizationLayerGroup&&u.map.removeLayer(u.jumpVisualizationLayerGroup),u.jumpVisualizationLayerGroup=K.layerGroup().addTo(u.map)}function cf(){u.landingPatternLayerGroup&&u.landingPatternLayerGroup.clearLayers()}function pi(n){cf(),n&&(n.legs.forEach(e=>{K.polyline(e.path,{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}).addTo(u.landingPatternLayerGroup)}),n.arrows.forEach(e=>{const a=uf(e.position[0],e.position[1],e.bearing,e.color);K.marker(e.position,{icon:a}).addTo(u.landingPatternLayerGroup).bindTooltip(e.tooltipText,{offset:[10,0],direction:"right",className:"wind-tooltip"})}))}function uf(n,e,a,o){const s=(a+360)%360,l=`
        <svg width="40" height="20" viewBox="0 0 40 20" xmlns="http://www.w3.org/2000/svg">
            <line x1="0" y1="10" x2="30" y2="10" stroke="${o}" stroke-width="4" />
            <polygon points="30,5 40,10 30,15" fill="${o}" />
        </svg>
    `;return K.divIcon({html:`<div style="transform: rotate(${s}deg); ...">${l}</div>`,className:"wind-arrow-icon",iconSize:[40,20],iconAnchor:[20,10]})}function hf(){u.map&&u.jumpRunTrackLayerGroup&&u.map.removeLayer(u.jumpRunTrackLayerGroup),u.jumpRunTrackLayerGroup=K.layerGroup().addTo(u.map)}function df(n,e){const a=K.icon({iconUrl:$o.CUTAWAY_MARKER,iconSize:[25,25],iconAnchor:[12,12],popupAnchor:[0,-12],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,41]});return K.marker([n,e],{icon:a,draggable:!0})}function ff(n){n.on("dragend",e=>{const a=n.getLatLng();u.cutAwayLat=a.lat,u.cutAwayLng=a.lng,console.log("Cut-away marker dragged to:",{lat:u.cutAwayLat,lng:u.cutAwayLng}),Xl(n,u.cutAwayLat,u.cutAwayLng);const o=new CustomEvent("cutaway:marker_placed",{bubbles:!0});u.map.getContainer().dispatchEvent(o)})}function Xl(n,e,a,o=!1){const s=_.getValue("coordFormat","radio","Decimal"),l=T.convertCoords(e,a,s);let c="<b>Cut-Away Start</b><br>";if(s==="MGRS")c+=`MGRS: ${l.lat}`;else{const d=f=>`${f.deg}°${f.min}'${f.sec.toFixed(0)}" ${f.dir}`;s==="DMS"?c+=`Lat: ${d(T.decimalToDms(e,!0))}<br>Lng: ${d(T.decimalToDms(a,!1))}`:c+=`Lat: ${e.toFixed(5)}<br>Lng: ${a.toFixed(5)}`}Yo(n,c,o)}function Ro(n){u.cutAwayCircle&&(u.map.removeLayer(u.cutAwayCircle),u.cutAwayCircle=null),n&&(u.cutAwayCircle=K.circle(n.center,{radius:n.radius,color:"purple",fillColor:"purple",fillOpacity:.2,weight:2}).addTo(u.map),u.cutAwayCircle.bindTooltip(n.tooltipContent,{permanent:!1,direction:"center",className:"cutaway-tooltip"}))}function mf(){u.cutAwayMarker&&(u.map.removeLayer(u.cutAwayMarker),u.cutAwayMarker=null),Ro(null)}function da(n){var l,c,d,f;if(hf(),!n||!u.jumpRunTrackLayerGroup){console.warn("No valid trackData or AppState.jumpRunTrackLayerGroup");return}if(!((c=(l=n.path)==null?void 0:l.latlngs)!=null&&c.length)||!((d=n.airplane)!=null&&d.position)){console.warn("Invalid trackData structure:",n);return}const e=K.polyline(n.path.latlngs,n.path.options).bindTooltip(n.path.tooltipText).addTo(u.jumpRunTrackLayerGroup);let a=null;(f=n.approachPath)!=null&&f.latlngs&&(a=K.polyline(n.approachPath.latlngs,n.approachPath.options).bindTooltip(n.approachPath.tooltipText).addTo(u.jumpRunTrackLayerGroup));const o=K.icon({iconUrl:$o.AIRPLANE_MARKER,iconSize:[32,32],iconAnchor:[16,16],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,32]}),s=K.marker(n.airplane.position,{icon:o,rotationAngle:n.airplane.bearing,rotationOrigin:"center center",draggable:!0,zIndexOffset:2e3}).bindTooltip("Drag to move Jump Run Track").addTo(u.jumpRunTrackLayerGroup);s.on("mousedown",()=>u.map.dragging.disable()),s.on("mouseup",()=>u.map.dragging.enable()),s.on("drag",p=>{var S;const g=p.target.getLatLng(),y=n.airplane.originalPosition;if(!y||!Number.isFinite(y.lat)||!Number.isFinite(y.lng)){console.warn("Invalid originalPosition:",y);return}const v=g.lat-y.lat,M=g.lng-y.lng;if(!Number.isFinite(v)||!Number.isFinite(M)){console.warn("Invalid delta values:",{deltaLat:v,deltaLng:M});return}const b=n.path.originalLatLngs.map(P=>[Number.isFinite(P[0])?P[0]+v:P[0],Number.isFinite(P[1])?P[1]+M:P[1]]);if(e.setLatLngs(b),a&&((S=n.approachPath)!=null&&S.originalLatLngs)){const P=n.approachPath.originalLatLngs.map(x=>[Number.isFinite(x[0])?x[0]+v:x[0],Number.isFinite(x[1])?x[1]+M:x[1]]);a.setLatLngs(P)}}),s.on("dragend",p=>{const g=p.target.getLatLng();if(!Number.isFinite(g.lat)||!Number.isFinite(g.lng)){console.warn("Invalid new position in dragend:",g);return}const y=new CustomEvent("track:dragend",{detail:{newPosition:g,originalTrackData:n},bubbles:!0});u.map.getContainer().dispatchEvent(y)})}async function ka(n,e){if(console.log("MapManager: Befehl erhalten, Marker zu erstellen/bewegen bei",n,e),typeof n!="number"||typeof e!="number"||n<-90||n>90||e<-180||e>180){console.error("MapManager: Ungültige Koordinaten:",{lat:n,lng:e});return}const a=await T.getAltitude(n,e);if(u.currentMarker)console.log("MapManager: Marker existiert, bewege ihn jetzt mit setLatLng."),u.currentMarker.setLatLng([n,e]);else{console.log("MapManager: Kein Marker vorhanden, erstelle einen neuen.");const s=pf(n,e);gf(s),u.currentMarker=s,u.currentMarker.addTo(u.map)}const o=`Lat: ${n.toFixed(5)}<br>Lng: ${e.toFixed(5)}<br>Alt: ${a} m`;Yo(u.currentMarker,o),u.lastLat=n,u.lastLng=e,u.lastAltitude=a,u.map.invalidateSize()}function pf(n,e){const a=K.icon({iconUrl:$o.DEFAULT_MARKER,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[13,32]});return K.marker([n,e],{icon:a,draggable:!0})}function gf(n){n.on("dragend",e=>{const a=n.getLatLng(),o=new CustomEvent("location:selected",{detail:{lat:a.lat,lng:a.lng,source:"marker_drag"},bubbles:!0});u.map.getContainer().dispatchEvent(o)})}function Yo(n,e,a=!1){var s;if(!n)return;const o=((s=n.getPopup())==null?void 0:s.isOpen())||a;n.unbindPopup().bindPopup(e),o&&n.openPopup()}function Vn(n=!1){u.isManualPanning&&!n||u.map&&u.currentMarker&&u.map.panTo(u.currentMarker.getLatLng())}const _f=K.Control.extend({options:{position:"bottomright"},onAdd:function(n){const e=K.DomUtil.create("div","leaflet-control-live-position");return e.style.display="none",e.style.background="rgba(255, 255, 255, 0.8)",e.style.padding="5px",e.style.borderRadius="4px",this._container=e,e},update:function(n){if(!n||n.latitude===null||n.latitude===void 0){this._container.style.display="none";return}const{latitude:e,longitude:a,deviceAltitude:o,altitudeAccuracy:s,accuracy:l,speedMs:c,direction:d,showJumpMasterLine:f,jumpMasterLineData:p,heightUnit:g,effectiveWindUnit:y,coordFormat:v,refLevel:M}=n,b=T.convertCoords(e,a,v),S=v==="MGRS"?`MGRS: ${b.lat}<br>`:`Lat: ${e.toFixed(5)}<br>Lng: ${a.toFixed(5)}<br>`;let P="Altitude: N/A<br>";if(o!==null){let B=M==="AGL"&&u.lastAltitude?o-parseFloat(u.lastAltitude):o,U=M==="AGL"&&u.lastAltitude?"abv DIP":M;const $=Math.round(T.convertHeight(B,g)),k=Math.round(T.convertHeight(s,g));P=`Altitude: ${$} ${g} ${U} (±${k||"N/A"} ${g})<br>`}const x=`Accuracy: ${Math.round(T.convertHeight(l,g))} ${g}<br>`,A=`Speed: ${T.convertWind(c,y,"m/s").toFixed(1)} ${y}<br>`,N=`Direction: ${d}°`;let I=`<span style="font-weight: bold;">Live Position</span><br>${S}${P}${x}${A}${N}`;if(f&&p){const B=Math.round(T.convertHeight(p.distance,g)),U=p.tot!=="N/A"&&p.tot<1200?`TOT: X - ${p.tot} s`:"TOT: N/A";I+=`<br><br><span style="font-weight: bold;">Jump Master Line to ${p.target}</span><br>`,I+=`Bearing: ${p.bearing}°<br>`,I+=`Distance: ${B} ${g}<br>`,I+=U}this._container.innerHTML=I,this._container.style.display="block"}});function yf(n,e){const a=[[n.lat,n.lng],[e.lat,e.lng]];u.jumpMasterLine?u.jumpMasterLine.setLatLngs(a):u.jumpMasterLine=K.polyline(a,{color:"blue",weight:3,dashArray:"5, 5"}).addTo(u.map)}function Or(){u.jumpMasterLine&&(u.map.removeLayer(u.jumpMasterLine),u.jumpMasterLine=null)}function vf(){u.livePositionControl&&u.livePositionControl.update(null)}function wf(n){u.livePositionControl&&u.livePositionControl.update(n)}function Ql(n){if(!u.isPlacingHarp)return;const{lat:e,lng:a}=n.latlng;u.harpMarker?(u.harpMarker.setLatLng([e,a]),console.log("Updated HARP marker position:",{lat:e,lng:a})):(u.harpMarker=Lf(e,a).addTo(u.map),console.log("Placed new HARP marker:",{lat:e,lng:a})),_.state.userSettings.harpLat=e,_.state.userSettings.harpLng=a,_.save(),u.isPlacingHarp=!1,u.map.off("click",Ql),console.log("HARP placement mode deactivated");const o=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');o&&(o.disabled=!1,console.log("Enabled HARP radio button"))}function Lf(n,e){const a=K.marker([n,e],{icon:K.divIcon({className:"harp-marker",html:'<div style="background-color: green; width: 10px; height: 10px; border-radius: 50%;"></div>',iconSize:[10,10],iconAnchor:[5,5]}),pane:"markerPane"});return console.log("Created HARP marker at:",{latitude:n,longitude:e}),a}function Mf(){if(!u.map){console.warn("Map not initialized, cannot clear HARP marker"),T.handleMessage("Map not initialized, cannot clear HARP marker.");return}u.harpMarker&&(u.map.removeLayer(u.harpMarker),u.harpMarker=null,console.log("Removed HARP marker")),_.state.userSettings.harpLat=null,_.state.userSettings.harpLng=null,_.save();const n=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');if(n&&(n.disabled=!0,console.log("Disabled HARP radio button")),_.state.userSettings.jumpMasterLineTarget==="HARP"&&_.state.userSettings.showJumpMasterLine){u.jumpMasterLine&&(u.map.removeLayer(u.jumpMasterLine),u.jumpMasterLine=null,console.log("Removed Jump Master Line: HARP marker cleared")),_.state.userSettings.jumpMasterLineTarget="DIP";const e=document.querySelector('input[name="jumpMasterLineTarget"][value="DIP"]');e&&(e.checked=!0,console.log("Switched Jump Master Line to DIP")),_.save(),u.liveMarker&&u.currentMarker&&u.lastLat!==null&&u.lastLng!==null&&debouncedPositionUpdate({coords:{latitude:u.lastLatitude,longitude:u.lastLongitude,accuracy:u.lastAccuracy,altitude:u.lastDeviceAltitude,altitudeAccuracy:u.lastAltitudeAccuracy}})}T.handleMessage("HARP marker cleared")}async function Pa(){if(!u.currentMarker||u.lastLat===null)return;const n=u.lastLat,e=u.lastLng,a=u.lastAltitude,o=_.getValue("coordFormat","radio","Decimal"),s=ze(),l=T.convertCoords(n,e,o);let c;if(o==="MGRS")c=`MGRS: ${l.lat}<br>Alt: ${a} m`;else{const d=f=>`${f.deg}°${f.min}'${f.sec.toFixed(0)}" ${f.dir}`;o==="DMS"?c=`Lat: ${d(T.decimalToDms(n,!0))}<br>Lng: ${d(T.decimalToDms(e,!1))}<br>Alt: ${a} m`:c=`Lat: ${n.toFixed(5)}<br>Lng: ${e.toFixed(5)}<br>Alt: ${a} m`}if(u.weatherData&&u.weatherData.surface_pressure){const d=u.weatherData.surface_pressure[s];d?c+=` QFE: ${d.toFixed(0)} hPa`:c+=" QFE: N/A"}else c+=" QFE: N/A";Yo(u.currentMarker,c)}async function Ea(n,e=null){var M;if(console.log(`updateWeatherDisplay called with index: ${n}, Time: ${u.weatherData.time[n]}`),!u.weatherData||!u.weatherData.time||n<0||n>=u.weatherData.time.length){console.error("No weather data available or index out of bounds:",n),document.getElementById("info").innerHTML="No weather data available",document.getElementById("selectedTime").innerHTML="Selected Time: ";const b=document.getElementById("timeSlider");b&&(b.value=0);return}u.landingWindDir=u.weatherData.wind_direction_10m[n]||null,console.log("landingWindDir updated to:",u.landingWindDir);const a=document.getElementById("customLandingDirectionLL"),o=document.getElementById("customLandingDirectionRR");a&&o&&u.landingWindDir!==null&&(a.value=Math.round(u.landingWindDir),o.value=Math.round(u.landingWindDir));const s=((M=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:M.value)||"AGL",l=_.getValue("heightUnit","radio","m"),c=_.getValue("windUnit","radio","kt"),d=_.getValue("temperatureUnit","radio","C"),f=await T.getDisplayTime(u.weatherData.time[n],u.lastLat,u.lastLng),p=Mn(n),g=s==="AMSL"&&u.lastAltitude!=="N/A"?Math.round(u.lastAltitude):0;if(!_.state.userSettings.showTable){document.getElementById("info").innerHTML="",document.getElementById("selectedTime").innerHTML=`Selected Time: ${f}`;return}const y=p.map(b=>{const S=parseFloat(b.spd);let P="";if(c==="bft"){const F=T.convertWind(S,"kt","km/h"),z=T.knotsToBeaufort(F);z<=1?P="wind-low":z<=3?P="wind-moderate":z<=4?P="wind-high":P="wind-very-high"}else{const F=T.convertWind(S,"kt","km/h");F<=3?P="wind-low":F<=10?P="wind-moderate":F<=16?P="wind-high":P="wind-very-high"}const x=b.rh;let A="";x!=="N/A"&&Number.isFinite(x)&&(x<65?A="humidity-low":x>=65&&x<=85?A="humidity-moderate":x>85&&x<100?A="humidity-high":x===100&&(A="humidity-saturated"));const N=s==="AMSL"?b.displayHeight+(l==="ft"?Math.round(g*3.28084):g):b.displayHeight,I=T.convertTemperature(b.temp,d==="C"?"°C":"°F"),B=I==="N/A"?"N/A":I.toFixed(0),U=T.convertWind(S,c,"km/h");let $;const k=s==="AMSL"?l==="ft"?Math.round(g*3.28084):g:0;if(Math.round(N)===k&&u.weatherData.wind_gusts_10m[n]!==void 0&&Number.isFinite(u.weatherData.wind_gusts_10m[n])){const F=u.weatherData.wind_gusts_10m[n],z=T.convertWind(F,c,"km/h"),W=c==="bft"?Math.round(U):U.toFixed(0),it=c==="bft"?Math.round(z):z.toFixed(0);$=`${W} G ${it}`}else $=U==="N/A"?"N/A":c==="bft"?Math.round(U):U.toFixed(0);const C=Math.round(T.convertWind(S,"kt","km/h")/5)*5,O=b.dir==="N/A"||isNaN(C)?"N/A":T.generateWindBarb(b.dir,C);return`<tr class="${P} ${A}">
                    <td>${Math.round(N)}</td>
                    <td>${T.roundToTens(b.dir)}</td>
                    <td>${$}</td>
                    <td>${O}</td>
                    <td>${B}</td>
                </tr>`}).join(""),v=`
        <table id="weatherTable">
            <thead>
                <tr>
                    <th>Height (${l} ${s})</th>
                    <th>Dir (deg)</th>
                    <th>Spd (${c})</th>
                    <th>Wind</th>
                    <th>T (${d==="C"?"°C":"°F"})</th>
                </tr>
            </thead>
            <tbody>
                ${y}
            </tbody>
        </table>`;document.getElementById("info").innerHTML=v,document.getElementById("selectedTime").innerHTML=`Selected Time: ${f}`}function sn(){var Di;if(!u.currentMarker||typeof u.currentMarker.getLatLng!="function"){console.warn("Landing pattern update skipped: AppState.currentMarker is not a valid marker object yet.",u.currentMarker);return}const n=u.currentMarker.getLatLng();if(!n){console.error("Could not get LatLng from the current marker. Aborting landing pattern update.",u.currentMarker);return}if(!_.state.isLandingPatternUnlocked||!_.state.userSettings.showLandingPattern){pi(null);return}if(!u.weatherData||!u.lastLat){pi(null);return}const e=u.map.getZoom();if(e<we.LANDING_PATTERN_MIN_ZOOM){console.log("Landing pattern not displayed - zoom too low:",e),pi(null);return}const a=parseInt(document.getElementById("timeSlider").value)||0,o=((Di=document.querySelector('input[name="landingDirection"]:checked'))==null?void 0:Di.value)||"LL",s=document.getElementById("customLandingDirectionLL"),l=document.getElementById("customLandingDirectionRR"),c=s?parseInt(s.value,10):null,d=l?parseInt(l.value,10):null,f=parseInt(document.getElementById("canopySpeed").value)||20,p=parseFloat(document.getElementById("descentRate").value)||3.5,g=parseInt(document.getElementById("legHeightFinal").value)||100,y=parseInt(document.getElementById("legHeightBase").value)||200,v=parseInt(document.getElementById("legHeightDownwind").value)||300,M=n.lat,b=n.lng,S=Math.round(u.lastAltitude),P=Mn(a);if(!P||P.length===0)return;const x=P.map(Kt=>Kt.height),A=P.map(Kt=>Number.isFinite(Kt.dir)?parseFloat(Kt.dir):0),N=P.map(Kt=>T.convertWind(parseFloat(Kt.spd)||0,"kt","km/h")),I=N.map((Kt,Ie)=>-Kt*Math.sin(A[Ie]*Math.PI/180)),B=N.map((Kt,Ie)=>-Kt*Math.cos(A[Ie]*Math.PI/180));let U;if(o==="LL"&&Number.isFinite(c)&&c>=0&&c<=359?U=c:o==="RR"&&Number.isFinite(d)&&d>=0&&d<=359?U=d:U=Number.isFinite(u.landingWindDir)?u.landingWindDir:A[0],!Number.isFinite(U)){console.warn("Invalid landing wind direction:",U);return}function $(Kt){const Ie=_.getValue("windUnit","radio","kt"),Tn=T.convertWind(Kt,Ie,"kt");return Ie==="bft"?Math.round(Tn):Tn.toFixed(1)}const k=(Kt,Ie,Tn,Aa,Yn)=>{const Oi=Aa*1.852/3.6*Yn/111e3,ce=Tn*Math.PI/180,st=Oi*Math.cos(ce),Ni=Oi*Math.sin(ce)/Math.cos(Kt*Math.PI/180);return[Kt+st,Ie+Ni]},C=[S,S+g];console.log("Final limits:",C);const O=T.calculateMeanWind(x,I,B,...C),F=O[0],z=O[1];if(!Number.isFinite(z)||!Number.isFinite(F)){console.warn("Invalid mean wind for final leg:",O);return}let W=null;z<=3?W="lightblue":z<=10?W="lightgreen":z<=16?W="#f5f34f":W="#ffcccc";const it=U,bt=T.calculateWindAngle(it,F),{crosswind:et,headwind:at}=T.calculateWindComponents(z,bt),G=T.calculateWCA(et,f)*(et>=0?1:-1),tt=T.normalizeAngle(it-G),Z=T.calculateCourseFromHeading(tt,F,z,f).groundSpeed,nt=g/p,V=Z*1.852/3.6*nt,lt=(U+180)%360,Y=k(M,b,lt,Z,nt);(M+Y[0])/2,(b+Y[1])/2;const j=[S+g,S+y],ft=T.calculateMeanWind(x,I,B,...j),X=ft[0],ht=ft[1];if(!Number.isFinite(ht)||!Number.isFinite(X)){console.warn("Invalid mean wind for base leg:",ft);return}let wt=null;ht<=3?wt="lightblue":ht<=10?wt="lightgreen":ht<=16?wt="#f5f34f":wt="#ffcccc",console.log("********* Landing Direction: ",o,"Effective Landing Wind Dir:",U);let rt=0;o==="LL"?(rt=(U+90)%360,console.log("Base Heading:",rt)):o==="RR"&&(rt=(U-90+360)%360,console.log("Base Heading:",rt));const Lt=T.calculateCourseFromHeading(rt,X,ht,f),kt=Lt.trueCourse,pt=Lt.groundSpeed;let mt=(kt+180)%360;pt<0&&(mt=(mt+180)%360,console.log("Base ground speed is negative:",pt,"New course:",mt));const ct=(y-g)/p,Dt=pt*1.852/3.6*ct;console.log("Base Course:",kt);const yt=T.calculateWindAngle(kt,X),{crosswind:At,headwind:Ft}=T.calculateWindComponents(ht,yt),de=T.calculateWCA(At,f)*(At>=0?1:-1),It=k(Y[0],Y[1],mt,pt,ct);(Y[0]+It[0])/2,(Y[1]+It[1])/2;const xe=[S+y,S+v],Rt=T.calculateMeanWind(x,I,B,...xe),Vt=Rt[0],Et=Rt[1];if(!Number.isFinite(Et)||!Number.isFinite(Vt)){console.warn("Invalid mean wind for downwind leg:",Rt);return}let zt=null;Et<=3?zt="lightblue":Et<=10?zt="lightgreen":Et<=16?zt="#f5f34f":zt="#ffcccc";const qt=U,rn=T.calculateWindAngle(qt,Vt),{crosswind:qe,headwind:be}=T.calculateWindComponents(Et,rn),ie=T.calculateWCA(qe,f)*(qe>=0?1:-1),Ae=T.normalizeAngle((qt-ie+180)%360),bn=T.calculateCourseFromHeading(Ae,Vt,Et,f).groundSpeed,Ci=(v-y)/p,cn=bn*1.852/3.6*Ci,$e=k(It[0],It[1],qt,bn,Ci),Ca=[(M+Y[0])/2,(b+Y[1])/2],xi=[(Y[0]+It[0])/2,(Y[1]+It[1])/2],Ai=[(It[0]+$e[0])/2,(It[1]+$e[1])/2];(It[0]+$e[0])/2,(It[1]+$e[1])/2,console.log(`Landing Pattern Updated:
        Final Leg: Wind: ${F.toFixed(1)}° @ ${z.toFixed(1)}kt, Course: ${it.toFixed(1)}°, WCA: ${G.toFixed(1)}°, GS: ${Z.toFixed(1)}kt, HW: ${at.toFixed(1)}kt, Length: ${V.toFixed(1)}m
        Base Leg: Wind: ${X.toFixed(1)}° @ ${ht.toFixed(1)}kt, Course: ${kt.toFixed(1)}°, WCA: ${de.toFixed(1)}°, GS: ${pt.toFixed(1)}kt, HW: ${Ft.toFixed(1)}kt, Length: ${Dt.toFixed(1)}m
        Downwind Leg: Wind: ${Vt.toFixed(1)}° @ ${Et.toFixed(1)}kt, Course: ${qt.toFixed(1)}°, WCA: ${ie.toFixed(1)}°, GS: ${bn.toFixed(1)}kt, HW: ${be.toFixed(1)}kt, Length: ${cn.toFixed(1)}m`);const Ii=u.weatherData.time[a];console.log("+++++++++ Koordinaten Pattern:",Ii),console.log("Coordinates DIP: ",M,b,"Altitude DIP:",S),console.log("Coordinates final end: ",Y[0],Y[1],"Leg Height:",S+g),console.log("Coordinates base end: ",It[0],It[1],"Leg Height:",S+y),console.log("Coordinates downwind end: ",$e[0],$e[1],"Leg Height:",S+v);const xa={legs:[{path:[[M,b],Y],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}},{path:[Y,It],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}},{path:[It,$e],options:{color:"red",weight:3,opacity:.8,dashArray:"5, 10"}}],arrows:[{position:Ca,bearing:(F-90+180)%360,color:W,tooltipText:`${Math.round(F)}° ${$(z)}${_.getValue("windUnit","radio","kt")}`},{position:xi,bearing:(ft[0]-90+180)%360,color:wt,tooltipText:`${Math.round(X)}° ${$(ht)}${_.getValue("windUnit","radio","kt")}`},{position:Ai,bearing:(Rt[0]-90+180)%360,color:zt,tooltipText:`${Math.round(Vt)}° ${$(Et)}${_.getValue("windUnit","radio","kt")}`}]};pi(xa)}function Jt(){var s,l,c,d,f,p,g,y;if(console.log("updateJumpRunTrackDisplay called"),!u.map){console.warn("Map not initialized, cannot update jump run track display");return}if(!(_.state.userSettings.showJumpRunTrack&&u.weatherData&&u.lastLat&&u.lastLng&&_.state.isCalculateJumpUnlocked&&_.state.userSettings.calculateJump)){console.log("Conditions not met to show JRT, clearing display."),da(null),u.lastTrackData=null;return}const e=ze(),a=Mn(e),o=wa(a);if(o&&((s=o.latlngs)==null?void 0:s.length)===2&&o.latlngs.every(v=>Number.isFinite(v[0])&&Number.isFinite(v[1]))){console.log("Drawing jump run track with data:",o);const v={path:{latlngs:o.latlngs,options:{color:"orange",weight:5,opacity:.8},tooltipText:`Jump Run Track: ${o.direction}°, Length: ${o.trackLength} m`,originalLatLngs:((c=(l=u.lastTrackData)==null?void 0:l.latlngs)==null?void 0:c.length)===2?u.lastTrackData.latlngs:o.latlngs},approachPath:((d=o.approachLatLngs)==null?void 0:d.length)===2&&o.approachLatLngs.every(M=>Number.isFinite(M[0])&&Number.isFinite(M[1]))?{latlngs:o.approachLatLngs,options:{color:"orange",weight:5,opacity:.8,dashArray:"5, 10"},tooltipText:`Approach Path: ${o.direction}°, Length: ${o.approachLength} m`,originalLatLngs:((p=(f=u.lastTrackData)==null?void 0:f.approachLatLngs)==null?void 0:p.length)===2?u.lastTrackData.approachLatLngs:o.approachLatLngs}:null,trackLength:o.trackLength,airplane:{position:L.latLng(o.latlngs[1][0],o.latlngs[1][1]),bearing:o.direction,originalPosition:(y=(g=u.lastTrackData)==null?void 0:g.latlngs)!=null&&y[1]&&Number.isFinite(u.lastTrackData.latlngs[1][0])?L.latLng(u.lastTrackData.latlngs[1][0],u.lastTrackData.latlngs[1][1]):L.latLng(o.latlngs[1][0],o.latlngs[1][1])}};da(v),u.lastTrackData={latlngs:o.latlngs,approachLatLngs:o.approachLatLngs,direction:o.direction,trackLength:o.trackLength,approachLength:o.approachLength},console.log("Updated AppState.lastTrackData:",u.lastTrackData)}else console.warn("No valid track data to display:",o),da(null),u.lastTrackData=null}let je=!1;function tc(){const n=document.getElementById("locationSearchInput"),e=document.getElementById("locationResults"),a=document.getElementById("saveCurrentLocationBtn");if(!n||!e||!a){console.error("Einige UI-Elemente für die Ortssuche wurden nicht gefunden.");return}const o=T.debounce(bf,300);n.addEventListener("input",()=>{o(n.value)}),n.addEventListener("focus",()=>{n.value.trim()||Re(),e.style.display="block"}),n.addEventListener("blur",()=>{setTimeout(()=>{e.style.display="none"},200)}),a._clickHandler&&(a.removeEventListener("click",a._clickHandler),console.log("Entfernte bestehenden click-Listener für saveCurrentLocationBtn")),a._clickHandler=s=>{if(s.stopPropagation(),u.lastLat===null||u.lastLng===null){T.handleError("Please select a location on the map first.");return}if(je){console.log("saveFavoriteBtn Klick blockiert: Ein Favorit wird bereits hinzugefügt.");return}const l=`DIP at ${u.lastLat.toFixed(4)}, ${u.lastLng.toFixed(4)}`,c=prompt("Enter a name for this favorite:",l);if(c){je=!0;try{ec(u.lastLat,u.lastLng,c),Xo(u.lastLat,u.lastLng,c,!0)}finally{je=!1,console.log("saveFavoriteBtn Aktion abgeschlossen, Sperre aufgehoben.")}}},a.addEventListener("click",a._clickHandler),console.log("Neuer click-Listener für saveCurrentLocationBtn hinzugefügt"),document.addEventListener("click",s=>{!n.contains(s.target)&&!e.contains(s.target)&&(e.style.display="none")})}async function bf(n){if(console.log("performSearch: Suche nach:",n),!n.trim()){console.log("performSearch: Leere Eingabe, zeige Favoriten/Verlauf."),Re();return}let e=[];const a=Tf(n);if(a)console.log("performSearch: Koordinaten gefunden:",a),e.push({display_name:`Koordinate: ${a.lat.toFixed(5)}, ${a.lng.toFixed(5)}`,lat:a.lat,lon:a.lng,type:"coordinate"}),Re(e);else{console.log("performSearch: Keine Koordinaten, starte Nominatim-Suche.");try{const o=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(n)}&format=json&limit=5&addressdetails=1`,s=await fetch(o,{method:"GET",headers:{"User-Agent":"Skydiving-Weather-App/1.0 (anonymous)"}});if(!s.ok)throw new Error(`Nominatim API Fehler: ${s.statusText}`);const l=await s.json();console.log("performSearch: Nominatim Ergebnisse:",l),e=l,Re(e)}catch(o){console.error("Fehler bei der Geocoding-Suche:",o),T.handleError("Could not find location."),Re([])}}}function Tf(n){console.log("parseQueryAsCoordinates: Eingabe:",n);const e=n.trim(),o=e.replace(/[,;\t]+/," ").trim().match(/^(-?\d{1,3}(?:\.\d+)?)\s+(-?\d{1,3}(?:\.\d+)?)$/);if(o){const c=parseFloat(o[1]),d=parseFloat(o[3]);if(console.log("parseQueryAsCoordinates: Dezimalgraden erkannt:",{lat:c,lng:d}),c>=-90&&c<=90&&d>=-180&&d<=180)return{lat:c,lng:d};console.warn("parseQueryAsCoordinates: Ungültige Koordinatenbereiche:",{lat:c,lng:d})}const s=e.replace(/\s/g,"").toUpperCase(),l=/^[0-9]{1,2}[C-HJ-NP-X][A-HJ-NP-Z]{2}(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})$/;if(typeof $d>"u")return console.warn("parseQueryAsCoordinates: MGRS-Bibliothek nicht geladen."),null;if(l.test(s))try{const[c,d]=qo(s);if(console.log("parseQueryAsCoordinates: MGRS erkannt:",{lat:d,lng:c}),!isNaN(d)&&!isNaN(c))return{lat:d,lng:c};console.warn("parseQueryAsCoordinates: Ungültige MGRS-Koordinaten:",{lat:d,lng:c})}catch(c){return console.warn("parseQueryAsCoordinates: MGRS-Parsing fehlgeschlagen:",c.message),null}return console.log("parseQueryAsCoordinates: Keine Koordinaten erkannt."),null}function Re(n=[]){const e=document.getElementById("locationResults");if(!e){console.error("resultsList nicht gefunden.");return}e.innerHTML="";const a=Ei(),o=a.filter(c=>c.isFavorite),s=a.filter(c=>!c.isFavorite);console.log("renderResultsList: Favoriten:",o),console.log("renderResultsList: Verlauf (nicht Favoriten):",s),console.log("renderResultsList: Suchergebnisse:",n);const l=c=>{const d=document.createElement("li"),f=parseFloat(c.lat),p=parseFloat(c.lng||c.lon);if(isNaN(f)||isNaN(p))return console.error("Ungültige Koordinaten in createListItem:",c),null;console.log("createListItem: Verarbeite Eintrag:",{lat:f,lng:p,label:c.display_name||c.label}),d.dataset.lat=f,d.dataset.lon=p;const g=document.createElement("span");g.className="location-name",g.textContent=c.display_name||c.label,d.appendChild(g),g.addEventListener("mousedown",b=>{const S=new CustomEvent("location:selected",{detail:{lat:f,lng:p},bubbles:!0,cancelable:!0});d.dispatchEvent(S),Xo(f,p,c.display_name||c.label,c.isFavorite||!1),e.style.display="none"});const y=document.createElement("div");y.className="location-item-buttons";const v=document.createElement("button");v.className="favorite-toggle",v.innerHTML=c.isFavorite?"★":"☆",c.isFavorite&&v.classList.add("is-favorite"),v.title="Als Favorit markieren/entfernen",y.appendChild(v),v.addEventListener("click",b=>{b.stopPropagation(),console.log("favToggle Klick für:",{lat:f,lng:p,label:c.display_name||c.label}),Sf(f,p,c.display_name||c.label)});const M=document.createElement("button");return M.className="delete-location-btn",M.textContent="×",M.title="Diesen Eintrag löschen",y.appendChild(M),M.addEventListener("click",b=>{b.stopPropagation(),confirm(`Möchten Sie "${c.display_name||c.label}" wirklich löschen?`)&&kf(f,p)}),d.appendChild(y),d};if(n.length>0){const c=document.createElement("li");c.className="results-heading",c.textContent="Results",c.style.fontWeight="bold",c.style.background="#f0f0f0",e.appendChild(c),n.forEach(d=>{const f=parseFloat(d.lat),p=parseFloat(d.lon),g=o.find(M=>Math.abs(M.lat-f)<.001&&Math.abs(M.lng-p)<.001);d.isFavorite=!!g,g&&(d.display_name=g.label);const y={lat:f,lng:p,display_name:d.display_name,isFavorite:d.isFavorite},v=l(y);v&&e.appendChild(v)})}if(o.length>0){const c=document.createElement("li");c.className="results-heading",c.textContent="Favorites",c.style.fontWeight="bold",c.style.background="#f0f0f0",e.appendChild(c),o.forEach(d=>{const f=l(d);f&&e.appendChild(f)})}if(s.length>0){const c=document.createElement("li");c.className="results-heading",c.textContent="Previous Locations",c.style.fontWeight="bold",c.style.background="#f0f0f0",e.appendChild(c),s.forEach(d=>{const f=l(d);f&&e.appendChild(f)})}console.log("renderResultsList: Liste gerendert.")}function Ei(){try{return JSON.parse(localStorage.getItem("coordHistory"))||[]}catch{return[]}}function Li(n){try{localStorage.setItem("coordHistory",JSON.stringify(n))}catch(e){console.error("Error saving history:",e)}}function Xo(n,e,a,o=!1){if(isNaN(n)||isNaN(e))return;let s=Ei();const l=parseFloat(n.toFixed(5)),c=parseFloat(e.toFixed(5));s=s.filter(p=>Math.abs(p.lat-l)>1e-4||Math.abs(p.lng-c)>1e-4),s.unshift({lat:l,lng:c,label:a,isFavorite:o,timestamp:Date.now()});const d=s.filter(p=>p.isFavorite),f=s.filter(p=>!p.isFavorite).slice(0,5);Li([...d,...f]),Re()}function ec(n,e,a,o=!1){if(isNaN(n)||isNaN(e)){console.error("Ungültige Koordinaten in addOrUpdateFavorite:",{lat:n,lng:e});return}if(je){console.log("addOrUpdateFavorite blockiert.");return}je=!0;try{let s=Ei();const l=parseFloat(n.toFixed(5)),c=parseFloat(e.toFixed(5));console.log("addOrUpdateFavorite: Verarbeite:",{newLat:l,newLng:c,name:a});const d=s.find(f=>Math.abs(f.lat-l)<1e-4&&Math.abs(f.lng-c)<1e-4);if(d)console.log("addOrUpdateFavorite: Aktualisiere bestehenden Eintrag:",d),d.isFavorite=!0,d.label=a;else{const f={lat:l,lng:c,label:a,isFavorite:!0,timestamp:Date.now()};console.log("addOrUpdateFavorite: Füge neuen Eintrag hinzu:",f),s.unshift(f)}Li(s),console.log("addOrUpdateFavorite: Verlauf nach Speicherung:",JSON.stringify(s)),o||T.handleMessage(`"${a}" als Favorit gespeichert.`),Re()}catch(s){console.error("Fehler in addOrUpdateFavorite:",s)}finally{je=!1,console.log("addOrUpdateFavorite abgeschlossen.")}}function Sf(n,e,a){if(isNaN(n)||isNaN(e)){console.error("Ungültige Koordinaten in toggleFavorite:",{lat:n,lng:e});return}if(je){console.log("toggleFavorite blockiert: Ein Favorit wird bereits hinzugefügt.");return}let o=Ei();const s=parseFloat(n.toFixed(5)),l=parseFloat(e.toFixed(5));console.log("toggleFavorite: Suche nach Eintrag mit:",{newLat:s,newLng:l,label:a});const c=o.find(d=>{const f=parseFloat(d.lat),p=parseFloat(d.lng);return Math.abs(f-s)<1e-4&&Math.abs(p-l)<1e-4});if(c)if(console.log("toggleFavorite: Bestehender Eintrag gefunden:",c),c.isFavorite)c.isFavorite=!1,T.handleMessage(`"${c.label}" ist kein Favorit mehr.`),Li(o),Re();else{je=!0;try{const d=prompt("Please enter a name for this favorite:",c.label||a);if(d)c.isFavorite=!0,c.label=d,T.handleMessage(`"${d}" als Favorit gespeichert.`),Li(o),Re();else{c.isFavorite=!1;return}}finally{je=!1,console.log("toggleFavorite abgeschlossen, Sperre aufgehoben.")}}else{console.log("toggleFavorite: Kein bestehender Eintrag, füge neuen Favoriten hinzu.");const d=prompt("Please enter a name for this favorite:",a);d&&ec(s,l,d)}}function kf(n,e){if(isNaN(n)||isNaN(e))return;const o=Ei().filter(s=>{const l=parseFloat(s.lat),c=parseFloat(s.lng||s.lon);return Math.abs(l-n)>1e-4||Math.abs(c-e)>1e-4});Li(o),T.handleMessage("Location deleted."),Re()}var fa={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Pf=fa.exports,Nr;function Ef(){return Nr||(Nr=1,function(n,e){((a,o)=>{n.exports=o()})(Pf,function a(){var o=typeof self<"u"?self:typeof window<"u"?window:o!==void 0?o:{},s,l=!o.document&&!!o.postMessage,c=o.IS_PAPA_WORKER||!1,d={},f=0,p={};function g(k){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(C){var O=B(C);O.chunkSize=parseInt(O.chunkSize),C.step||C.chunk||(O.chunkSize=null),this._handle=new S(O),(this._handle.streamer=this)._config=O}).call(this,k),this.parseChunk=function(C,O){var F=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<F){let W=this._config.newline;W||(z=this._config.quoteChar||'"',W=this._handle.guessLineEndings(C,z)),C=[...C.split(W).slice(F)].join(W)}this.isFirstChunk&&$(this._config.beforeFirstChunk)&&(z=this._config.beforeFirstChunk(C))!==void 0&&(C=z),this.isFirstChunk=!1,this._halted=!1;var F=this._partialLine+C,z=(this._partialLine="",this._handle.parse(F,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(C=z.meta.cursor,F=(this._finished||(this._partialLine=F.substring(C-this._baseIndex),this._baseIndex=C),z&&z.data&&(this._rowCount+=z.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),c)o.postMessage({results:z,workerId:p.WORKER_ID,finished:F});else if($(this._config.chunk)&&!O){if(this._config.chunk(z,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=z=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(z.data),this._completeResults.errors=this._completeResults.errors.concat(z.errors),this._completeResults.meta=z.meta),this._completed||!F||!$(this._config.complete)||z&&z.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),F||z&&z.meta.paused||this._nextChunk(),z}this._halted=!0},this._sendError=function(C){$(this._config.error)?this._config.error(C):c&&this._config.error&&o.postMessage({workerId:p.WORKER_ID,error:C,finished:!1})}}function y(k){var C;(k=k||{}).chunkSize||(k.chunkSize=p.RemoteChunkSize),g.call(this,k),this._nextChunk=l?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(O){this._input=O,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(C=new XMLHttpRequest,this._config.withCredentials&&(C.withCredentials=this._config.withCredentials),l||(C.onload=U(this._chunkLoaded,this),C.onerror=U(this._chunkError,this)),C.open(this._config.downloadRequestBody?"POST":"GET",this._input,!l),this._config.downloadRequestHeaders){var O,F=this._config.downloadRequestHeaders;for(O in F)C.setRequestHeader(O,F[O])}var z;this._config.chunkSize&&(z=this._start+this._config.chunkSize-1,C.setRequestHeader("Range","bytes="+this._start+"-"+z));try{C.send(this._config.downloadRequestBody)}catch(W){this._chunkError(W.message)}l&&C.status===0&&this._chunkError()}},this._chunkLoaded=function(){C.readyState===4&&(C.status<200||400<=C.status?this._chunkError():(this._start+=this._config.chunkSize||C.responseText.length,this._finished=!this._config.chunkSize||this._start>=(O=>(O=O.getResponseHeader("Content-Range"))!==null?parseInt(O.substring(O.lastIndexOf("/")+1)):-1)(C),this.parseChunk(C.responseText)))},this._chunkError=function(O){O=C.statusText||O,this._sendError(new Error(O))}}function v(k){(k=k||{}).chunkSize||(k.chunkSize=p.LocalChunkSize),g.call(this,k);var C,O,F=typeof FileReader<"u";this.stream=function(z){this._input=z,O=z.slice||z.webkitSlice||z.mozSlice,F?((C=new FileReader).onload=U(this._chunkLoaded,this),C.onerror=U(this._chunkError,this)):C=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var z=this._input,W=(this._config.chunkSize&&(W=Math.min(this._start+this._config.chunkSize,this._input.size),z=O.call(z,this._start,W)),C.readAsText(z,this._config.encoding));F||this._chunkLoaded({target:{result:W}})},this._chunkLoaded=function(z){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(z.target.result)},this._chunkError=function(){this._sendError(C.error)}}function M(k){var C;g.call(this,k=k||{}),this.stream=function(O){return C=O,this._nextChunk()},this._nextChunk=function(){var O,F;if(!this._finished)return O=this._config.chunkSize,C=O?(F=C.substring(0,O),C.substring(O)):(F=C,""),this._finished=!C,this.parseChunk(F)}}function b(k){g.call(this,k=k||{});var C=[],O=!0,F=!1;this.pause=function(){g.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){g.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(z){this._input=z,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){F&&C.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),C.length?this.parseChunk(C.shift()):O=!0},this._streamData=U(function(z){try{C.push(typeof z=="string"?z:z.toString(this._config.encoding)),O&&(O=!1,this._checkIsFinished(),this.parseChunk(C.shift()))}catch(W){this._streamError(W)}},this),this._streamError=U(function(z){this._streamCleanUp(),this._sendError(z)},this),this._streamEnd=U(function(){this._streamCleanUp(),F=!0,this._streamData("")},this),this._streamCleanUp=U(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function S(k){var C,O,F,z,W=Math.pow(2,53),it=-W,bt=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,et=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,at=this,G=0,tt=0,J=!1,Z=!1,nt=[],V={data:[],errors:[],meta:{}};function lt(X){return k.skipEmptyLines==="greedy"?X.join("").trim()==="":X.length===1&&X[0].length===0}function Y(){if(V&&F&&(ft("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+p.DefaultDelimiter+"'"),F=!1),k.skipEmptyLines&&(V.data=V.data.filter(function(Lt){return!lt(Lt)})),j()){let Lt=function(kt,pt){$(k.transformHeader)&&(kt=k.transformHeader(kt,pt)),nt.push(kt)};var rt=Lt;if(V)if(Array.isArray(V.data[0])){for(var X=0;j()&&X<V.data.length;X++)V.data[X].forEach(Lt);V.data.splice(0,1)}else V.data.forEach(Lt)}function ht(Lt,kt){for(var pt=k.header?{}:[],mt=0;mt<Lt.length;mt++){var ct=mt,Dt=Lt[mt],Dt=((yt,At)=>(Ft=>(k.dynamicTypingFunction&&k.dynamicTyping[Ft]===void 0&&(k.dynamicTyping[Ft]=k.dynamicTypingFunction(Ft)),(k.dynamicTyping[Ft]||k.dynamicTyping)===!0))(yt)?At==="true"||At==="TRUE"||At!=="false"&&At!=="FALSE"&&((Ft=>{if(bt.test(Ft)&&(Ft=parseFloat(Ft),it<Ft&&Ft<W))return 1})(At)?parseFloat(At):et.test(At)?new Date(At):At===""?null:At):At)(ct=k.header?mt>=nt.length?"__parsed_extra":nt[mt]:ct,Dt=k.transform?k.transform(Dt,ct):Dt);ct==="__parsed_extra"?(pt[ct]=pt[ct]||[],pt[ct].push(Dt)):pt[ct]=Dt}return k.header&&(mt>nt.length?ft("FieldMismatch","TooManyFields","Too many fields: expected "+nt.length+" fields but parsed "+mt,tt+kt):mt<nt.length&&ft("FieldMismatch","TooFewFields","Too few fields: expected "+nt.length+" fields but parsed "+mt,tt+kt)),pt}var wt;V&&(k.header||k.dynamicTyping||k.transform)&&(wt=1,!V.data.length||Array.isArray(V.data[0])?(V.data=V.data.map(ht),wt=V.data.length):V.data=ht(V.data,0),k.header&&V.meta&&(V.meta.fields=nt),tt+=wt)}function j(){return k.header&&nt.length===0}function ft(X,ht,wt,rt){X={type:X,code:ht,message:wt},rt!==void 0&&(X.row=rt),V.errors.push(X)}$(k.step)&&(z=k.step,k.step=function(X){V=X,j()?Y():(Y(),V.data.length!==0&&(G+=X.data.length,k.preview&&G>k.preview?O.abort():(V.data=V.data[0],z(V,at))))}),this.parse=function(X,ht,wt){var rt=k.quoteChar||'"',rt=(k.newline||(k.newline=this.guessLineEndings(X,rt)),F=!1,k.delimiter?$(k.delimiter)&&(k.delimiter=k.delimiter(X),V.meta.delimiter=k.delimiter):((rt=((Lt,kt,pt,mt,ct)=>{var Dt,yt,At,Ft;ct=ct||[",","	","|",";",p.RECORD_SEP,p.UNIT_SEP];for(var de=0;de<ct.length;de++){for(var It,xe=ct[de],Rt=0,Vt=0,Et=0,zt=(At=void 0,new x({comments:mt,delimiter:xe,newline:kt,preview:10}).parse(Lt)),qt=0;qt<zt.data.length;qt++)pt&&lt(zt.data[qt])?Et++:(It=zt.data[qt].length,Vt+=It,At===void 0?At=It:0<It&&(Rt+=Math.abs(It-At),At=It));0<zt.data.length&&(Vt/=zt.data.length-Et),(yt===void 0||Rt<=yt)&&(Ft===void 0||Ft<Vt)&&1.99<Vt&&(yt=Rt,Dt=xe,Ft=Vt)}return{successful:!!(k.delimiter=Dt),bestDelimiter:Dt}})(X,k.newline,k.skipEmptyLines,k.comments,k.delimitersToGuess)).successful?k.delimiter=rt.bestDelimiter:(F=!0,k.delimiter=p.DefaultDelimiter),V.meta.delimiter=k.delimiter),B(k));return k.preview&&k.header&&rt.preview++,C=X,O=new x(rt),V=O.parse(C,ht,wt),Y(),J?{meta:{paused:!0}}:V||{meta:{paused:!1}}},this.paused=function(){return J},this.pause=function(){J=!0,O.abort(),C=$(k.chunk)?"":C.substring(O.getCharIndex())},this.resume=function(){at.streamer._halted?(J=!1,at.streamer.parseChunk(C,!0)):setTimeout(at.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,O.abort(),V.meta.aborted=!0,$(k.complete)&&k.complete(V),C=""},this.guessLineEndings=function(Lt,rt){Lt=Lt.substring(0,1048576);var rt=new RegExp(P(rt)+"([^]*?)"+P(rt),"gm"),wt=(Lt=Lt.replace(rt,"")).split("\r"),rt=Lt.split(`
`),Lt=1<rt.length&&rt[0].length<wt[0].length;if(wt.length===1||Lt)return`
`;for(var kt=0,pt=0;pt<wt.length;pt++)wt[pt][0]===`
`&&kt++;return kt>=wt.length/2?`\r
`:"\r"}}function P(k){return k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function x(k){var C=(k=k||{}).delimiter,O=k.newline,F=k.comments,z=k.step,W=k.preview,it=k.fastMode,bt=null,et=!1,at=k.quoteChar==null?'"':k.quoteChar,G=at;if(k.escapeChar!==void 0&&(G=k.escapeChar),(typeof C!="string"||-1<p.BAD_DELIMITERS.indexOf(C))&&(C=","),F===C)throw new Error("Comment character same as delimiter");F===!0?F="#":(typeof F!="string"||-1<p.BAD_DELIMITERS.indexOf(F))&&(F=!1),O!==`
`&&O!=="\r"&&O!==`\r
`&&(O=`
`);var tt=0,J=!1;this.parse=function(Z,nt,V){if(typeof Z!="string")throw new Error("Input must be a string");var lt=Z.length,Y=C.length,j=O.length,ft=F.length,X=$(z),ht=[],wt=[],rt=[],Lt=tt=0;if(!Z)return Rt();if(it||it!==!1&&Z.indexOf(at)===-1){for(var kt=Z.split(O),pt=0;pt<kt.length;pt++){if(rt=kt[pt],tt+=rt.length,pt!==kt.length-1)tt+=O.length;else if(V)return Rt();if(!F||rt.substring(0,ft)!==F){if(X){if(ht=[],Ft(rt.split(C)),Vt(),J)return Rt()}else Ft(rt.split(C));if(W&&W<=pt)return ht=ht.slice(0,W),Rt(!0)}}return Rt()}for(var mt=Z.indexOf(C,tt),ct=Z.indexOf(O,tt),Dt=new RegExp(P(G)+P(at),"g"),yt=Z.indexOf(at,tt);;)if(Z[tt]===at)for(yt=tt,tt++;;){if((yt=Z.indexOf(at,yt+1))===-1)return V||wt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ht.length,index:tt}),It();if(yt===lt-1)return It(Z.substring(tt,yt).replace(Dt,at));if(at===G&&Z[yt+1]===G)yt++;else if(at===G||yt===0||Z[yt-1]!==G){mt!==-1&&mt<yt+1&&(mt=Z.indexOf(C,yt+1));var At=de((ct=ct!==-1&&ct<yt+1?Z.indexOf(O,yt+1):ct)===-1?mt:Math.min(mt,ct));if(Z.substr(yt+1+At,Y)===C){rt.push(Z.substring(tt,yt).replace(Dt,at)),Z[tt=yt+1+At+Y]!==at&&(yt=Z.indexOf(at,tt)),mt=Z.indexOf(C,tt),ct=Z.indexOf(O,tt);break}if(At=de(ct),Z.substring(yt+1+At,yt+1+At+j)===O){if(rt.push(Z.substring(tt,yt).replace(Dt,at)),xe(yt+1+At+j),mt=Z.indexOf(C,tt),yt=Z.indexOf(at,tt),X&&(Vt(),J))return Rt();if(W&&ht.length>=W)return Rt(!0);break}wt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ht.length,index:tt}),yt++}}else if(F&&rt.length===0&&Z.substring(tt,tt+ft)===F){if(ct===-1)return Rt();tt=ct+j,ct=Z.indexOf(O,tt),mt=Z.indexOf(C,tt)}else if(mt!==-1&&(mt<ct||ct===-1))rt.push(Z.substring(tt,mt)),tt=mt+Y,mt=Z.indexOf(C,tt);else{if(ct===-1)break;if(rt.push(Z.substring(tt,ct)),xe(ct+j),X&&(Vt(),J))return Rt();if(W&&ht.length>=W)return Rt(!0)}return It();function Ft(Et){ht.push(Et),Lt=tt}function de(Et){var zt=0;return zt=Et!==-1&&(Et=Z.substring(yt+1,Et))&&Et.trim()===""?Et.length:zt}function It(Et){return V||(Et===void 0&&(Et=Z.substring(tt)),rt.push(Et),tt=lt,Ft(rt),X&&Vt()),Rt()}function xe(Et){tt=Et,Ft(rt),rt=[],ct=Z.indexOf(O,tt)}function Rt(Et){if(k.header&&!nt&&ht.length&&!et){var zt=ht[0],qt=Object.create(null),rn=new Set(zt);let qe=!1;for(let be=0;be<zt.length;be++){let ie=zt[be];if(qt[ie=$(k.transformHeader)?k.transformHeader(ie,be):ie]){let Ae,ln=qt[ie];for(;Ae=ie+"_"+ln,ln++,rn.has(Ae););rn.add(Ae),zt[be]=Ae,qt[ie]++,qe=!0,(bt=bt===null?{}:bt)[Ae]=ie}else qt[ie]=1,zt[be]=ie;rn.add(ie)}qe&&console.warn("Duplicate headers found and renamed."),et=!0}return{data:ht,errors:wt,meta:{delimiter:C,linebreak:O,aborted:J,truncated:!!Et,cursor:Lt+(nt||0),renamedHeaders:bt}}}function Vt(){z(Rt()),ht=[],wt=[]}},this.abort=function(){J=!0},this.getCharIndex=function(){return tt}}function A(k){var C=k.data,O=d[C.workerId],F=!1;if(C.error)O.userError(C.error,C.file);else if(C.results&&C.results.data){var z={abort:function(){F=!0,N(C.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if($(O.userStep)){for(var W=0;W<C.results.data.length&&(O.userStep({data:C.results.data[W],errors:C.results.errors,meta:C.results.meta},z),!F);W++);delete C.results}else $(O.userChunk)&&(O.userChunk(C.results,z,C.file),delete C.results)}C.finished&&!F&&N(C.workerId,C.results)}function N(k,C){var O=d[k];$(O.userComplete)&&O.userComplete(C),O.terminate(),delete d[k]}function I(){throw new Error("Not implemented.")}function B(k){if(typeof k!="object"||k===null)return k;var C,O=Array.isArray(k)?[]:{};for(C in k)O[C]=B(k[C]);return O}function U(k,C){return function(){k.apply(C,arguments)}}function $(k){return typeof k=="function"}return p.parse=function(k,C){var O=(C=C||{}).dynamicTyping||!1;if($(O)&&(C.dynamicTypingFunction=O,O={}),C.dynamicTyping=O,C.transform=!!$(C.transform)&&C.transform,!C.worker||!p.WORKERS_SUPPORTED)return O=null,p.NODE_STREAM_INPUT,typeof k=="string"?(k=(F=>F.charCodeAt(0)!==65279?F:F.slice(1))(k),O=new(C.download?y:M)(C)):k.readable===!0&&$(k.read)&&$(k.on)?O=new b(C):(o.File&&k instanceof File||k instanceof Object)&&(O=new v(C)),O.stream(k);(O=(()=>{var F;return!!p.WORKERS_SUPPORTED&&(F=(()=>{var z=o.URL||o.webkitURL||null,W=a.toString();return p.BLOB_URL||(p.BLOB_URL=z.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",W,")();"],{type:"text/javascript"})))})(),(F=new o.Worker(F)).onmessage=A,F.id=f++,d[F.id]=F)})()).userStep=C.step,O.userChunk=C.chunk,O.userComplete=C.complete,O.userError=C.error,C.step=$(C.step),C.chunk=$(C.chunk),C.complete=$(C.complete),C.error=$(C.error),delete C.worker,O.postMessage({input:k,config:C,workerId:O.id})},p.unparse=function(k,C){var O=!1,F=!0,z=",",W=`\r
`,it='"',bt=it+it,et=!1,at=null,G=!1,tt=((()=>{if(typeof C=="object"){if(typeof C.delimiter!="string"||p.BAD_DELIMITERS.filter(function(nt){return C.delimiter.indexOf(nt)!==-1}).length||(z=C.delimiter),typeof C.quotes!="boolean"&&typeof C.quotes!="function"&&!Array.isArray(C.quotes)||(O=C.quotes),typeof C.skipEmptyLines!="boolean"&&typeof C.skipEmptyLines!="string"||(et=C.skipEmptyLines),typeof C.newline=="string"&&(W=C.newline),typeof C.quoteChar=="string"&&(it=C.quoteChar),typeof C.header=="boolean"&&(F=C.header),Array.isArray(C.columns)){if(C.columns.length===0)throw new Error("Option columns is empty");at=C.columns}C.escapeChar!==void 0&&(bt=C.escapeChar+it),C.escapeFormulae instanceof RegExp?G=C.escapeFormulae:typeof C.escapeFormulae=="boolean"&&C.escapeFormulae&&(G=/^[=+\-@\t\r].*$/)}})(),new RegExp(P(it),"g"));if(typeof k=="string"&&(k=JSON.parse(k)),Array.isArray(k)){if(!k.length||Array.isArray(k[0]))return J(null,k,et);if(typeof k[0]=="object")return J(at||Object.keys(k[0]),k,et)}else if(typeof k=="object")return typeof k.data=="string"&&(k.data=JSON.parse(k.data)),Array.isArray(k.data)&&(k.fields||(k.fields=k.meta&&k.meta.fields||at),k.fields||(k.fields=Array.isArray(k.data[0])?k.fields:typeof k.data[0]=="object"?Object.keys(k.data[0]):[]),Array.isArray(k.data[0])||typeof k.data[0]=="object"||(k.data=[k.data])),J(k.fields||[],k.data||[],et);throw new Error("Unable to serialize unrecognized input");function J(nt,V,lt){var Y="",j=(typeof nt=="string"&&(nt=JSON.parse(nt)),typeof V=="string"&&(V=JSON.parse(V)),Array.isArray(nt)&&0<nt.length),ft=!Array.isArray(V[0]);if(j&&F){for(var X=0;X<nt.length;X++)0<X&&(Y+=z),Y+=Z(nt[X],X);0<V.length&&(Y+=W)}for(var ht=0;ht<V.length;ht++){var wt=(j?nt:V[ht]).length,rt=!1,Lt=j?Object.keys(V[ht]).length===0:V[ht].length===0;if(lt&&!j&&(rt=lt==="greedy"?V[ht].join("").trim()==="":V[ht].length===1&&V[ht][0].length===0),lt==="greedy"&&j){for(var kt=[],pt=0;pt<wt;pt++){var mt=ft?nt[pt]:pt;kt.push(V[ht][mt])}rt=kt.join("").trim()===""}if(!rt){for(var ct=0;ct<wt;ct++){0<ct&&!Lt&&(Y+=z);var Dt=j&&ft?nt[ct]:ct;Y+=Z(V[ht][Dt],ct)}ht<V.length-1&&(!lt||0<wt&&!Lt)&&(Y+=W)}}return Y}function Z(nt,V){var lt,Y;return nt==null?"":nt.constructor===Date?JSON.stringify(nt).slice(1,25):(Y=!1,G&&typeof nt=="string"&&G.test(nt)&&(nt="'"+nt,Y=!0),lt=nt.toString().replace(tt,bt),(Y=Y||O===!0||typeof O=="function"&&O(nt,V)||Array.isArray(O)&&O[V]||((j,ft)=>{for(var X=0;X<ft.length;X++)if(-1<j.indexOf(ft[X]))return!0;return!1})(lt,p.BAD_DELIMITERS)||-1<lt.indexOf(z)||lt.charAt(0)===" "||lt.charAt(lt.length-1)===" ")?it+lt+it:lt)}},p.RECORD_SEP="",p.UNIT_SEP="",p.BYTE_ORDER_MARK="\uFEFF",p.BAD_DELIMITERS=["\r",`
`,'"',p.BYTE_ORDER_MARK],p.WORKERS_SUPPORTED=!l&&!!o.Worker,p.NODE_STREAM_INPUT=1,p.LocalChunkSize=10485760,p.RemoteChunkSize=5242880,p.DefaultDelimiter=",",p.Parser=x,p.ParserHandle=S,p.NetworkStreamer=y,p.FileStreamer=v,p.StringStreamer=M,p.ReadableStreamStreamer=b,o.jQuery&&((s=o.jQuery).fn.parse=function(k){var C=k.config||{},O=[];return this.each(function(W){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var it=0;it<this.files.length;it++)O.push({file:this.files[it],inputElem:this,instanceConfig:s.extend({},C)})}),F(),this;function F(){if(O.length===0)$(k.complete)&&k.complete();else{var W,it,bt,et,at=O[0];if($(k.before)){var G=k.before(at.file,at.inputElem);if(typeof G=="object"){if(G.action==="abort")return W="AbortError",it=at.file,bt=at.inputElem,et=G.reason,void($(k.error)&&k.error({name:W},it,bt,et));if(G.action==="skip")return void z();typeof G.config=="object"&&(at.instanceConfig=s.extend(at.instanceConfig,G.config))}else if(G==="skip")return void z()}var tt=at.instanceConfig.complete;at.instanceConfig.complete=function(J){$(tt)&&tt(J,at.file,at.inputElem),z()},p.parse(at.file,at.instanceConfig)}}function z(){O.splice(0,1),F()}}),c&&(o.onmessage=function(k){k=k.data,p.WORKER_ID===void 0&&k&&(p.WORKER_ID=k.workerId),typeof k.input=="string"?o.postMessage({workerId:p.WORKER_ID,results:p.parse(k.input,k.config),finished:!0}):(o.File&&k.input instanceof File||k.input instanceof Object)&&(k=p.parse(k.input,k.config))&&o.postMessage({workerId:p.WORKER_ID,results:k,finished:!0})}),(y.prototype=Object.create(g.prototype)).constructor=y,(v.prototype=Object.create(g.prototype)).constructor=v,(M.prototype=Object.create(M.prototype)).constructor=M,(b.prototype=Object.create(g.prototype)).constructor=b,p})}(fa)),fa.exports}var Cf=Ef();function xf(n,e,a,o){if(!u.map)return console.warn("Map not initialized for getTooltipContent"),"Map not initialized";const s=_.getValue("coordFormat","radio","Decimal"),l=_.getValue("windUnit","radio","kt"),c=_.getValue("heightUnit","radio","m"),d=T.convertCoords(n.lat,n.lng,s);let f=s==="MGRS"?`MGRS: ${d.lat}`:`Lat: ${d.lat}<br>Lng: ${d.lng}`;const p=n.ele;let g=p!==null&&o!==null?p-o:null;if(g!==null){const M=c||_.state.userSettings.heightUnit||"m";g=T.convertHeight(g,M),g=Math.round(g),f+=`<br>Altitude: ${g} ${M} AGL`}else f+="<br>Altitude: N/A";let y="N/A",v="N/A";if(e>0&&n.time&&a[e-1].time&&n.ele!==null&&a[e-1].ele!==null){const M=(n.time.toMillis()-a[e-1].time.toMillis())/1e3;if(M>0){const S=u.map.distance([a[e-1].lat,a[e-1].lng],[n.lat,n.lng])/M;y=T.convertWind(S,l,"m/s"),y=l==="bft"?Math.round(y):y.toFixed(1),v=((n.ele-a[e-1].ele)/M).toFixed(1)}}return f+=`<br>Speed: ${y} ${l}`,f+=`<br>Descent Rate: ${v} m/s`,f}async function Af(n){if(!u.map)return T.handleError("Map not initialized."),null;u.isLoadingGpx=!0;const e=new FileReader;return new Promise((a,o)=>{e.onload=async function(s){var l,c;try{const d=s.target.result,g=new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("trkpt"),y=[];for(let M=0;M<g.length;M++){const b=parseFloat(g[M].getAttribute("lat")),S=parseFloat(g[M].getAttribute("lon"));if(isNaN(b)||isNaN(S))continue;const P=(l=g[M].getElementsByTagName("ele")[0])==null?void 0:l.textContent,x=(c=g[M].getElementsByTagName("time")[0])==null?void 0:c.textContent;y.push({lat:b,lng:S,ele:P?parseFloat(P):null,time:x?ot.fromISO(x,{zone:"utc"}):null})}if(y.length<2)throw new Error("GPX track has insufficient points.");const v=await nc(y,n.name);a(v)}catch(d){console.error("[trackManager] Error in loadGpxTrack:",d),T.handleError("Error parsing GPX file: "+d.message),a(null)}finally{u.isLoadingGpx=!1}},e.onerror=()=>{T.handleError("Error reading GPX file."),u.isLoadingGpx=!1,o(new Error("Error reading GPX file."))},e.readAsText(n)})}async function If(n){if(!u.map)return T.handleError("Map not initialized."),null;u.isLoadingGpx=!0;const e=new FileReader;return new Promise((a,o)=>{e.onload=async function(s){try{const l=s.target.result,c=[];Cf.parse(l,{skipEmptyLines:!0,step:function(d){const f=d.data;if(f[0]&&f[0].toUpperCase()==="$GNSS"&&f.length>=5){let p=f[1];const g=parseFloat(f[2]),y=parseFloat(f[3]),v=parseFloat(f[4]);if(isNaN(g)||isNaN(y)||isNaN(v))return;let M=null;try{M=ot.fromISO(p,{setZone:!0}).toUTC(),M.isValid||(M=null)}catch{M=null}c.push({lat:g,lng:y,ele:v,time:M})}},complete:async function(){if(c.length<2)throw new Error("CSV track has insufficient points.");const d=await nc(c,n.name);a(d)},error:function(d){throw new Error("Error parsing CSV: "+d.message)}})}catch(l){console.error("[trackManager] Error in loadCsvTrackUTC:",l),T.handleError("Error parsing CSV file: "+l.message),a(null)}finally{u.isLoadingGpx=!1}},e.onerror=()=>{T.handleError("Error reading CSV file."),u.isLoadingGpx=!1,o(new Error("Error reading CSV file."))},e.readAsText(n)})}async function nc(n,e){try{if(console.log(`[trackManager] renderTrack called for ${e} with ${n.length} points.`),!u.map)return console.warn("[trackManager] Map object in AppState is not available in renderTrack."),T.handleError("Map not initialized. Cannot render track."),null;u.gpxLayer&&u.map.hasLayer(u.gpxLayer)&&u.map.removeLayer(u.gpxLayer),u.gpxLayer=null,u.gpxPoints=n,u.isTrackLoaded=!1;const a={finalPointData:null,timestampToUseForWeather:null,historicalDateString:null,summaryForInfoElement:"",success:!1};if(n.length>0){const s=n[n.length-1];if(u.lastLat=s.lat,u.lastLng=s.lng,u.lastAltitude=await T.getAltitude(u.lastLat,u.lastLng),a.finalPointData={lat:u.lastLat,lng:u.lastLng,altitude:u.lastAltitude},n[0].time&&n[0].time.isValid){const g=n[0].time,y=ot.utc().startOf("day"),v=g.startOf("day");v<y&&(a.historicalDateString=v.toFormat("yyyy-MM-dd"));let M=g.startOf("hour");g.minute>=30&&(M=M.plus({hours:1})),a.timestampToUseForWeather=M.toISO()}const l=(n.reduce((g,y,v)=>{if(v===0||!u.map)return 0;const M=n[v-1];return g+u.map.distance([M.lat,M.lng],[y.lat,y.lng])},0)/1e3).toFixed(2),c=n.map(g=>g.ele).filter(g=>g!==null),d=c.length?Math.min(...c).toFixed(0):"N/A",f=c.length?Math.max(...c).toFixed(0):"N/A",p=new CustomEvent("track:loaded",{detail:{lat:u.lastLat,lng:u.lastLng,altitude:u.lastAltitude,timestamp:a.timestampToUseForWeather,historicalDate:a.historicalDateString,summary:`<br><strong>Track:</strong> Distance: ${l} km, Min Elevation: ${d} m, Max Elevation: ${f} m (Source: ${e})`},bubbles:!0,cancelable:!0});u.map.getContainer().dispatchEvent(p)}u.gpxLayer=K.layerGroup([],{pane:"gpxTrackPane"});const o=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null;for(let s=0;s<n.length-1;s++){const l=n[s],c=n[s+1],d=l.ele,f=c.ele;let p="#808080";if(o!==null&&d!==null&&f!==null){const y=d-o,v=f-o,M=(y+v)/2;p=T.interpolateColor(M)}const g=K.polyline([[l.lat,l.lng],[c.lat,c.lng]],{color:p,weight:4,opacity:.75,pane:"gpxTrackPane"}).bindTooltip("",{sticky:!0});g.on("mousemove",function(y){const v=y.latlng;let M=n[0],b=1/0,S=0;n.forEach((P,x)=>{const A=Math.sqrt(Math.pow(P.lat-v.lat,2)+Math.pow(P.lng-v.lng,2));A<b&&(b=A,M=P,S=x)}),g.setTooltipContent(xf(M,S,n,o)).openTooltip(v)}),u.gpxLayer.addLayer(g)}if(u.map&&u.gpxLayer.addTo(u.map),u.isTrackLoaded=!0,n.length>0&&u.map){const s=K.latLngBounds(n.map(l=>[l.lat,l.lng]));s.isValid()?u.map.fitBounds(s,{padding:[50,50],maxZoom:u.map.getMaxZoom()||18}):T.handleError("Unable to display track: invalid coordinates.")}return a.success=!0,console.log("[trackManager] renderTrack finished successfully."),a}catch(a){return console.error("[trackManager] Error in renderTrack:",a),T.handleError("Error rendering track: "+a.message),u.gpxPoints=[],u.gpxLayer&&u.map&&u.map.hasLayer(u.gpxLayer)&&u.map.removeLayer(u.gpxLayer),u.gpxLayer=null,u.isTrackLoaded=!1,{success:!1,error:a.message}}}function Df(n,e){return K.marker([n,e],{icon:K.divIcon({className:"live-marker",html:'<div style="background-color: blue; width: 10px; height: 10px; border-radius: 50%;"></div>',iconSize:[10,10],iconAnchor:[5,5]}),zIndexOffset:1e3})}function Of(n,e,a){u.accuracyCircle&&u.map.removeLayer(u.accuracyCircle),u.accuracyCircle=K.circle([n,e],{radius:a,color:"blue",fillOpacity:.1,weight:1,dashArray:"5, 5"}).addTo(u.map)}const Nf=T.debounce(async n=>{if(console.log("[LiveTrackingManager] Received position data:",n),!u.map){console.warn("[LiveTrackingManager] Map not initialized, skipping position update.");return}const{latitude:e,longitude:a,accuracy:o,altitude:s,altitudeAccuracy:l}=n.coords;if(console.log("[LiveTrackingManager] Position details:",{latitude:e,longitude:a,accuracy:o,deviceAltitude:s,altitudeAccuracy:l}),o>we.GEOLOCATION_ACCURACY_THRESHOLD_M){console.log("[LiveTrackingManager] Skipping position update due to low accuracy:",o);return}const c=Date.now();let d=0,f="N/A";if(u.prevLat!==null&&u.prevLng!==null&&u.prevTime!==null){const y=u.map.distance([u.prevLat,u.prevLng],[e,a]),v=(c-u.prevTime)/1e3;v>na.MIN_TIME_DIFF_FOR_SPEED_CALC_S&&(d=y/v,f=T.calculateBearing(u.prevLat,u.prevLng,e,a).toFixed(0))}const p=d<na.SPEED_SMOOTHING_TRESHOLD?na.SPEED_SMOOTHING_LOW:na.SPEED_SMOOTHING_HIGH;u.lastSmoothedSpeedMs=p*d+(1-p)*u.lastSmoothedSpeedMs,u.liveMarker?u.liveMarker.setLatLng([e,a]):u.liveMarker=Df(e,a).addTo(u.map),o&&Of(e,a,o),u.prevLat=e,u.prevLng=a,u.prevTime=c;const g=new CustomEvent("tracking:positionUpdated",{detail:{latitude:e,longitude:a,deviceAltitude:s,altitudeAccuracy:l,accuracy:o,speedMs:u.lastSmoothedSpeedMs,direction:f},bubbles:!0,cancelable:!0});console.log("[LiveTrackingManager] Dispatching tracking:positionUpdated event:",g.detail),document.dispatchEvent(g)},300);function Ff(){if(u.watchId===null){if(!navigator.geolocation){T.handleError("Geolocation is not supported by your browser."),document.dispatchEvent(new CustomEvent("tracking:stopped"));return}console.log("[LiveTrackingManager] Starting position tracking..."),u.watchId=navigator.geolocation.watchPosition(Nf,n=>{T.handleError(`Geolocation error: ${n.message}`),ic()},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),document.dispatchEvent(new CustomEvent("tracking:started"))}}function ic(){u.watchId!==null&&(navigator.geolocation.clearWatch(u.watchId),u.watchId=null),u.liveMarker&&u.map.removeLayer(u.liveMarker),u.accuracyCircle&&u.map.removeLayer(u.accuracyCircle),u.liveMarker=null,u.accuracyCircle=null,u.prevLat=null,u.prevLng=null,u.prevTime=null,u.lastSmoothedSpeedMs=0,document.dispatchEvent(new CustomEvent("tracking:stopped")),console.log("[LiveTrackingManager] Stopped position tracking and cleaned up.")}function Fr(){if(u.autoupdateInterval){console.log("[AutoupdateManager] Autoupdate is already running.");return}if(!navigator.onLine){T.handleError("Cannot enable autoupdate while offline.");const n=document.getElementById("autoupdateCheckbox");n&&(n.checked=!1),_.state.userSettings.autoupdate=!1,_.save();return}console.log("[AutoupdateManager] Starting autoupdate interval."),document.dispatchEvent(new CustomEvent("autoupdate:tick",{detail:{isInitialTick:!0}})),u.autoupdateInterval=setInterval(()=>{console.log("[AutoupdateManager] Tick..."),document.dispatchEvent(new CustomEvent("autoupdate:tick",{detail:{isInitialTick:!1}}))},60*1e3),ye("Autoupdate enabled")}function ac(){u.autoupdateInterval&&(clearInterval(u.autoupdateInterval),u.autoupdateInterval=null,console.log("[AutoupdateManager] Stopped autoupdate interval."),ye("Autoupdate disabled"))}function Rf(){var e;const n=document.getElementById("autoupdateCheckbox");if(!n){console.warn("[AutoupdateManager] Autoupdate checkbox not found.");return}n.checked=_.state.userSettings.autoupdate,n.addEventListener("change",()=>{_.state.userSettings.autoupdate=n.checked,_.save();const a=document.getElementById("historicalDatePicker");if(n.checked&&(a!=null&&a.value)){n.checked=!1,_.state.userSettings.autoupdate=!1,_.save(),Gn("Autoupdate cannot be enabled with a historical date set.");return}n.checked?Fr():ac()}),_.state.userSettings.autoupdate&&!((e=document.getElementById("historicalDatePicker"))!=null&&e.value)&&Fr()}window.L=K;function oc(n,e={}){console.log(`[EventManager] Dispatching event: ${n}`,e);const a=new CustomEvent(n,{detail:e,bubbles:!0,cancelable:!0});document.dispatchEvent(a)}const gi=()=>_.getValue("heightUnit","radio","m"),_o=()=>_.getValue("windUnit","radio","kt"),sc=()=>_.getValue("coordFormat","radio","Decimal");function zn(n,e,a){console.log(`setupCheckbox called for id: ${n}`);const o=document.getElementById(n);o?(o._changeHandler&&(o.removeEventListener("change",o._changeHandler),console.log(`Removed previous change listener for ${n}`)),o._changeHandler=s=>{console.log(`Change event fired for ${n}, checked: ${o.checked}, event:`,s),s.stopPropagation(),a(o)},o.addEventListener("change",o._changeHandler),o.addEventListener("click",s=>{console.log(`Click event on ${n}, checked: ${o.checked}, target:`,s.target)}),console.log(`Attached change and click listeners to ${n}`),n==="showLandingPattern"&&!(_.isFeatureUnlocked("landingPattern")&&_.state.isLandingPatternUnlocked)&&(o.style.opacity="0.5",o.title="Feature locked. Click to enter password.")):console.warn(`Checkbox ${n} not found`)}function yo(n,e,a){if(console.log(`toggleSubmenu called for ${n.textContent||n.id}: ${a?"show":"hide"}`),e){e.classList.contains("submenu")||e.classList.add("submenu"),e.classList.toggle("hidden",!a),n.setAttribute("aria-expanded",a),console.log(`Submenu toggled for ${n.textContent||n.id}: ${a?"shown":"hidden"}`);let o=0;const s=5,l=()=>{const c={isHidden:e.classList.contains("hidden"),displayStyle:window.getComputedStyle(e).display};a&&(c.isHidden||c.displayStyle==="none")&&(console.warn(`Submenu for ${n.textContent||n.id} was hidden unexpectedly. Forcing it to be visible.`),e.classList.remove("hidden"),e.style.display="block",o++,o<s&&setTimeout(l,100))};setTimeout(l,100)}else console.warn(`Submenu for ${n.textContent||n.id} not found`)}function We(n,e){document.querySelectorAll(`input[name="${n}"]`).forEach(o=>{o.addEventListener("change",()=>{const s=_.getValue(n,"radio",_.defaultSettings[n]);if(_.state.userSettings[n]=s,_.save(),console.log(`${n} changed to: ${s} and saved to localStorage`),n==="landingDirection"){const l=document.getElementById("customLandingDirectionLL"),c=document.getElementById("customLandingDirectionRR"),d=_.state.userSettings.landingDirection;l&&(l.disabled=d!=="LL"),c&&(c.disabled=d!=="RR"),d==="LL"&&l&&!l.value&&_.state.userSettings.customLandingDirectionLL===""&&(l.value=Math.round(u.landingWindDir||0),_.state.userSettings.customLandingDirectionLL=parseInt(l.value),_.save(),console.log(`Set customLandingDirectionLL to ${l.value}`)),d==="RR"&&c&&!c.value&&_.state.userSettings.customLandingDirectionRR===""&&(c.value=Math.round(u.landingWindDir||0),_.state.userSettings.customLandingDirectionRR=parseInt(c.value),_.save(),console.log(`Set customLandingDirectionRR to ${c.value}`))}e()})})}function Xt(n,e,a,o){const s=document.getElementById(n);if(!s){console.warn(`Input element ${n} not found`);return}s.addEventListener(e,T.debounce(()=>{const l=s.type==="number"?parseFloat(s.value):s.value;_.state.userSettings[n]=l,_.save(),console.log(`${n} changed to: ${l} and saved to localStorage`),o(l)},a))}function vo(n,e){const a=document.getElementById(n);if(!a){console.warn(`Input element ${n} not found`);return}a.addEventListener("blur",()=>{const o=parseInt(a.value)||e;console.log(`Attempting to update ${n} to ${o}`),_.state.userSettings[n]=o,_.save();const s=document.getElementById("legHeightFinal"),l=document.getElementById("legHeightBase"),c=document.getElementById("legHeightDownwind");if(!isNaN(o)&&o>=50&&o<=1e3&&om(s,l,c))console.log(`Valid ${n}: ${o}, updating displays`),le(),u.weatherData&&u.lastLat&&u.lastLng&&n==="legHeightDownwind"&&_.state.userSettings.calculateJump&&nn();else{let d=e;const f=parseInt(s==null?void 0:s.value)||100,p=parseInt(l==null?void 0:l.value)||200,g=parseInt(c==null?void 0:c.value)||300;n==="legHeightFinal"&&(d=Math.min(p-1,100)),n==="legHeightBase"&&(d=Math.max(f+1,Math.min(g-1,200))),n==="legHeightDownwind"&&(d=Math.max(p+1,300)),a.value=d,_.state.userSettings[n]=d,_.save(),console.log(`Adjusted ${n} to ${d} due to invalid input`),T.handleError(`Adjusted ${n} to ${d} to maintain valid leg order.`)}})}function zf(){console.log("setupMenuEvents wird aufgerufen für allgemeine Menü-Logik.");const n=document.getElementById("hamburgerBtn"),e=document.getElementById("menu");!n||!e||(n.addEventListener("click",a=>{a.stopPropagation(),e.classList.toggle("hidden")}),document.addEventListener("click",a=>{!e.contains(a.target)&&!n.contains(a.target)&&e.classList.add("hidden")}),e.addEventListener("click",a=>{const o=a.target;if(o.matches("li > span")||o.matches("li > label")){a.preventDefault(),a.stopPropagation();const l=o.closest("li").querySelector("ul.submenu");l&&l.classList.toggle("hidden")}}))}function $f(){if(!u.map){console.warn("Map not initialized, skipping setupCheckboxEvents");return}zn("showTableCheckbox","showTable",c=>{_.state.userSettings.showTable=c.checked,_.save(),console.log("showTableCheckbox changed:",c.checked);const d=document.getElementById("info");d&&(d.style.display=c.checked?"block":"none",console.log("Info display set to:",d.style.display)),c.checked&&u.weatherData&&u.lastLat&&u.lastLng&&Ea(ze()),Vn()}),zn("showExitAreaCheckbox","showExitArea",c=>{_.state.userSettings.showExitArea=c.checked,_.save(),console.log("Show Exit Area set to:",_.state.userSettings.showExitArea),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&he()}),zn("showCanopyAreaCheckbox","showCanopyArea",c=>{_.state.userSettings.showCanopyArea=c.checked,_.save(),console.log("Show Canopy Area set to:",_.state.userSettings.showCanopyArea),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&he()}),zn("showJumpRunTrack","showJumpRunTrack",c=>{if(_.state.userSettings.showJumpRunTrack=c.checked,_.save(),c.checked=_.state.userSettings.showJumpRunTrack,console.log("showJumpRunTrack changed:",c.checked),c.checked&&u.weatherData&&u.lastLat&&u.lastLng&&_.state.isCalculateJumpUnlocked&&_.state.userSettings.calculateJump)am();else{u.jumpRunTrackLayer&&(u.jumpRunTrackLayer.airplaneMarker&&u.map&&typeof u.map.removeLayer=="function"&&(u.map.removeLayer(u.jumpRunTrackLayer.airplaneMarker),u.jumpRunTrackLayer.airplaneMarker=null),u.jumpRunTrackLayer.approachLayer&&u.map&&typeof u.map.removeLayer=="function"&&(u.map.removeLayer(u.jumpRunTrackLayer.approachLayer),u.jumpRunTrackLayer.approachLayer=null),u.map&&typeof u.map.removeLayer=="function"&&u.map.removeLayer(u.jumpRunTrackLayer),u.jumpRunTrackLayer=null,console.log("Removed JRT polyline"));const d=document.getElementById("jumpRunTrackDirection");if(d){const f=wa();d.value=f?f.direction:"",console.log("Updated jumpRunTrackDirection value:",(f==null?void 0:f.direction)||"")}}}),zn("showCutAwayFinder","showCutAwayFinder",c=>{var f;_.state.userSettings.showCutAwayFinder=c.checked,_.save(),console.log("Show Cut Away Finder set to:",c.checked);const d=(f=c.closest("li"))==null?void 0:f.querySelector("ul.submenu");c.checked?d&&d.classList.remove("hidden"):(d&&d.classList.add("hidden"),mf(),u.cutAwayLat=null,u.cutAwayLng=null),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&he()}),zn("showLandingPattern","showLandingPattern",c=>{const d="landingPattern",f=()=>{var y;_.state.userSettings.showLandingPattern=!0,_.save();const g=(y=c.closest("li"))==null?void 0:y.querySelector("ul");yo(c,g,!0),sn()},p=()=>{var y;_.state.userSettings.showLandingPattern=!1,_.save(),c.checked=!1;const g=(y=c.closest("li"))==null?void 0:y.querySelector("ul");yo(c,g,!1),pi(null)};c.checked?_.isFeatureUnlocked(d)?f():_.showPasswordModal(d,f,p):p()});const n=document.getElementById("showJumpMasterLine");n&&(n.disabled=!_.state.userSettings.trackPosition,n.style.opacity=n.disabled?"0.5":"1",n.addEventListener("change",()=>{var f;const c=n.checked;if(c&&n.disabled){n.checked=!1,T.handleError("Please start Live Tracking first.");return}_.state.userSettings.showJumpMasterLine=c,_.save(),oc("ui:showJumpMasterLineChanged",{isChecked:c});const d=(f=n.closest("li"))==null?void 0:f.querySelector("ul.submenu");d&&yo(n,d,c)}));const e=document.getElementById("trackPositionCheckbox");e&&e.addEventListener("change",()=>{const c=e.checked;_.state.userSettings.trackPosition=c,_.save(),c?Ff():ic()});const a=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');a&&(a.disabled=!_.state.userSettings.harpLat||!_.state.userSettings.harpLng,console.log("HARP radio button initialized, disabled:",a.disabled));const o=document.getElementById("placeHarpButton");o&&o.addEventListener("click",()=>{u.isPlacingHarp=!0,console.log("HARP placement mode activated"),u.map.on("click",Ql),T.handleMessage("Click the map to place the HARP marker")});const s=document.getElementById("clearHarpButton");s&&s.addEventListener("click",Mf);const l=document.querySelector(".hamburger-menu");l&&l.addEventListener("click",c=>{console.log("Menu click:",c.target,"class:",c.target.className,"id:",c.target.id)})}function Bf(){const n=document.getElementById("timeSlider");if(!n){console.warn("Time slider not found:",{id:"timeSlider"});return}n.addEventListener("input",async()=>{var a,o,s;const e=parseInt(n.value)||0;if(console.log("Time slider moved to index:",e),u.weatherData&&u.lastLat&&u.lastLng)await Ea(e),await Pa(),u.lastAltitude!=="N/A"&&Mi(),_.state.userSettings.showLandingPattern&&(console.log("Updating landing pattern for slider index:",e),sn()),_.state.userSettings.calculateJump&&(console.log("Recalculating jump for slider index:",e),he(),Ge()),_.state.userSettings.showJumpRunTrack&&(console.log("Updating jump run track for slider index:",e),Jt()),Ve();else{let l="N/A";if((o=(a=u.weatherData)==null?void 0:a.time)!=null&&o[e])l=await T.getDisplayTime(u.weatherData.time[e],u.lastLat,u.lastLng);else if(u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0){const d=Object.keys(u.ensembleModelsData)[0],f=(s=u.ensembleModelsData[d])==null?void 0:s.time;f!=null&&f[e]&&(l=await T.getDisplayTime(f[e],u.lastLat,u.lastLng))}const c=document.getElementById("selectedTime");c&&(c.innerHTML=`Selected Time: ${l}`)}_.state.userSettings.selectedEnsembleModels&&_.state.userSettings.selectedEnsembleModels.length>0&&(console.log("Time slider change triggering ensemble update for index:",e),u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0?ya():console.warn("Ensemble update skipped: AppState.ensembleModelsData is not populated yet."))}),n.addEventListener("change",async()=>{var s,l,c;const e=parseInt(n.value)||0;let a="N/A";if((l=(s=u.weatherData)==null?void 0:s.time)!=null&&l[e])a=await T.getDisplayTime(u.weatherData.time[e],u.lastLat,u.lastLng);else if(u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0){const d=Object.keys(u.ensembleModelsData)[0],f=(c=u.ensembleModelsData[d])==null?void 0:c.time;f!=null&&f[e]&&(a=await T.getDisplayTime(f[e],u.lastLat,u.lastLng))}const o=document.getElementById("selectedTime");o&&(o.innerHTML=`Selected Time: ${a}`,console.log("Time slider change event, updated selectedTime label to:",a))})}function Uf(){const n=document.getElementById("modelSelect");if(!n){console.warn("modelSelect element not found");return}n.addEventListener("change",async()=>{var e,a;if(console.log("Model select changed to:",n.value),_.state.userSettings.model=n.value,_.save(),u.lastLat&&u.lastLng){const o=ze(),s=((a=(e=u.weatherData)==null?void 0:e.time)==null?void 0:a[o])||null,l=await Ln(u.lastLat,u.lastLng,s);l&&await uc(l)}else T.handleError("Please select a position on the map first.")})}function Hf(){if(We("refLevel",()=>{_.updateUnitLabels(),le()}),We("heightUnit",()=>{if(_.updateUnitLabels(),le(),Ve(),u.lastMouseLatLng&&u.coordsControl){const o=sc(),s=u.lastMouseLatLng.lat,l=u.lastMouseLatLng.lng;let c;o==="MGRS"?c=`MGRS: ${T.decimalToMgrs(s,l)}`:c=`Lat: ${s.toFixed(5)}, Lng: ${l.toFixed(5)}`,lc(s,l,{lat:s,lng:l},(d,f)=>{if(u.lastMouseLatLng){const p=Math.abs(u.lastMouseLatLng.lat-f.lat),g=Math.abs(u.lastMouseLatLng.lng-f.lng),y=.05;if(p<y&&g<y){const v=gi();let M=d==="N/A"?"N/A":d;M!=="N/A"&&(M=T.convertHeight(M,v),M=Math.round(M)),console.log("Updating elevation display after heightUnit change:",{lat:s,lng:l,elevation:d,heightUnit:v,displayElevation:M}),u.coordsControl.update(`${c}<br>Elevation: ${M} ${M==="N/A"?"":v}`)}}})}if(u.gpxLayer&&u.gpxPoints.length>0){const o=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null,s=_o(),l=gi();u.gpxLayer.eachLayer(c=>{c instanceof K.Polyline&&c.on("mousemove",function(d){const f=d.latlng;let p=u.gpxPoints[0],g=1/0,y=0;u.gpxPoints.forEach((v,M)=>{const b=Math.sqrt(Math.pow(v.lat-f.lat,2)+Math.pow(v.lng-f.lng,2));b<g&&(g=b,p=v,y=M)}),c.setTooltipContent(getTooltipContent(p,y,u.gpxPoints,o,s,l)).openTooltip(f)})})}}),We("temperatureUnit",()=>{le()}),We("windUnit",()=>{if(_.updateUnitLabels(),le(),Ve(),u.gpxLayer&&u.gpxPoints.length>0){const o=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null,s=_o(),l=gi();u.gpxLayer.eachLayer(c=>{c instanceof K.Polyline&&c.on("mousemove",function(d){const f=d.latlng;let p=u.gpxPoints[0],g=1/0,y=0;u.gpxPoints.forEach((v,M)=>{const b=Math.sqrt(Math.pow(v.lat-f.lat,2)+Math.pow(v.lng-f.lng,2));b<g&&(g=b,p=v,y=M)}),c.setTooltipContent(getTooltipContent(p,y,u.gpxPoints,o,s,l)).openTooltip(f)})})}}),We("timeZone",async()=>{le()}),We("coordFormat",()=>{u.lastLat&&u.lastLng&&Pa(),Ve()}),We("downloadFormat",()=>{console.log("Download format changed:",rc())}),We("landingDirection",()=>{const o=document.getElementById("customLandingDirectionLL"),s=document.getElementById("customLandingDirectionRR"),l=_.state.userSettings.landingDirection;console.log("landingDirection changed:",{landingDirection:l,customLL:o==null?void 0:o.value,customRR:s==null?void 0:s.value}),o&&(o.disabled=l!=="LL",l==="LL"&&!o.value&&u.landingWindDir!==null&&(o.value=Math.round(u.landingWindDir),_.state.userSettings.customLandingDirectionLL=parseInt(o.value),_.save())),s&&(s.disabled=l!=="RR",l==="RR"&&!s.value&&u.landingWindDir!==null&&(s.value=Math.round(u.landingWindDir),_.state.userSettings.customLandingDirectionRR=parseInt(s.value),_.save())),cc(),le()}),We("jumpMasterLineTarget",()=>{_.state.userSettings.jumpMasterLineTarget=_.getValue("jumpMasterLineTarget","radio","DIP"),_.save(),console.log("jumpMasterLineTarget changed:",_.state.userSettings.jumpMasterLineTarget),oc("jml:targetChanged");const o=document.querySelector('input[name="jumpMasterLineTarget"][value="HARP"]');o&&(o.disabled=!u.harpMarker||_.state.userSettings.harpLat===null||_.state.userSettings.harpLng===null,console.log("HARP radio button disabled:",o.disabled))}),u.gpxLayer&&u.gpxPoints.length>0){const o=u.lastAltitude!=="N/A"&&!isNaN(u.lastAltitude)?parseFloat(u.lastAltitude):null,s=_o(),l=gi();u.gpxLayer.eachLayer(c=>{c instanceof K.Polyline&&c.on("mousemove",function(d){const f=d.latlng;let p=u.gpxPoints[0],g=1/0,y=0;u.gpxPoints.forEach((v,M)=>{const b=Math.sqrt(Math.pow(v.lat-f.lat,2)+Math.pow(v.lng-f.lng,2));b<g&&(g=b,p=v,y=M)}),c.setTooltipContent(getTooltipContent(p,y,u.gpxPoints,o,s,l)).openTooltip(f)})})}document.querySelectorAll('input[name="ensembleScenario"]').forEach(o=>{o.addEventListener("change",()=>{if(o.checked)if(_.state.userSettings.currentEnsembleScenario=o.value,u.currentEnsembleScenario=o.value,_.save(),console.log("Ensemble scenario changed to:",o.value),_.state.userSettings.selectedEnsembleModels.length>0){const s=_.state.userSettings.selectedEnsembleModels.every(l=>u.ensembleModelsData&&u.ensembleModelsData[l]);!s&&o.value!=="all_models"?Jo():!s&&o.value==="all_models"&&u.ensembleModelsData&&Object.keys(u.ensembleModelsData).length>0||s?ya():(T.handleMessage("Please select models and ensure data is fetched."),vn())}else o.value!=="all_models"&&T.handleMessage("Please select models from the 'Ensemble > Models' menu first."),vn()})});const e=_.state.userSettings.currentEnsembleScenario||"all_models",a=document.querySelector(`input[name="ensembleScenario"][value="${e}"]`);a&&(a.checked=!0,u.currentEnsembleScenario=e),u.map&&!u.ensembleLayerGroup&&(u.ensembleLayerGroup=K.layerGroup().addTo(u.map))}function Zf(){Xt("lowerLimit","change",300,n=>{u.weatherData&&u.lastLat&&u.lastLng&&u.lastAltitude!=="N/A"&&Mi()}),Xt("upperLimit","change",300,n=>{u.weatherData&&u.lastLat&&u.lastLng&&u.lastAltitude!=="N/A"&&Mi()}),Xt("openingAltitude","change",300,n=>{!isNaN(n)&&n>=500&&n<=15e3?_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&(nn(),Ge()):(T.handleError("Opening altitude must be between 500 and 15000 meters."),Nt("openingAltitude",1200),_.state.userSettings.openingAltitude=1200,_.save())}),Xt("exitAltitude","change",300,n=>{!isNaN(n)&&n>=500&&n<=15e3?_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&nn():(T.handleError("Exit altitude must be between 500 and 15000 meters."),Nt("exitAltitude",3e3),_.state.userSettings.exitAltitude=3e3,_.save())}),Xt("canopySpeed","change",300,n=>{!isNaN(n)&&n>=5&&n<=50?le():(T.handleError("Canopy speed must be between 5 and 50 kt."),Nt("canopySpeed",20),_.state.userSettings.canopySpeed=20,_.save())}),Xt("descentRate","change",300,n=>{!isNaN(n)&&n>=1&&n<=10?le():(T.handleError("Descent rate must be between 1 and 10 m/s."),Nt("descentRate",3),_.state.userSettings.descentRate=3,_.save())}),Xt("interpStepSelect","change",300,n=>{le()}),vo("legHeightFinal",100),vo("legHeightBase",200),vo("legHeightDownwind",300),Xt("customLandingDirectionLL","input",100,n=>{const e=parseInt(n,10);console.log("customLandingDirectionLL input:",{value:n,customDir:e}),!isNaN(e)&&e>=0&&e<=359?(_.state.userSettings.customLandingDirectionLL=e,_.save(),_.state.userSettings.landingDirection==="LL"&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating landing pattern for LL:",e),sn(),Vn())):(T.handleError("Landing direction must be between 0 and 359°."),Nt("customLandingDirectionLL",_.state.userSettings.customLandingDirectionLL||0))}),Xt("customLandingDirectionRR","input",100,n=>{const e=parseInt(n,10);console.log("customLandingDirectionRR input:",{value:n,customDir:e}),!isNaN(e)&&e>=0&&e<=359?(_.state.userSettings.customLandingDirectionRR=e,_.save(),_.state.userSettings.landingDirection==="RR"&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating landing pattern for RR:",e),sn(),Vn())):(T.handleError("Landing direction must be between 0 and 359°."),Nt("customLandingDirectionRR",_.state.userSettings.customLandingDirectionRR||0))}),Xt("jumpRunTrackDirection","change",0,n=>{const e=parseInt(n,10);if(console.log("jumpRunTrackDirection change event:",{value:n,customDir:e,jumpRunTrackOffset:_.state.userSettings.jumpRunTrackOffset}),!isNaN(e)&&e>=0&&e<=359)u.customJumpRunDirection=e,console.log("Set custom direction from input:",e),u.weatherData&&u.lastLat&&u.lastLng?(_.state.userSettings.showJumpRunTrack&&(console.log("Updating JRT for custom direction input"),Jt()),_.state.userSettings.calculateJump&&(console.log("Recalculating jump for custom JRT direction"),nn(),Ge())):console.warn("Cannot update JRT or jump: missing conditions",{weatherData:!!u.weatherData,lastLat:u.lastLat,lastLng:u.lastLng});else{console.log("Invalid direction input, resetting to calculated"),T.handleError("Jump run direction must be between 0 and 359°."),u.customJumpRunDirection=null;const a=document.getElementById("jumpRunTrackDirection");a&&a.addEventListener("change",()=>{const o=parseFloat(a.value);Number.isFinite(o)&&o>=0&&o<=359?(_.state.userSettings.customJumpRunDirection=o,console.log("Setting 'customJumpRunDirection' on change to:",o)):(_.state.userSettings.customJumpRunDirection=null,a.value="",console.log("Invalid direction, resetting to calculated.")),_.save(),Jt()}),u.weatherData&&u.lastLat&&u.lastLng&&(_.state.userSettings.showJumpRunTrack&&(console.log("Updating JRT for invalid direction input"),Jt()),_.state.userSettings.calculateJump&&(console.log("Recalculating jump for reset JRT direction"),nn(),Ge()))}}),Xt("jumpRunTrackOffset","change",0,n=>{const e=parseInt(n,10);if(console.log("jumpRunTrackOffset change event:",{value:n,offset:e}),!isNaN(e)&&e>=-5e4&&e<=5e4&&e%100===0)_.state.userSettings.jumpRunTrackOffset=e,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating JRT for offset change"),Jt());else{T.handleError("Offset must be between -50000 and 50000 in steps of 100.");const a=document.getElementById("jumpRunTrackOffset");a&&(a.value=0),_.state.userSettings.jumpRunTrackOffset=0,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&(console.log("Resetting JRT for invalid offset"),Jt())}}),Xt("jumpRunTrackForwardOffset","change",0,n=>{const e=parseInt(n,10);if(console.log("jumpRunTrackForwardOffset change event:",{value:n,offset:e}),!isNaN(e)&&e>=-5e4&&e<=5e4&&e%100===0)_.state.userSettings.jumpRunTrackForwardOffset=e,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Updating JRT for forward offset change"),Jt());else{T.handleError("Forward offset must be between -50000 and 50000 in steps of 100.");const a=document.getElementById("jumpRunTrackForwardOffset");a&&(a.value=0),_.state.userSettings.jumpRunTrackForwardOffset=0,_.save(),_.state.userSettings.calculateJump&&_.state.userSettings.showJumpRunTrack&&(console.log("Resetting JRT for invalid forward offset"),Jt())}}),Xt("aircraftSpeedKt","change",300,n=>{const e=Br(n);document.getElementById("jumperSeparation").value=e,_.state.userSettings.jumperSeparation=e,_.state.userSettings.aircraftSpeedKt=parseFloat(n),_.save(),he(),Jt()}),Xt("numberOfJumpers","change",300,n=>{const e=parseFloat(n);!isNaN(e)&&e>=1&&e<=50?(_.state.userSettings.numberOfJumpers=e,_.save(),_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Recalculating jump for jumper number change"),nn(),Ge())):(T.handleError("Jumper number must be between 1 and 50."),Nt("numberOfJumpers",defaultSettings.numberOfJumpers),_.state.userSettings.numberOfJumpers=defaultSettings.numberOfJumpers,_.save())}),Xt("jumperSeparation","change",300,n=>{const e=parseFloat(n);!isNaN(e)&&e>=1&&e<=50?(_.state.userSettings.jumperSeparation=e,u.isJumperSeparationManual=!0,_.save(),console.log(`jumperSeparation manually set to ${e}s`),_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Recalculating jump for jumper separation change"),nn(),Ge())):(T.handleError("Jumper separation must be between 1 and 50 seconds."),Nt("jumperSeparation",defaultSettings.jumperSeparation),_.state.userSettings.jumperSeparation=defaultSettings.jumperSeparation,u.isJumperSeparationManual=!1,_.save())}),Xt("cutAwayAltitude","change",300,n=>{!isNaN(n)&&n>=400&&n<=15e3?(_.state.userSettings.cutAwayAltitude=n,_.save(),_.state.userSettings.showCutAwayFinder&&u.weatherData&&u.lastLat&&u.lastLng&&(console.log("Recalculating jump for cut-away altitude change"),he())):(T.handleError("Cut away altitude must be between 400 and 15000 meters."),Nt("cutAwayAltitude",1e3),_.state.userSettings.cutAwayAltitude=1e3,_.save())}),Xt("historicalDatePicker","change",300,n=>{console.log("historicalDatePicker changed to:",n),u.lastLat&&u.lastLng?Ln(u.lastLat,u.lastLng,n?`${n}T00:00:00Z`:null).then(e=>{e&&(u.weatherData=e,le())}):T.handleError("Please select a position on the map first.")})}function Wf(){const n=document.getElementById("downloadButton");n&&n.addEventListener("click",()=>{const e=rc();nm(e)})}function Gf(){const n=document.getElementById("clearHistoricalDate");n&&n.addEventListener("click",()=>{const e=document.getElementById("historicalDatePicker");e&&(e.value="",console.log("Cleared historical date, refetching forecast data"),u.lastLat&&u.lastLng&&Ln(u.lastLat,u.lastLng,null).then(a=>{a&&(u.weatherData=a,le())}))})}function Vf(){tc(),console.log("Coordinate events setup complete.")}function jf(){const n=document.querySelectorAll('input[name="cutAwayState"]');if(n.length===0)return;const e=_.state.userSettings.cutAwayState||"Partially",a=document.querySelector(`input[name="cutAwayState"][value="${e}"]`);a&&(a.checked=!0),n.forEach(o=>{o.addEventListener("change",()=>{o.checked&&(console.log(`Cut Away State changed to: ${o.value}`),_.state.userSettings.cutAwayState=o.value,_.save(),u.weatherData&&u.lastLat&&u.lastLng&&_.state.userSettings.calculateJump&&he())})})}function Jf(){console.log("App: Richte Event-Listener für Track-Einstellungen ein.");const n=(o,s)=>{const l=document.getElementById(o);l&&(l.value=_.state.userSettings[s]||0,console.log(`Set ${o} to initial value:`,l.value),l.addEventListener("input",()=>{const c=parseFloat(l.value);isNaN(c)||(_.state.userSettings[s]=c,_.save(),Jt())}))};n("numberOfJumpers","numberOfJumpers"),n("jumperSeparation","jumperSeparation"),n("jumpRunTrackOffset","jumpRunTrackOffset"),n("jumpRunTrackForwardOffset","jumpRunTrackForwardOffset");const e=document.getElementById("jumpRunTrackDirection");e&&(e.value=_.state.userSettings.customJumpRunDirection||"",e.addEventListener("change",()=>{const o=parseFloat(e.value);Number.isFinite(o)&&o>=0&&o<=359?(_.state.userSettings.customJumpRunDirection=o,console.log("Setting 'customJumpRunDirection' on change to:",o)):(_.state.userSettings.customJumpRunDirection=null,e.value="",console.log("Invalid direction, resetting to calculated.")),_.save(),Jt()}));const a=document.getElementById("showJumpRunTrack");a&&a.addEventListener("change",o=>{_.state.userSettings.showJumpRunTrack=o.target.checked,_.save(),Jt()})}function qf(){console.log("App: Richte Event-Listener für Karten-Events ein."),document.addEventListener("map:location_selected",async n=>{const{lat:e,lng:a,source:o}=n.detail;console.log(`App: Event 'map:location_selected' von '${o}' empfangen.`),u.lastLat=e,u.lastLng=a,u.lastAltitude=await T.getAltitude(e,a),Xo(e,a),resetJumpRunDirection(!0),await Ln(e,a),_.state.userSettings.calculateJump&&(he(),Ge()),Vn(!0),u.isManualPanning=!1,Jt(),sn()}),document.addEventListener("map:mousemove",n=>{const{lat:e,lng:a}=n.detail;u.lastMouseLatLng={lat:e,lng:a};const o=sc();let s;if(o==="MGRS")s=`MGRS: ${T.decimalToMgrs(e,a)||"N/A"}`;else if(o==="DMS"){const l=c=>`${c.deg}°${c.min}'${c.sec.toFixed(0)}" ${c.dir}`;s=`Lat: ${l(T.decimalToDms(e,!0))}, Lng: ${l(T.decimalToDms(a,!1))}`}else s=`Lat: ${e.toFixed(5)}, Lng: ${a.toFixed(5)}`;u.coordsControl&&u.coordsControl.update(`${s}<br>Elevation: Fetching...<br>QFE: Fetching...`),lc(e,a,{lat:e,lng:a},({elevation:l,qfe:c},d)=>{if(u.lastMouseLatLng&&u.coordsControl){const f=Math.abs(u.lastMouseLatLng.lat-d.lat),p=Math.abs(u.lastMouseLatLng.lng-d.lng),g=.05;if(f<g&&p<g){const y=gi();let v=l==="N/A"?"N/A":l;v!=="N/A"&&(v=T.convertHeight(v,y),v=Math.round(v));const M=c==="N/A"?"N/A":`${c} hPa`;u.coordsControl.update(`${s}<br>Elevation: ${v} ${v==="N/A"?"":y}<br>QFE: ${M}`)}}})})}function Kf(){console.log("setupMenuItemEvents wird aufgerufen für 'Calculate Jump'.");const n=Array.from(document.querySelectorAll(".menu-label")).find(o=>o.textContent.trim()==="Calculate Jump");if(!n){console.error("Calculate Jump menu item not found");return}const e=n.closest("li").querySelector("ul.submenu"),a=()=>{_.isFeatureUnlocked("calculateJump")?(n.style.opacity="1",n.title="Click to open/close jump calculation settings"):(n.style.opacity="0.5",n.title="Feature locked. Click to enter password.",e&&e.classList.add("hidden"))};a(),n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),_.isFeatureUnlocked("calculateJump")?e&&e.classList.toggle("hidden"):_.showPasswordModal("calculateJump",()=>{a(),e&&e.classList.remove("hidden")},()=>{a()})})}function Yf(){const n=document.getElementById("resetCutAwayMarker");n&&n.addEventListener("click",()=>{if(!u.map){console.warn("Map not initialized, cannot reset cut-away marker");return}u.cutAwayMarker&&(u.map.removeLayer(u.cutAwayMarker),u.cutAwayMarker=null,u.cutAwayLat=null,u.cutAwayLng=null,console.log("Cut-away marker reset"),u.cutAwayCircle&&(u.map.removeLayer(u.cutAwayCircle),u.cutAwayCircle=null,console.log("Cleared cut-away circle")),document.getElementById("info").innerHTML="Right-click map to place cut-away marker")})}function Xf(){console.log("[app.js] Setting up track events");const n=document.getElementById("trackFileInput"),e=document.getElementById("loading");n&&n.addEventListener("change",async o=>{const s=o.target.files[0];if(e&&(e.style.display="block"),!s){T.handleError("No file selected."),e&&(e.style.display="none");return}const l=s.name.split(".").pop().toLowerCase();let c=null;try{l==="gpx"?c=await Af(s):l==="csv"?c=await If(s):(T.handleError("Unsupported file type. Please upload a .gpx or .csv file."),e&&(e.style.display="none"))}catch(d){console.error("Error during track file processing:",d),T.handleError("Failed to process track file."),e&&(e.style.display="none")}});const a=document.getElementById("clearTrack");a&&a.addEventListener("click",()=>{if(!u.map){T.handleError("Cannot clear track: map not initialized.");return}if(u.gpxLayer)try{u.map.hasLayer(u.gpxLayer)&&u.map.removeLayer(u.gpxLayer),u.gpxLayer=null,u.gpxPoints=[],u.isTrackLoaded=!1;const o=document.getElementById("info");if(o){const s=/(<br><strong>Available Models:<\/strong><ul>.*?<\/ul>|<br><strong>Available Models:<\/strong> None)/s,c=o.innerHTML.match(s);o.innerHTML="Click on the map to fetch weather data."+(c?c[0]:"")}n&&(n.value="")}catch(o){T.handleError("Failed to clear track: "+o.message)}else T.handleMessage("No track to clear.")}),u.map&&u.map.getContainer().addEventListener("track:loaded",async o=>{try{const{lat:s,lng:l,timestamp:c,historicalDate:d,summary:f}=o.detail;if(console.log('Event "track:loaded" empfangen, starte Aktionen.'),d){console.log("Historischer Track geladen, deaktiviere Autoupdate.");const y=document.getElementById("autoupdateCheckbox");y&&(y.checked=!1),ac(),_.state.userSettings.autoupdate=!1,_.save(),T.handleMessage("Autoupdate disabled for historical track viewing.")}await ka(s,l);const p=await Ln(s,l,c);if(p){u.weatherData=p;const y=document.getElementById("timeSlider");if(y&&u.weatherData.time){y.max=u.weatherData.time.length-1,y.disabled=y.max<=0;const v=new Date(c).getTime();let M=0,b=1/0;u.weatherData.time.forEach((S,P)=>{const x=Math.abs(new Date(S).getTime()-v);x<b&&(b=x,M=P)}),y.value=M}}await le(),_.state.isCalculateJumpUnlocked&&_.state.userSettings.calculateJump&&he(),_.state.isLandingPatternUnlocked&&_.state.userSettings.showLandingPattern&&sn();const g=document.getElementById("info");if(g&&f){const y=/(<br><strong>Available Models:<\/strong><ul>.*?<\/ul>|<br><strong>Available Models:<\/strong> None)/s,v=g.innerHTML.match(y);g.innerHTML=f+(v?v[0]:"")}if(d){const y=document.getElementById("historicalDatePicker");y&&(y.value=d)}}catch(s){console.error("Fehler bei der Verarbeitung von track:loaded:",s),T.handleError("Konnte Track-Daten nicht vollständig verarbeiten.")}finally{e&&(e.style.display="none")}})}function Qf(){const n=document.getElementById("bottom-container");if(!n){console.error("Bottom container not found; cannot create settings/cache buttons.");return}const e=document.createElement("div");e.id="settings-cache-buttons",e.className="button-wrapper";const a=document.createElement("button");a.id="resetButton",a.textContent="Reset Settings",a.title="Resets all settings to their default values and locks all features",a.addEventListener("click",()=>{confirm("Are you sure you want to reset all settings and lock all features?")&&(localStorage.removeItem("unlockedFeatures"),localStorage.removeItem("upperWindsSettings"),window.location.reload())}),e.appendChild(a);const o=document.createElement("button");o.id="clearCacheButton",o.textContent="Clear Tile Cache",o.title="Clears cached map tiles. Pan/zoom to cache more tiles for offline use.",o.addEventListener("click",async()=>{try{const s=await ne.getCacheSize();await ne.clearCache(),T.handleMessage(`Tile cache cleared successfully (freed ${s.toFixed(2)} MB).`),console.log("Tile cache cleared")}catch(s){T.handleError("Failed to clear tile cache: "+s.message)}}),e.appendChild(o),n.appendChild(e)}function tm(){const n=document.getElementById("cacheRadiusSelect");n?(n.addEventListener("change",()=>{if(!_.state||!_.state.userSettings){console.error("Settings not properly initialized");return}_.state.userSettings.cacheRadiusKm=parseInt(n.value,10),_.save(),console.log("Updated cacheRadiusKm:",_.state.userSettings.cacheRadiusKm)}),console.log("cacheRadiusSelect listener attached, initial value:",n.value)):console.warn("cacheRadiusSelect not found in DOM");const e=document.getElementById("cacheZoomLevelsSelect");e?(e.addEventListener("change",()=>{const[o,s]=e.value.split("-").map(Number);_.state.userSettings.cacheZoomLevels=Array.from({length:s-o+1},(l,c)=>o+c),_.save(),console.log("Updated cacheZoomLevels:",_.state.userSettings.cacheZoomLevels)}),console.log("cacheZoomLevelsSelect listener attached, initial value:",e.value)):console.warn("cacheZoomLevelsSelect not found in DOM");const a=document.getElementById("recacheNowButton");a?(a.addEventListener("click",o=>{if(o.stopPropagation(),console.log("Recache Now button clicked"),!navigator.onLine){T.handleError("Cannot recache while offline.");return}const{map:s,lastLat:l,lastLng:c,baseMaps:d}=u;if(!s){console.warn("Map not initialized, cannot recache tiles"),T.handleMessage("Map not initialized, cannot recache tiles.");return}Ud({map:s,lastLat:l,lastLng:c,baseMaps:d})}),console.log("recacheNowButton listener attached")):console.warn("recacheNowButton not found in DOM")}function em(){console.log("Initializing all UI event listeners..."),zf(),$f(),Bf(),Uf(),Hf(),Zf(),Wf(),Xf(),Gf(),Vf(),jf(),Jf(),qf(),Kf(),Yf(),Qf(),tm()}const nn=T.debounce(he,300),rc=()=>_.getValue("downloadFormat","radio","csv");T.handleMessage=ye;K.Control.Coordinates=K.Control.extend({options:{position:"bottomleft"},onAdd:function(n){var e=K.DomUtil.create("div","leaflet-control-coordinates");return e.style.background="rgba(255, 255, 255, 0.8)",e.style.padding="5px",e.style.borderRadius="4px",e.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",e.innerHTML="Move mouse over map",this._container=e,e},update:function(n){this._container.innerHTML=n}});let wo=new Map,Lo=new Map;const lc=T.debounce(async(n,e,a,o)=>{var p,g,y,v;const s=`${n.toFixed(5)},${e.toFixed(5)}`,l=ze(),c=`${s}-${l}`;let d,f;if(wo.has(s))d=wo.get(s);else try{d=await T.getAltitude(n,e),wo.set(s,d)}catch(M){console.warn("Failed to fetch elevation:",M),d="N/A"}if(Lo.has(c))f=Lo.get(c);else if(u.weatherData&&u.weatherData.surface_pressure&&l>=0&&l<u.weatherData.surface_pressure.length){const M=u.weatherData.surface_pressure[l],b=((p=u.weatherData.temperature_2m)==null?void 0:p[l])||16.1,S=u.lastAltitude!=="N/A"?u.lastAltitude:339;f=T.calculateQFE(M,d,S,b),Lo.set(c,f),console.log("Calculated QFE:",{lat:n,lng:e,surfacePressure:M,elevation:d,referenceElevation:S,temperature:b,qfe:f})}else console.warn("Surface pressure not available for QFE:",{hasWeatherData:!!u.weatherData,hasSurfacePressure:!!((g=u.weatherData)!=null&&g.surface_pressure),sliderIndexValid:l>=0&&l<(((v=(y=u.weatherData)==null?void 0:y.surface_pressure)==null?void 0:v.length)||0)}),f="N/A";o({elevation:d,qfe:f},a)},500);function Mi(){var $;console.log("Calculating mean wind with model:",document.getElementById("modelSelect").value,"weatherData:",u.weatherData);const n=document.getElementById("timeSlider").value||0,e=Mn(n);let a=parseFloat(document.getElementById("lowerLimit").value)||0,o=parseFloat(document.getElementById("upperLimit").value);const s=(($=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:$.value)||"AGL",l=_.getValue("heightUnit","radio","m"),c=_.getValue("windUnit","radio","kt"),d=Math.round(u.lastAltitude);if(!u.weatherData||u.lastAltitude==="N/A"){handleError("Cannot calculate mean wind: missing data or altitude");return}a=l==="ft"?a/3.28084:a,o=l==="ft"?o/3.28084:o,s==="AMSL"&&a<d&&(T.handleError(`Lower limit adjusted to terrain altitude (${d} m ${s}) as it cannot be below ground level in ${s} mode.`),a=d,document.getElementById("lowerLimit").value=T.convertHeight(a,l));const f=s==="AGL"?a+d:a,p=s==="AGL"?o+d:o;if(isNaN(a)||isNaN(o)||a>=o){T.handleError("Invalid layer limits. Ensure Lower < Upper and both are numbers.");return}if(!e||e.length===0){T.handleError("No valid weather data available to calculate mean wind.");return}const g=e.map(k=>k.height),y=e.map(k=>parseFloat(k.dir)||0),v=e.map(k=>T.convertWind(parseFloat(k.spd)||0,c,"km/h")),M=v.map((k,C)=>-k*Math.sin(y[C]*Math.PI/180)),b=v.map((k,C)=>-k*Math.cos(y[C]*Math.PI/180)),S=T.calculateMeanWind(g,M,b,f,p),[P,x]=S,A=T.roundToTens(P)===0&&P>=0&&P<5?360:T.roundToTens(P),N=Math.round(T.convertHeight(a,l)),I=Math.round(T.convertHeight(o,l));T.convertWind(x,c,"kt");const B=Number.isFinite(x)?c==="bft"?Math.round(x):x.toFixed(1):"N/A",U=`Mean wind (${N}-${I} ${l} ${s}): ${A}° ${B} ${c}`;document.getElementById("meanWindResult").innerHTML=U,console.log("Calculated Mean Wind:",U,"u:",S[2],"v:",S[3])}function nm(n){var J,Z,nt,V,lt,Y;if(!u.weatherData||!u.weatherData.time){T.handleError("No weather data available to download.");return}const e=document.getElementById("timeSlider").value||0,a=document.getElementById("modelSelect").value.toUpperCase(),o=T.formatTime(u.weatherData.time[e]).replace(" ","_"),s=`${o}_${a}_${n}.txt`,l={ATAK:{interpStep:1e3,heightUnit:"ft",refLevel:"AGL",windUnit:"kt"},Windwatch:{interpStep:100,heightUnit:"ft",refLevel:"AGL",windUnit:"km/h"},HEIDIS:{interpStep:100,heightUnit:"m",refLevel:"AGL",temperatureUnit:"C",windUnit:"m/s"},Customized:{}},c={interpStep:$r(),heightUnit:_.getValue("heightUnit","radio","m"),refLevel:((J=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:J.value)||"AGL",windUnit:_.getValue("windUnit","radio","kt"),temperatureUnit:_.getValue("temperatureUnit","radio","C")};let d={...c};const f=l[n];if(f&&Object.keys(f).length>0){let j=!1;for(const[ft,X]of Object.entries(f))if(d[ft]!==X){switch(j=!0,ft){case"interpStep":document.getElementById("interpStepSelect").value=X,_.state.userSettings.interpStep=X;break;case"heightUnit":document.querySelector(`input[name="heightUnit"][value="${X}"]`).checked=!0,_.state.userSettings.heightUnit=X;break;case"refLevel":document.querySelector(`input[name="refLevel"][value="${X}"]`).checked=!0,_.state.userSettings.refLevel=X;break;case"windUnit":document.querySelector(`input[name="windUnit"][value="${X}"]`).checked=!0,_.state.userSettings.windUnit=X;break;case"temperatureUnit":document.querySelector(`input[name="temperatureUnit"][value="${X}"]`).checked=!0,_.state.userSettings.temperatureUnit=X;break}d[ft]=X}j&&(_.save(),console.log(`Adjusted settings for ${n} compatibility:`,f),_.updateUnitLabels(),_.updateUnitLabels(),_.updateUnitLabels())}let p="",g=" ";const y=_.getValue("heightUnit","radio","m"),v=_.getValue("temperatureUnit","radio","C"),M=_.getValue("windUnit","radio","kt"),b=((Z=document.querySelector('input[name="refLevel"]:checked'))==null?void 0:Z.value)||"AGL";if(n==="ATAK")p=`Alt Dir Spd
${y}${b}
`;else if(n==="Windwatch"){const j=Math.round(y==="ft"?u.lastAltitude*3.28084:u.lastAltitude);p=`Version 1.0, ID = 9999999999
${o}, Ground Level: ${j} ft
Windsond ${a}
 AGL[ft] Wind[°] Speed[km/h]
`}else if(n==="HEIDIS"){const j=b==="AGL"?`h(${y}AGL)`:`h(${y}AMSL)`,ft=v==="C"?"°C":"°F";p=`${j} p(hPa) T(${ft}) Dew(${ft}) Dir(°) Spd(${M}) RH(%)`}else if(n==="Customized"){const j=b==="AGL"?`h(${y}AGL)`:`h(${y}AMSL)`,ft=v==="C"?"°C":"°F";p=`${j} p(hPa) T(${ft}) Dew(${ft}) Dir(°) Spd(${M}) RH(%)`}const S=Math.round(u.lastAltitude),P=b==="AGL"?0:S,x=(nt=u.weatherData.temperature_2m)==null?void 0:nt[e],A=(V=u.weatherData.relative_humidity_2m)==null?void 0:V[e],N=(lt=u.weatherData.wind_speed_10m)==null?void 0:lt[e],I=(Y=u.weatherData.wind_direction_10m)==null?void 0:Y[e],B=T.calculateDewpoint(x,A),U=u.weatherData.surface_pressure[e],$=Math.round(T.convertHeight(P,y)),k=T.convertTemperature(x,v),C=T.convertTemperature(B,v),O=T.convertWind(N,M,"km/h"),F=k==="N/A"?"N/A":k.toFixed(1),z=C==="N/A"?"N/A":C.toFixed(1),W=O==="N/A"?"N/A":M==="bft"?Math.round(O):O.toFixed(1),it=I==="N/A"||I===void 0?"N/A":Math.round(I),bt=A==="N/A"||A===void 0?"N/A":Math.round(A);n==="ATAK"?p+=`${$}${g}${it}${g}${W}
`:n==="Windwatch"?p+=`${$}${g}${it}${g}${W}
`:n==="HEIDIS"?p+=`
${$}${g}${U==="N/A"?"N/A":U.toFixed(1)}${g}${F}${g}${z}${g}${it}${g}${W}${g}${bt}
`:n==="Customized"&&(p+=`
${$}${g}${U==="N/A"?"N/A":U.toFixed(1)}${g}${F}${g}${z}${g}${it}${g}${W}${g}${bt}
`);const et=Mn(e);if(!et||et.length===0){T.handleError("No interpolated data available to download.");return}et.forEach(j=>{if(j.displayHeight!==P){const ft=Math.round(T.convertHeight(j.displayHeight,y)),X=j.pressure==="N/A"?"N/A":j.pressure.toFixed(1),ht=T.convertTemperature(j.temp,v),wt=T.convertTemperature(j.dew,v),rt=T.convertWind(j.spd,M,_.getValue("windUnit","radio","kt")),Lt=ht==="N/A"?"N/A":ht.toFixed(1),kt=wt==="N/A"?"N/A":wt.toFixed(1),pt=rt==="N/A"?"N/A":M==="bft"?Math.round(rt):rt.toFixed(1),mt=j.dir==="N/A"?"N/A":Math.round(j.dir),ct=j.rh==="N/A"?"N/A":Math.round(j.rh);n==="ATAK"?p+=`${ft}${g}${mt}${g}${pt}
`:n==="Windwatch"?p+=`${ft}${g}${mt}${g}${pt}
`:n==="HEIDIS"?p+=`${ft}${g}${X}${g}${Lt}${g}${kt}${g}${mt}${g}${pt}${g}${ct}
`:n==="Customized"&&(p+=`${ft}${g}${X}${g}${Lt}${g}${kt}${g}${mt}${g}${pt}${g}${ct}
`)}});const at=new Blob([p],{type:"text/plain"}),G=window.URL.createObjectURL(at),tt=document.createElement("a");tt.href=G,tt.download=s,document.body.appendChild(tt),tt.click(),document.body.removeChild(tt),window.URL.revokeObjectURL(G),document.getElementById("interpStepSelect").value=c.interpStep,document.querySelector(`input[name="heightUnit"][value="${c.heightUnit}"]`).checked=!0,document.querySelector(`input[name="refLevel"][value="${c.refLevel}"]`).checked=!0,document.querySelector(`input[name="windUnit"][value="${c.windUnit}"]`).checked=!0,document.querySelector(`input[name="temperatureUnit"][value="${c.temperatureUnit}"]`).checked=!0,_.state.userSettings.interpStep=c.interpStep,_.state.userSettings.heightUnit=c.heightUnit,_.state.userSettings.refLevel=c.refLevel,_.state.userSettings.windUnit=c.windUnit,_.state.userSettings.temperatureUnit=c.temperatureUnit,_.save(),_.updateUnitLabels(),_.updateUnitLabels(),_.updateUnitLabels()}async function im(){if(!u.lastLat||!u.lastLng){console.warn("No location selected, cannot update weather data"),T.handleError("Please select a location to enable autoupdate."),stopAutoupdate(),document.getElementById("autoupdateCheckbox").checked=!1,_.state.userSettings.autoupdate=!1,_.save();return}if(!navigator.onLine){console.warn("Cannot update weather data: offline"),T.handleError("Cannot update weather data while offline."),stopAutoupdate(),document.getElementById("autoupdateCheckbox").checked=!1,_.state.userSettings.autoupdate=!1,_.save();return}const n=document.getElementById("timeSlider");if(!n){console.warn("Time slider not found, cannot update to current hour");return}const a=new Date().getUTCHours();n.value=a,console.log(`Set slider to current hour: ${a}`);try{await Ln(u.lastLat,u.lastLng,null,!1),console.log("Weather data fetched for current hour"),await Ea(a),u.lastAltitude!=="N/A"&&Mi(),_.state.userSettings.calculateJump&&_.state.isCalculateJumpUnlocked&&(nn(),Ge(),_.state.userSettings.showJumpRunTrack&&Jt()),console.log("Updated all displays for current hour")}catch(o){console.error("Error updating to current hour:",o),T.handleError("Failed to update weather data: "+o.message)}}function he(){if(!_.state.isCalculateJumpUnlocked||!_.state.userSettings.calculateJump){ha(null),Ro(null);return}if(!u.weatherData||!u.lastLat||!u.lastLng){ha(null);return}const n=ze(),e=Mn(n),a={exitCircles:[],canopyCircles:[],canopyLabels:[]};if(_.state.userSettings.showExitArea){const s=Hr(e);if(s){a.exitCircles.push({center:[s.greenLat,s.greenLng],radius:s.greenRadius,color:"green",fillColor:"green",fillOpacity:.2,weight:2});const l=`
                Exit areas calculated with:<br>
                Throw/Drift: ${Number.isFinite(s.freeFallDirection)?Math.round(s.freeFallDirection):"N/A"}° ${Number.isFinite(s.freeFallDistance)?Math.round(s.freeFallDistance):"N/A"} m<br>
                Free Fall Time: ${s.freeFallTime!=null&&!isNaN(s.freeFallTime)?Math.round(s.freeFallTime):"N/A"} sec
            `;a.exitCircles.push({center:[s.darkGreenLat,s.darkGreenLng],radius:s.darkGreenRadius,color:"darkgreen",fillColor:"darkgreen",fillOpacity:.2,weight:2,tooltip:l})}}if(_.state.userSettings.showCanopyArea){const s=bu(e);if(s){const l=T.calculateNewCenter(s.redLat,s.redLng,s.displacementFull,s.directionFull);a.canopyCircles.push({center:l,radius:s.radiusFull,color:"red",weight:2,opacity:.8,fillOpacity:0}),s.additionalBlueRadii.forEach((c,d)=>{const f=T.calculateNewCenter(s.blueLat,s.blueLng,s.additionalBlueDisplacements[d],s.additionalBlueDirections[d]);a.canopyCircles.push({center:f,radius:c,color:"blue",weight:1,fillColor:"blue",fillOpacity:.1,opacity:1}),a.canopyLabels.push({center:f,radius:c,text:`${Math.round(s.additionalBlueUpperLimits[d])}m`})})}}ha(a);let o=null;if(_.state.userSettings.showCutAwayFinder&&u.cutAwayLat!==null){const s=Ge(e);s&&(o={center:s.center,radius:s.radius,tooltipContent:s.tooltipContent})}Ro(o)}function am(){return!_.state.userSettings.showJumpRunTrack||!_.state.userSettings.calculateJump||!u.weatherData||!u.lastLat||!u.lastLng?(console.log("Skipping calculateJumpRunTrack: conditions not met"),null):(console.log("Calculating jump run track..."),Jt(),wa())}function om(n,e,a){const o=parseInt(n.value)||100,s=parseInt(e.value)||200,l=parseInt(a.value)||300;return s<=o?(T.handleError("Base leg must start higher than final leg."),!1):l<=s?(T.handleError("Downwind leg must start higher than base leg."),!1):!0}function Ve(n=null){const e=_.state.userSettings.showJumpMasterLine;if(!e){Or(),vf();return}if(!u.liveMarker){Or();return}const a=u.liveMarker.getLatLng();if(!a)return;const o=n||{latitude:a.lat,longitude:a.lng,speedMs:u.lastSmoothedSpeedMs,direction:u.lastDirection,deviceAltitude:u.lastDeviceAltitude,altitudeAccuracy:u.lastAltitudeAccuracy,accuracy:u.lastAccuracy};let s=null,l=null,c="";if(_.state.userSettings.jumpMasterLineTarget==="HARP"&&u.harpMarker?(l=u.harpMarker.getLatLng(),c="HARP"):u.currentMarker&&(l=u.currentMarker.getLatLng(),c="DIP"),l){const f=u.map.distance(a,l),p=Math.round(T.calculateBearing(a.lat,a.lng,l.lat,l.lng)),g=o.speedMs>1?o.speedMs:1,y=Math.round(f/g);s={distance:f,bearing:p,tot:y,target:c},yf(a,l)}const d={heightUnit:_.getValue("heightUnit","radio","m"),effectiveWindUnit:_.getValue("windUnit","radio","kt")==="bft"?"kt":_.getValue("windUnit","radio","kt"),coordFormat:_.getValue("coordFormat","radio","Decimal"),refLevel:_.getValue("refLevel","radio","AGL")};wf({...o,showJumpMasterLine:e,jumpMasterLineData:s,...d})}function sm(){if(_.initialize(),_.state.isLandingPatternUnlocked=_.state.unlockedFeatures.landingPattern,_.state.isCalculateJumpUnlocked=_.state.unlockedFeatures.calculateJump,_.state.userSettings.showJumpMasterLine=!1,console.log("Initial unlock status:",{isLandingPatternUnlocked:_.state.isLandingPatternUnlocked,isCalculateJumpUnlocked:_.state.isCalculateJumpUnlocked}),u.isInitialized){console.log("App already initialized, skipping");return}u.isInitialized=!0,console.log("Initializing app")}function rm(){lm("modelSelect",_.state.userSettings.model),tn("refLevel",_.state.userSettings.refLevel),tn("heightUnit",_.state.userSettings.heightUnit),tn("temperatureUnit",_.state.userSettings.temperatureUnit),tn("windUnit",_.state.userSettings.windUnit),tn("timeZone",_.state.userSettings.timeZone),tn("coordFormat",_.state.userSettings.coordFormat),tn("downloadFormat",_.state.userSettings.downloadFormat),tn("landingDirection",_.state.userSettings.landingDirection),Nt("canopySpeed",_.state.userSettings.canopySpeed),Nt("descentRate",_.state.userSettings.descentRate),Nt("legHeightDownwind",_.state.userSettings.legHeightDownwind),Nt("legHeightBase",_.state.userSettings.legHeightBase),Nt("legHeightFinal",_.state.userSettings.legHeightFinal),Nt("customLandingDirectionLL",_.state.userSettings.customLandingDirectionLL),Nt("customLandingDirectionRR",_.state.userSettings.customLandingDirectionRR),Nt("lowerLimit",_.state.userSettings.lowerLimit),Nt("upperLimit",_.state.userSettings.upperLimit),Nt("openingAltitude",_.state.userSettings.openingAltitude),Nt("exitAltitude",_.state.userSettings.exitAltitude),Nt("interpStepSelect",_.state.userSettings.interpStep),Nt("aircraftSpeedKt",_.state.userSettings.aircraftSpeedKt),Nt("jumpRunTrackOffset",_.state.userSettings.jumpRunTrackOffset),Nt("numberOfJumpers",_.state.userSettings.numberOfJumpers),$n("showTableCheckbox",_.state.userSettings.showTable),$n("calculateJumpCheckbox",_.state.userSettings.calculateJump),$n("showLandingPattern",_.state.userSettings.showLandingPattern),$n("showJumpRunTrack",_.state.userSettings.showJumpRunTrack),$n("showCanopyAreaCheckbox",_.state.userSettings.showCanopyArea),$n("showExitAreaCheckbox",_.state.userSettings.showExitArea),_.state.userSettings.isCustomJumpRunDirection=_.state.userSettings.isCustomJumpRunDirection||!1;const n=document.getElementById("customLandingDirectionLL"),e=document.getElementById("customLandingDirectionRR");n&&_.state.userSettings.customLandingDirectionLL!==""&&!isNaN(_.state.userSettings.customLandingDirectionLL)&&(n.value=_.state.userSettings.customLandingDirectionLL),e&&_.state.userSettings.customLandingDirectionRR!==""&&!isNaN(_.state.userSettings.customLandingDirectionRR)&&(e.value=_.state.userSettings.customLandingDirectionRR);const a=Br(_.state.userSettings.aircraftSpeedKt);Nt("jumperSeparation",a),_.state.userSettings.jumperSeparation=a,_.save();const o=document.getElementById("showLandingPattern"),s=document.getElementById("calculateJumpCheckbox");o&&(o.title=_.isFeatureUnlocked("landingPattern")&&_.state.isLandingPatternUnlocked?"":"Feature locked. Click to enter password.",o.style.opacity=_.isFeatureUnlocked("landingPattern")&&_.state.isLandingPatternUnlocked?"1":"0.5",console.log("Initialized showLandingPattern UI:",{checked:o.checked,opacity:o.style.opacity})),s&&(s.title=_.isFeatureUnlocked("calculateJump")&&_.state.isCalculateJumpUnlocked?"":"Feature locked. Click to enter password.",s.style.opacity=_.isFeatureUnlocked("calculateJump")&&_.state.isCalculateJumpUnlocked?"1":"0.5",console.log("Initialized calculateJumpCheckbox UI:",{checked:s.checked,opacity:s.style.opacity}));const l=document.getElementById("showJumpMasterLine");l&&(l.disabled=!_.state.userSettings.trackPosition,l.style.opacity=l.disabled?"0.5":"1",l.title=l.disabled?"Enable Live Tracking to use Jump Master Line":"");const c=document.getElementById("jumpRunTrackDirection");c&&(c.textContent="-"),cc()}function cc(){const n=document.getElementById("info");n&&(n.style.display=_.state.userSettings.showTable?"block":"none");const e=document.getElementById("customLandingDirectionLL"),a=document.getElementById("customLandingDirectionRR"),o=document.getElementById("showJumpRunTrack"),s=document.getElementById("showExitAreaCheckbox");e&&(e.disabled=_.state.userSettings.landingDirection!=="LL"),a&&(a.disabled=_.state.userSettings.landingDirection!=="RR"),o&&(o.disabled=!_.state.userSettings.calculateJump),s&&(s.disabled=!_.state.userSettings.calculateJump),_.updateUnitLabels()}async function uc(n){u.weatherData=n;const e=document.getElementById("timeSlider");if(!e)return;const o=(d=>{const f=d==null?void 0:d.temperature_2m;if(!f||f.length===0)return 0;for(let p=f.length-1;p>=0;p--)if(f[p]!==null&&f[p]!==void 0)return p;return 0})(n);console.log(`Daten sind gültig bis Index: ${o}. Setze Slider-Maximum.`),e.max=o,e.disabled=e.max<=0;const s=new Date().getTime();let l=0,c=1/0;n.time.forEach((d,f)=>{if(f<=o){const p=Math.abs(new Date(d).getTime()-s);p<c&&(c=p,l=f)}}),e.value=l,await le(),_.updateModelRunInfo(u.lastModelRun,u.lastLat,u.lastLng)}async function le(){console.log("updateAllDisplays called");try{const n=ze();u.weatherData&&u.lastLat&&u.lastLng&&(await Ea(n),await Pa(),u.lastAltitude!=="N/A"&&Mi(),sn(),_.state.userSettings.calculateJump&&he(),_.state.userSettings.showJumpRunTrack&&Jt())}catch(n){console.error("Error in updateAllDisplays:",n),Gn(n.message)}}function $n(n,e){const a=document.getElementById(n);a&&(a.checked=e)}function lm(n,e){const a=document.getElementById(n);a?a.value=e:console.warn(`Element ${n} not found`)}function Nt(n,e){const a=document.getElementById(n);a&&(a.value=e)}function Rr(n,e){const a=document.getElementById(n);if(a){const o=a.value;a.value=e,console.log(`Set ${n} silently:`,{old:o,new:e})}}function tn(n,e){const a=document.querySelector(`input[name="${n}"][value="${e}"]`);a?a.checked=!0:console.warn(`Radio ${n} with value ${e} not found`)}function cm(){console.log("[App] Setting up application event listeners..."),document.addEventListener("tracking:started",()=>{const n=document.getElementById("showJumpMasterLine");n&&(n.disabled=!1,n.style.opacity="1",n.title="")}),document.addEventListener("tracking:stopped",()=>{const n=document.getElementById("showJumpMasterLine");n&&(n.checked=!1,n.disabled=!0,n.style.opacity="0.5",n.title="Enable Live Tracking to use Jump Master Line"),_.state.userSettings.showJumpMasterLine&&(_.state.userSettings.showJumpMasterLine=!1,_.save()),Ve()}),document.addEventListener("ui:showJumpMasterLineChanged",()=>{Ve()}),document.addEventListener("jml:targetChanged",()=>{Ve()}),document.addEventListener("tracking:positionUpdated",n=>{Ve(n.detail)})}document.addEventListener("DOMContentLoaded",async()=>{sm(),rm(),await Jd(),cm(),Rf(),em(),tc(),document.addEventListener("cutaway:marker_placed",()=>{console.log("App: Event 'cutaway:marker_placed' empfangen. Neuberechnung wird ausgelöst."),u.weatherData&&u.lastLat&&u.lastLng&&he()}),document.addEventListener("track:dragend",n=>{console.log("App: Event 'track:dragend' empfangen. Neuberechnung der Offsets relativ zum DIP.");const{newPosition:e,originalTrackData:a}=n.detail,o=K.latLng(u.lastLat,u.lastLng),s=a.trackLength,l=a.airplane.bearing,c=e,[d,f]=T.calculateNewCenter(c.lat,c.lng,s/2,(l+180)%360),p=K.latLng(d,f),g=u.map.distance(o,p);let v=T.calculateBearing(o.lat,o.lng,p.lat,p.lng)-l;v=(v+180)%360-180;const M=v*(Math.PI/180),b=Math.round(g*Math.cos(M)),S=Math.round(g*Math.sin(M));_.state.userSettings.jumpRunTrackOffset=S,_.state.userSettings.jumpRunTrackForwardOffset=b,_.save(),Rr("jumpRunTrackOffset",S),Rr("jumpRunTrackForwardOffset",b),Jt()}),document.addEventListener("location:selected",async n=>{var l,c;const{lat:e,lng:a,source:o}=n.detail;console.log(`App: Event 'location:selected' empfangen. Quelle: ${o}`);const s=document.getElementById("loading");s&&(s.style.display="block");try{const d=ze(),f=((c=(l=u.weatherData)==null?void 0:l.time)==null?void 0:c[d])||null,p=await Ln(e,a,f);p?await uc(p):u.weatherData=null,await ka(e,a),await Pa(),Vn(!0),u.isManualPanning=!1,_.state.userSettings.showJumpMasterLine&&Ve()}catch(d){console.error('Fehler beim Verarbeiten von "location:selected":',d),Gn(d.message)}finally{s&&(s.style.display="none")}}),document.addEventListener("map:zoomend",n=>{console.log("App: Event 'map:zoomend' empfangen.");const e=u.map.getZoom();_.state.userSettings.calculateJump&&u.weatherData&&u.lastLat&&(e>=we.MIN_ZOOM&&e<=we.MAX_ZOOM?he():ha(null)),_.state.userSettings.showJumpRunTrack&&(e>=we.MIN_ZOOM&&e<=we.MAX_ZOOM?Jt():da(null)),_.state.userSettings.showLandingPattern&&sn()}),document.addEventListener("autoupdate:tick",async n=>{if(!_.state.userSettings.autoupdate)return;const e=new Date,a=document.getElementById("timeSlider");if(!a)return;const o=e.getUTCHours(),s=parseInt(a.value,10);(o!==s||n.detail.isInitialTick)&&(console.log(`[App] Autoupdate triggered. Current Hour: ${o}, Slider Hour: ${s}`),await im())})})});export default um();
